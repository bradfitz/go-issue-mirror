{
	"id": 118288501,
	"number": 13362,
	"state": "closed",
	"title": "runtime: TestStackBarrierProfiling missed stack barrier",
	"body": "Found while stress testing TestStackBarrierProfiling at 54bd5a7 on master linux/amd64:\r\n\r\n```\r\n--- FAIL: TestStackBarrierProfiling (4.94s)\r\n\tpprof_test.go:342: subprocess failed with exit status 2:\r\n\t\tfound next stack barrier at 0xc82043d798; expected [*0xc820455798=0x48d610 *0xc8204557d0=0x48d610 *0xc820455808=0x48d610 *0xc820455840=0x48d610 *0xc820455878=0x48d610 *0xc8204558b0=0x48d610 *0xc8204558e8=0x48d610 *0xc820455920=0x48d610 *0xc820455958=0x48d610 *0xc820455990=0x48d610 *0xc8204559c8=0x48d610 *0xc820455a00=0x48d610 *0xc820455a38=0x48d610 *0xc820455a70=0x48d610 *0xc820455aa8=0x48d610 *0xc820455ae0=0x48d610 *0xc820455b18=0x48d610 *0xc820455b50=0x48d610 *0xc820455b88=0x48d610 *0xc820455bc0=0x48f5b4 *0xc820455bf0=0x48bb53 *0xc820455e48=0x48d564 *0xc820455f90=0x47c098 *0xc820455fc8=0x45bba1]\r\n\t\tfatal error: missed stack barrier\r\n\t\t\r\n\t\tgoroutine 0 [idle]:\r\n\t\truntime.throw(0x5f1140, 0x14)\r\n\t\t\t/home/austin/go.dev/src/runtime/panic.go:530 +0x90 fp=0xc8200b74b0 sp=0xc8200b7498\r\n\t\truntime.gentraceback(0x419e66, 0xc8200c0e90, 0x0, 0xc820092180, 0x0, 0xc8200b7778, 0x40, 0x0, 0x0, 0x6, ...)\r\n\t\t\t/home/austin/go.dev/src/runtime/traceback.go:293 +0x13c9 fp=0xc8200b7708 sp=0xc8200b74b0\r\n\t\truntime.sigprof(0x419e66, 0xc8200c0e90, 0x0, 0xc820092180, 0xc82008a400)\r\n\t\t\t/home/austin/go.dev/src/runtime/proc.go:2940 +0x533 fp=0xc8200b79d8 sp=0xc8200b7708\r\n\t\truntime.sighandler(0xc80000001b, 0xc8200b7bf0, 0xc8200b7ac0, 0xc820092180)\r\n\t\t\t/home/austin/go.dev/src/runtime/signal_amd64x.go:48 +0xbe fp=0xc8200b7a70 sp=0xc8200b79d8\r\n\t\truntime.sigtrampgo(0x1b, 0xc8200b7bf0, 0xc8200b7ac0)\r\n\t\t\t/home/austin/go.dev/src/runtime/signal_linux.go:21 +0x95 fp=0xc8200b7aa0 sp=0xc8200b7a70\r\n\t\truntime.sigtramp(0x1, 0x0, 0xc8200b4000, 0x0, 0x4000, 0xe, 0x6b5a20, 0x0, 0x212, 0x1000, ...)\r\n\t\t\t/home/austin/go.dev/src/runtime/sys_linux_amd64.s:234 +0x1b fp=0xc8200b7ac0 sp=0xc8200b7aa0\r\n\t\truntime.sigreturn(0x0, 0xc8200b4000, 0x0, 0x4000, 0xe, 0x6b5a20, 0x0, 0x212, 0x1000, 0x400, ...)\r\n\t\t\t/home/austin/go.dev/src/runtime/sys_linux_amd64.s:238 fp=0xc8200b7ac8 sp=0xc8200b7ac0\r\n\t\t\r\n\t\tgoroutine 9 [garbage collection]:\r\n\t\truntime.systemstack_switch()\r\n\t\t\t/home/austin/go.dev/src/runtime/asm_amd64.s:245 fp=0xc8204552b8 sp=0xc8204552b0\r\n\t\truntime.gcMarkTermination()\r\n\t\t\t/home/austin/go.dev/src/runtime/mgc.go:1164 +0x136 fp=0xc820455508 sp=0xc8204552b8\r\n\t\truntime.gcMarkDone()\r\n\t\t\t/home/austin/go.dev/src/runtime/mgc.go:1128 +0x262 fp=0xc820455528 sp=0xc820455508\r\n\t\truntime.gcMarkDone()\r\n\t\t\t/home/austin/go.dev/src/runtime/mgc.go:1095 +0x1f0 fp=0xc820455548 sp=0xc820455528\r\n\t\truntime.gcAssistAlloc(0xc820001980)\r\n\t\t\t/home/austin/go.dev/src/runtime/mgcmark.go:428 +0x18c fp=0xc8204555c8 sp=0xc820455548\r\n\t\truntime.mallocgc(0x400, 0x553360, 0xc800000001, 0x0)\r\n\t\t\t/home/austin/go.dev/src/runtime/malloc.go:533 +0x184 fp=0xc8204556a0 sp=0xc8204555c8\r\n\t\truntime.newarray(0x553360, 0x400, 0xc820102000)\r\n\t\t\t/home/austin/go.dev/src/runtime/malloc.go:795 +0xc9 fp=0xc8204556e0 sp=0xc8204556a0\r\n\t\truntime.makeslice(0x54a6c0, 0x400, 0x400, 0x0, 0x0, 0x0)\r\n\t\t\t/home/austin/go.dev/src/runtime/slice.go:32 +0x165 fp=0xc820455730 sp=0xc8204556e0\r\n\t\truntime/pprof_test.deepStack(0x3d4, 0xc820102000)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:372 +0x52 fp=0xc820455768 sp=0xc820455730\r\n\t\truntime/pprof_test.deepStack(0x3d5, 0xc820100000)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc8204557a0 sp=0xc820455768\r\n\t\truntime/pprof_test.deepStack(0x3d6, 0x400)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc8204557d8 sp=0xc8204557a0\r\n\t\truntime/pprof_test.deepStack(0x3d7, 0x400)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc820455810 sp=0xc8204557d8\r\n\t\truntime/pprof_test.deepStack(0x3d8, 0x400)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc820455848 sp=0xc820455810\r\n\t\truntime/pprof_test.deepStack(0x3d9, 0x400)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc820455880 sp=0xc820455848\r\n\t\truntime/pprof_test.deepStack(0x3da, 0x400)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc8204558b8 sp=0xc820455880\r\n\t\truntime/pprof_test.deepStack(0x3db, 0x400)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc8204558f0 sp=0xc8204558b8\r\n\t\truntime/pprof_test.deepStack(0x3dc, 0x400)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc820455928 sp=0xc8204558f0\r\n\t\truntime/pprof_test.deepStack(0x3dd, 0x400)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc820455960 sp=0xc820455928\r\n\t\truntime/pprof_test.deepStack(0x3de, 0x400)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc820455998 sp=0xc820455960\r\n\t\truntime/pprof_test.deepStack(0x3df, 0x400)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc8204559d0 sp=0xc820455998\r\n\t\truntime/pprof_test.deepStack(0x3e0, 0x400)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc820455a08 sp=0xc8204559d0\r\n\t\truntime/pprof_test.deepStack(0x3e1, 0x400)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc820455a40 sp=0xc820455a08\r\n\t\truntime/pprof_test.deepStack(0x3e2, 0x400)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc820455a78 sp=0xc820455a40\r\n\t\truntime/pprof_test.deepStack(0x3e3, 0x400)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc820455ab0 sp=0xc820455a78\r\n\t\truntime/pprof_test.deepStack(0x3e4, 0x400)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc820455ae8 sp=0xc820455ab0\r\n\t\truntime/pprof_test.deepStack(0x3e5, 0x400)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc820455b20 sp=0xc820455ae8\r\n\t\truntime/pprof_test.deepStack(0x3e6, 0x400)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc820455b58 sp=0xc820455b20\r\n\t\truntime/pprof_test.deepStack(0x3e7, 0x400)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc820455b90 sp=0xc820455b58\r\n\t\truntime/pprof_test.deepStack(0x3e8, 0x0)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:373 +0x90 fp=0xc820455bc8 sp=0xc820455b90\r\n\t\truntime/pprof_test.TestStackBarrierProfiling.func1()\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:356 +0x54 fp=0xc820455bf8 sp=0xc820455bc8\r\n\t\truntime/pprof_test.testCPUProfile(0xc8200a6000, 0x0, 0x0, 0x0, 0xc820455e90)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:145 +0x1a3 fp=0xc820455e50 sp=0xc820455bf8\r\n\t\truntime/pprof_test.TestStackBarrierProfiling(0xc8200a6000)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof_test.go:363 +0x564 fp=0xc820455f98 sp=0xc820455e50\r\n\t\ttesting.tRunner(0xc8200a6000, 0x6ba4b0)\r\n\t\t\t/home/austin/go.dev/src/testing/testing.go:456 +0x98 fp=0xc820455fd0 sp=0xc820455f98\r\n\t\truntime.goexit()\r\n\t\t\t/home/austin/go.dev/src/runtime/asm_amd64.s:1988 +0x1 fp=0xc820455fd8 sp=0xc820455fd0\r\n\t\tcreated by testing.RunTests\r\n\t\t\t/home/austin/go.dev/src/testing/testing.go:565 +0x879\r\n\t\t\r\n\t\tgoroutine 1 [chan receive]:\r\n\t\truntime.gopark(0x618fe0, 0xc820066238, 0x5d1910, 0xc, 0x17, 0x3)\r\n\t\t\t/home/austin/go.dev/src/runtime/proc.go:206 +0x163 fp=0xc8200b2ba0 sp=0xc8200b2b78\r\n\t\truntime.goparkunlock(0xc820066238, 0x5d1910, 0xc, 0x7fd062ba5017, 0x3)\r\n\t\t\t/home/austin/go.dev/src/runtime/proc.go:212 +0x54 fp=0xc8200b2bd8 sp=0xc8200b2ba0\r\n\t\truntime.chanrecv(0x54ab40, 0xc8200661e0, 0xc8200b2db8, 0xc820053c01, 0x470000)\r\n\t\t\t/home/austin/go.dev/src/runtime/chan.go:470 +0x49f fp=0xc8200b2c60 sp=0xc8200b2bd8\r\n\t\truntime.chanrecv1(0x54ab40, 0xc8200661e0, 0xc8200b2db8)\r\n\t\t\t/home/austin/go.dev/src/runtime/chan.go:355 +0x2b fp=0xc8200b2c90 sp=0xc8200b2c60\r\n\t\ttesting.RunTests(0x618c48, 0x6ba420, 0x8, 0x8, 0x7fd000000001)\r\n\t\t\t/home/austin/go.dev/src/testing/testing.go:566 +0x8b9 fp=0xc8200b2e10 sp=0xc8200b2c90\r\n\t\ttesting.(*M).Run(0xc8200b2f38, 0x408e2d)\r\n\t\t\t/home/austin/go.dev/src/testing/testing.go:498 +0x81 fp=0xc8200b2e98 sp=0xc8200b2e10\r\n\t\tmain.main()\r\n\t\t\truntime/pprof/_test/_testmain.go:70 +0x117 fp=0xc8200b2f90 sp=0xc8200b2e98\r\n\t\truntime.main()\r\n\t\t\t/home/austin/go.dev/src/runtime/proc.go:132 +0x2b0 fp=0xc8200b2fe0 sp=0xc8200b2f90\r\n\t\truntime.goexit()\r\n\t\t\t/home/austin/go.dev/src/runtime/asm_amd64.s:1988 +0x1 fp=0xc8200b2fe8 sp=0xc8200b2fe0\r\n\t\t\r\n\t\tgoroutine 2 [force gc (idle)]:\r\n\t\truntime.gopark(0x618fe0, 0x6bc8e0, 0x5d2330, 0xf, 0x14, 0x1)\r\n\t\t\t/home/austin/go.dev/src/runtime/proc.go:206 +0x163 fp=0xc82002e378 sp=0xc82002e350\r\n\t\truntime.goparkunlock(0x6bc8e0, 0x5d2330, 0xf, 0xc820000114, 0x1)\r\n\t\t\t/home/austin/go.dev/src/runtime/proc.go:212 +0x54 fp=0xc82002e3b0 sp=0xc82002e378\r\n\t\truntime.forcegchelper()\r\n\t\t\t/home/austin/go.dev/src/runtime/proc.go:173 +0xb8 fp=0xc82002e3e0 sp=0xc82002e3b0\r\n\t\truntime.goexit()\r\n\t\t\t/home/austin/go.dev/src/runtime/asm_amd64.s:1988 +0x1 fp=0xc82002e3e8 sp=0xc82002e3e0\r\n\t\tcreated by runtime.init.4\r\n\t\t\t/home/austin/go.dev/src/runtime/proc.go:162 +0x2b\r\n\t\t\r\n\t\tgoroutine 3 [GC sweep wait]:\r\n\t\truntime.gopark(0x618fe0, 0x6bca60, 0x5cf670, 0xd, 0x44f614, 0x1)\r\n\t\t\t/home/austin/go.dev/src/runtime/proc.go:206 +0x163 fp=0xc82004a768 sp=0xc82004a740\r\n\t\truntime.goparkunlock(0x6bca60, 0x5cf670, 0xd, 0x14, 0x1)\r\n\t\t\t/home/austin/go.dev/src/runtime/proc.go:212 +0x54 fp=0xc82004a7a0 sp=0xc82004a768\r\n\t\truntime.bgsweep(0xc8200180e0)\r\n\t\t\t/home/austin/go.dev/src/runtime/mgcsweep.go:79 +0x14d fp=0xc82004a7d8 sp=0xc82004a7a0\r\n\t\truntime.goexit()\r\n\t\t\t/home/austin/go.dev/src/runtime/asm_amd64.s:1988 +0x1 fp=0xc82004a7e0 sp=0xc82004a7d8\r\n\t\tcreated by runtime.gcenable\r\n\t\t\t/home/austin/go.dev/src/runtime/mgc.go:191 +0x53\r\n\t\t\r\n\t\tgoroutine 7 [GC worker (idle)]:\r\n\t\truntime.gopark(0x618e80, 0xc820034c00, 0x5ebbe0, 0x10, 0x14, 0x0)\r\n\t\t\t/home/austin/go.dev/src/runtime/proc.go:206 +0x163 fp=0xc8200d5768 sp=0xc8200d5740\r\n\t\truntime.gcBgMarkWorker(0xc820026000)\r\n\t\t\t/home/austin/go.dev/src/runtime/mgc.go:1369 +0x12c fp=0xc8200d57d8 sp=0xc8200d5768\r\n\t\truntime.goexit()\r\n\t\t\t/home/austin/go.dev/src/runtime/asm_amd64.s:1988 +0x1 fp=0xc8200d57e0 sp=0xc8200d57d8\r\n\t\tcreated by runtime.gcBgMarkStartWorkers\r\n\t\t\t/home/austin/go.dev/src/runtime/mgc.go:1316 +0x93\r\n\t\t\r\n\t\tgoroutine 8 [finalizer wait]:\r\n\t\truntime.gopark(0x618fe0, 0x6d79a8, 0x5d1f90, 0xe, 0x14, 0x1)\r\n\t\t\t/home/austin/go.dev/src/runtime/proc.go:206 +0x163 fp=0xc820030b38 sp=0xc820030b10\r\n\t\truntime.goparkunlock(0x6d79a8, 0x5d1f90, 0xe, 0x14, 0x1)\r\n\t\t\t/home/austin/go.dev/src/runtime/proc.go:212 +0x54 fp=0xc820030b70 sp=0xc820030b38\r\n\t\truntime.runfinq()\r\n\t\t\t/home/austin/go.dev/src/runtime/mfinal.go:158 +0xaa fp=0xc820030be0 sp=0xc820030b70\r\n\t\truntime.goexit()\r\n\t\t\t/home/austin/go.dev/src/runtime/asm_amd64.s:1988 +0x1 fp=0xc820030be8 sp=0xc820030be0\r\n\t\tcreated by runtime.createfing\r\n\t\t\t/home/austin/go.dev/src/runtime/mfinal.go:139 +0x60\r\n\t\t\r\n\t\tgoroutine 10 [syscall]:\r\n\t\truntime.notetsleepg(0x7fd0627c4008, 0xffffffffffffffff, 0xc8200a6000)\r\n\t\t\t/home/austin/go.dev/src/runtime/lock_futex.go:205 +0x4e fp=0xc820046640 sp=0xc820046618\r\n\t\truntime.(*cpuProfile).getprofile(0x7fd0627c4000, 0x0, 0x0, 0x0)\r\n\t\t\t/home/austin/go.dev/src/runtime/cpuprof.go:341 +0x5dd fp=0xc820046748 sp=0xc820046640\r\n\t\truntime.CPUProfile(0x0, 0x0, 0x0)\r\n\t\t\t/home/austin/go.dev/src/runtime/cpuprof.go:421 +0x34 fp=0xc820046770 sp=0xc820046748\r\n\t\truntime/pprof.profileWriter(0x7fd062b5b580, 0xc8200aa000)\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof.go:599 +0x1c fp=0xc8200467d0 sp=0xc820046770\r\n\t\truntime.goexit()\r\n\t\t\t/home/austin/go.dev/src/runtime/asm_amd64.s:1988 +0x1 fp=0xc8200467d8 sp=0xc8200467d0\r\n\t\tcreated by runtime/pprof.StartCPUProfile\r\n\t\t\t/home/austin/go.dev/src/runtime/pprof/pprof.go:593 +0x145\r\n\t\t\r\n\t\tgoroutine 11 [syscall]:\r\n\t\truntime.notetsleepg(0x6bcad8, 0x129f39f59, 0x0)\r\n\t\t\t/home/austin/go.dev/src/runtime/lock_futex.go:205 +0x4e fp=0xc82002c358 sp=0xc82002c330\r\n\t\truntime.timerproc()\r\n\t\t\t/home/austin/go.dev/src/runtime/time.go:209 +0xde fp=0xc82002c3e0 sp=0xc82002c358\r\n\t\truntime.goexit()\r\n\t\t\t/home/austin/go.dev/src/runtime/asm_amd64.s:1988 +0x1 fp=0xc82002c3e8 sp=0xc82002c3e0\r\n\t\tcreated by runtime.addtimerLocked\r\n\t\t\t/home/austin/go.dev/src/runtime/time.go:116 +0x11f\r\n\t\t\r\n\t\tgoroutine 14 [GC worker (idle)]:\r\n\t\truntime.gopark(0x618e80, 0xc82008a400, 0x5ebbe0, 0x10, 0x14, 0x0)\r\n\t\t\t/home/austin/go.dev/src/runtime/proc.go:206 +0x163 fp=0xc8200d7768 sp=0xc8200d7740\r\n\t\truntime.gcBgMarkWorker(0xc820023500)\r\n\t\t\t/home/austin/go.dev/src/runtime/mgc.go:1369 +0x12c fp=0xc8200d77d8 sp=0xc8200d7768\r\n\t\truntime.goexit()\r\n\t\t\t/home/austin/go.dev/src/runtime/asm_amd64.s:1988 +0x1 fp=0xc8200d77e0 sp=0xc8200d77d8\r\n\t\tcreated by runtime.gcBgMarkStartWorkers\r\n\t\t\t/home/austin/go.dev/src/runtime/mgc.go:1316 +0x93\r\n\t\t\r\n\t\tgoroutine 17 [GC worker (idle)]:\r\n\t\truntime.gopark(0x618e80, 0xc8200ce400, 0x5ebbe0, 0x10, 0x48d514, 0x0)\r\n\t\t\t/home/austin/go.dev/src/runtime/proc.go:206 +0x163 fp=0xc82004b768 sp=0xc82004b740\r\n\t\truntime.gcBgMarkWorker(0xc820022000)\r\n\t\t\t/home/austin/go.dev/src/runtime/mgc.go:1369 +0x12c fp=0xc82004b7d8 sp=0xc82004b768\r\n\t\truntime.goexit()\r\n\t\t\t/home/austin/go.dev/src/runtime/asm_amd64.s:1988 +0x1 fp=0xc82004b7e0 sp=0xc82004b7d8\r\n\t\tcreated by runtime.gcBgMarkStartWorkers\r\n\t\t\t/home/austin/go.dev/src/runtime/mgc.go:1316 +0x93\r\n\t\t\r\n\t\tgoroutine 18 [GC worker (idle)]:\r\n\t\truntime.gopark(0x618e80, 0xc820034800, 0x5ebbe0, 0x10, 0x48d514, 0x0)\r\n\t\t\t/home/austin/go.dev/src/runtime/proc.go:206 +0x163 fp=0xc82004c768 sp=0xc82004c740\r\n\t\truntime.gcBgMarkWorker(0xc820024a00)\r\n\t\t\t/home/austin/go.dev/src/runtime/mgc.go:1369 +0x12c fp=0xc82004c7d8 sp=0xc82004c768\r\n\t\truntime.goexit()\r\n\t\t\t/home/austin/go.dev/src/runtime/asm_amd64.s:1988 +0x1 fp=0xc82004c7e0 sp=0xc82004c7d8\r\n\t\tcreated by runtime.gcBgMarkStartWorkers\r\n\t\t\t/home/austin/go.dev/src/runtime/mgc.go:1316 +0x93\r\nFAIL\r\n```",
	"user": {
		"login": "aclements",
		"id": 2688315,
		"type": "User",
		"site_admin": false
	},
	"assignee": {
		"login": "aclements",
		"id": 2688315,
		"type": "User",
		"site_admin": false
	},
	"comments": 8,
	"closed_at": "2015-11-24T01:51:12Z",
	"created_at": "2015-11-22T21:07:07Z",
	"updated_at": "2015-11-24T02:00:29Z",
	"milestone": {
		"id": 1096159,
		"number": 24,
		"title": "Go1.6"
	}
}
