{
	"id": 51288538,
	"number": 8678,
	"state": "closed",
	"title": "runtime: badm onM panic loop or stacktrace",
	"body": "\u003cpre\u003eI just had an in-development test hang in my client synced to 428dd5a62a9d+ and upon\nsending SIGQUIT saw this suspicious stack trace:\n\n$ go test -v -run=DialTLS\n=== RUN TestTransportDialTLS\n`\\^[\\\\`\\\n^\\runtime: newstack called from g=0xc208002000\n\tm=0x5ef5c0 m-\u0026gt;curg=0x0 m-\u0026gt;g0=0x5eef80 m-\u0026gt;gsignal=0xc208002000\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:222 +0x32 fp=0xc208004200 sp=0xc2080041f8\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc208004210 sp=0xc208004200\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc208004228 sp=0xc208004210\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc208004240 sp=0xc208004228\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc208004248 sp=0xc208004240\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc208004258 sp=0xc208004248\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc208004270 sp=0xc208004258\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc208004288 sp=0xc208004270\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc208004290 sp=0xc208004288\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc2080042a0 sp=0xc208004290\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc2080042b8 sp=0xc2080042a0\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc2080042d0 sp=0xc2080042b8\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc2080042d8 sp=0xc2080042d0\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc2080042e8 sp=0xc2080042d8\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc208004300 sp=0xc2080042e8\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc208004318 sp=0xc208004300\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc208004320 sp=0xc208004318\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc208004330 sp=0xc208004320\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc208004348 sp=0xc208004330\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc208004360 sp=0xc208004348\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc208004368 sp=0xc208004360\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc208004378 sp=0xc208004368\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc208004390 sp=0xc208004378\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc2080043a8 sp=0xc208004390\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc2080043b0 sp=0xc2080043a8\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc2080043c0 sp=0xc2080043b0\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc2080043d8 sp=0xc2080043c0\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc2080043f0 sp=0xc2080043d8\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc2080043f8 sp=0xc2080043f0\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc208004408 sp=0xc2080043f8\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc208004420 sp=0xc208004408\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc208004438 sp=0xc208004420\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc208004440 sp=0xc208004438\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc208004450 sp=0xc208004440\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc208004468 sp=0xc208004450\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc208004480 sp=0xc208004468\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc208004488 sp=0xc208004480\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc208004498 sp=0xc208004488\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc2080044b0 sp=0xc208004498\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc2080044c8 sp=0xc2080044b0\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc2080044d0 sp=0xc2080044c8\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc2080044e0 sp=0xc2080044d0\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc2080044f8 sp=0xc2080044e0\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc208004510 sp=0xc2080044f8\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc208004518 sp=0xc208004510\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc208004528 sp=0xc208004518\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc208004540 sp=0xc208004528\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc208004558 sp=0xc208004540\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc208004560 sp=0xc208004558\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc208004570 sp=0xc208004560\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc208004588 sp=0xc208004570\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc2080045a0 sp=0xc208004588\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc2080045a8 sp=0xc2080045a0\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc2080045b8 sp=0xc2080045a8\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc2080045d0 sp=0xc2080045b8\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc2080045e8 sp=0xc2080045d0\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc2080045f0 sp=0xc2080045e8\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc208004600 sp=0xc2080045f0\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc208004618 sp=0xc208004600\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc208004630 sp=0xc208004618\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc208004638 sp=0xc208004630\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc208004648 sp=0xc208004638\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc208004660 sp=0xc208004648\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc208004678 sp=0xc208004660\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc208004680 sp=0xc208004678\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc208004690 sp=0xc208004680\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc2080046a8 sp=0xc208004690\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc2080046c0 sp=0xc2080046a8\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc2080046c8 sp=0xc2080046c0\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc2080046d8 sp=0xc2080046c8\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc2080046f0 sp=0xc2080046d8\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc208004708 sp=0xc2080046f0\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc208004710 sp=0xc208004708\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc208004720 sp=0xc208004710\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc208004738 sp=0xc208004720\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc208004750 sp=0xc208004738\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc208004758 sp=0xc208004750\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc208004768 sp=0xc208004758\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc208004780 sp=0xc208004768\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc208004798 sp=0xc208004780\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc2080047a0 sp=0xc208004798\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc2080047b0 sp=0xc2080047a0\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc2080047c8 sp=0xc2080047b0\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc2080047e0 sp=0xc2080047c8\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc2080047e8 sp=0xc2080047e0\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc2080047f8 sp=0xc2080047e8\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc208004810 sp=0xc2080047f8\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc208004828 sp=0xc208004810\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc208004830 sp=0xc208004828\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc208004840 sp=0xc208004830\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc208004858 sp=0xc208004840\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc208004870 sp=0xc208004858\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc208004878 sp=0xc208004870\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc208004888 sp=0xc208004878\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc2080048a0 sp=0xc208004888\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc2080048b8 sp=0xc2080048a0\nruntime.onM(0x4a46f0)\n\t/Users/bradfitz/go/src/pkg/runtime/asm_amd64.s:217 +0x32 fp=0xc2080048c0 sp=0xc2080048b8\nruntime.startpanic()\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:143 +0x14 fp=0xc2080048d0 sp=0xc2080048c0\nruntime.gothrow(0x453390, 0x20)\n\t/Users/bradfitz/go/src/pkg/runtime/panic1.go:175 +0x35 fp=0xc2080048e8 sp=0xc2080048d0\nruntime.badonm()\n\t/Users/bradfitz/go/src/pkg/runtime/stubs.go:79 +0x33 fp=0xc208004900 sp=0xc2080048e8\n...additional frames elided...\nfatal error: runtime: wrong goroutine in newstack\u003c/pre\u003e",
	"user": {
		"login": "bradfitz",
		"id": 2621,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"assignee": {
		"login": "rsc",
		"id": 104030,
		"type": "User",
		"site_admin": false
	},
	"comments": 2,
	"closed_at": "2014-12-08T10:48:07Z",
	"created_at": "2014-09-07T16:56:42Z",
	"updated_at": "2016-06-25T01:40:57Z",
	"milestone": {
		"id": 1067218,
		"number": 21,
		"title": "Go1.4"
	}
}
