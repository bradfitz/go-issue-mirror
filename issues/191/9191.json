{
	"id": 51289211,
	"number": 9191,
	"state": "closed",
	"title": "runtime: OpenReader: Invalid heap pointer in both 1.4rc2 and 1.4rc1",
	"body": "by **pruest**:\n\n\u003cpre\u003eWorks in all releases prior to 1.4rc1.\n\nCode base installs, but fails at run time (test or regular execution).\nThe code triggering the problem is attempting to open a binary looking\nfor an embedded zip file. In this case there is no zip file in the binary. \nIn the past an error would have been returned.\n\n    reader, err := zip.OpenReader(programName)  // load.go line 102 in trace below.\n\nExcerpt from full trace below:\n--------------------------------\ngoroutine 5 [garbage collection]:\nruntime.switchtoM()\n\t/usr/local/go/src/runtime/asm_amd64.s:198 fp=0xc20805e8b8 sp=0xc20805e8b0\nruntime.gogc(0x0)\n\t/usr/local/go/src/runtime/malloc.go:469 +0x1cf fp=0xc20805e8f0 sp=0xc20805e8b8\nruntime.mallocgc(0x12000, 0x4158140, 0x1, 0x403dff3)\n\t/usr/local/go/src/runtime/malloc.go:341 +0x391 fp=0xc20805e9a0 sp=0xc20805e8f0\nruntime.newarray(0x4158140, 0x10400, 0x400)\n\t/usr/local/go/src/runtime/malloc.go:365 +0xc1 fp=0xc20805e9d8 sp=0xc20805e9a0\nruntime.makeslice(0x414f980, 0x10400, 0x10400, 0x0, 0x0, 0x0)\n\t/usr/local/go/src/runtime/slice.go:32 +0x15c fp=0xc20805ea20 sp=0xc20805e9d8\narchive/zip.readDirectoryEnd(0x43a4d08, 0xc20802a090, 0x30d1c8, 0x0, 0x0, 0x0)\n\t/usr/local/go/src/archive/zip/reader.go:330 +0x10c fp=0xc20805eb68 sp=0xc20805ea20\narchive/zip.(*Reader).init(0xc20802e588, 0x43a4d08, 0xc20802a090, 0x30d1c8, 0x0, 0x0)\n\t/usr/local/go/src/archive/zip/reader.go:76 +0x65 fp=0xc20805ec58 sp=0xc20805eb68\narchive/zip.OpenReader(0x7fff5fbffa58, 0x5c, 0x0, 0x0, 0x0)\n\t/usr/local/go/src/archive/zip/reader.go:57 +0x1ae fp=0xc20805ecf0 sp=0xc20805ec58\nvu/load.newLoader(0x19)\n\t/Users/rust/code/vu/src/vu/load/load.go:102 +0x28c fp=0xc20805edd0 sp=0xc20805ecf0\n\n\n------------------------------------------------------------------------------------------------------\nFull trace from 1.4rc2\n------------------------------------------------------------------------------------------------------\nruntime: garbage collector found invalid heap pointer *(0xc20805ee48+0x80)=0x18 s=nil\nfatal error: invalid heap pointer\n\nruntime stack:\nruntime.throw(0x42c2f63)\n\t/usr/local/go/src/runtime/panic.go:491 +0xad fp=0x7fff5fbff310 sp=0x7fff5fbff2e0\nscanblock(0xc20805ee48, 0x128, 0x422e178)\n\t/usr/local/go/src/runtime/mgc0.c:378 +0x551 fp=0x7fff5fbff450 sp=0x7fff5fbff310\nscanframe(0x7fff5fbff558, 0x0, 0x101)\n\t/usr/local/go/src/runtime/mgc0.c:719 +0x164 fp=0x7fff5fbff4c0 sp=0x7fff5fbff450\nruntime.gentraceback(0x4039df0, 0xc20805e8b0, 0x0, 0xc208000b40, 0x0, 0x0, 0x7fffffff,\n0x7fff5fbff608, 0x0, 0x0, ...)\n\t/usr/local/go/src/runtime/traceback.go:311 +0x7a8 fp=0x7fff5fbff5b0 sp=0x7fff5fbff4c0\nscanstack(0xc208000b40)\n\t/usr/local/go/src/runtime/mgc0.c:777 +0x21c fp=0x7fff5fbff620 sp=0x7fff5fbff5b0\nmarkroot(0xc208010000, 0x9)\n\t/usr/local/go/src/runtime/mgc0.c:553 +0xe7 fp=0x7fff5fbff680 sp=0x7fff5fbff620\nruntime.parfordo(0xc208010000)\n\t/usr/local/go/src/runtime/parfor.c:76 +0xb2 fp=0x7fff5fbff700 sp=0x7fff5fbff680\ngc(0x7fff5fbff838)\n\t/usr/local/go/src/runtime/mgc0.c:1439 +0x25e fp=0x7fff5fbff818 sp=0x7fff5fbff700\nruntime.gc_m()\n\t/usr/local/go/src/runtime/mgc0.c:1368 +0xe0 fp=0x7fff5fbff850 sp=0x7fff5fbff818\nruntime.onM(0x42e1010)\n\t/usr/local/go/src/runtime/asm_amd64.s:257 +0x68 fp=0x7fff5fbff858 sp=0x7fff5fbff850\nruntime.mstart()\n\t/usr/local/go/src/runtime/proc.c:818 fp=0x7fff5fbff860 sp=0x7fff5fbff858\n\ngoroutine 5 [garbage collection]:\nruntime.switchtoM()\n\t/usr/local/go/src/runtime/asm_amd64.s:198 fp=0xc20805e8b8 sp=0xc20805e8b0\nruntime.gogc(0x0)\n\t/usr/local/go/src/runtime/malloc.go:469 +0x1cf fp=0xc20805e8f0 sp=0xc20805e8b8\nruntime.mallocgc(0x12000, 0x4158140, 0x1, 0x403dff3)\n\t/usr/local/go/src/runtime/malloc.go:341 +0x391 fp=0xc20805e9a0 sp=0xc20805e8f0\nruntime.newarray(0x4158140, 0x10400, 0x400)\n\t/usr/local/go/src/runtime/malloc.go:365 +0xc1 fp=0xc20805e9d8 sp=0xc20805e9a0\nruntime.makeslice(0x414f980, 0x10400, 0x10400, 0x0, 0x0, 0x0)\n\t/usr/local/go/src/runtime/slice.go:32 +0x15c fp=0xc20805ea20 sp=0xc20805e9d8\narchive/zip.readDirectoryEnd(0x43a4d08, 0xc20802a090, 0x30d1c8, 0x0, 0x0, 0x0)\n\t/usr/local/go/src/archive/zip/reader.go:330 +0x10c fp=0xc20805eb68 sp=0xc20805ea20\narchive/zip.(*Reader).init(0xc20802e588, 0x43a4d08, 0xc20802a090, 0x30d1c8, 0x0, 0x0)\n\t/usr/local/go/src/archive/zip/reader.go:76 +0x65 fp=0xc20805ec58 sp=0xc20805eb68\narchive/zip.OpenReader(0x7fff5fbffa58, 0x5c, 0x0, 0x0, 0x0)\n\t/usr/local/go/src/archive/zip/reader.go:57 +0x1ae fp=0xc20805ecf0 sp=0xc20805ec58\nvu/load.newLoader(0x19)\n\t/Users/rust/code/vu/src/vu/load/load.go:102 +0x28c fp=0xc20805edd0 sp=0xc20805ecf0\nvu/load.NewLoader(0x0, 0x0)\n\t/Users/rust/code/vu/src/vu/load/load.go:78 +0x31 fp=0xc20805ee00 sp=0xc20805edd0\nvu/audio.TestAudio(0xc208062000)\n\t/Users/rust/code/vu/src/vu/audio/audio_test.go:15 +0x67 fp=0xc20805ef78 sp=0xc20805ee00\ntesting.tRunner(0xc208062000, 0x42c73a0)\n\t/usr/local/go/src/testing/testing.go:447 +0xbf fp=0xc20805efd0 sp=0xc20805ef78\nruntime.goexit()\n\t/usr/local/go/src/runtime/asm_amd64.s:2232 +0x1 fp=0xc20805efd8 sp=0xc20805efd0\ncreated by testing.RunTests\n\t/usr/local/go/src/testing/testing.go:555 +0xa8b\n\ngoroutine 1 [chan receive]:\nruntime.gopark(0x4032190, 0xc208056238, 0x41ed330, 0xc)\n\t/usr/local/go/src/runtime/proc.go:130 +0x105 fp=0xc208061ba8 sp=0xc208061b78\nruntime.goparkunlock(0xc208056238, 0x41ed330, 0xc)\n\t/usr/local/go/src/runtime/proc.go:136 +0x48 fp=0xc208061bd0 sp=0xc208061ba8\nruntime.chanrecv(0x4150040, 0xc2080561e0, 0xc208061dc0, 0x4058a01, 0x0)\n\t/usr/local/go/src/runtime/chan.go:410 +0x452 fp=0xc208061c70 sp=0xc208061bd0\nruntime.chanrecv1(0x4150040, 0xc2080561e0, 0xc208061dc0)\n\t/usr/local/go/src/runtime/chan.go:311 +0x2b fp=0xc208061ca0 sp=0xc208061c70\ntesting.RunTests(0x4234e10, 0x42c73a0, 0x1, 0x1, 0xee99d9ca48babd01)\n\t/usr/local/go/src/testing/testing.go:556 +0xad6 fp=0xc208061e48 sp=0xc208061ca0\ntesting.(*M).Run(0xc2080300f0, 0x42cc8e0)\n\t/usr/local/go/src/testing/testing.go:485 +0x6c fp=0xc208061ed0 sp=0xc208061e48\nmain.main()\n\tvu/audio/_test/_testmain.go:52 +0x1d5 fp=0xc208061f98 sp=0xc208061ed0\nruntime.main()\n\t/usr/local/go/src/runtime/proc.go:63 +0xf3 fp=0xc208061fe0 sp=0xc208061f98\nruntime.goexit()\n\t/usr/local/go/src/runtime/asm_amd64.s:2232 +0x1 fp=0xc208061fe8 sp=0xc208061fe0\n\ngoroutine 2 [force gc (idle)]:\nruntime.gopark(0x4032190, 0x42e0bb0, 0x41ee7f0, 0xf)\n\t/usr/local/go/src/runtime/proc.go:130 +0x105 fp=0xc20801a798 sp=0xc20801a768\nruntime.goparkunlock(0x42e0bb0, 0x41ee7f0, 0xf)\n\t/usr/local/go/src/runtime/proc.go:136 +0x48 fp=0xc20801a7c0 sp=0xc20801a798\nruntime.forcegchelper()\n\t/usr/local/go/src/runtime/proc.go:99 +0xce fp=0xc20801a7e0 sp=0xc20801a7c0\nruntime.goexit()\n\t/usr/local/go/src/runtime/asm_amd64.s:2232 +0x1 fp=0xc20801a7e8 sp=0xc20801a7e0\ncreated by runtime.initÂ·4\n\t/usr/local/go/src/runtime/proc.go:87 +0x25\n\ngoroutine 3 [GC sweep wait]:\nruntime.gopark(0x4032190, 0x42cccb8, 0x41e8210, 0xd)\n\t/usr/local/go/src/runtime/proc.go:130 +0x105 fp=0xc20801df98 sp=0xc20801df68\nruntime.goparkunlock(0x42cccb8, 0x41e8210, 0xd)\n\t/usr/local/go/src/runtime/proc.go:136 +0x48 fp=0xc20801dfc0 sp=0xc20801df98\nruntime.bgsweep()\n\t/usr/local/go/src/runtime/mgc0.go:98 +0xbc fp=0xc20801dfe0 sp=0xc20801dfc0\nruntime.goexit()\n\t/usr/local/go/src/runtime/asm_amd64.s:2232 +0x1 fp=0xc20801dfe8 sp=0xc20801dfe0\ncreated by gc\n\t/usr/local/go/src/runtime/mgc0.c:1383\n\ngoroutine 4 [finalizer wait]:\nruntime.gopark(0x4032190, 0x42cccb0, 0x41ee0b0, 0xe)\n\t/usr/local/go/src/runtime/proc.go:130 +0x105 fp=0xc208018f30 sp=0xc208018f00\nruntime.goparkunlock(0x42cccb0, 0x41ee0b0, 0xe)\n\t/usr/local/go/src/runtime/proc.go:136 +0x48 fp=0xc208018f58 sp=0xc208018f30\nruntime.runfinq()\n\t/usr/local/go/src/runtime/malloc.go:727 +0xba fp=0xc208018fe0 sp=0xc208018f58\nruntime.goexit()\n\t/usr/local/go/src/runtime/asm_amd64.s:2232 +0x1 fp=0xc208018fe8 sp=0xc208018fe0\ncreated by runtime.createfing\n\t/usr/local/go/src/runtime/malloc.go:707 +0x5e\n\ngoroutine 17 [syscall, locked to thread]:\nruntime.goexit()\n\t/usr/local/go/src/runtime/asm_amd64.s:2232 +0x1 fp=0xc20805dfe8 sp=0xc20805dfe0\u003c/pre\u003e",
	"user": {
		"login": "gopherbot",
		"id": 8566911,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"comments": 6,
	"closed_at": "2014-12-08T10:50:09Z",
	"created_at": "2014-12-02T12:10:06Z",
	"updated_at": "2016-06-25T01:45:13Z",
	"milestone": {
		"id": 1067218,
		"number": 21,
		"title": "Go1.4"
	}
}
