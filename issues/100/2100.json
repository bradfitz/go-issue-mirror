{
	"id": 51278727,
	"number": 2100,
	"state": "closed",
	"title": "Go tests hang after revision 8ea3939bd68a is applied",
	"body": "\u003cpre\u003eWindows XP 32-bit and Windows 7 64-bit\n\n$ env | grep '^GO'\nGOBIN=c:\\go\\bin\nGOARCH=386\nGOMAXPROCS=1\nGOROOT=c:\\go\nGOOS=windows\n\n$ hg id\n8ea3939bd68a\n\nAfter revision 8ea3939bd68a is applied and ./all.bash is run, some tests intermittently\nhang in various places when GOMAXPROCS=1 (the tests pass when GOMAXPROCS=4 on 1+, 2, and\n4 cores). For example,\n\nGo tests hang after revision 8ea3939bd68a is applied\n\nWindows XP 32-bit and Windows 7 64-bit\n\n$ env | grep '^GO'\nGOBIN=c:\\go\\bin\nGOARCH=386\nGOMAXPROCS=1\nGOROOT=c:\\go\nGOOS=windows\n\n$ hg id\n8ea3939bd68a\n\nAfter revision 8ea3939bd68a is applied and ./all.bash is run, some tests intermittently\nhang in various places when GOMAXPROCS=1 (the tests pass when GOMAXPROCS=4 on 1+, 2, and\n4 cores). For example,\n\n$ gotest -v\nrm -f _test/http.a\n8g  -o _gotest_.8 chunked.go client.go cookie.go dump.go fs.go header.go lex.go\npersist.go request.go response.go reverseproxy.go server.go sniff.go status.go t\nransfer.go transport.go url.go  cookie_test.go export_test.go header_test.go lex\n_test.go proxy_test.go range_test.go readrequest_test.go requestwrite_test.go re\nsponse_test.go responsewrite_test.go url_test.go\nrm -f _test/http.a\ngopack grc _test/http.a _gotest_.8\n=== RUN  http_test.TestClient\n--- PASS: http_test.TestClient (0.03 seconds)\n=== RUN  http_test.TestClientHead\n--- PASS: http_test.TestClientHead (0.00 seconds)\n=== RUN  http_test.TestGetRequestFormat\n--- PASS: http_test.TestGetRequestFormat (0.00 seconds)\n=== RUN  http_test.TestPostRequestFormat\n--- PASS: http_test.TestPostRequestFormat (0.00 seconds)\n=== RUN  http_test.TestPostFormRequestFormat\n--- PASS: http_test.TestPostFormRequestFormat (0.00 seconds)\n=== RUN  http_test.TestRedirects\n--- PASS: http_test.TestRedirects (0.05 seconds)\n=== RUN  http_test.TestStreamingGet\n--- PASS: http_test.TestStreamingGet (0.00 seconds)\n=== RUN  http_test.TestClientWrites\n--- PASS: http_test.TestClientWrites (0.00 seconds)\n=== RUN  http.TestWriteSetCookies\n--- PASS: http.TestWriteSetCookies (0.00 seconds)\n=== RUN  http.TestSetCookie\n--- PASS: http.TestSetCookie (0.00 seconds)\n=== RUN  http.TestAddCookie\n--- PASS: http.TestAddCookie (0.00 seconds)\n=== RUN  http.TestReadSetCookies\n--- PASS: http.TestReadSetCookies (0.00 seconds)\n=== RUN  http.TestReadCookies\n--- PASS: http.TestReadCookies (0.02 seconds)\n=== RUN  http_test.TestServeFile\n--- PASS: http_test.TestServeFile (0.02 seconds)\n=== RUN  http_test.TestFileServerCleans\n--- PASS: http_test.TestFileServerCleans (0.00 seconds)\n=== RUN  http_test.TestFileServerImplicitLeadingSlash\n--- PASS: http_test.TestFileServerImplicitLeadingSlash (0.00 seconds)\n=== RUN  http_test.TestDirJoin\n--- PASS: http_test.TestDirJoin (0.00 seconds)\n        skipping test; no /etc/hosts file\n=== RUN  http_test.TestServeFileContentType\n--- PASS: http_test.TestServeFileContentType (0.00 seconds)\n=== RUN  http_test.TestServeFileMimeType\n--- PASS: http_test.TestServeFileMimeType (0.00 seconds)\n=== RUN  http_test.TestServeFileWithContentEncoding\n--- PASS: http_test.TestServeFileWithContentEncoding (0.02 seconds)\n=== RUN  http.TestHeaderWrite\n--- PASS: http.TestHeaderWrite (0.00 seconds)\n=== RUN  http.TestSplitFieldValue\n--- PASS: http.TestSplitFieldValue (0.00 seconds)\n=== RUN  http.TestUseProxy\n--- PASS: http.TestUseProxy (0.00 seconds)\n=== RUN  http.TestParseRange\n--- PASS: http.TestParseRange (0.00 seconds)\n=== RUN  http.TestReadRequest\n--- PASS: http.TestReadRequest (0.02 seconds)\n=== RUN  http_test.TestParseForm\n--- PASS: http_test.TestParseForm (0.00 seconds)\n=== RUN  http_test.TestQuery\n--- PASS: http_test.TestQuery (0.00 seconds)\n=== RUN  http_test.TestPostQuery\n--- PASS: http_test.TestPostQuery (0.00 seconds)\n=== RUN  http_test.TestPostContentTypeParsing\n--- PASS: http_test.TestPostContentTypeParsing (0.00 seconds)\n=== RUN  http_test.TestMultipartReader\n--- PASS: http_test.TestMultipartReader (0.00 seconds)\n=== RUN  http_test.TestRedirect\n--- PASS: http_test.TestRedirect (0.00 seconds)\n=== RUN  http_test.TestSetBasicAuth\n--- PASS: http_test.TestSetBasicAuth (0.00 seconds)\n=== RUN  http_test.TestMultipartRequest\n--- PASS: http_test.TestMultipartRequest (0.02 seconds)\n=== RUN  http_test.TestMultipartRequestAuto\n--- PASS: http_test.TestMultipartRequestAuto (0.00 seconds)\n=== RUN  http_test.TestEmptyMultipartRequest\n--- PASS: http_test.TestEmptyMultipartRequest (0.00 seconds)\n=== RUN  http.TestRequestWrite\n--- PASS: http.TestRequestWrite (0.00 seconds)\n=== RUN  http.TestRequestWriteClosesBody\n--- PASS: http.TestRequestWriteClosesBody (0.00 seconds)\n=== RUN  http.TestReadResponse\n--- PASS: http.TestReadResponse (0.00 seconds)\n=== RUN  http.TestReadResponseCloseInMiddle\n--- PASS: http.TestReadResponseCloseInMiddle (0.45 seconds)\n=== RUN  http.TestResponseWrite\n--- PASS: http.TestResponseWrite (0.00 seconds)\n=== RUN  http_test.TestReverseProxy\n--- PASS: http_test.TestReverseProxy (0.02 seconds)\n=== RUN  http_test.TestConsumingBodyOnNextConn\n--- PASS: http_test.TestConsumingBodyOnNextConn (0.00 seconds)\n=== RUN  http_test.TestHostHandlers\n--- PASS: http_test.TestHostHandlers (0.00 seconds)\n=== RUN  http_test.TestMuxRedirectLeadingSlashes\n--- PASS: http_test.TestMuxRedirectLeadingSlashes (0.00 seconds)\n=== RUN  http_test.TestServerTimeouts\n--- PASS: http_test.TestServerTimeouts (0.28 seconds)\n=== RUN  http_test.TestIdentityResponse\n--- PASS: http_test.TestIdentityResponse (0.00 seconds)\n=== RUN  http_test.TestServeHTTP10Close\n--- PASS: http_test.TestServeHTTP10Close (0.00 seconds)\n=== RUN  http_test.TestHandlersCanSetConnectionClose11\n--- PASS: http_test.TestHandlersCanSetConnectionClose11 (0.00 seconds)\n=== RUN  http_test.TestHandlersCanSetConnectionClose10\n--- PASS: http_test.TestHandlersCanSetConnectionClose10 (0.00 seconds)\n=== RUN  http_test.TestSetsRemoteAddr\n--- PASS: http_test.TestSetsRemoteAddr (0.00 seconds)\n=== RUN  http_test.TestChunkedResponseHeaders\n--- PASS: http_test.TestChunkedResponseHeaders (0.00 seconds)\n=== RUN  http_test.Test304Responses\n--- PASS: http_test.Test304Responses (0.00 seconds)\n=== RUN  http_test.TestHeadResponses\n--- PASS: http_test.TestHeadResponses (0.00 seconds)\n=== RUN  http_test.TestTLSServer\n--- PASS: http_test.TestTLSServer (0.23 seconds)\n=== RUN  http_test.TestServerExpect\n\u0026lt;HANG\u0026gt;\n\n$ gotest -v\nrm -f _test/http.a\nrm -f _test/http.a\ngopack grc _test/http.a _gotest_.8\n=== RUN  http_test.TestClient\n--- PASS: http_test.TestClient (0.02 seconds)\n=== RUN  http_test.TestClientHead\n--- PASS: http_test.TestClientHead (0.00 seconds)\n=== RUN  http_test.TestGetRequestFormat\n--- PASS: http_test.TestGetRequestFormat (0.00 seconds)\n=== RUN  http_test.TestPostRequestFormat\n--- PASS: http_test.TestPostRequestFormat (0.00 seconds)\n=== RUN  http_test.TestPostFormRequestFormat\n--- PASS: http_test.TestPostFormRequestFormat (0.00 seconds)\n=== RUN  http_test.TestRedirects\n--- PASS: http_test.TestRedirects (0.03 seconds)\n=== RUN  http_test.TestStreamingGet\n--- PASS: http_test.TestStreamingGet (0.00 seconds)\n=== RUN  http_test.TestClientWrites\n--- PASS: http_test.TestClientWrites (0.02 seconds)\n=== RUN  http.TestWriteSetCookies\n--- PASS: http.TestWriteSetCookies (0.00 seconds)\n=== RUN  http.TestSetCookie\n--- PASS: http.TestSetCookie (0.00 seconds)\n=== RUN  http.TestAddCookie\n--- PASS: http.TestAddCookie (0.00 seconds)\n=== RUN  http.TestReadSetCookies\n--- PASS: http.TestReadSetCookies (0.00 seconds)\n=== RUN  http.TestReadCookies\n--- PASS: http.TestReadCookies (0.00 seconds)\n=== RUN  http_test.TestServeFile\n--- PASS: http_test.TestServeFile (0.02 seconds)\n=== RUN  http_test.TestFileServerCleans\n--- PASS: http_test.TestFileServerCleans (0.00 seconds)\n=== RUN  http_test.TestFileServerImplicitLeadingSlash\n--- PASS: http_test.TestFileServerImplicitLeadingSlash (0.00 seconds)\n=== RUN  http_test.TestDirJoin\n--- PASS: http_test.TestDirJoin (0.00 seconds)\n        skipping test; no /etc/hosts file\n=== RUN  http_test.TestServeFileContentType\n\u0026lt;HANG\u0026gt;\n\n$ gotest -v\nrm -f _test/http.a\nrm -f _test/http.a\ngopack grc _test/http.a _gotest_.8\n=== RUN  http_test.TestClient\n--- PASS: http_test.TestClient (0.02 seconds)\n=== RUN  http_test.TestClientHead\n--- PASS: http_test.TestClientHead (0.00 seconds)\n=== RUN  http_test.TestGetRequestFormat\n--- PASS: http_test.TestGetRequestFormat (0.00 seconds)\n=== RUN  http_test.TestPostRequestFormat\n--- PASS: http_test.TestPostRequestFormat (0.00 seconds)\n=== RUN  http_test.TestPostFormRequestFormat\n--- PASS: http_test.TestPostFormRequestFormat (0.00 seconds)\n=== RUN  http_test.TestRedirects\n--- PASS: http_test.TestRedirects (0.05 seconds)\n=== RUN  http_test.TestStreamingGet\n--- PASS: http_test.TestStreamingGet (0.00 seconds)\n=== RUN  http_test.TestClientWrites\n--- PASS: http_test.TestClientWrites (0.00 seconds)\n=== RUN  http.TestWriteSetCookies\n--- PASS: http.TestWriteSetCookies (0.00 seconds)\n=== RUN  http.TestSetCookie\n--- PASS: http.TestSetCookie (0.00 seconds)\n=== RUN  http.TestAddCookie\n--- PASS: http.TestAddCookie (0.00 seconds)\n=== RUN  http.TestReadSetCookies\n--- PASS: http.TestReadSetCookies (0.00 seconds)\n=== RUN  http.TestReadCookies\n--- PASS: http.TestReadCookies (0.00 seconds)\n=== RUN  http_test.TestServeFile\n--- PASS: http_test.TestServeFile (0.02 seconds)\n=== RUN  http_test.TestFileServerCleans\n--- PASS: http_test.TestFileServerCleans (0.00 seconds)\n=== RUN  http_test.TestFileServerImplicitLeadingSlash\n--- PASS: http_test.TestFileServerImplicitLeadingSlash (0.00 seconds)\n=== RUN  http_test.TestDirJoin\n--- PASS: http_test.TestDirJoin (0.00 seconds)\n        skipping test; no /etc/hosts file\n=== RUN  http_test.TestServeFileContentType\n--- PASS: http_test.TestServeFileContentType (0.02 seconds)\n=== RUN  http_test.TestServeFileMimeType\n--- PASS: http_test.TestServeFileMimeType (0.00 seconds)\n=== RUN  http_test.TestServeFileWithContentEncoding\n--- PASS: http_test.TestServeFileWithContentEncoding (0.00 seconds)\n=== RUN  http.TestHeaderWrite\n--- PASS: http.TestHeaderWrite (0.00 seconds)\n=== RUN  http.TestSplitFieldValue\n--- PASS: http.TestSplitFieldValue (0.00 seconds)\n=== RUN  http.TestUseProxy\n--- PASS: http.TestUseProxy (0.00 seconds)\n=== RUN  http.TestParseRange\n--- PASS: http.TestParseRange (0.00 seconds)\n=== RUN  http.TestReadRequest\n--- PASS: http.TestReadRequest (0.00 seconds)\n=== RUN  http_test.TestParseForm\n--- PASS: http_test.TestParseForm (0.00 seconds)\n=== RUN  http_test.TestQuery\n--- PASS: http_test.TestQuery (0.00 seconds)\n=== RUN  http_test.TestPostQuery\n--- PASS: http_test.TestPostQuery (0.00 seconds)\n=== RUN  http_test.TestPostContentTypeParsing\n--- PASS: http_test.TestPostContentTypeParsing (0.00 seconds)\n=== RUN  http_test.TestMultipartReader\n--- PASS: http_test.TestMultipartReader (0.00 seconds)\n=== RUN  http_test.TestRedirect\n--- PASS: http_test.TestRedirect (0.00 seconds)\n=== RUN  http_test.TestSetBasicAuth\n--- PASS: http_test.TestSetBasicAuth (0.00 seconds)\n=== RUN  http_test.TestMultipartRequest\n--- PASS: http_test.TestMultipartRequest (0.00 seconds)\n=== RUN  http_test.TestMultipartRequestAuto\n--- PASS: http_test.TestMultipartRequestAuto (0.00 seconds)\n=== RUN  http_test.TestEmptyMultipartRequest\n--- PASS: http_test.TestEmptyMultipartRequest (0.00 seconds)\n=== RUN  http.TestRequestWrite\n--- PASS: http.TestRequestWrite (0.00 seconds)\n=== RUN  http.TestRequestWriteClosesBody\n--- PASS: http.TestRequestWriteClosesBody (0.00 seconds)\n=== RUN  http.TestReadResponse\n--- PASS: http.TestReadResponse (0.00 seconds)\n=== RUN  http.TestReadResponseCloseInMiddle\n--- PASS: http.TestReadResponseCloseInMiddle (0.47 seconds)\n=== RUN  http.TestResponseWrite\n--- PASS: http.TestResponseWrite (0.00 seconds)\n=== RUN  http_test.TestReverseProxy\n--- PASS: http_test.TestReverseProxy (0.00 seconds)\n=== RUN  http_test.TestConsumingBodyOnNextConn\n--- PASS: http_test.TestConsumingBodyOnNextConn (0.02 seconds)\n=== RUN  http_test.TestHostHandlers\n--- PASS: http_test.TestHostHandlers (0.00 seconds)\n=== RUN  http_test.TestMuxRedirectLeadingSlashes\n--- PASS: http_test.TestMuxRedirectLeadingSlashes (0.00 seconds)\n=== RUN  http_test.TestServerTimeouts\n--- PASS: http_test.TestServerTimeouts (0.27 seconds)\n=== RUN  http_test.TestIdentityResponse\n--- PASS: http_test.TestIdentityResponse (0.00 seconds)\n=== RUN  http_test.TestServeHTTP10Close\n--- PASS: http_test.TestServeHTTP10Close (0.00 seconds)\n=== RUN  http_test.TestHandlersCanSetConnectionClose11\n--- PASS: http_test.TestHandlersCanSetConnectionClose11 (0.00 seconds)\n=== RUN  http_test.TestHandlersCanSetConnectionClose10\n--- PASS: http_test.TestHandlersCanSetConnectionClose10 (0.00 seconds)\n=== RUN  http_test.TestSetsRemoteAddr\n--- PASS: http_test.TestSetsRemoteAddr (0.00 seconds)\n=== RUN  http_test.TestChunkedResponseHeaders\n--- PASS: http_test.TestChunkedResponseHeaders (0.00 seconds)\n=== RUN  http_test.Test304Responses\n--- PASS: http_test.Test304Responses (0.02 seconds)\n=== RUN  http_test.TestHeadResponses\n--- PASS: http_test.TestHeadResponses (0.00 seconds)\n=== RUN  http_test.TestTLSServer\n--- PASS: http_test.TestTLSServer (0.25 seconds)\n=== RUN  http_test.TestServerExpect\n--- PASS: http_test.TestServerExpect (0.00 seconds)\n=== RUN  http_test.TestServerConsumesRequestBody\n--- PASS: http_test.TestServerConsumesRequestBody (0.05 seconds)\n=== RUN  http_test.TestTimeoutHandler\n--- PASS: http_test.TestTimeoutHandler (0.00 seconds)\n=== RUN  http_test.TestRedirectMunging\n--- PASS: http_test.TestRedirectMunging (0.00 seconds)\n=== RUN  http_test.TestZeroLengthPostAndResponse\n--- PASS: http_test.TestZeroLengthPostAndResponse (0.00 seconds)\n=== RUN  http_test.TestHandlerPanic\n--- PASS: http_test.TestHandlerPanic (0.02 seconds)\n=== RUN  http_test.TestNoDate\n--- PASS: http_test.TestNoDate (0.00 seconds)\n=== RUN  http_test.TestStripPrefix\n--- PASS: http_test.TestStripPrefix (0.00 seconds)\n=== RUN  http_test.TestAcceptMaxFds\n--- PASS: http_test.TestAcceptMaxFds (0.00 seconds)\n=== RUN  http_test.TestDetectContentType\n--- PASS: http_test.TestDetectContentType (0.00 seconds)\n=== RUN  http_test.TestServerContentType\n--- PASS: http_test.TestServerContentType (0.00 seconds)\n=== RUN  http_test.TestTransportKeepAlives\n--- PASS: http_test.TestTransportKeepAlives (0.02 seconds)\n=== RUN  http_test.TestTransportConnectionCloseOnResponse\n--- PASS: http_test.TestTransportConnectionCloseOnResponse (0.00 seconds)\n=== RUN  http_test.TestTransportConnectionCloseOnRequest\n--- PASS: http_test.TestTransportConnectionCloseOnRequest (0.02 seconds)\n=== RUN  http_test.TestTransportIdleCacheKeys\n--- PASS: http_test.TestTransportIdleCacheKeys (0.00 seconds)\n=== RUN  http_test.TestTransportMaxPerHostIdleConns\n2011/07/25 09:17:13 Unsolicited response received on idle HTTP channel starting\nwith \u0026quot;\u0026quot;; err=WSARecv tcp 127.0.0.1:49969: A request to send or receive data was\ndisallowed because the socket had already been shut down in that direction with\na previous shutdown call.\n--- PASS: http_test.TestTransportMaxPerHostIdleConns (0.00 seconds)\n=== RUN  http_test.TestTransportServerClosingUnexpectedly\n--- PASS: http_test.TestTransportServerClosingUnexpectedly (0.03 seconds)\n=== RUN  http_test.TestTransportHeadResponses\n--- PASS: http_test.TestTransportHeadResponses (0.00 seconds)\n=== RUN  http_test.TestTransportHeadChunkedResponse\n--- PASS: http_test.TestTransportHeadChunkedResponse (0.00 seconds)\n=== RUN  http_test.TestTransportNilURL\n--- PASS: http_test.TestTransportNilURL (0.00 seconds)\n=== RUN  http_test.TestTransportGzip\n--- PASS: http_test.TestTransportGzip (0.98 seconds)\n=== RUN  http_test.TestTransportProxy\n--- PASS: http_test.TestTransportProxy (0.00 seconds)\n=== RUN  http_test.TestTransportGzipRecursive\n--- PASS: http_test.TestTransportGzipRecursive (0.00 seconds)\n=== RUN  http_test.TestTransportAltProto\n--- PASS: http_test.TestTransportAltProto (0.00 seconds)\n=== RUN  http.TestParseURL\n--- PASS: http.TestParseURL (0.00 seconds)\n=== RUN  http.TestParseURLReference\n--- PASS: http.TestParseURLReference (0.02 seconds)\n=== RUN  http.TestParseRequestURL\n--- PASS: http.TestParseRequestURL (0.00 seconds)\n=== RUN  http.TestURLString\n--- PASS: http.TestURLString (0.00 seconds)\n=== RUN  http.TestURLUnescape\n--- PASS: http.TestURLUnescape (0.00 seconds)\n=== RUN  http.TestURLEscape\n--- PASS: http.TestURLEscape (0.00 seconds)\n=== RUN  http.TestEscapeUserinfo\n--- PASS: http.TestEscapeUserinfo (0.00 seconds)\n=== RUN  http.TestUnescapeUserinfo\n--- PASS: http.TestUnescapeUserinfo (0.00 seconds)\n=== RUN  http.TestEncodeQuery\n--- PASS: http.TestEncodeQuery (0.00 seconds)\n=== RUN  http.TestResolvePath\n--- PASS: http.TestResolvePath (0.00 seconds)\n=== RUN  http.TestResolveReference\n--- PASS: http.TestResolveReference (0.00 seconds)\n=== RUN  http.TestQueryValues\n--- PASS: http.TestQueryValues (0.00 seconds)\nPASS\u003c/pre\u003e",
	"user": {
		"login": "peterGo",
		"id": 4561296,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"comments": 11,
	"closed_at": "2014-12-08T10:11:19Z",
	"created_at": "2011-07-25T13:34:59Z",
	"updated_at": "2016-06-24T19:32:40Z"
}
