{
	"id": 59234845,
	"number": 10023,
	"state": "closed",
	"title": "cmd/cgo: SIGSEGV using C++ files in package on Windows",
	"body": "Hi,\r\n\r\nthis seems to me the same as [#5629](https://github.com/golang/go/issues/5629). Under Linux, if I compile the following files it runs fine.\r\n\r\ntest.go:\r\n```go\r\npackage main\r\n\r\n// #include \"test.h\"\r\nimport \"C\"\r\n\r\nfunc main() {\r\n\tC.cpptest()\r\n}\r\n```\r\n\r\ntest.h:\r\n```cpp\r\n#ifdef __cplusplus\r\nextern \"C\" {\r\n#endif\r\n    void cpptest(void);\r\n#ifdef __cplusplus\r\n}\r\n#endif\r\n```\r\n\r\ntest.cpp:\r\n```cpp\r\n#include \"test.h\"\r\n#include \u003ciostream\u003e\r\n\r\nvoid cpptest (void) {\r\n    std::cerr \u003c\u003c \"ctest!\\n\";\r\n}\r\n```\r\n\r\nUnder Windows, using mingw-w64, it crashes:\r\n```\r\nException 0xc0000005 0x0 0xffffffffffffffff 0x6fc8da99\r\nPC=0x6fc8da99\r\nsignal arrived during cgo execution\r\n\r\nmain._Cfunc_cpptest()\r\n\t_/F_/Home-Mirror/Programming/Go-Workspace/src/_obj/_cgo_gotypes.go:22 +0x4c\r\nmain.main()\r\n\tF:/Home-Mirror/Programming/Go-Workspace/src/test.go:7 +0x22\r\n\r\ngoroutine 2 [runnable]:\r\nruntime.forcegchelper()\r\n\tc:/go/src/runtime/proc.go:90\r\nruntime.goexit()\r\n\tc:/go/src/runtime/asm_amd64.s:2232 +0x1\r\n\r\ngoroutine 3 [runnable]:\r\nruntime.bgsweep()\r\n\tc:/go/src/runtime/mgc0.go:82\r\nruntime.goexit()\r\n\tc:/go/src/runtime/asm_amd64.s:2232 +0x1\r\n\r\ngoroutine 17 [syscall, locked to thread]:\r\nruntime.goexit()\r\n\tc:/go/src/runtime/asm_amd64.s:2232 +0x1\r\nrax     0x47db90\r\nrbx     0x47db90\r\nrcx     0x22fe60\r\nrdx     0x900047e0102524ff\r\nrdi     0xc082025f90\r\nrsi     0x22fe60\r\nrbp     0x482220\r\nrsp     0x22fdf0\r\nr8      0x7\r\nr9      0xc082025f38\r\nr10     0x28\r\nr11     0x449360\r\nr12     0x7\r\nr13     0x22fe60\r\nr14     0x0\r\nr15     0x460750\r\nrip     0x6fc8da99\r\nrflags  0x10206\r\ncs      0x33\r\nfs      0x53\r\ngs      0x2b\r\n```\r\n\r\nIn the mentioned issue [#5629](https://github.com/golang/go/issues/5629) @ianlancetaylor suggest: \"My guess is that the global constructors are not being run, but I have no idea why that would be happening.\"\r\n\r\nI'm a C++ newbie, but this sounds to me a good guess. I found this issue while debugging go-qml, where I got some crashes under Windows:\r\n- using `dynamic_cast` (see [go-qml issue #19](https://github.com/go-qml/qml/issues/19)) -- maybe RTTI is not initialized?\r\n- using a `static` local variable (see [go-qml issue #142](https://github.com/go-qml/qml/issues/142)) -- maybe \"globals\" are not initialized?\r\n\r\nI'm using versions:\r\n```\r\n\u003e go version\r\ngo version go1.4.2 windows/amd64\r\n\u003e gcc -v\r\nUsing built-in specs.\r\nCOLLECT_GCC=F:\\Windows\\Go\\mingw64\\bin\\gcc.exe\r\nCOLLECT_LTO_WRAPPER=F:/Windows/Go/mingw64/bin/../libexec/gcc/x86_64-w64-mingw32/4.9.2/lto-wrapper.exe\r\nTarget: x86_64-w64-mingw32\r\nConfigured with: ../../../src/gcc-4.9.2/configure --host=x86_64-w64-mingw32 --build=x86_64-w64-mingw32 --target=x86_64-w64-mingw32 --prefix=/mingw64 --with-sysroot=/c/mingw492/x86_64-492-posix-seh-rt_v3-rev0/mingw64 --with-gxx-include-dir=/mingw64/x86_64-w64-mingw32/include/c++ --enable-shared --enable-static --disable-multilib --enable-languages=ada,c,c++,fortran,objc,obj-c++,lto --enable-libstdcxx-time=yes --enable-threads=posix --enable-libgomp --enable-libatomic --enable-lto --enable-graphite --enable-checking=release --enable-fully-dynamic-string --enable-version-specific-runtime-libs --disable-isl-version-check --disable-cloog-version-check --disable-libstdcxx-pch --disable-libstdcxx-debug --enable-bootstrap --disable-rpath --disable-win32-registry --disable-nls --disable-werror --disable-symvers --with-gnu-as --with-gnu-ld --with-arch=nocona --with-tune=core2 --with-libiconv --with-system-zlib --with-gmp=/c/mingw492/prerequisites/x86_64-w64-mingw32-static --with-mpfr=/c/mingw492/prerequisites/x86_64-w64-mingw32-static --with-mpc=/c/mingw492/prerequisites/x86_64-w64-mingw32-static --with-isl=/c/mingw492/prerequisites/x86_64-w64-mingw32-static --with-cloog=/c/mingw492/prerequisites/x86_64-w64-mingw32-static --enable-cloog-backend=isl --with-pkgversion='x86_64-posix-seh-rev0, Built by MinGW-W64 project' --with-bugurl=http://sourceforge.net/projects/mingw-w64 CFLAGS='-O2 -pipe -I/c/mingw492/x86_64-492-posix-seh-rt_v3-rev0/mingw64/opt/include -I/c/mingw492/prerequisites/x86_64-zlib-static/include -I/c/mingw492/prerequisites/x86_64-w64-mingw32-static/include' CXXFLAGS='-O2 -pipe -I/c/mingw492/x86_64-492-posix-seh-rt_v3-rev0/mingw64/opt/include -I/c/mingw492/prerequisites/x86_64-zlib-static/include -I/c/mingw492/prerequisites/x86_64-w64-mingw32-static/include' CPPFLAGS= LDFLAGS='-pipe -L/c/mingw492/x86_64-492-posix-seh-rt_v3-rev0/mingw64/opt/lib -L/c/mingw492/prerequisites/x86_64-zlib-static/lib -L/c/mingw492/prerequisites/x86_64-w64-mingw32-static/lib '\r\nThread model: posix\r\ngcc version 4.9.2 (x86_64-posix-seh-rev0, Built by MinGW-W64 project) \r\n```",
	"user": {
		"login": "neclepsio",
		"id": 178987,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"comments": 2,
	"closed_at": "2015-03-03T02:55:26Z",
	"created_at": "2015-02-27T13:17:31Z",
	"updated_at": "2016-06-25T02:02:11Z"
}
