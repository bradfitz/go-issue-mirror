{
	"id": 51285789,
	"number": 6828,
	"state": "closed",
	"title": "net: Dial fails on Solaris with gccgo",
	"body": "\u003cpre\u003eWhat steps will reproduce the problem?\n\n1. Download attached file (standalone $GOROOT/src/pkg/net/dial_test.go:/TestDialer)\n2. gccgo a.go -lsocket -lnsl\n3. ./a.out\n\nWhat is the expected output?\n\nNothing.\n\nWhat do you see instead?\n\nDial failed: dial tcp4 127.0.0.1:60819: invalid argument\n\nWhich compiler are you using (5g, 6g, 8g, gccgo)?\n\ngccgo\n\nWhich operating system are you using?\n\nSolaris\n\n: oos:1; uname -a\nSunOS oos 5.11 omnios-b281e50 i86pc i386 i86pc\n: oos:1; cat /etc/release\n  OmniOS v11 r151006\n  Copyright 2012-2013 OmniTI Computer Consulting, Inc. All rights reserved.\n  Use is subject to license terms.\n: oos:1; \n\nWhich version are you using?  (run 'go version')\n\n: oos:1; gccgo -v\nUsing built-in specs.\nCOLLECT_GCC=gccgo\nCOLLECT_LTO_WRAPPER=/opt/gcc482/bin/../libexec/gcc/x86_64-sun-solaris2.11/4.8.2/lto-wrapper\nTarget: x86_64-sun-solaris2.11\nConfigured with: ../src/configure --prefix=/home/aram/gcc482\n--build=x86_64-sun-solaris2.11 --host=x86_64-sun-solaris2.11 --disable-multilib\n--disable-shared --enable-threads=posix --enable-languages=c,c++,go --disable-libssp\n--disable-nls --with-gnu-as --with-gnu-ld --enable-ld --disable-gold\nThread model: posix\ngcc version 4.8.2 (GCC) \n\nPlease provide any additional information below.\n\nI can reproduce this on a slow machine 100% of the time. On a fast machine it fails only\naround 20% of the time.\n\nThis is a truss snippet:\n\n/1:\tconnect(6, 0xC20082EB4C, 16, SOV_XPG4_2)\tErr#150 EINPROGRESS\n/1:\tgetcontext(0xC200001850)\n/1:\twrite(5, \u0026quot;\\0\u0026quot;, 1)\t\t\t\t= 1\n/1:\tgetcontext(0xC200001C50)\n/1:\tsetcontext(0xC200211220)\n/1:\tsetcontext(0xFFFFFD7FFFDFECC0)\n/1:\tgetcontext(0xC200629850)\n/1:\tmmap(0x00000000, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANON, 4294967295, 0) =\n0xFFFFFD7FEE300000\n/1:\tmmap(0x00000000, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANON, 4294967295, 0) =\n0xFFFFFD7FEE2F0000\n/1:\tmmap(0x00000000, 4096, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANON, 4294967295, 0) =\n0xFFFFFD7FEE2E0000\n/1:\tmmap(0x00000000, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANON, 4294967295, 0) =\n0xFFFFFD7FEE2D0000\n/2:\tpollsys(0xFFFFFD7FEE4529D0, 0, 0xFFFFFD7FEE452AC0, 0x00000000) = 0\n/1:\tmmap(0x00000000, 12288, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_ANON, 4294967295, 0) =\n0xFFFFFD7FEE2C0000\n/1:\tlwp_sigmask(SIG_SETMASK, 0xFFBFFEEF, 0xFFFFFFF7, 0x000000FF, 0x00000000) =\n0xFFBFFEFF [0xFFFFFFFF]\n/1:\tmmap(0x00000000, 12288, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_NORESERVE|MAP_ANON,\n4294967295, 0) = 0xFFFFFD7FEE2B0000\n/1:\tuucopy(0xC200829970, 0xFFFFFD7FEE2B2FE8, 24)\t= 0\n/1:\tlwp_create(0xC200829A80, LWP_DETACHED|LWP_SUSPENDED, 0xC200829DEC) = 3\n/2:\tpollsys(0xFFFFFD7FEE4529D0, 0, 0xFFFFFD7FEE452AC0, 0x00000000) = 0\n/3:\tlwp_create()\t(returning as new lwp ...)\t= 0\n/1:\tlwp_continue(3)\t\t\t\t\t= 0\n/3:\tsetustack(0xFFFFFD7FEE430AE8)\n/1:\tlwp_sigmask(SIG_SETMASK, 0x00000000, 0x00000000, 0x00000000, 0x00000000) =\n0xFFBFFEFF [0xFFFFFFFF]\n/3:\tschedctl()\t\t\t\t\t= 0xFFFFFD7FEE49A020\n/3:\tgetcontext(0xFFFFFD7FEE2B2C10)\n/3:\tgetcontext(0xC200C4FC50)\n/3:\tsigaltstack(0xFFFFFD7FEE2B2F30, 0x00000000)\t= 0\n/3:\tlwp_sigmask(SIG_SETMASK, 0x00000000, 0x00000000, 0x00000000, 0x00000000) =\n0xFFBFFEFF [0xFFFFFFFF]\n/2:\tpollsys(0xFFFFFD7FEE4529D0, 0, 0xFFFFFD7FEE452AC0, 0x00000000) = 0\n/3:\tsetcontext(0xFFFFFD7FEE2B2B80)\n/3:\tgetcontext(0xC200849050)\n/3:\tpollsys(0xC200A49C90, 2, 0x00000000, 0x00000000) = 2\n/3:\tgetcontext(0xC200849050)\n/3:\tread(4, \u0026quot;\\0\u0026quot;, 100)\t\t\t\t= 1\n/3:\tgetcontext(0xC200849050)\n/2:\tpollsys(0xFFFFFD7FEE4529D0, 0, 0xFFFFFD7FEE452AC0, 0x00000000) = 0\n/2:\tpollsys(0xFFFFFD7FEE4529D0, 0, 0xFFFFFD7FEE452AC0, 0x00000000) = 0\n/2:\tlwp_sigmask(SIG_SETMASK, 0xFFBFFEEF, 0xFFFFFFF7, 0x000000FF, 0x00000000) =\n0xFFBFFEFF [0xFFFFFFFF]\n/2:\tmmap(0x00000000, 12288, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_NORESERVE|MAP_ANON,\n4294967295, 0) = 0xFFFFFD7FEE2A0000\n/2:\tuucopy(0xFFFFFD7FEE452550, 0xFFFFFD7FEE2A2FE8, 24) = 0\n/2:\tlwp_create(0xFFFFFD7FEE452660, LWP_DETACHED|LWP_SUSPENDED, 0xFFFFFD7FEE4529CC) = 4\n/2:\tlwp_continue(4)\t\t\t\t\t= 0\n/4:\tlwp_create()\t(returning as new lwp ...)\t= 0\n/2:\tlwp_sigmask(SIG_SETMASK, 0x00000000, 0x00000000, 0x00000000, 0x00000000) =\n0xFFBFFEFF [0xFFFFFFFF]\n/4:\tsetustack(0xFFFFFD7FEE4312E8)\n/4:\tschedctl()\t\t\t\t\t= 0xFFFFFD7FEE49A030\n/2:\tpollsys(0xFFFFFD7FEE4529D0, 0, 0xFFFFFD7FEE452AC0, 0x00000000) = 0\n/4:\tgetcontext(0xFFFFFD7FEE2A2C10)\n/4:\tgetcontext(0xC200C60C50)\n/4:\tsigaltstack(0xFFFFFD7FEE2A2F30, 0x00000000)\t= 0\n/4:\tlwp_sigmask(SIG_SETMASK, 0x00000000, 0x00000000, 0x00000000, 0x00000000) =\n0xFFBFFEFF [0xFFFFFFFF]\n/4:\tsetcontext(0xFFFFFD7FEE2A2B80)\n/4:\tgetcontext(0xC200849850)\n/4:\taccept(3, 0xC200831310, 0xC200000168, SOV_DEFAULT, 0) = 7\n/4:\tgetcontext(0xC200849850)\n/4:\tfcntl(7, F_SETFD, 0x00000001)\t\t\t= 0\n/4:\tgetcontext(0xC200849850)\n/2:\tpollsys(0xFFFFFD7FEE4529D0, 0, 0xFFFFFD7FEE452AC0, 0x00000000) = 0\n/4:\tfcntl(7, F_GETFL)\t\t\t\t= 130\n/4:\tgetcontext(0xC200849850)\n/4:\tfcntl(7, F_SETFL, FWRITE|FNONBLOCK)\t\t= 0\n/4:\tgetsockname(7, 0xC200831380, 0xC200000170, SOV_DEFAULT) = 0\n/4:\tgetcontext(0xC200849850)\n/4:\tsetsockopt(7, tcp, TCP_NODELAY, 0xC200000198, 4, SOV_DEFAULT) = 0\n/4:\tgetcontext(0xC200849850)\n/4:\tclose(7)\t\t\t\t\t= 0\n/4:\tgetcontext(0xC200849C50)\n/4:\tsetcontext(0xC200C49C10)\n/4:\tsetcontext(0xFFFFFD7FEE2A2B60)\n/4:\tgetcontext(0xC200001850)\n/2:\tpollsys(0xFFFFFD7FEE4529D0, 0, 0xFFFFFD7FEE452AC0, 0x00000000) = 0\n/4:\tconnect(6, 0xC20082EB4C, 16, SOV_XPG4_2)\tErr#22 EINVAL\n/4:\tgetcontext(0xC200001850)\n/4:\tclose(6)\t\t\t\t\t= 0\n/4:\tgetcontext(0xC200001850)\nDial failed: dial tcp4 127.0.0.1:46372: invalid argument\n/4:\twrite(1, \u0026quot; D i a l   f a i l e d :\u0026quot;.., 57)\t= 57\n/4:\tgetcontext(0xC200001850)\n/4:\tclose(3)\t\t\t\t\t= 0\n/4:\t_exit(0)\n\nYou can see that the first connect returns EINPROGRESS and the second one EINVAL.\u003c/pre\u003e\n\n\n\n\n\nAttachments:\n\n1. \u003ca href=\"https://storage.googleapis.com/go-attachment/6828/0/test0.go.txt\"\u003etest0.go.txt\u003c/a\u003e (748 bytes)",
	"user": {
		"login": "4ad",
		"id": 1331747,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"comments": 9,
	"closed_at": "2014-12-08T10:37:58Z",
	"created_at": "2013-11-24T12:16:26Z",
	"updated_at": "2016-06-25T01:22:53Z"
}
