{
	"id": 156695313,
	"number": 15831,
	"state": "closed",
	"title": "runtime: Crash on package init with fatal error: bad pointer in write barrier",
	"body": "1. What version of Go are you using (`go version`)?\r\n1.6.2\r\n\r\n2. What operating system and processor architecture are you using (`go env`)?\r\nWas built for android arm using go 1.6.2 and gomobile githash c435d0b.\r\n\r\n3. What did you do?\r\n\r\nWhen java loads the go library, it caused a crash:\r\n\r\n```\r\n                          Go  E  runtime: writebarrierptr *0x67a39d4c = 0x68686868\r\n05-11 09:51:19.314   8537     8606                               Go  E  fatal error: bad pointer in write barrier\r\n05-11 09:51:19.324   8537     8606                               Go  E  runtime stack:\r\n05-11 09:51:19.324   8537     8606                               Go  E  runtime.throw(0x571ac710, 0x1c)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/runtime/panic.go:547 +0x80\r\n05-11 09:51:19.324   8537     8606                               Go  E  runtime.writebarrierptr.func1()\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/runtime/mbarrier.go:140 +0xb4\r\n05-11 09:51:19.324   8537     8606                               Go  E  runtime.systemstack(0x57373800)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/runtime/asm_arm.s:247 +0x8c\r\n05-11 09:51:19.324   8537     8606                               Go  E  runtime.mstart()\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/runtime/proc.go:1051\r\n05-11 09:51:19.324   8537     8606                               Go  E  goroutine 1 [running, locked to thread]:\r\n05-11 09:51:19.324   8537     8606                               Go  E  runtime.systemstack_switch()\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/runtime/asm_arm.s:192 +0x4 fp=0x67a39c54 sp=0x67a39c50\r\n05-11 09:51:19.324   8537     8606                               Go  E  runtime.writebarrierptr(0x67a39d4c, 0x68686868)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/runtime/mbarrier.go:141 +0xa4 fp=0x67a39c6c sp=0x67a39c54\r\n05-11 09:51:19.324   8537     8606                               Go  E  github.com/google/gopacket/layers.init.1()\r\n05-11 09:51:19.324   8537     8606                               Go  E  /Users/kargs/code/go/src/github.com/google/gopacket/layers/enums.go:381 +0x4dc fp=0x67a39e70 sp=0x67a39c6c\r\n05-11 09:51:19.324   8537     8606                               Go  E  github.com/google/gopacket/layers.init()\r\n05-11 09:51:19.324   8537     8606                               Go  E  /Users/kargs/code/go/src/github.com/google/gopacket/layers/usb.go:308 +0x74c8 fp=0x67a39f4c sp=0x67a39e70\r\n05-11 09:51:19.324   8537     8606                               Go  E  github.com/thisisnotourname/android-lib/go/router.init()\r\n05-11 09:51:19.324   8537     8606                               Go  E  /Users/kargs/code/go/src/github.com/thisisnotourname/android-lib/go/router/table.go:540 +0x74 fp=0x67a39f84 sp=0x67a39f4c\r\n05-11 09:51:19.324   8537     8606                               Go  E  github.com/thisisnotourname/android-lib/go/control.init()\r\n05-11 09:51:19.324   8537     8606                               Go  E  /Users/kargs/code/go/src/github.com/thisisnotourname/android-lib/go/control/time.go:10 +0xd0 fp=0x67a39f98 sp=0x67a39f84\r\n05-11 09:51:19.324   8537     8606                               Go  E  github.com/thisisnotourname/android-lib/go/api.init()\r\n05-11 09:51:19.324   8537     8606                               Go  E  /Users/kargs/code/go/src/github.com/thisisnotourname/android-lib/go/api/jsonagents.go:82 +0x64 fp=0x67a39f9c sp=0x67a39f98\r\n05-11 09:51:19.324   8537     8606                               Go  E  _/var/folders/yn/q2mv635j31n0xrzmymdzgcjr0000gn/T/gomobile-work-814562066/gomobile_bind.init()\r\n05-11 09:51:19.324   8537     8606                               Go  E  _/var/folders/yn/q2mv635j31n0xrzmymdzgcjr0000gn/T/gomobile-work-814562066/gomobile_bind/_obj/_cgo_import.go:1 +0x5c fp=0x67a39fa0 sp=0x67a39f9c\r\n05-11 09:51:19.324   8537     8606                               Go  E  main.init()\r\n05-11 09:51:19.324   8537     8606                               Go  E  /var/folders/yn/q2mv635j31n0xrzmymdzgcjr0000gn/T/gomobile-work-814562066/androidlib/main.go:9 +0x5c fp=0x67a39fa4 sp=0x67a39fa0\r\n05-11 09:51:19.324   8537     8606                               Go  E  runtime.main()\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/runtime/proc.go:177 +0x2dc fp=0x67a39fcc sp=0x67a39fa4\r\n05-11 09:51:19.324   8537     8606                               Go  E  runtime.goexit()\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/runtime/asm_arm.s:990 +0x4 fp=0x67a39fcc sp=0x67a39fcc\r\n05-11 09:51:19.324   8537     8606                               Go  E  goroutine 17 [chan receive, locked to thread]:\r\n05-11 09:51:19.324   8537     8606                               Go  E  runtime.gopark(0x571f39cc, 0x67a5a070, 0x5717ffb0, 0xc, 0x17, 0x3)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/runtime/proc.go:262 +0x15c\r\n05-11 09:51:19.324   8537     8606                               Go  E  runtime.goparkunlock(0x67a5a070, 0x5717ffb0, 0xc, 0x17, 0x3)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/runtime/proc.go:268 +0x48\r\n05-11 09:51:19.324   8537     8606                               Go  E  runtime.chanrecv(0x57069e40, 0x67a5a040, 0x0, 0x1, 0x56c00000)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/runtime/chan.go:470 +0x538\r\n05-11 09:51:19.324   8537     8606                               Go  E  runtime.chanrecv1(0x57069e40, 0x67a5a040, 0x0)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/runtime/chan.go:355 +0x28\r\n05-11 09:51:19.324   8537     8606                               Go  E  runtime.cgocallbackg1()\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/runtime/cgocall.go:199 +0x88\r\n05-11 09:51:19.324   8537     8606                               Go  E  runtime.cgocallbackg()\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/runtime/cgocall.go:180 +0xb0\r\n05-11 09:51:19.324   8537     8606                               Go  E  runtime.cgocallback_gofunc(0x0, 0x0, 0x0)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/runtime/asm_arm.s:621 +0x58\r\n05-11 09:51:19.324   8537     8606                               Go  E  runtime.goexit()\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/runtime/asm_arm.s:990 +0x4\r\n05-11 09:51:19.324   8537     8606                               Go  E  goroutine 18 [syscall, locked to thread]:\r\n05-11 09:51:19.324   8537     8606                               Go  E  runtime.goexit()\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/runtime/asm_arm.s:990 +0x4\r\n05-11 09:51:19.324   8537     8606                               Go  E  goroutine 5 [syscall]:\r\n05-11 09:51:19.324   8537     8606                               Go  E  syscall.Syscall(0x3, 0x56, 0x67a88000, 0x400, 0x0, 0x0, 0x0)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/syscall/asm_linux_arm.s:17 +0x8\r\n05-11 09:51:19.324   8537     8606                               Go  E  syscall.read(0x56, 0x67a88000, 0x400, 0x400, 0x0, 0x0, 0x0)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/syscall/zsyscall_linux_arm.go:783 +0x78\r\n05-11 09:51:19.324   8537     8606                               Go  E  syscall.Read(0x56, 0x67a88000, 0x400, 0x400, 0x0, 0x0, 0x0)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/syscall/syscall_unix.go:161 +0x4c\r\n05-11 09:51:19.324   8537     8606                               Go  E  os.(*File).read(0x67a20160, 0x67a88000, 0x400, 0x400, 0x0, 0x0, 0x0)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/os/file_unix.go:228 +0x54\r\n05-11 09:51:19.324   8537     8606                               Go  E  os.(*File).Read(0x67a20160, 0x67a88000, 0x400, 0x400, 0x67a88000, 0x0, 0x0)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/os/file.go:95 +0x84\r\n05-11 09:51:19.324   8537     8606                               Go  E  bufio.(*Reader).fill(0x67a29f7c)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/bufio/bufio.go:97 +0x1cc\r\n05-11 09:51:19.324   8537     8606                               Go  E  bufio.(*Reader).ReadSlice(0x67a29f7c, 0x56c14a0a, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/bufio/bufio.go:328 +0x26c\r\n05-11 09:51:19.324   8537     8606                               Go  E  bufio.(*Reader).ReadLine(0x67a29f7c, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/bufio/bufio.go:357 +0x60\r\n05-11 09:51:19.324   8537     8606                               Go  E  golang.org/x/mobile/internal/mobileinit.lineLog(0x67a20160, 0x6)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /Users/kargs/code/go/src/golang.org/x/mobile/internal/mobileinit/mobileinit_android.go:50 +0xf4\r\n05-11 09:51:19.324   8537     8606                               Go  E  created by golang.org/x/mobile/internal/mobileinit.init.1\r\n05-11 09:51:19.324   8537     8606                               Go  E  /Users/kargs/code/go/src/golang.org/x/mobile/internal/mobileinit/mobileinit_android.go:74 +0x11c\r\n05-11 09:51:19.324   8537     8606                               Go  E  goroutine 6 [syscall]:\r\n05-11 09:51:19.324   8537     8606                               Go  E  syscall.Syscall(0x3, 0x61, 0x67a88400, 0x400, 0x0, 0x0, 0x0)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/syscall/asm_linux_arm.s:17 +0x8\r\n05-11 09:51:19.324   8537     8606                               Go  E  syscall.read(0x61, 0x67a88400, 0x400, 0x400, 0x0, 0x0, 0x0)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/syscall/zsyscall_linux_arm.go:783 +0x78\r\n05-11 09:51:19.324   8537     8606                               Go  E  syscall.Read(0x61, 0x67a88400, 0x400, 0x400, 0x0, 0x0, 0x0)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/syscall/syscall_unix.go:161 +0x4c\r\n05-11 09:51:19.324   8537     8606                               Go  E  os.(*File).read(0x67a20170, 0x67a88400, 0x400, 0x400, 0x0, 0x0, 0x0)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/os/file_unix.go:228 +0x54\r\n05-11 09:51:19.324   8537     8606                               Go  E  os.(*File).Read(0x67a20170, 0x67a88400, 0x400, 0x400, 0x67a88400, 0x0, 0x0)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/os/file.go:95 +0x84\r\n05-11 09:51:19.324   8537     8606                               Go  E  bufio.(*Reader).fill(0x67a2a77c)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/bufio/bufio.go:97 +0x1cc\r\n05-11 09:51:19.324   8537     8606                               Go  E  bufio.(*Reader).ReadSlice(0x67a2a77c, 0x56c14a0a, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/bufio/bufio.go:328 +0x26c\r\n05-11 09:51:19.324   8537     8606                               Go  E  bufio.(*Reader).ReadLine(0x67a2a77c, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /usr/local/Cellar/go/1.6.2/libexec/src/bufio/bufio.go:357 +0x60\r\n05-11 09:51:19.324   8537     8606                               Go  E  golang.org/x/mobile/internal/mobileinit.lineLog(0x67a20170, 0x4)\r\n05-11 09:51:19.324   8537     8606                               Go  E  /Users/kargs/code/go/src/golang.org/x/mobile/internal/mobileinit/mobileinit_android.go:50 +0xf4\r\n05-11 09:51:19.324   8537     8606                               Go  E  created by golang.org/x/mobile/internal/mobileinit.init.1\r\n05-11 09:51:19.324   8537     8606                               Go  E  /Users/kargs/code/go/src/golang.org/x/mobile/internal/mobileinit/mobileinit_android.go:81 +0x1b8\r\n```\r\n\r\nThe only `init()` that actually seem to do something is [gopacket enums](https://github.com/google/gopacket/blob/b09bf408520f7646e29b7033d9adb00ed779a1c4/layers/enums.go#L379)\r\n\r\nUnfortunately it has only happened occasionally and I don't know how to reproduce it.\r\nThe specific android device in question that it happened on is SM-G355H\r\n\r\nI believe this is related to https://github.com/golang/go/issues/11689",
	"user": {
		"login": "balboah",
		"id": 294690,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "NeedsInvestigation"
		}
	],
	"comments": 6,
	"closed_at": "2016-06-17T15:19:23Z",
	"created_at": "2016-05-25T08:49:31Z",
	"updated_at": "2016-06-17T15:19:23Z",
	"milestone": {
		"id": 1414133,
		"number": 31,
		"title": "Go1.7"
	}
}
