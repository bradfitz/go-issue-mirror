{
	"id": 151929200,
	"number": 15489,
	"state": "closed",
	"title": "cmd/link: Deprecated syntax `-ldflags \"-X var val\"` fails with usage message",
	"body": "1. What version of Go are you using (`go version`)?\r\n\r\n```\r\ngo version go1.6.2 darwin/amd64\r\n```\r\n\r\n2. What operating system and processor architecture are you using (`go env`)?\r\n\r\n```\r\nGOARCH=\"amd64\"\r\nGOBIN=\"\"\r\nGOEXE=\"\"\r\nGOHOSTARCH=\"amd64\"\r\nGOHOSTOS=\"darwin\"\r\nGOOS=\"darwin\"\r\nGOPATH=\"\"\r\nGORACE=\"\"\r\nGOROOT=\"/opt/local/lib/go\"\r\nGOTOOLDIR=\"/opt/local/lib/go/pkg/tool/darwin_amd64\"\r\nGO15VENDOREXPERIMENT=\"1\"\r\nCC=\"/usr/bin/clang\"\r\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fno-common\"\r\nCXX=\"clang++\"\r\nCGO_ENABLED=\"1\"\r\n```\r\n\r\n3. What did you do?\r\nIf possible, provide a recipe for reproducing the error.\r\nA complete runnable program is good.\r\nA link on play.golang.org is best.\r\n\r\nTry to build [mongo-tools](https://github.com/mongodb/mongo-tools) 3.2.5 or earlier on OS X with go 1.5 or later\r\n\r\n4. What did you expect to see?\r\n\r\nExpected successful build\r\n\r\n5. What did you see instead?\r\n\r\nGot this warning and error:\r\n\r\n```\r\nlink: warning: option -X github.com/mongodb/mongo-tools/common/options.Gitspec -X may not work in future releases; use -X github.com/mongodb/mongo-tools/common/options.Gitspec=-X\r\nusage: link [options] main.o\r\n  -B note\r\n    \tadd an ELF NT_GNU_BUILD_ID note when using ELF\r\n  -C\tcheck Go calls to C code\r\n  -D address\r\n    \tset data segment address (default -1)\r\n  -E entry\r\n    \tset entry symbol name\r\n  -H type\r\n    \tset header type\r\n  -I linker\r\n    \tuse linker as ELF dynamic linker\r\n  -L directory\r\n    \tadd specified directory to library path\r\n  -R quantum\r\n    \tset address rounding quantum (default -1)\r\n  -T address\r\n    \tset text segment address (default -1)\r\n  -V\tprint version and exit\r\n  -X definition\r\n    \tadd string value definition of the form importpath.name=value\r\n  -a\tdisassemble output\r\n  -buildid id\r\n    \trecord id as Go toolchain build id\r\n  -buildmode mode\r\n    \tset build mode\r\n  -c\tdump call graph\r\n  -cpuprofile file\r\n    \twrite cpu profile to file\r\n  -d\tdisable dynamic executable\r\n  -extar string\r\n    \tarchive program for buildmode=c-archive\r\n  -extld linker\r\n    \tuse linker when linking in external mode\r\n  -extldflags flags\r\n    \tpass flags to external linker\r\n  -f\tignore version mismatch\r\n  -g\tdisable go package data checks\r\n  -h\thalt on error\r\n  -installsuffix suffix\r\n    \tset package directory suffix\r\n  -k symbol\r\n    \tset field tracking symbol\r\n  -libgcc string\r\n    \tcompiler support lib for internal linking; use \"none\" to disable\r\n  -linkmode mode\r\n    \tset link mode (internal, external, auto)\r\n  -linkshared\r\n    \tlink against installed Go shared libraries\r\n  -memprofile file\r\n    \twrite memory profile to file\r\n  -memprofilerate rate\r\n    \tset runtime.MemProfileRate to rate\r\n  -msan\r\n    \tenable MSan interface\r\n  -n\tdump symbol table\r\n  -o file\r\n    \twrite output to file\r\n  -r path\r\n    \tset the ELF dynamic linker search path to dir1:dir2:...\r\n  -race\r\n    \tenable race detector\r\n  -s\tdisable symbol table\r\n  -shared\r\n    \tgenerate shared object (implies -linkmode external)\r\n  -tmpdir directory\r\n    \tuse directory for temporary files\r\n  -u\treject unsafe packages\r\n  -v\tprint link trace\r\n  -w\tdisable DWARF generation\r\n```\r\n\r\nI have [reported this bug](https://jira.mongodb.org/browse/TOOLS-1151) to the developers of mongo-tools, and while they will address the problem by changing mongo-tools to use the new `var=val` syntax, because they no longer care about compatibility with old go versions, they feel it is a bug in go that the old syntax is not being accepted. They feel that after the `link: warning` message about the deprecated syntax, the build should proceed, and not exit with a usage message.",
	"user": {
		"login": "ryandesign",
		"id": 429209,
		"type": "User",
		"site_admin": false
	},
	"comments": 3,
	"closed_at": "2016-04-29T18:25:14Z",
	"created_at": "2016-04-29T17:34:38Z",
	"updated_at": "2016-04-29T21:14:07Z"
}
