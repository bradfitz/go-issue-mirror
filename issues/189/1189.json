{
	"id": 51277471,
	"number": 1189,
	"state": "closed",
	"title": "dyld cannot reliably reference symbols in a binary generated by 6l",
	"body": "by **jimmc2**:\n\n\u003cpre\u003eWhat steps will reproduce the problem?\nrun a 6.out binary that loads a native .so./.dylib on OS X - see test attached case\nThis is the issue that causes the dyld: Symbol not found: __swig_gc_makegostring \nruntime link failure.\n\nWhat is the expected output?\nlinked program should execute\n\nWhat do you see instead?\ndyld: Symbol not found: _aaaaa\n  Referenced from: /Users/jim/src/bug/bug_macho_dynexport/./t\n  Expected in: flat namespace\n\nTrace/BPT trap\n\nWhich compiler are you using (5g, 6g, 8g, gccgo)?\n6g/6l\n\nWhich operating system are you using?\nOS X 10.6\n\nWhich revision are you using?  (hg identify)\n684ebd420f34 tip\n\nPlease provide any additional information below.\n\nTest case for 6l symbol ordering bug.\n\nA gcc compiled .so cannot reliably reference symbols defined in a mach-O 6.out file.\n\nDyld does a binary search so symbols need to be emitted in alpha order or there needs to\nbe a toc present in the binary.\n\nWith -DGOOD defined in the 6c compile step in the Makefile, make clean all generates a\nrunnable binary. Without it you get a dynamic link failure at load time.\n\nbroken:\n$ otool -Iv t\nt:\nIndirect symbols for (__DATA,__nl_symbol_ptr) 8 entries\naddress            index name\n0x0000000000016598     0 _a\n0x00000000000165a0     1 _aa\n0x00000000000165a8     2 _aaa\n0x00000000000165b0     3 _aaaaa\n0x00000000000165b8     4 _aaaa\n0x00000000000165c0     5 _libcgo_thread_start\n0x00000000000165c8     6 _so_func\n0x00000000000165d0     7 _initcgo\n\n\nwith -DGOOD (still broken, but good enough in this case)\n$ otool -Iv t\nt:\nIndirect symbols for (__DATA,__nl_symbol_ptr) 8 entries\naddress            index name\n0x0000000000016598     0 _a\n0x00000000000165a0     1 _b\n0x00000000000165a8     2 _c\n0x00000000000165b0     3 _d\n0x00000000000165b8     4 _e\n0x00000000000165c0     5 _libcgo_thread_start\n0x00000000000165c8     6 _so_func\n0x00000000000165d0     7 _initcgo\u003c/pre\u003e\n\n\n\n\n\nAttachments:\n\n1. \u003ca href=\"https://storage.googleapis.com/go-attachment/1189/0/bug_macho_dynexport.tar.gz\"\u003ebug_macho_dynexport.tar.gz\u003c/a\u003e (1720 bytes)",
	"user": {
		"login": "gopherbot",
		"id": 8566911,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"assignee": {
		"login": "rsc",
		"id": 104030,
		"type": "User",
		"site_admin": false
	},
	"comments": 3,
	"closed_at": "2014-12-08T10:07:17Z",
	"created_at": "2010-10-11T10:44:38Z",
	"updated_at": "2016-06-24T19:21:11Z"
}
