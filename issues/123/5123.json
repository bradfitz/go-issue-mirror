{
	"id": 51283155,
	"number": 5123,
	"state": "closed",
	"title": "os/exec: test deadlock",
	"body": "\u003cpre\u003eparent: 16408:2be8c885acc8 tip\n net: band-aid for windows network poller\n\n$ go test os/exec\ndeadlocks with the following stacks\nlooks like a real deadlock between tls.Conn.Read and Close\n\n\nSIGABRT: abort\nPC=0x423cb1\n\nruntime.futex()\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/sys_linux_amd64.s:266 +0x21\nruntime.futexsleep(0x7e68d8, 0x0, 0xffffffffffffffff)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/os_linux.c:58 +0x59\nruntime.notesleep(0x7e68d8)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/lock_futex.c:125 +0x69\nsysmon()\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/proc.c:1995 +0x196\nruntime.mstart()\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/proc.c:485 +0xd2\ncrosscall_amd64()\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/crypto/dsa/dsa.go:0 +0xc\n\ngoroutine 1 [chan receive]:\nruntime.park(0x40acf0, 0xc2000cbef0, 0x7e280a)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/proc.c:1167 +0x64\nruntime.chanrecv(0x5c5920, 0xc2000cbea0, 0x7ffff7f67ce0, 0x0, 0x0, ...)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/chan.c:366 +0x566\nruntime.chanrecv1()\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/chan.c:458 +0x38\ntesting.RunTests(0x6d4810, 0x7e0d20, 0xc, 0xc, 0x0, ...)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/testing/testing.go:427 +0x88e\ntesting.Main(0x6d4810, 0x7e0d20, 0xc, 0xc, 0x7e5240, ...)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/testing/testing.go:358 +0x8a\nmain.main()\n\tos/exec/_test/_testmain.go:65 +0x9a\nruntime.main()\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/proc.c:182 +0x92\nruntime.goexit()\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/proc.c:1214\n\ngoroutine 2 [syscall]:\nruntime.goexit()\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/proc.c:1214\n\ngoroutine 3 [syscall]:\nruntime.entersyscallblock()\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/proc.c:1324 +0x16e\nruntime.MHeap_Scavenger()\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/mheap.c:435 +0xee\nruntime.goexit()\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/proc.c:1214\ncreated by runtime.main\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/proc.c:165\n\ngoroutine 18 [semacquire]:\nruntime.park(0x40acf0, 0x7f4720, 0x7db990)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/proc.c:1167 +0x64\nsemacquireimpl(0xc2000c5298, 0x1)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/zsema_linux_amd64.c:113 +0x116\nsync.runtime_Semacquire(0xc2000c5298)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/zsema_linux_amd64.c:165 +0x2e\nsync.(*Mutex).Lock(0xc2000c5294)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/sync/mutex.go:66 +0xbb\ncrypto/tls.(*Conn).Close(0xc2000c5280, 0x0, 0x0)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/crypto/tls/conn.go:816 +0x4e\nnet/http/httptest.(*Server).CloseClientConnections(0xc2001c45a0)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/net/http/httptest/server.go:184 +0xa6\nnet/http/httptest.(*Server).Close(0xc2001c45a0)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/net/http/httptest/server.go:169 +0x4f\nos/exec.TestExtraFiles(0xc2000fa1b0)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/os/exec/exec_test.go:268 +0xe52\ntesting.tRunner(0xc2000fa1b0, 0x7e0dc8)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/testing/testing.go:346 +0x8a\nruntime.goexit()\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/proc.c:1214\ncreated by testing.RunTests\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/testing/testing.go:426 +0x86b\n\ngoroutine 16 [finalizer wait]:\nruntime.park(0x0, 0x0, 0x7e306a)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/proc.c:1167 +0x64\nrunfinq()\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/mgc0.c:2068 +0x6d\nruntime.goexit()\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/proc.c:1214\ncreated by runtime.gc\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/mgc0.c:1772\n\ngoroutine 21 [IO wait]:\nruntime.park(0x40acf0, 0x7ffff7e46c88, 0x7e138f)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/proc.c:1167 +0x64\nnetpollblock(0x7ffff7e46c80, 0x72)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/znetpoll_linux_amd64.c:255 +0x9f\nnet.runtime_pollWait(0x7ffff7e46c80, 0x72, 0x0)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/znetpoll_linux_amd64.c:118 +0x82\nnet.(*pollDesc).WaitRead(0xc2000fa500, 0xb, 0xc2000cf120)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/net/fd_poll_runtime.go:75 +0x31\nnet.(*netFD).Read(0xc2000fa480, 0xc20008ac00, 0x400, 0x400, 0x0, ...)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/net/fd_unix.go:192 +0x2b3\nnet.(*conn).Read(0xc200000ae0, 0xc20008ac00, 0x400, 0x400, 0x7fff00000002, ...)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/net/net.go:123 +0xc3\ncrypto/tls.(*block).readFromUntil(0xc2001ef3c0, 0xc2001ef3f0, 0xc200000ae0, 0x5,\n0xc200000ae0, ...)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/crypto/tls/conn.go:401 +0xbd\ncrypto/tls.(*Conn).readRecord(0xc2000c5280, 0x16, 0x0, 0x4c78c3)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/crypto/tls/conn.go:481 +0xfa\ncrypto/tls.(*Conn).readHandshake(0xc2000c5280, 0x16, 0xc200000b74, 0x4, 0x0, ...)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/crypto/tls/conn.go:683 +0xac\ncrypto/tls.(*serverHandshakeState).doFullHandshake(0xc2001f4000, 0xc2001f4000, 0x0)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/crypto/tls/handshake_server.go:325 +0x78a\ncrypto/tls.(*Conn).serverHandshake(0xc2000c5280, 0x0, 0x0)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/crypto/tls/handshake_server.go:65 +0x21c\ncrypto/tls.(*Conn).Handshake(0xc2000c5280, 0x0, 0x0)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/crypto/tls/conn.go:844 +0xec\nnet/http.(*conn).serve(0xc2000fa510)\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/net/http/server.go:912 +0x1c8\nruntime.goexit()\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/runtime/proc.c:1214\ncreated by net/http.(*Server).Serve\n\t/usr/local/google/home/dvyukov/src/go4/src/pkg/net/http/server.go:1439 +0x266\u003c/pre\u003e",
	"user": {
		"login": "dvyukov",
		"id": 1095328,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		},
		{
			"name": "Testing"
		}
	],
	"comments": 15,
	"closed_at": "2014-12-08T10:27:24Z",
	"created_at": "2013-03-25T17:11:12Z",
	"updated_at": "2016-06-24T22:36:23Z",
	"milestone": {
		"id": 1067211,
		"number": 17,
		"title": "Go1.3"
	}
}
