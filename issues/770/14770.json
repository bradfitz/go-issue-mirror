{
	"id": 140127714,
	"number": 14770,
	"state": "closed",
	"title": "runtime/trace: test failed(timeout/hang) in low end machine, CgoCallbackGC use up all CPU power",
	"body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What version of Go are you using (`go version`)?\r\n\u003cpre\u003e\r\n$ go version\r\ngo version devel +b354f91 Fri Mar 11 06:43:01 2016 +0000 freebsd/amd64\r\n\u003c/pre\u003e\r\n2. What operating system and processor architecture are you using (`go env`)?\r\n\u003cpre\u003e\r\n$ uname -a\r\nFreeBSD freebsd-i5-box.localdomain 10.2-STABLE FreeBSD 10.2-STABLE #0 r292855: Tue Dec 29 06:17:50 UTC 2015     root@releng1.nyi.freebsd.org:/usr/obj/usr/src/sys/GENERIC  amd64\r\n\u003c/pre\u003e\r\n\u003cpre\u003e\r\n$ cpuflags clang\r\nUnknown machine - please send cpuflags details to abs@absd.org\r\nOS\t\t: 'FreeBSD'\r\nhw.model\t: 'Genuine Intel CPU           U7300  @ 1.30GHz'\r\nhw.machine\t: 'amd64'\r\nhw.machine_arch : 'amd64'\r\ncpu details\t:\r\nCPU: Genuine Intel(R) CPU           U7300  @ 1.30GHz (1339.03-MHz K8-class CPU)\r\n  Origin=\"GenuineIntel\"  Id=0x1067a  Family=0x6  Model=0x17  Stepping=10\r\n  Features=0xbfebfbff\u003cFPU,VME,DE,PSE,TSC,MSR,PAE,MCE,CX8,APIC,SEP,MTRR,PGE,MCA,CMOV,PAT,PSE36,CLFLUSH,DTS,ACPI,MMX,FXSR,SSE,SSE2,SS,HTT,TM,PBE\u003e\r\n  Features2=0xc08e3bd\u003cSSE3,DTES64,MON,DS_CPL,VMX,EST,TM2,SSSE3,CX16,xTPR,PDCM,SSE4.1,XSAVE,OSXSAVE\u003e\r\n  AMD Features=0x20100800\u003cSYSCALL,NX,LM\u003e\r\n  AMD Features2=0x1\u003cLAHF\u003e\r\n  VT-x: HLT,PAUSE\r\n  TSC: P-state invariant, performance statistics\r\n-msse3 -mfpmath=sse\r\n\u003c/pre\u003e\r\n\u003cpre\u003e\r\n$ go env\r\nGOARCH=\"amd64\"\r\nGOBIN=\"/home/rhinofly/home/ds/sandspace/go/bin.freebsd-amd64\"\r\nGOEXE=\"\"\r\nGOHOSTARCH=\"amd64\"\r\nGOHOSTOS=\"freebsd\"\r\nGOOS=\"freebsd\"\r\nGOPATH=\"/home/rhinofly/home/ds/sandspace/external/:/home/rhinofly/home/ds/sandspace/golibs/\"\r\nGORACE=\"\"\r\nGOROOT=\"/home/rhinofly/home/ds/sandspace/go\"\r\nGOTOOLDIR=\"/home/rhinofly/home/ds/sandspace/go/pkg/tool/freebsd_amd64\"\r\nCC=\"clang\"\r\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -gno-record-gcc-switches\"\r\nCXX=\"clang++\"\r\nCGO_ENABLED=\"1\"\r\n\u003c/pre\u003e\r\n\r\n3. What did you do?\r\nIf possible, provide a recipe for reproducing the error.\r\nA complete runnable program is good.\r\nA link on play.golang.org is best.\r\n\r\n\u003cpre\u003e\r\ngit clone https://github.com/golang/go.git tips-go \u0026\u0026 cd tips-go/src \u0026\u0026 ./all.bash\r\n\u003c/pre\u003e\r\n\r\n4. What did you expect to see?\r\n\r\nall test pass\r\n\r\n5. What did you see instead?\r\n\r\n\u003cpre\u003e\r\nok  \treflect\t0.234s\r\nok  \tregexp\t0.483s\r\nok  \tregexp/syntax\t1.091s\r\n\r\nSIGQUIT: quit\r\nPC=0x456597 m=0\r\n\r\ngoroutine 0 [idle]:\r\nruntime.nanotime(0x754088, 0x0, 0x186a0, 0x4380e1bacf7, 0x754220, 0x40e4dd, 0x754088, 0x186a0, 0xc82001f200, 0x42d5ec, ...)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/sys_freebsd_amd64.s:166 +0x17 fp=0x7fffffffe1d0 sp=0x7fffffffe1a8\r\nruntime.notetsleep_internal(0x754088, 0x186a0, 0xc82001f200)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/lock_futex.go:179 +0x10b fp=0x7fffffffe200 sp=0x7fffffffe1d0\r\nruntime.notetsleep(0x754088, 0x186a0, 0xc820416e00)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/lock_futex.go:194 +0x4d fp=0x7fffffffe220 sp=0x7fffffffe200\r\nruntime.forEachP(0x66caf8)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/proc.go:1161 +0x2fc fp=0x7fffffffe288 sp=0x7fffffffe220\r\nruntime.gcMarkDone.func1()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/mgc.go:1090 +0x23 fp=0x7fffffffe298 sp=0x7fffffffe288\r\nruntime.systemstack(0x754200)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/asm_amd64.s:291 +0x79 fp=0x7fffffffe2a0 sp=0x7fffffffe298\r\nruntime.mstart()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/proc.go:1030 fp=0x7fffffffe2a8 sp=0x7fffffffe2a0\r\n\r\ngoroutine 151 [running]:\r\nruntime.systemstack_switch()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/asm_amd64.s:245 fp=0xc820027728 sp=0xc820027720\r\nruntime.gcMarkDone()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/mgc.go:1091 +0x139 fp=0xc820027748 sp=0xc820027728\r\nruntime.gcBgMarkWorker(0xc82001e000)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/mgc.go:1474 +0x293 fp=0xc8200277b8 sp=0xc820027748\r\nruntime.goexit()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/asm_amd64.s:2006 +0x1 fp=0xc8200277c0 sp=0xc8200277b8\r\ncreated by runtime.gcBgMarkStartWorkers\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/mgc.go:1324 +0x8a\r\n\r\ngoroutine 1 [chan receive, 3 minutes]:\r\nruntime.gopark(0x66ccb0, 0xc82042c478, 0x631229, 0xc, 0xc820090317, 0x3)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/proc.go:262 +0x131 fp=0xc820429bf8 sp=0xc820429bd0\r\nruntime.goparkunlock(0xc82042c478, 0x631229, 0xc, 0x17, 0x3)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/proc.go:268 +0x54 fp=0xc820429c30 sp=0xc820429bf8\r\nruntime.chanrecv(0x593b20, 0xc82042c420, 0xc820429df8, 0xc820429c01, 0x4668fb)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/chan.go:474 +0x2ac fp=0xc820429cb0 sp=0xc820429c30\r\nruntime.chanrecv1(0x593b20, 0xc82042c420, 0xc820429df8)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/chan.go:357 +0x2b fp=0xc820429ce0 sp=0xc820429cb0\r\ntesting.RunTests(0x66c6a0, 0x750540, 0xb1, 0xb1, 0x5b)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/testing/testing.go:582 +0x351 fp=0xc820429e20 sp=0xc820429ce0\r\ntesting.(*M).Run(0xc820429ef8, 0x40df13)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/testing/testing.go:515 +0x79 fp=0xc820429ea0 sp=0xc820429e20\r\nruntime_test.TestMain(0xc820429ef8)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/crash_test.go:24 +0x25 fp=0xc820429ee8 sp=0xc820429ea0\r\nmain.main()\r\n\truntime/_test/_testmain.go:954 +0xb4 fp=0xc820429f50 sp=0xc820429ee8\r\nruntime.main()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/proc.go:188 +0x20a fp=0xc820429fa0 sp=0xc820429f50\r\nruntime.goexit()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/asm_amd64.s:2006 +0x1 fp=0xc820429fa8 sp=0xc820429fa0\r\n\r\ngoroutine 17 [syscall, 4 minutes, locked to thread]:\r\nruntime.goexit()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/asm_amd64.s:2006 +0x1 fp=0xc820038fb8 sp=0xc820038fb0\r\n\r\ngoroutine 2 [force gc (idle), 3 minutes]:\r\nruntime.gopark(0x66ccb0, 0x753950, 0x633ada, 0xf, 0x100000000000014, 0x1)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/proc.go:262 +0x131 fp=0xc820026758 sp=0xc820026730\r\nruntime.goparkunlock(0x753950, 0x633ada, 0xf, 0xc820000114, 0x1)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/proc.go:268 +0x54 fp=0xc820026790 sp=0xc820026758\r\nruntime.forcegchelper()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/proc.go:229 +0x9f fp=0xc8200267c0 sp=0xc820026790\r\nruntime.goexit()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/asm_amd64.s:2006 +0x1 fp=0xc8200267c8 sp=0xc8200267c0\r\ncreated by runtime.init.4\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/proc.go:218 +0x2b\r\n\r\ngoroutine 3 [GC sweep wait, 3 minutes]:\r\nruntime.gopark(0x66ccb0, 0x753b80, 0x631cab, 0xd, 0x44c714, 0x1)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/proc.go:262 +0x131 fp=0xc820026f48 sp=0xc820026f20\r\nruntime.goparkunlock(0x753b80, 0x631cab, 0xd, 0x14, 0x1)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/proc.go:268 +0x54 fp=0xc820026f80 sp=0xc820026f48\r\nruntime.bgsweep(0xc82001a070)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/mgcsweep.go:79 +0x125 fp=0xc820026fb8 sp=0xc820026f80\r\nruntime.goexit()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/asm_amd64.s:2006 +0x1 fp=0xc820026fc0 sp=0xc820026fb8\r\ncreated by runtime.gcenable\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/mgc.go:191 +0x53\r\n\r\ngoroutine 18 [finalizer wait, 4 minutes]:\r\nruntime.gopark(0x66ccb0, 0x76ef30, 0x632cbe, 0xe, 0x14, 0x1)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/proc.go:262 +0x131 fp=0xc820022710 sp=0xc8200226e8\r\nruntime.goparkunlock(0x76ef30, 0x632cbe, 0xe, 0x14, 0x1)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/proc.go:268 +0x54 fp=0xc820022748 sp=0xc820022710\r\nruntime.runfinq()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/mfinal.go:158 +0xa5 fp=0xc8200227c0 sp=0xc820022748\r\nruntime.goexit()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/asm_amd64.s:2006 +0x1 fp=0xc8200227c8 sp=0xc8200227c0\r\ncreated by runtime.createfing\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/mfinal.go:139 +0x66\r\n\r\ngoroutine 19 [syscall, 3 minutes]:\r\nruntime.notetsleepg(0x753c98, 0x29845e9534, 0x0)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/lock_futex.go:205 +0x34 fp=0xc820022f48 sp=0xc820022f20\r\nruntime.timerproc()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/time.go:209 +0x363 fp=0xc820022fc0 sp=0xc820022f48\r\nruntime.goexit()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/asm_amd64.s:2006 +0x1 fp=0xc820022fc8 sp=0xc820022fc0\r\ncreated by runtime.addtimerLocked\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/time.go:116 +0x115\r\n\r\ngoroutine 22443 [syscall, 3 minutes]:\r\nsyscall.Syscall6(0x7, 0x5dc1, 0xc820036ce4, 0x0, 0xc820090480, 0x0, 0x0, 0x5d1fa0, 0xc800000000, 0xc820010700)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/syscall/asm_freebsd_amd64.s:44 +0x5 fp=0xc820036c38 sp=0xc820036c30\r\nsyscall.wait4(0x5dc1, 0xc820036ce4, 0x0, 0xc820090480, 0x90, 0x617760, 0x1)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/syscall/zsyscall_freebsd_amd64.go:34 +0x78 fp=0xc820036ca8 sp=0xc820036c38\r\nsyscall.Wait4(0x5dc1, 0xc820036d2c, 0x0, 0xc820090480, 0x66c848, 0xc82042e3c0, 0xc82044a7c0)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/syscall/syscall_bsd.go:129 +0x47 fp=0xc820036cf0 sp=0xc820036ca8\r\nos.(*Process).wait(0xc82044ac40, 0xc820080380, 0xc8200840d0, 0xc82044a7e0)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/os/exec_unix.go:22 +0xf4 fp=0xc820036d70 sp=0xc820036cf0\r\nos.(*Process).Wait(0xc82044ac40, 0xc820036dd0, 0x0, 0x0)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/os/doc.go:49 +0x21 fp=0xc820036d98 sp=0xc820036d70\r\nos/exec.(*Cmd).Wait(0xc82042e3c0, 0x0, 0x0)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/os/exec/exec.go:396 +0x58 fp=0xc820036e20 sp=0xc820036d98\r\nos/exec.(*Cmd).Run(0xc82042e3c0, 0xc820080380, 0xc820435c00)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/os/exec/exec.go:262 +0x3e fp=0xc820036e40 sp=0xc820036e20\r\nos/exec.(*Cmd).CombinedOutput(0xc82042e3c0, 0xc82042e3c0, 0xc8200c46d8, 0x1, 0x1, 0xc82042e3c0)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/os/exec/exec.go:453 +0x174 fp=0xc820036e80 sp=0xc820036e40\r\nruntime_test.runTestProg(0xc8200903f0, 0x630885, 0xb, 0x631bdb, 0xd, 0x593b20, 0x427659)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/crash_test.go:68 +0xf9 fp=0xc820036ef0 sp=0xc820036e80\r\nruntime_test.TestCgoCallbackGC(0xc8200903f0)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/crash_cgo_test.go:54 +0x63 fp=0xc820036f80 sp=0xc820036ef0\r\ntesting.tRunner(0xc8200903f0, 0x750720)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/testing/testing.go:473 +0x7e fp=0xc820036fa0 sp=0xc820036f80\r\nruntime.goexit()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/asm_amd64.s:2006 +0x1 fp=0xc820036fa8 sp=0xc820036fa0\r\ncreated by testing.RunTests\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/testing/testing.go:581 +0x30b\r\n\r\ngoroutine 152 [GC worker (idle), 3 minutes]:\r\nruntime.gopark(0xc820010190, 0xc820023fa0, 0x6345fe, 0x10, 0xc820023f14, 0x0)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/proc.go:262 +0x131 fp=0xc820023f48 sp=0xc820023f20\r\nruntime.gcBgMarkWorker(0xc82001f500)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/mgc.go:1397 +0xc1 fp=0xc820023fb8 sp=0xc820023f48\r\nruntime.goexit()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/asm_amd64.s:2006 +0x1 fp=0xc820023fc0 sp=0xc820023fb8\r\ncreated by runtime.gcBgMarkStartWorkers\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/mgc.go:1324 +0x8a\r\n\r\ngoroutine 22444 [syscall, 3 minutes]:\r\nsyscall.Syscall(0x3, 0x4, 0xc820438c00, 0x200, 0x0, 0x5fd, 0x0)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/syscall/asm_freebsd_amd64.s:21 +0x5 fp=0xc820029ca8 sp=0xc820029ca0\r\nsyscall.read(0x4, 0xc820438c00, 0x200, 0x200, 0xc820438c00, 0x0, 0x100000000)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/syscall/zsyscall_freebsd_amd64.go:892 +0x48 fp=0xc820029cf0 sp=0xc820029ca8\r\nsyscall.Read(0x4, 0xc820438c00, 0x200, 0x200, 0x0, 0xc82000d400, 0xc8200ccc00)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/syscall/syscall_unix.go:161 +0x3f fp=0xc820029d30 sp=0xc820029cf0\r\nos.(*File).read(0xc8200840b8, 0xc820438c00, 0x200, 0x200, 0x4c8921, 0x593580, 0x200)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/os/file_unix.go:228 +0x68 fp=0xc820029d70 sp=0xc820029d30\r\nos.(*File).Read(0xc8200840b8, 0xc820438c00, 0x200, 0x200, 0x1, 0x42c675, 0xc8200cccb8)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/os/file.go:95 +0x4c fp=0xc820029dd0 sp=0xc820029d70\r\nbytes.(*Buffer).ReadFrom(0xc820080380, 0x8007d5068, 0xc8200840b8, 0xc820029ea8, 0x40e001, 0x42acb1)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/bytes/buffer.go:176 +0x15f fp=0xc820029e38 sp=0xc820029dd0\r\nio.copyBuffer(0x800810690, 0xc820080380, 0x8007d5068, 0xc8200840b8, 0x0, 0x0, 0x0, 0xc82042c418, 0x0, 0x0)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/io/io.go:374 +0x319 fp=0xc820029ed0 sp=0xc820029e38\r\nio.Copy(0x800810690, 0xc820080380, 0x8007d5068, 0xc8200840b8, 0x593a60, 0xc82042c3c0, 0xc820029f98)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/io/io.go:350 +0x5a fp=0xc820029f28 sp=0xc820029ed0\r\nos/exec.(*Cmd).writerDescriptor.func1(0x593a60, 0xc82042c3c0)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/os/exec/exec.go:236 +0x56 fp=0xc820029f80 sp=0xc820029f28\r\nos/exec.(*Cmd).Start.func1(0xc82042e3c0, 0xc82044a7c0)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/os/exec/exec.go:344 +0x20 fp=0xc820029fb0 sp=0xc820029f80\r\nruntime.goexit()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/asm_amd64.s:2006 +0x1 fp=0xc820029fb8 sp=0xc820029fb0\r\ncreated by os/exec.(*Cmd).Start\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/os/exec/exec.go:345 +0x521\r\n\r\nrax    0x0\r\nrbx    0x7fffffffe168\r\nrcx    0x7fffffff\r\nrdx    0x754088\r\nrdi    0x4\r\nrsi    0x7fffffffe1b0\r\nrbp    0x3b9aca00\r\nrsp    0x7fffffffe1a8\r\nr8     0x7fffffffe160\r\nr9     0x0\r\nr10    0x7fffffff\r\nr11    0x202\r\nr12    0x0\r\nr13    0x7fffffffe200\r\nr14    0x44c670\r\nr15    0x0\r\nrip    0x456597\r\nrflags 0x202\r\ncs     0x43\r\nfs     0x13\r\ngs     0x1b\r\n*** Test killed: ran too long (4m0s).\r\nFAIL\truntime\t647.781s\r\nok  \truntime/debug\t0.020s\r\nok  \truntime/internal/atomic\t0.226s\r\nok  \truntime/pprof\t2.686s\r\n\r\npanic: test timed out after 3m0s\r\n\r\ngoroutine 38 [running]:\r\npanic(0x550220, 0xc8234f4040)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/panic.go:500 +0x189\r\ntesting.startAlarm.func1()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/testing/testing.go:724 +0x10f\r\ncreated by time.goFunc\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/time/sleep.go:129 +0x3a\r\n\r\ngoroutine 1 [chan receive, 2 minutes]:\r\ntesting.RunTests(0x5cfab8, 0x673200, 0x7, 0x7, 0x1)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/testing/testing.go:582 +0x351\r\ntesting.(*M).Run(0xc820034f08, 0x404b89)\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/testing/testing.go:515 +0x79\r\nmain.main()\r\n\truntime/trace/_test/_testmain.go:68 +0xb4\r\n\r\ngoroutine 17 [syscall, 2 minutes, locked to thread]:\r\nruntime.goexit()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/asm_amd64.s:2006 +0x1\r\n\r\ngoroutine 8 [running]:\r\n\tgoroutine running on other thread; stack unavailable\r\ncreated by testing.RunTests\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/testing/testing.go:581 +0x30b\r\n\r\ngoroutine 22 [select (no cases), 2 minutes]:\r\nruntime/trace_test.TestTraceSymbolize.func1()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/trace/trace_stack_test.go:38 +0x14\r\ncreated by runtime/trace_test.TestTraceSymbolize\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/trace/trace_stack_test.go:39 +0xc9\r\n\r\ngoroutine 23 [chan send (nil chan), 2 minutes]:\r\nruntime/trace_test.TestTraceSymbolize.func2()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/trace/trace_stack_test.go:42 +0x3f\r\ncreated by runtime/trace_test.TestTraceSymbolize\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/trace/trace_stack_test.go:43 +0xe1\r\n\r\ngoroutine 24 [chan receive (nil chan), 2 minutes]:\r\nruntime/trace_test.TestTraceSymbolize.func3()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/trace/trace_stack_test.go:46 +0x35\r\ncreated by runtime/trace_test.TestTraceSymbolize\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/trace/trace_stack_test.go:47 +0xf9\r\n\r\ngoroutine 84 [select (no cases), 2 minutes]:\r\nruntime/trace_test.TestTraceStress.func9()\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/trace/trace_test.go:200 +0x19\r\ncreated by runtime/trace_test.TestTraceStress\r\n\t/usr/home/rhinofly/ds/sandspace/tips-go/src/runtime/trace/trace_test.go:201 +0x539\r\n*** Test killed: ran too long (4m0s).\r\nFAIL\truntime/trace\t944.500s\r\nok  \tsort\t0.138s\r\nok  \tstrconv\t1.259s\r\nok  \tstrings\t0.706s\r\nok  \tsync\t0.171s\r\n\u003c/pre\u003e\r\n\r\n\u003cpre\u003e\r\n$ top -IaS\r\n\r\nlast pid: 24204;  load averages: 92.07, 46.36, 21.11                                                                                                                  up 0+01:16:39  16:07:03\r\n120 processes: 4 running, 115 sleeping, 1 waiting\r\nCPU: 19.0% user,  0.0% nice, 81.0% system,  0.0% interrupt,  0.0% idle\r\nMem: 575M Active, 503M Inact, 4076M Wired, 1468K Cache, 2740M Free\r\nARC: 1954M Total, 658M MFU, 975M MRU, 162K Anon, 29M Header, 292M Other\r\nSwap: \r\n\r\n  PID USERNAME    THR PRI NICE   SIZE    RES STATE   C   TIME    WCPU COMMAND\r\n24001 rhinofly    204  20    0   117M 48424K uwait   1   6:05 156.30% /tmp/go-build734138444/testprogcgo.exe CgoCallbackGC\r\n 1325 rhinofly      1  20    0   180M 38560K select  1   1:15   0.78% X :0 (Xorg)\r\n   22 root          1  24    -     0K    16K geli:w  0   1:26   0.39% [g_eli[0] ada0p4]\r\n 1219 root          1  20    0 16736K  2236K select  1   0:06   0.20% /usr/sbin/moused -p /dev/ums0 -t auto -I /var/run/moused.ums0.pid\r\n 1512 rhinofly      4  52    0   219M 27364K select  1   0:17   0.10% /usr/local/bin/xfce4-terminal\r\n\u003c/pre\u003e\r\n\r\n\u003cpre\u003e\r\n$ pstree -p 24001\r\n-+= 00001 root /sbin/init --\r\n \\-+- 01512 rhinofly /usr/local/bin/xfce4-terminal\r\n   \\-+= 03094 rhinofly bash\r\n     \\-+= 21931 rhinofly bash ./all.bash\r\n       \\-+- 22842 rhinofly go tool dist test -rebuild --no-rebuild\r\n         \\-+- 22857 rhinofly /usr/home/rhinofly/ds/sandspace/tips-go/pkg/tool/freebsd_amd64/dist test -rebuild --no-rebuild\r\n           \\-+- 22870 rhinofly go test -short -tags= -timeout=3m0s -gcflags= archive/tar archive/zip bufio bytes compress/bzip2 compress/flate compress/gzip compress/lzw compress/zlib conta\r\n             \\-+- 23893 rhinofly /tmp/go-build431565516/runtime/_test/runtime.test -test.short=true -test.timeout=3m0s\r\n               \\--- 24001 rhinofly /tmp/go-build734138444/testprogcgo.exe CgoCallbackGC\r\n\u003c/pre\u003e\r\n\r\n### more info:\r\n\r\nExcepted kill timeout is test.timeout=3m0s, but in most case the test run more then 3min(4m0s in this case), looks like the parent(PID 23893) has no CPU tick to issue \"kill -SIGQUIT\" to CgoCallbackGC (PID 24001).\r\n\r\nIs that too many goroutine created from https://github.com/golang/go/blob/master/src/runtime/testdata/testprogcgo/callback.go#L66?\r\n\u003cpre\u003e\r\n 65 func CgoCallbackGC() {\r\n 66         const P = 100\r\n 67         done := make(chan bool)\r\n 68         // allocate a bunch of stack frames and spray them with pointers\r\n\u003c/pre\u003e\r\n\r\nAfter reduce const P = 100 to const P = 20 everything is OK(ok  \truntime/trace\t41.667s). Maybe a auto-detect P base on runtime.NumCPU() is better?\r\n",
	"user": {
		"login": "wheelcomplex",
		"id": 1411633,
		"type": "User",
		"site_admin": false
	},
	"comments": 4,
	"closed_at": "2016-03-11T09:46:41Z",
	"created_at": "2016-03-11T09:02:13Z",
	"updated_at": "2016-03-14T01:44:19Z"
}
