{
	"id": 51281797,
	"number": 4199,
	"state": "closed",
	"title": "cmd/6g: investigate x*5 =\u003e x\u003c\u003c2 + x",
	"body": "\u003cpre\u003ego version devel +8230013d1c40 Thu Oct 04 15:42:57 2012 -0400\n\npackage x\n\nfunc idct(dst []byte, stride int, src *[64]int) {\n\t// Horizontal 1-D IDCT.\n\tfor y := 0; y \u0026lt; 8; y++ {\n\t\t// If all the AC components are zero, then the IDCT is trivial.\n\t\tif src[y*8+1] == 0 \u0026amp;\u0026amp; src[y*8+2] == 0 {\n\t\t\tdc := src[y*8+0] \u0026lt;\u0026lt; 3\n\t\t\tsrc[y*8+0] = dc\n\t\t}\n\t}\n}\n\n6g output:\n\n0000 (x.go:3) TEXT    idct+0(SB),$0-40\n0001 (x.go:3) MOVQ    src+32(FP),CX\n0002 (x.go:5) MOVQ    $0,AX\n0003 (x.go:5) JMP     ,5\n0004 (x.go:5) INCQ    ,AX\n0005 (x.go:5) CMPQ    AX,$8\n0006 (x.go:5) JGE     $0,49\n0007 (x.go:7) MOVQ    AX,BP\n0008 (x.go:7) IMULQ   $8,BP\n0009 (x.go:7) INCQ    ,BP\n0010 (x.go:7) MOVQ    CX,R8\n0011 (x.go:7) CMPQ    BP,$64\n0012 (x.go:7) JCS     $1,15\n0013 (x.go:7) CALL    ,runtime.panicindex+0(SB)\n0014 (x.go:7) UNDEF   ,\n0015 (x.go:7) MOVQ    (R8)(BP*8),BX\n0016 (x.go:7) CMPQ    BX,$0\n0017 (x.go:7) JNE     ,4\n0018 (x.go:7) MOVQ    AX,BP\n0019 (x.go:7) IMULQ   $8,BP\n0020 (x.go:7) ADDQ    $2,BP\n0021 (x.go:7) MOVQ    CX,R8\n0022 (x.go:7) CMPQ    BP,$64\n0023 (x.go:7) JCS     $1,26\n0024 (x.go:7) CALL    ,runtime.panicindex+0(SB)\n0025 (x.go:7) UNDEF   ,\n0026 (x.go:7) MOVQ    (R8)(BP*8),BX\n0027 (x.go:7) CMPQ    BX,$0\n0028 (x.go:7) JNE     ,4\n0029 (x.go:8) MOVQ    AX,BP\n0030 (x.go:8) IMULQ   $8,BP\n0031 (x.go:8) ADDQ    $0,BP\n0032 (x.go:8) MOVQ    CX,R8\n0033 (x.go:8) CMPQ    BP,$64\n0034 (x.go:8) JCS     $1,37\n0035 (x.go:8) CALL    ,runtime.panicindex+0(SB)\n0036 (x.go:8) UNDEF   ,\n0037 (x.go:8) MOVQ    (R8)(BP*8),SI\n0038 (x.go:8) SHLQ    $3,SI\n0039 (x.go:9) MOVQ    AX,BP\n0040 (x.go:9) IMULQ   $8,BP\n0041 (x.go:9) ADDQ    $0,BP\n0042 (x.go:9) MOVQ    CX,BX\n0043 (x.go:9) CMPQ    BP,$64\n0044 (x.go:9) JCS     $1,47\n0045 (x.go:9) CALL    ,runtime.panicindex+0(SB)\n0046 (x.go:9) UNDEF   ,\n0047 (x.go:9) MOVQ    SI,(BX)(BP*8)\n0048 (x.go:7) JMP     ,4\n0049 (x.go:12) RET     ,\n\nAFter linking:\n\ncodeblk [0x2000,0x13800) at offset 0x1000\n002000\tmain.idct            | (3)\tTEXT\tmain.idct+0(SB),$171798691840\n002000\t65488b0c25a0080000   | (3)\tMOVQ\t2208(GS),CX\n002009\t483b21               | (3)\tCMPQ\tSP,(CX)\n00200c\t7705                 | (3)\tJHI\t,2013\n00200e\te89d100100           | (3)\tCALL\t,130b0+runtime.morestack40\n002013\t488b4c2428           | (3)\tMOVQ\tmain.src+40(SP),CX\n002018\t4831c0               | (5)\tMOVQ\t$0,AX\n00201b\t4883f808             | (5)\tCMPQ\tAX,$8\n00201f\t7d78                 | (5)\tJGE\t$0,2099\n002021\t4889c5               | (7)\tMOVQ\tAX,BP\n002024\t486bed08             | (7)\tIMULQ\t$8,BP\n002028\t48ffc5               | (7)\tINCQ\t,BP\n00202b\t4989c8               | (7)\tMOVQ\tCX,R8\n00202e\t4883fd40             | (7)\tCMPQ\tBP,$64\n002032\t737b                 | (7)\tJCC\t$1,20af\n002034\t498b1ce8             | (7)\tMOVQ\t(R8)(BP*8),BX\n002038\t4883fb00             | (7)\tCMPQ\tBX,$0\n00203c\t7552                 | (7)\tJNE\t,2090\n00203e\t4889c5               | (7)\tMOVQ\tAX,BP\n002041\t486bed08             | (7)\tIMULQ\t$8,BP\n002045\t4883c502             | (7)\tADDQ\t$2,BP\n002049\t4989c8               | (7)\tMOVQ\tCX,R8\n00204c\t4883fd40             | (7)\tCMPQ\tBP,$64\n002050\t7356                 | (7)\tJCC\t$1,20a8\n002052\t498b1ce8             | (7)\tMOVQ\t(R8)(BP*8),BX\n002056\t4883fb00             | (7)\tCMPQ\tBX,$0\n00205a\t7534                 | (7)\tJNE\t,2090\n00205c\t4889c5               | (8)\tMOVQ\tAX,BP\n00205f\t486bed08             | (8)\tIMULQ\t$8,BP\n002063\t4883c500             | (8)\tADDQ\t$0,BP\n002067\t4989c8               | (8)\tMOVQ\tCX,R8\n00206a\t4883fd40             | (8)\tCMPQ\tBP,$64\n00206e\t7331                 | (8)\tJCC\t$1,20a1\n002070\t498b34e8             | (8)\tMOVQ\t(R8)(BP*8),SI\n002074\t48c1e603             | (8)\tSHLQ\t$3,SI\n002078\t4889c5               | (9)\tMOVQ\tAX,BP\n00207b\t486bed08             | (9)\tIMULQ\t$8,BP\n00207f\t4883c500             | (9)\tADDQ\t$0,BP\n002083\t4889cb               | (9)\tMOVQ\tCX,BX\n002086\t4883fd40             | (9)\tCMPQ\tBP,$64\n00208a\t730e                 | (9)\tJCC\t$1,209a\n00208c\t488934eb             | (9)\tMOVQ\tSI,(BX)(BP*8)\n002090\t48ffc0               | (5)\tINCQ\t,AX\n002093\t4883f808             | (5)\tCMPQ\tAX,$8\n002097\t7c88                 | (5)\tJLT\t$0,2021\n002099\tc3                   | (12)\tRET\t,\n00209a\te8017d0000           | (9)\tCALL\t,9da0+runtime.panicindex\n00209f\t0f0b                 | (9)\tUNDEF\t,\n0020a1\te8fa7c0000           | (8)\tCALL\t,9da0+runtime.panicindex\n0020a6\t0f0b                 | (8)\tUNDEF\t,\n0020a8\te8f37c0000           | (7)\tCALL\t,9da0+runtime.panicindex\n0020ad\t0f0b                 | (7)\tUNDEF\t,\n0020af\te8ec7c0000           | (7)\tCALL\t,9da0+runtime.panicindex\n0020b4\t0f0b                 | (7)\tUNDEF\t,\n_                    000020b6| 00 00 00 00 00 00 00 00 00 00\n\n\nThe IMULQs are all by $8 and could be shifts. Also there are some instances of ADDQ $0,\nBP, which are pointless.\u003c/pre\u003e",
	"user": {
		"login": "robpike",
		"id": 4324516,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		},
		{
			"name": "Performance"
		}
	],
	"comments": 10,
	"closed_at": "2014-12-08T10:22:22Z",
	"created_at": "2012-10-05T20:28:41Z",
	"updated_at": "2016-06-24T22:26:04Z"
}
