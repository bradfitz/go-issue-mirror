{
	"id": 53825885,
	"number": 9543,
	"state": "closed",
	"title": "net/http: Default Client / HTTP mangles requests with specific long urls causing remote servers to throw 400s on valid requests",
	"body": "1.) Go Version: `go1.3 darwin/amd64` (Also affects `go version go1.3 linux/amd64`)\r\n2.)  `OSX 10.9.5` / `Ubuntu 12.04.2 LTS (GNU/Linux 3.2.0-24-generic x86_64)`\r\n3.) \r\n\r\nWhen making a request with **this specific** a long url (it seems when the query_string is 266 characters), the go http client seems to mangle the request.\r\n\r\nHere is a sample hits that hits the google homepage, making the query longer and longer until the error occurs: https://gist.github.com/nemothekid/501fb7e520999342560a\r\n\r\n4.) For comparison, the python requests library doesn't have a problem with this:\r\n\r\n```python\r\n\u003e\u003e\u003e import requests\r\n\u003e\u003e\u003e r = requests.get(\"https://www.google.com?part=id\u0026id=ZKfj0-ygXbg%2C8SINiaqgNIQ%2CxeQhXEJaHRo%2CU2VHAMOP5DY%2CGMr1JhKms5M%2CyKjYj5HMaNU%2CJgFAaxNc-tk%2CoMnDCxiZVMw%2Ck4VG725R4X0%2CU-s10nNV_N0%2CkN-p51dFYrk%2CmmIFr0NgRi8%2C4uuQ-qxjqbU%2CuRaePS8fjQE%2CJt_G6a4g9lw%2C5GaFxfjdfX8%2CoKoDg2aG-z4%2CrArN_38Xil8%2C -RuZqxSiFIw%2CNBvTI73iNDo%2CDaRvvkud9MQ%2CZm4y67kxpBk%2CG9MQIHE4pd0%2C2YwKlqgCdQw%2C6pc67X22kFo%2CYvxGDTawvAI%2CgpdFKiMGrDA%2CVEqtKfXYX6A%2ClqQCJ-xCEBE%2CmW8WwnqTmDA%2CZ0W_4kN8isA%2C3i8icj_wJGM%2C0i6E8FPecGc%2Cw8ISxSwSz-0%2CGx2ahhyKqEU%2CrFsJdFKsJDU%2C9ET_qEJYEew%2CVdXBiVM6hyI%2CefL0fPMZGCo%2CHH1OMx7dhhk%2ClvCd9zjXeZE%2CIJ0uQjwTc8o%2CMqoReZ6WJjU%2C0UkWtQGzdXc%2CIZjgPfWX8Jc%2CGvnULl2TRlw%2C6UNXAoOt-zk%2CQDaDKoGV-YA%2CX253vC7vvb8%2Cc-MWDL4C8PY\u0026maxResults=50\u0026\")\r\n\u003e\u003e\u003e r.text\r\nu'\u003c!doctype html\u003e\u003chtml itemscope=\"\" itemtype=\"http://schema.org/WebPage\" lang=\"en\"\u003e\u003chead\u003e\u003cmeta content=\"Search the world\\'s information, including webpages, images, videos and more. Google has many special features to help you find exactly what you\\'re looking for.\" name=\"description\"\u003e\u003cmeta content=\"noodp\" name=\"robots\"\u003e\u003cmeta content=\"/images/google_favicon_128.png\" itemprop=\"image\"\u003e\u003ctitle\u003eGoogle\u003c/title\u003e\u003cscript\u003e(function(){window.google={kEI:\\'tzGvVITFIomDoQTBrYGgCA...\r\n```\r\n\r\n5.) If you run the code above, Google (and other servers) you will get a 400 error. (I'm not sure what Google's 400 looks like, but I'm unsure even if the response completes).\r\n\r\n```\r\n\u003c!DOCTYPE html\u003e\r\n\u003chtml lang=en\u003e\r\n  \u003cmeta charset=utf-8\u003e\r\n  \u003cmeta name=viewport content=\"initial-scale=1, minimum-scale=1, width=device-width\"\u003e\r\n  \u003ctitle\u003eError 400 (Bad Request)!!1\u003c/title\u003e\r\n  \u003cstyle\u003e\r\n    *{margin:0;padding:0}html,code{font:15px/22px arial,sans-serif}html{background:#fff;color:#222;padding:15px}body{margin:7% auto 0;max-width:390px;min-height:180px;padding:30px 0 15px}* \u003e body{background:url(//www.google.com/images/errors/robot.png) 100% 5px no-repeat;padding-right:205px}p{margin:11px 0 22px;overflow:hidden}ins{color:#777;text-decoration:none}a img{border:0}@media screen and (max-width:772px){body{background:none;margin-top:0;max-width:none;padding-right:0}}#logo{background:url(//www.google.com/images/errors/logo_sm_2.png) no-repeat}@media only screen and (min-resolution:192dpi){#logo{background:url(//www.google.com/images/errors/logo_sm_2_hr.png) no-repeat 0% 0%/100% 100%;-moz-border-image:url(//www.google.com/images/errors/logo_sm_2_hr.png) 0}}@media only screen and (-webkit-min-device-pixel-ratio:2){#logo{background:url(//www.google.com/images/errors/logo_sm_2_hr.png) no-repeat;-webkit-background-size:100% 100%}}#logo{display:inline-block;height:55px;width:150px}\r\n  \u003c/style\u003e\r\n  \u003ca href=//www.google.com/\u003e\u003cspan id=logo aria-label=Google\u003e\u003c/span\u003e\u003c/a\u003e\r\n  \u003cp\u003e\u003cb\u003e400.\u003c/b\u003e \u003cins\u003eThat’s an error.\u003c/ins\u003e\r\n  \u003cp\u003eYour client has issued a malformed or illegal request.  \u003cins\u003eThat’s all we know.\u003c/ins\u003e\r\n```\r\n\r\nThis doesn't effect every long url, for example in the gist provided if you set `u` to:\r\n```go\r\nu := h + \"?part=id\u0026id=LxtN--HMNsA%2CgiIT5ALtjPY%2C5fmzALLsofw%2CahBMSnKmMHs%2C2lduGacyTTo%2CQTXrc-XrHc4%2ChleMcTD8qrk%2CLVa9IMK6-bg%2CF9SyVu74gWg%2Cz5ITVelLBYY%2Ccx-lqXEU_aI%2Cvcr4MzfQQvQ%2CCNBVPuHmn70%2C0VmHS9CQcZI%2CS7IDGVC1KN4%2CsuUOAusvDEc%2CMpg41_O5XOY%2CHa1a_UEIsiE%2CRLkWr_ybDqc%2C_YFGr_9vBwg%2CeIo9iuZ6REA%2CePCalOWbEn8%2CwYt_PSUtp-A%2CJzt6JODbssE%2ClfYHdaUfSjY%2CEtcGmHs3Qss%2CyaqNkw0HW7M%2CqxCfvgeeT58%2Cc2MSgxccv_0%2Cm8UnfePn2fg%2C4h0TiFKao2w%2CVo8yWORV7TI%2C2JxxLHafwMg%2CL_YTkZtfuAA%2CODV566R-4wc%2CPlZ4MQR0de4%2CzsbpRQDNQKQ%2CAGWNVxcF4P0%2CtgSAufCbf6M%2C1jXC6L4WREE%2C7GnhVg61l5w%2C2YEccc4Vp44%2CDg0E7pzAm8o%2CRKzWK1eyPAQ%2Ct-dPaxAuDkY%2Cjh3hRvNy1C0%2CtitAChBO0jc%2CBinjgB0bWjE%2Cx7rHmM-cUjs%2CttT0GmCLeVs\u0026maxResults=50\"\r\n```\r\nyou can successfully execute that entire request with no problems. (I also don't know what the difference between the two urls, both are essentially random strings).\r\n",
	"user": {
		"login": "nemothekid",
		"id": 940094,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"comments": 3,
	"closed_at": "2015-01-09T03:03:15Z",
	"created_at": "2015-01-09T02:03:33Z",
	"updated_at": "2016-06-25T01:58:07Z"
}
