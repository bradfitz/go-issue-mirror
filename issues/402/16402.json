{
	"id": 165981855,
	"number": 16402,
	"state": "closed",
	"title": "x/tools/imports: upper-cased import paths not being selected as candidates",
	"body": "I just noticed that import paths that start with an uppercase letter don't get imported automatically after the update.\r\n\r\nLooking at the code and  https://github.com/golang/tools/blob/master/imports/fix.go#L651,\r\nI tried to change the behavior, using strings.ToLower on `lastTwoComponents` and the package gets imported automatically.\r\n\r\n1. What version of Go are you using (`go version`)?\r\n1.6.2\r\n\r\n2. What operating system and processor architecture are you using (`go env`)?\r\n```bash\r\nGOARCH=\"amd64\"\r\nGOBIN=\"\"\r\nGOEXE=\"\"\r\nGOHOSTARCH=\"amd64\"\r\nGOHOSTOS=\"darwin\"\r\nGOOS=\"darwin\"\r\nGOPATH=\"/Users/vincenzo\"\r\nGORACE=\"\"\r\nGOROOT=\"/usr/local/Cellar/go/1.6.2/libexec\"\r\nGOTOOLDIR=\"/usr/local/Cellar/go/1.6.2/libexec/pkg/tool/darwin_amd64\"\r\nGO15VENDOREXPERIMENT=\"0\"\r\nCC=\"clang\"\r\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fno-common\"\r\nCXX=\"clang++\"\r\nCGO_ENABLED=\"1\"\r\n```\r\n\r\n3. What did you do?\r\nWrote a simple test to make goimports find an import path with an uppercase letter\r\n\r\n```go\r\nfunc TestFindUpperCasedImportGoPath(t *testing.T) {\r\n\ttestConfig{\r\n\t\tgopathFiles: map[string]string{\r\n\t\t\t\"golang.org/bits/Bytes/bytes.go\": \"package bytes\\ntype Buffer2 struct {}\\n\",\r\n\t\t},\r\n\t}.test(t, func(t *goimportTest) {\r\n\t\tgot, rename, err := findImportGoPath(\"bytes\", map[string]bool{\"Buffer2\": true}, filepath.Join(t.gopath, \"src/golang.org/x.go\"))\r\n\t\tif err != nil {\r\n\t\t\tt.Fatal(err)\r\n\t\t}\r\n\t\twant := \"golang.org/bits/Bytes\"\r\n\t\tif got != want || !rename {\r\n\t\t\tt.Errorf(`findImportGoPath(\"bytes\", Buffer2 ...) = %q, %t; want %q, true`, got, rename, want)\r\n\t\t}\r\n\t})\r\n}\r\n```\r\n\r\n4. What did you expect to see?\r\nTest passing and two candidates for `TestFindUpperCasedImportGoPath`.\r\n\u003cpre\u003e\r\n\u003e Environment:\r\n\u003e   GOROOT=/usr/local/Cellar/go/1.6.2/libexec\r\n\u003e   GOPATH=/Users/vincenzo\r\n\u003e Directory: /Users/vincenzo/src/golang.org/x/tools/imports\r\n\u003e Command: /usr/local/bin/go test -v\r\n\u003e Output:\r\n=== RUN   TestFixImports\r\n--- PASS: TestFixImports (0.00s)\r\n=== RUN   TestImportSymlinks\r\n2016/07/17 10:38:12 mypkg candidate 1/1: x/mypkg\r\n--- PASS: TestImportSymlinks (0.01s)\r\n=== RUN   TestFixImportsVendorPackage\r\n--- PASS: TestFixImportsVendorPackage (0.00s)\r\n=== RUN   TestFindImportGoPath\r\n2016/07/17 10:38:12 bytes candidate 1/1: bits/bytes\r\n2016/07/17 10:38:12 bytes candidate 1/1: bits/bytes\r\n--- PASS: TestFindImportGoPath (0.00s)\r\n=== RUN   TestFindImportInternal\r\n2016/07/17 10:38:12 race candidate 1/5: cmd/trace\r\n2016/07/17 10:38:12 race candidate 2/5: runtime/race\r\n2016/07/17 10:38:12 race candidate 3/5: internal/race\r\n2016/07/17 10:38:12 race candidate 4/5: runtime/trace\r\n2016/07/17 10:38:12 race candidate 5/5: internal/trace\r\n2016/07/17 10:38:12 race candidate 1/3: cmd/trace\r\n2016/07/17 10:38:12 race candidate 2/3: runtime/race\r\n2016/07/17 10:38:12 race candidate 3/3: runtime/trace\r\n--- PASS: TestFindImportInternal (0.01s)\r\n=== RUN   TestFindImportRandRead\r\n--- PASS: TestFindImportRandRead (0.00s)\r\n=== RUN   TestFindImportVendor\r\n2016/07/17 10:38:12 hpack candidate 1/1: golang.org/x/net/http2/hpack\r\n--- PASS: TestFindImportVendor (0.00s)\r\n=== RUN   TestFindUpperCasedImportGoPath\r\n\u003cb\u003e2016/07/17 10:38:12 bytes candidate 1/2: bytes\r\n2016/07/17 10:38:12 bytes candidate 2/2: golang.org/bits/Bytes\r\n--- PASS: TestFindUpperCasedImportGoPath (0.01s)\u003c/b\u003e\r\n=== RUN   TestProcessVendor\r\n2016/07/17 10:38:12 hpack candidate 1/1: internal/golang.org/x/net/http2/hpack\r\n--- PASS: TestProcessVendor (0.01s)\r\n=== RUN   TestFindImportStdlib\r\n--- PASS: TestFindImportStdlib (0.00s)\r\n=== RUN   TestRenameWhenPackageNameMismatch\r\n--- PASS: TestRenameWhenPackageNameMismatch (0.00s)\r\n=== RUN   TestOptimizationWhenInGoroot\r\n2016/07/17 10:38:12 bar candidate 1/1: foo/bar/v1\r\n--- PASS: TestOptimizationWhenInGoroot (0.01s)\r\n=== RUN   TestIgnoreDocumentationPackage\r\n2016/07/17 10:38:12 foo candidate 1/1: foo\r\n--- PASS: TestIgnoreDocumentationPackage (0.00s)\r\n=== RUN   TestImportPathToNameGoPathParse\r\n--- PASS: TestImportPathToNameGoPathParse (0.00s)\r\n=== RUN   TestIgnoreConfiguration\r\n2016/07/17 10:38:12 pkg candidate 1/1: otherwise-longer-so-worse.example.net/foo/pkg\r\n--- PASS: TestIgnoreConfiguration (0.01s)\r\nPASS\r\nok  \tgolang.org/x/tools/imports\t0.065s\r\n\u003e Elapsed: 1.098s\r\n\u003e Result: Success\r\n\u003c/pre\u003e\r\n\r\n5. What did you see instead?\r\nTest failed (output below) and only 1 candidate for `TestFindUpperCasedImportGoPath`.\r\n\r\n\u003cpre\u003e\r\n=== RUN   TestFixImports\r\n--- PASS: TestFixImports (0.00s)\r\n=== RUN   TestImportSymlinks\r\n2016/07/17 10:45:35 mypkg candidate 1/1: x/mypkg\r\n--- PASS: TestImportSymlinks (0.01s)\r\n=== RUN   TestFixImportsVendorPackage\r\n--- PASS: TestFixImportsVendorPackage (0.00s)\r\n=== RUN   TestFindImportGoPath\r\n2016/07/17 10:45:35 bytes candidate 1/1: bits/bytes\r\n2016/07/17 10:45:35 bytes candidate 1/1: bits/bytes\r\n--- PASS: TestFindImportGoPath (0.00s)\r\n=== RUN   TestFindImportInternal\r\n2016/07/17 10:45:35 race candidate 1/5: cmd/trace\r\n2016/07/17 10:45:35 race candidate 2/5: runtime/race\r\n2016/07/17 10:45:35 race candidate 3/5: internal/race\r\n2016/07/17 10:45:35 race candidate 4/5: runtime/trace\r\n2016/07/17 10:45:35 race candidate 5/5: internal/trace\r\n2016/07/17 10:45:35 race candidate 1/3: cmd/trace\r\n2016/07/17 10:45:35 race candidate 2/3: runtime/race\r\n2016/07/17 10:45:35 race candidate 3/3: runtime/trace\r\n--- PASS: TestFindImportInternal (0.00s)\r\n=== RUN   TestFindImportRandRead\r\n--- PASS: TestFindImportRandRead (0.00s)\r\n=== RUN   TestFindImportVendor\r\n2016/07/17 10:45:35 hpack candidate 1/1: golang.org/x/net/http2/hpack\r\n--- PASS: TestFindImportVendor (0.00s)\r\n=== RUN   TestFindUpperCasedImportGoPath\r\n\u003cb\u003e2016/07/17 10:45:35 bytes candidate 1/1: bytes\r\n--- FAIL: TestFindUpperCasedImportGoPath (0.01s)\r\n\tfix_test.go:1105: findImportGoPath(\"bytes\", Buffer2 ...) = \"\", false; want \"golang.org/bits/Bytes\", true\u003c/b\u003e\r\n=== RUN   TestProcessVendor\r\n2016/07/17 10:45:35 hpack candidate 1/1: internal/golang.org/x/net/http2/hpack\r\n--- PASS: TestProcessVendor (0.01s)\r\n=== RUN   TestFindImportStdlib\r\n--- PASS: TestFindImportStdlib (0.00s)\r\n=== RUN   TestRenameWhenPackageNameMismatch\r\n2016/07/17 10:45:35 bar candidate 1/1: foo/bar/v1\r\n--- PASS: TestRenameWhenPackageNameMismatch (0.01s)\r\n=== RUN   TestOptimizationWhenInGoroot\r\n--- PASS: TestOptimizationWhenInGoroot (0.01s)\r\n=== RUN   TestIgnoreDocumentationPackage\r\n2016/07/17 10:45:35 foo candidate 1/1: foo\r\n--- PASS: TestIgnoreDocumentationPackage (0.01s)\r\n=== RUN   TestImportPathToNameGoPathParse\r\n--- PASS: TestImportPathToNameGoPathParse (0.00s)\r\n=== RUN   TestIgnoreConfiguration\r\n2016/07/17 10:45:35 pkg candidate 1/1: otherwise-longer-so-worse.example.net/foo/pkg\r\n--- PASS: TestIgnoreConfiguration (0.01s)\r\nFAIL\r\nexit status 1\r\nFAIL\tgolang.org/x/tools/imports\t0.068s\r\n\u003e Elapsed: 1.119s\r\n\u003e Result: Error\r\n\u003c/pre\u003e\r\n\r\n",
	"user": {
		"login": "vinceprignano",
		"id": 3118335,
		"type": "User",
		"site_admin": false
	},
	"assignee": {
		"login": "bradfitz",
		"id": 2621,
		"type": "User",
		"site_admin": false
	},
	"comments": 5,
	"closed_at": "2016-07-18T23:39:41Z",
	"created_at": "2016-07-17T15:40:20Z",
	"updated_at": "2016-07-18T23:39:41Z",
	"milestone": {
		"id": 1067491,
		"number": 22,
		"title": "Unreleased"
	}
}
