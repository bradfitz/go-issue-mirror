{
	"id": 131196113,
	"body": "I'm new to boltdb so can't speak to the reason they used mmap.\r\n\r\nMy patch is for x/sys/unix itself.  It appears the solaris build has been broken for some time:\r\n\r\n     http://build.golang.org/?repo=golang.org%2fx%2fsys\r\n\r\nHere is my x/sys patch:\r\n```\r\ndiff --git a/unix/mksyscall_solaris.pl b/unix/mksyscall_solaris.pl\r\nindex e81edb9..9ec19e0 100755\r\n--- a/unix/mksyscall_solaris.pl\r\n+++ b/unix/mksyscall_solaris.pl\r\n@@ -269,7 +269,10 @@ print \u003c\u003cEOF;\r\n \r\n package $package\r\n \r\n-import \"unsafe\"\r\n+import (\r\n+       \"syscall\"\r\n+       \"unsafe\"\r\n+)\r\n EOF\r\n \r\n print \"import \\\"golang.org/x/sys/unix\\\"\\n\" if $package ne \"unix\";\r\ndiff --git a/unix/syscall_solaris.go b/unix/syscall_solaris.go\r\nindex ea5ac78..d5886ee 100644\r\n--- a/unix/syscall_solaris.go\r\n+++ b/unix/syscall_solaris.go\r\n@@ -527,3 +527,17 @@ func writelen(fd int, buf *byte, nbuf int) (n int, err error) {\r\n        }\r\n        return\r\n }\r\n+\r\n+var mapper = \u0026mmapper{\r\n+       active: make(map[*byte][]byte),\r\n+       mmap:   mmap,\r\n+       munmap: munmap,\r\n+}\r\n+\r\n+func Mmap(fd int, offset int64, length int, prot int, flags int) (data []byte, err error) {\r\n+       return mapper.Mmap(fd, offset, length, prot, flags)\r\n+}\r\n+\r\n+func Munmap(b []byte) (err error) {\r\n+       return mapper.Munmap(b)\r\n+}\r\ndiff --git a/unix/zsyscall_solaris_amd64.go b/unix/zsyscall_solaris_amd64.go\r\nindex 4c2f8bf..a05befa 100644\r\n--- a/unix/zsyscall_solaris_amd64.go\r\n+++ b/unix/zsyscall_solaris_amd64.go\r\n@@ -5,92 +5,96 @@\r\n \r\n package unix\r\n \r\n-import \"unsafe\"\r\n+import (\r\n+       \"syscall\"\r\n+       \"unsafe\"\r\n+)\r\n \r\n var (\r\n-       modlibc      = syscall.newLazySO(\"libc.so\")\r\n-       modlibsocket = syscall.newLazySO(\"libsocket.so\")\r\n-\r\n-       procgetgroups    = modlibc.NewProc(\"getgroups\")\r\n-       procsetgroups    = modlibc.NewProc(\"setgroups\")\r\n-       procfcntl        = modlibc.NewProc(\"fcntl\")\r\n-       procaccept       = modlibsocket.NewProc(\"accept\")\r\n-       procsendmsg      = modlibsocket.NewProc(\"sendmsg\")\r\n-       procAccess       = modlibc.NewProc(\"access\")\r\n-       procAdjtime      = modlibc.NewProc(\"adjtime\")\r\n-       procChdir        = modlibc.NewProc(\"chdir\")\r\n-       procChmod        = modlibc.NewProc(\"chmod\")\r\n-       procChown        = modlibc.NewProc(\"chown\")\r\n-       procChroot       = modlibc.NewProc(\"chroot\")\r\n-       procClose        = modlibc.NewProc(\"close\")\r\n-       procDup          = modlibc.NewProc(\"dup\")\r\n-       procExit         = modlibc.NewProc(\"exit\")\r\n-       procFchdir       = modlibc.NewProc(\"fchdir\")\r\n-       procFchmod       = modlibc.NewProc(\"fchmod\")\r\n-       procFchown       = modlibc.NewProc(\"fchown\")\r\n-       procFpathconf    = modlibc.NewProc(\"fpathconf\")\r\n-       procFstat        = modlibc.NewProc(\"fstat\")\r\n-       procGetdents     = modlibc.NewProc(\"getdents\")\r\n-       procGetgid       = modlibc.NewProc(\"getgid\")\r\n-       procGetpid       = modlibc.NewProc(\"getpid\")\r\n-       procGeteuid      = modlibc.NewProc(\"geteuid\")\r\n-       procGetegid      = modlibc.NewProc(\"getegid\")\r\n-       procGetppid      = modlibc.NewProc(\"getppid\")\r\n-       procGetpriority  = modlibc.NewProc(\"getpriority\")\r\n-       procGetrlimit    = modlibc.NewProc(\"getrlimit\")\r\n+       modlibc = newLazySO(\"libc.so\")\r\n+       modlibsocket = newLazySO(\"libsocket.so\")\r\n+\r\n+       procgetgroups = modlibc.NewProc(\"getgroups\")\r\n+       procsetgroups = modlibc.NewProc(\"setgroups\")\r\n+       procfcntl = modlibc.NewProc(\"fcntl\")\r\n+       procaccept = modlibsocket.NewProc(\"accept\")\r\n+       procsendmsg = modlibsocket.NewProc(\"sendmsg\")\r\n+       procAccess = modlibc.NewProc(\"access\")\r\n+       procAdjtime = modlibc.NewProc(\"adjtime\")\r\n+       procChdir = modlibc.NewProc(\"chdir\")\r\n+       procChmod = modlibc.NewProc(\"chmod\")\r\n+       procChown = modlibc.NewProc(\"chown\")\r\n+       procChroot = modlibc.NewProc(\"chroot\")\r\n+       procClose = modlibc.NewProc(\"close\")\r\n+       procDup = modlibc.NewProc(\"dup\")\r\n+       procExit = modlibc.NewProc(\"exit\")\r\n+       procFchdir = modlibc.NewProc(\"fchdir\")\r\n+       procFchmod = modlibc.NewProc(\"fchmod\")\r\n+       procFchown = modlibc.NewProc(\"fchown\")\r\n+       procFpathconf = modlibc.NewProc(\"fpathconf\")\r\n+       procFstat = modlibc.NewProc(\"fstat\")\r\n+       procGetdents = modlibc.NewProc(\"getdents\")\r\n+       procGetgid = modlibc.NewProc(\"getgid\")\r\n+       procGetpid = modlibc.NewProc(\"getpid\")\r\n+       procGeteuid = modlibc.NewProc(\"geteuid\")\r\n+       procGetegid = modlibc.NewProc(\"getegid\")\r\n+       procGetppid = modlibc.NewProc(\"getppid\")\r\n+       procGetpriority = modlibc.NewProc(\"getpriority\")\r\n+       procGetrlimit = modlibc.NewProc(\"getrlimit\")\r\n        procGettimeofday = modlibc.NewProc(\"gettimeofday\")\r\n-       procGetuid       = modlibc.NewProc(\"getuid\")\r\n-       procKill         = modlibc.NewProc(\"kill\")\r\n-       procLchown       = modlibc.NewProc(\"lchown\")\r\n-       procLink         = modlibc.NewProc(\"link\")\r\n-       proclisten       = modlibsocket.NewProc(\"listen\")\r\n-       procLstat        = modlibc.NewProc(\"lstat\")\r\n-       procMkdir        = modlibc.NewProc(\"mkdir\")\r\n-       procMknod        = modlibc.NewProc(\"mknod\")\r\n-       procNanosleep    = modlibc.NewProc(\"nanosleep\")\r\n-       procOpen         = modlibc.NewProc(\"open\")\r\n-       procPathconf     = modlibc.NewProc(\"pathconf\")\r\n-       procPread        = modlibc.NewProc(\"pread\")\r\n-       procPwrite       = modlibc.NewProc(\"pwrite\")\r\n-       procread         = modlibc.NewProc(\"read\")\r\n-       procReadlink     = modlibc.NewProc(\"readlink\")\r\n-       procRename       = modlibc.NewProc(\"rename\")\r\n-       procRmdir        = modlibc.NewProc(\"rmdir\")\r\n-       proclseek        = modlibc.NewProc(\"lseek\")\r\n-       procSetegid      = modlibc.NewProc(\"setegid\")\r\n-       procSeteuid      = modlibc.NewProc(\"seteuid\")\r\n-       procSetgid       = modlibc.NewProc(\"setgid\")\r\n-       procSetpgid      = modlibc.NewProc(\"setpgid\")\r\n-       procSetpriority  = modlibc.NewProc(\"setpriority\")\r\n-       procSetregid     = modlibc.NewProc(\"setregid\")\r\n-       procSetreuid     = modlibc.NewProc(\"setreuid\")\r\n-       procSetrlimit    = modlibc.NewProc(\"setrlimit\")\r\n-       procSetsid       = modlibc.NewProc(\"setsid\")\r\n-       procSetuid       = modlibc.NewProc(\"setuid\")\r\n-       procshutdown     = modlibsocket.NewProc(\"shutdown\")\r\n-       procStat         = modlibc.NewProc(\"stat\")\r\n-       procSymlink      = modlibc.NewProc(\"symlink\")\r\n-       procSync         = modlibc.NewProc(\"sync\")\r\n-       procTruncate     = modlibc.NewProc(\"truncate\")\r\n-       procFsync        = modlibc.NewProc(\"fsync\")\r\n-       procFtruncate    = modlibc.NewProc(\"ftruncate\")\r\n-       procUmask        = modlibc.NewProc(\"umask\")\r\n-       procUnlink       = modlibc.NewProc(\"unlink\")\r\n-       procUtimes       = modlibc.NewProc(\"utimes\")\r\n-       procbind         = modlibsocket.NewProc(\"bind\")\r\n-       procconnect      = modlibsocket.NewProc(\"connect\")\r\n-       procmmap         = modlibc.NewProc(\"mmap\")\r\n-       procmunmap       = modlibc.NewProc(\"munmap\")\r\n-       procsendto       = modlibsocket.NewProc(\"sendto\")\r\n-       procsocket       = modlibsocket.NewProc(\"socket\")\r\n-       procsocketpair   = modlibsocket.NewProc(\"socketpair\")\r\n-       procwrite        = modlibc.NewProc(\"write\")\r\n-       procgetsockopt   = modlibsocket.NewProc(\"getsockopt\")\r\n-       procgetpeername  = modlibsocket.NewProc(\"getpeername\")\r\n-       procgetsockname  = modlibsocket.NewProc(\"getsockname\")\r\n-       procsetsockopt   = modlibsocket.NewProc(\"setsockopt\")\r\n-       procrecvfrom     = modlibsocket.NewProc(\"recvfrom\")\r\n-       procrecvmsg      = modlibsocket.NewProc(\"recvmsg\")\r\n+       procGetuid = modlibc.NewProc(\"getuid\")\r\n+       procKill = modlibc.NewProc(\"kill\")\r\n+       procLchown = modlibc.NewProc(\"lchown\")\r\n+       procLink = modlibc.NewProc(\"link\")\r\n+       proclisten = modlibsocket.NewProc(\"listen\")\r\n+       procLstat = modlibc.NewProc(\"lstat\")\r\n+       procMkdir = modlibc.NewProc(\"mkdir\")\r\n+       procMknod = modlibc.NewProc(\"mknod\")\r\n+       procNanosleep = modlibc.NewProc(\"nanosleep\")\r\n+       procOpen = modlibc.NewProc(\"open\")\r\n+       procPathconf = modlibc.NewProc(\"pathconf\")\r\n+       procPread = modlibc.NewProc(\"pread\")\r\n+       procPwrite = modlibc.NewProc(\"pwrite\")\r\n+       procread = modlibc.NewProc(\"read\")\r\n+       procReadlink = modlibc.NewProc(\"readlink\")\r\n+       procRename = modlibc.NewProc(\"rename\")\r\n+       procRmdir = modlibc.NewProc(\"rmdir\")\r\n+       proclseek = modlibc.NewProc(\"lseek\")\r\n+       procSetegid = modlibc.NewProc(\"setegid\")\r\n+       procSeteuid = modlibc.NewProc(\"seteuid\")\r\n+       procSetgid = modlibc.NewProc(\"setgid\")\r\n+       procSetpgid = modlibc.NewProc(\"setpgid\")\r\n+       procSetpriority = modlibc.NewProc(\"setpriority\")\r\n+       procSetregid = modlibc.NewProc(\"setregid\")\r\n+       procSetreuid = modlibc.NewProc(\"setreuid\")\r\n+       procSetrlimit = modlibc.NewProc(\"setrlimit\")\r\n+       procSetsid = modlibc.NewProc(\"setsid\")\r\n+       procSetuid = modlibc.NewProc(\"setuid\")\r\n+       procshutdown = modlibsocket.NewProc(\"shutdown\")\r\n+       procStat = modlibc.NewProc(\"stat\")\r\n+       procSymlink = modlibc.NewProc(\"symlink\")\r\n+       procSync = modlibc.NewProc(\"sync\")\r\n+       procTruncate = modlibc.NewProc(\"truncate\")\r\n+       procFsync = modlibc.NewProc(\"fsync\")\r\n+       procFtruncate = modlibc.NewProc(\"ftruncate\")\r\n+       procUmask = modlibc.NewProc(\"umask\")\r\n+       procUnlink = modlibc.NewProc(\"unlink\")\r\n+       procUtimes = modlibc.NewProc(\"utimes\")\r\n+       procbind = modlibsocket.NewProc(\"bind\")\r\n+       procconnect = modlibsocket.NewProc(\"connect\")\r\n+       procmmap = modlibc.NewProc(\"mmap\")\r\n+       procmunmap = modlibc.NewProc(\"munmap\")\r\n+       procsendto = modlibsocket.NewProc(\"sendto\")\r\n+       procsocket = modlibsocket.NewProc(\"socket\")\r\n+       procsocketpair = modlibsocket.NewProc(\"socketpair\")\r\n+       procwrite = modlibc.NewProc(\"write\")\r\n+       procgetsockopt = modlibsocket.NewProc(\"getsockopt\")\r\n+       procgetpeername = modlibsocket.NewProc(\"getpeername\")\r\n+       procgetsockname = modlibsocket.NewProc(\"getsockname\")\r\n+       procsetsockopt = modlibsocket.NewProc(\"setsockopt\")\r\n+       procrecvfrom = modlibsocket.NewProc(\"recvfrom\")\r\n+       procrecvmsg = modlibsocket.NewProc(\"recvmsg\")\r\n+\r\n )\r\n \r\n func getgroups(ngid int, gid *_Gid_t) (n int, err error) {\r\n@@ -906,3 +910,5 @@ func recvmsg(s int, msg *Msghdr, flags int) (n int, err error) {\r\n        }\r\n        return\r\n }\r\n+\r\n+\r\n```",
	"user": {
		"login": "ksedgwic",
		"id": 38590,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2015-08-14T18:02:37Z",
	"updated_at": "2015-08-14T18:02:37Z"
}
