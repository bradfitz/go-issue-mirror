{
	"id": 155844727,
	"number": 15759,
	"state": "open",
	"title": "image: optimize Image.At().RGBA()",
	"body": "In the Go standard library (and x/image), we can see several calls that look like `Image.At().RGBA()`.\r\nThese calls mostly happen in y/x loops.\r\nThey are slow because they allocate memory.\r\n\r\nI have written a library that speeds up `Image.At().RGBA()`.\r\nIt is available on https://github.com/pierrre/imageutil\r\n\r\nIf you call https://godoc.org/github.com/pierrre/imageutil#NewAtFunc with an image, it returns a https://godoc.org/github.com/pierrre/imageutil#AtFunc\r\nA `AtFunc` returns the RGBA value (uint32) for a given pixel (x/y).\r\nA call to `NewAtFunc()` allocates memory, but it only happens 1 time per image.\r\nA call to a `AtFunc` doesn't allocate memory (most of the time).\r\n\r\nThere is also `NewSetFunc()` that helps to set RGBA values to an image.\r\nIt works the same way.\r\n\r\nMy code is just a copy/paste of the Go standard library, but organized differently.\r\n\r\nBenchmarks!\r\n\r\nI've written benchmarks for \"encode\" functions.\r\nIt only tests blank images, but it will give you an idea.\r\n```go\r\npackage benchimageencode\r\n\r\nimport (\r\n\t\"bytes\"\r\n\t\"image\"\r\n\t\"image/color\"\r\n\t\"image/gif\"\r\n\t\"image/jpeg\"\r\n\t\"image/png\"\r\n\t\"io\"\r\n\t\"strconv\"\r\n\t\"testing\"\r\n\r\n\t\"golang.org/x/image/bmp\"\r\n\t\"golang.org/x/image/tiff\"\r\n)\r\n\r\nfunc Benchmark(b *testing.B) {\r\n\tbuf := new(bytes.Buffer)\r\n\tfor _, tcEnc := range []struct {\r\n\t\tname string\r\n\t\tenc  func(w io.Writer, im image.Image) error\r\n\t}{\r\n\t\t{\r\n\t\t\t\"JPEG\",\r\n\t\t\tfunc(w io.Writer, im image.Image) error {\r\n\t\t\t\treturn jpeg.Encode(w, im, nil)\r\n\t\t\t},\r\n\t\t},\r\n\t\t{\"PNG\", png.Encode},\r\n\t\t{\r\n\t\t\t\"GIF\",\r\n\t\t\tfunc(w io.Writer, im image.Image) error {\r\n\t\t\t\treturn gif.Encode(w, im, nil)\r\n\t\t\t},\r\n\t\t},\r\n\t\t{\"BMP\", bmp.Encode},\r\n\t\t{\r\n\t\t\t\"TIFF\",\r\n\t\t\tfunc(w io.Writer, im image.Image) error {\r\n\t\t\t\treturn tiff.Encode(w, im, nil)\r\n\t\t\t},\r\n\t\t},\r\n\t} {\r\n\t\tb.Run(tcEnc.name, func(b *testing.B) {\r\n\t\t\tfor _, tcIm := range []struct {\r\n\t\t\t\tname     string\r\n\t\t\t\tnewImage func(image.Rectangle) image.Image\r\n\t\t\t}{\r\n\t\t\t\t{\r\n\t\t\t\t\t\"RGBA\",\r\n\t\t\t\t\tfunc(r image.Rectangle) image.Image {\r\n\t\t\t\t\t\treturn image.NewRGBA(r)\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"RGBA64\",\r\n\t\t\t\t\tfunc(r image.Rectangle) image.Image {\r\n\t\t\t\t\t\treturn image.NewRGBA64(r)\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"NRGBA\",\r\n\t\t\t\t\tfunc(r image.Rectangle) image.Image {\r\n\t\t\t\t\t\treturn image.NewNRGBA(r)\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"NRGBA64\",\r\n\t\t\t\t\tfunc(r image.Rectangle) image.Image {\r\n\t\t\t\t\t\treturn image.NewNRGBA64(r)\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"Alpha\",\r\n\t\t\t\t\tfunc(r image.Rectangle) image.Image {\r\n\t\t\t\t\t\treturn image.NewAlpha(r)\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"Alpha16\",\r\n\t\t\t\t\tfunc(r image.Rectangle) image.Image {\r\n\t\t\t\t\t\treturn image.NewAlpha16(r)\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"Gray\",\r\n\t\t\t\t\tfunc(r image.Rectangle) image.Image {\r\n\t\t\t\t\t\treturn image.NewGray(r)\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"Gray16\",\r\n\t\t\t\t\tfunc(r image.Rectangle) image.Image {\r\n\t\t\t\t\t\treturn image.NewGray16(r)\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"Paletted\",\r\n\t\t\t\t\tfunc(r image.Rectangle) image.Image {\r\n\t\t\t\t\t\treturn image.NewPaletted(r, color.Palette{\r\n\t\t\t\t\t\t\tcolor.RGBA{R: 0x00, G: 0x00, B: 0x00, A: 0xFF},\r\n\t\t\t\t\t\t\tcolor.RGBA{R: 0xFF, G: 0x00, B: 0x00, A: 0xFF},\r\n\t\t\t\t\t\t\tcolor.RGBA{R: 0x00, G: 0xFF, B: 0x00, A: 0xFF},\r\n\t\t\t\t\t\t\tcolor.RGBA{R: 0x00, G: 0x00, B: 0xFF, A: 0xFF},\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"YCbCr\",\r\n\t\t\t\t\tfunc(r image.Rectangle) image.Image {\r\n\t\t\t\t\t\treturn image.NewYCbCr(r, image.YCbCrSubsampleRatio444)\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"NYCbCrA\",\r\n\t\t\t\t\tfunc(r image.Rectangle) image.Image {\r\n\t\t\t\t\t\treturn image.NewNYCbCrA(r, image.YCbCrSubsampleRatio444)\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t\t{\r\n\t\t\t\t\t\"CMYK\",\r\n\t\t\t\t\tfunc(r image.Rectangle) image.Image {\r\n\t\t\t\t\t\treturn image.NewCMYK(r)\r\n\t\t\t\t\t},\r\n\t\t\t\t},\r\n\t\t\t} {\r\n\t\t\t\tb.Run(tcIm.name, func(b *testing.B) {\r\n\t\t\t\t\tfor _, size := range []int{\r\n\t\t\t\t\t\t10, 100, 1000,\r\n\t\t\t\t\t} {\r\n\t\t\t\t\t\tim := tcIm.newImage(image.Rect(0, 0, size, size))\r\n\t\t\t\t\t\tb.Run(strconv.Itoa(size), func(b *testing.B) {\r\n\t\t\t\t\t\t\tfor i := 0; i \u003c b.N; i++ {\r\n\t\t\t\t\t\t\t\tbuf.Reset()\r\n\t\t\t\t\t\t\t\terr := tcEnc.enc(buf, im)\r\n\t\t\t\t\t\t\t\tif err != nil {\r\n\t\t\t\t\t\t\t\t\tb.Fatal(err)\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t}\r\n\t\t\t\t})\r\n\t\t\t}\r\n\t\t})\r\n\t}\r\n}\r\n```\r\n\r\nResults:\r\n```\r\nbenchmark                          old ns/op      new ns/op      delta\r\nBenchmark/JPEG/RGBA/10-8           6891           6922           +0.45%\r\nBenchmark/JPEG/RGBA/100-8          243797         226064         -7.27%\r\nBenchmark/JPEG/RGBA/1000-8         18211697       18183751       -0.15%\r\nBenchmark/JPEG/RGBA64/10-8         15505          8078           -47.90%\r\nBenchmark/JPEG/RGBA64/100-8        654661         284739         -56.51%\r\nBenchmark/JPEG/RGBA64/1000-8       51987889       22906425       -55.94%\r\nBenchmark/JPEG/NRGBA/10-8          15891          7327           -53.89%\r\nBenchmark/JPEG/NRGBA/100-8         646659         257388         -60.20%\r\nBenchmark/JPEG/NRGBA/1000-8        53610219       20396700       -61.95%\r\nBenchmark/JPEG/NRGBA64/10-8        16586          7310           -55.93%\r\nBenchmark/JPEG/NRGBA64/100-8       718770         256065         -64.37%\r\nBenchmark/JPEG/NRGBA64/1000-8      55099237       20160389       -63.41%\r\nBenchmark/JPEG/Alpha/10-8          13366          7624           -42.96%\r\nBenchmark/JPEG/Alpha/100-8         535532         274982         -48.65%\r\nBenchmark/JPEG/Alpha/1000-8        43495216       21314882       -50.99%\r\nBenchmark/JPEG/Alpha16/10-8        14041          7849           -44.10%\r\nBenchmark/JPEG/Alpha16/100-8       567633         271382         -52.19%\r\nBenchmark/JPEG/Alpha16/1000-8      46175342       21845906       -52.69%\r\nBenchmark/JPEG/Gray/10-8           4124           4114           -0.24%\r\nBenchmark/JPEG/Gray/100-8          80502          81061          +0.69%\r\nBenchmark/JPEG/Gray/1000-8         7237756        7227977        -0.14%\r\nBenchmark/JPEG/Gray16/10-8         13816          7688           -44.35%\r\nBenchmark/JPEG/Gray16/100-8        565986         273270         -51.72%\r\nBenchmark/JPEG/Gray16/1000-8       46435379       21609969       -53.46%\r\nBenchmark/JPEG/Paletted/10-8       9504           7861           -17.29%\r\nBenchmark/JPEG/Paletted/100-8      339095         277612         -18.13%\r\nBenchmark/JPEG/Paletted/1000-8     27374214       22215206       -18.85%\r\nBenchmark/JPEG/YCbCr/10-8          16747          8353           -50.12%\r\nBenchmark/JPEG/YCbCr/100-8         693129         293951         -57.59%\r\nBenchmark/JPEG/YCbCr/1000-8        56055246       23340037       -58.36%\r\nBenchmark/JPEG/NYCbCrA/10-8        17758          9100           -48.76%\r\nBenchmark/JPEG/NYCbCrA/100-8       753606         331801         -55.97%\r\nBenchmark/JPEG/NYCbCrA/1000-8      61176716       27043470       -55.79%\r\nBenchmark/JPEG/CMYK/10-8           16301          8968           -44.98%\r\nBenchmark/JPEG/CMYK/100-8          664311         332938         -49.88%\r\nBenchmark/JPEG/CMYK/1000-8         53249646       26513162       -50.21%\r\nBenchmark/PNG/RGBA/10-8            233825         234277         +0.19%\r\nBenchmark/PNG/RGBA/100-8           1318376        1244438        -5.61%\r\nBenchmark/PNG/RGBA/1000-8          87804961       87500804       -0.35%\r\nBenchmark/PNG/RGBA64/10-8          234305         241012         +2.86%\r\nBenchmark/PNG/RGBA64/100-8         1560487        1571785        +0.72%\r\nBenchmark/PNG/RGBA64/1000-8        116953559      115641713      -1.12%\r\nBenchmark/PNG/NRGBA/10-8           224863         215643         -4.10%\r\nBenchmark/PNG/NRGBA/100-8          543683         477847         -12.11%\r\nBenchmark/PNG/NRGBA/1000-8         22236178       22087216       -0.67%\r\nBenchmark/PNG/NRGBA64/10-8         278971         229319         -17.80%\r\nBenchmark/PNG/NRGBA64/100-8        1338571        1344189        +0.42%\r\nBenchmark/PNG/NRGBA64/1000-8       94600702       92419064       -2.31%\r\nBenchmark/PNG/Alpha/10-8           226913         235867         +3.95%\r\nBenchmark/PNG/Alpha/100-8          1237592        1212220        -2.05%\r\nBenchmark/PNG/Alpha/1000-8         87412677       86772330       -0.73%\r\nBenchmark/PNG/Alpha16/10-8         238503         230353         -3.42%\r\nBenchmark/PNG/Alpha16/100-8        1534150        1577323        +2.81%\r\nBenchmark/PNG/Alpha16/1000-8       114207844      113559204      -0.57%\r\nBenchmark/PNG/Gray/10-8            240275         224893         -6.40%\r\nBenchmark/PNG/Gray/100-8           349896         319882         -8.58%\r\nBenchmark/PNG/Gray/1000-8          5872431        5918043        +0.78%\r\nBenchmark/PNG/Gray16/10-8          232315         219746         -5.41%\r\nBenchmark/PNG/Gray16/100-8         856544         922971         +7.76%\r\nBenchmark/PNG/Gray16/1000-8        51153358       50292261       -1.68%\r\nBenchmark/PNG/Paletted/10-8        222739         229109         +2.86%\r\nBenchmark/PNG/Paletted/100-8       320867         322279         +0.44%\r\nBenchmark/PNG/Paletted/1000-8      5880143        5995715        +1.97%\r\nBenchmark/PNG/YCbCr/10-8           264396         229815         -13.08%\r\nBenchmark/PNG/YCbCr/100-8          1119731        944250         -15.67%\r\nBenchmark/PNG/YCbCr/1000-8         72874727       42894471       -41.14%\r\nBenchmark/PNG/NYCbCrA/10-8         254977         239658         -6.01%\r\nBenchmark/PNG/NYCbCrA/100-8        1646790        1662818        +0.97%\r\nBenchmark/PNG/NYCbCrA/1000-8       126894096      125769798      -0.89%\r\nBenchmark/PNG/CMYK/10-8            288477         227636         -21.09%\r\nBenchmark/PNG/CMYK/100-8           1050239        883844         -15.84%\r\nBenchmark/PNG/CMYK/1000-8          68309463       42997860       -37.05%\r\nBenchmark/BMP/RGBA/10-8            2357           2337           -0.85%\r\nBenchmark/BMP/RGBA/100-8           19857          19835          -0.11%\r\nBenchmark/BMP/RGBA/1000-8          1699880        1658537        -2.43%\r\nBenchmark/BMP/RGBA64/10-8          5892           2893           -50.90%\r\nBenchmark/BMP/RGBA64/100-8         370764         72362          -80.48%\r\nBenchmark/BMP/RGBA64/1000-8        37558621       6772522        -81.97%\r\nBenchmark/BMP/NRGBA/10-8           5587           2754           -50.71%\r\nBenchmark/BMP/NRGBA/100-8          330937         57430          -82.65%\r\nBenchmark/BMP/NRGBA/1000-8         32697775       5413184        -83.44%\r\nBenchmark/BMP/NRGBA64/10-8         6067           2779           -54.19%\r\nBenchmark/BMP/NRGBA64/100-8        379282         59023          -84.44%\r\nBenchmark/BMP/NRGBA64/1000-8       36784396       5547886        -84.92%\r\nBenchmark/BMP/Alpha/10-8           4947           2691           -45.60%\r\nBenchmark/BMP/Alpha/100-8          268719         54878          -79.58%\r\nBenchmark/BMP/Alpha/1000-8         26591321       5049983        -81.01%\r\nBenchmark/BMP/Alpha16/10-8         5236           2747           -47.54%\r\nBenchmark/BMP/Alpha16/100-8        290536         57670          -80.15%\r\nBenchmark/BMP/Alpha16/1000-8       28806912       5421961        -81.18%\r\nBenchmark/BMP/Gray/10-8            3576           3575           -0.03%\r\nBenchmark/BMP/Gray/100-8           4829           4768           -1.26%\r\nBenchmark/BMP/Gray/1000-8          58899          57669          -2.09%\r\nBenchmark/BMP/Gray16/10-8          5166           2781           -46.17%\r\nBenchmark/BMP/Gray16/100-8         287760         57665          -79.96%\r\nBenchmark/BMP/Gray16/1000-8        28462012       5463188        -80.81%\r\nBenchmark/BMP/Paletted/10-8        3210           3358           +4.61%\r\nBenchmark/BMP/Paletted/100-8       4386           4546           +3.65%\r\nBenchmark/BMP/Paletted/1000-8      58090          58225          +0.23%\r\nBenchmark/BMP/YCbCr/10-8           6046           2999           -50.40%\r\nBenchmark/BMP/YCbCr/100-8          387509         79009          -79.61%\r\nBenchmark/BMP/YCbCr/1000-8         38474751       7584745        -80.29%\r\nBenchmark/BMP/NYCbCrA/10-8         6739           3387           -49.74%\r\nBenchmark/BMP/NYCbCrA/100-8        462438         116874         -74.73%\r\nBenchmark/BMP/NYCbCrA/1000-8       45898191       11495621       -74.95%\r\nBenchmark/BMP/CMYK/10-8            5594           3105           -44.49%\r\nBenchmark/BMP/CMYK/100-8           339544         90794          -73.26%\r\nBenchmark/BMP/CMYK/1000-8          33004703       8738049        -73.52%\r\nBenchmark/TIFF/RGBA/10-8           2312           2509           +8.52%\r\nBenchmark/TIFF/RGBA/100-8          4122           3509           -14.87%\r\nBenchmark/TIFF/RGBA/1000-8         295062         288624         -2.18%\r\nBenchmark/TIFF/RGBA64/10-8         2698           2657           -1.52%\r\nBenchmark/TIFF/RGBA64/100-8        63975          65120          +1.79%\r\nBenchmark/TIFF/RGBA64/1000-8       6303790        6177960        -2.00%\r\nBenchmark/TIFF/NRGBA/10-8          1867           1850           -0.91%\r\nBenchmark/TIFF/NRGBA/100-8         2997           3031           +1.13%\r\nBenchmark/TIFF/NRGBA/1000-8        293275         297403         +1.41%\r\nBenchmark/TIFF/NRGBA64/10-8        2641           2737           +3.63%\r\nBenchmark/TIFF/NRGBA64/100-8       64303          64035          -0.42%\r\nBenchmark/TIFF/NRGBA64/1000-8      6227868        6260150        +0.52%\r\nBenchmark/TIFF/Alpha/10-8          4791           2631           -45.08%\r\nBenchmark/TIFF/Alpha/100-8         270968         60194          -77.79%\r\nBenchmark/TIFF/Alpha/1000-8        26615543       5647306        -78.78%\r\nBenchmark/TIFF/Alpha16/10-8        5037           2701           -46.38%\r\nBenchmark/TIFF/Alpha16/100-8       293523         68395          -76.70%\r\nBenchmark/TIFF/Alpha16/1000-8      29014088       6497133        -77.61%\r\nBenchmark/TIFF/Gray/10-8           1481           1431           -3.38%\r\nBenchmark/TIFF/Gray/100-8          1652           1657           +0.30%\r\nBenchmark/TIFF/Gray/1000-8         36243          38499          +6.22%\r\nBenchmark/TIFF/Gray16/10-8         1728           1826           +5.67%\r\nBenchmark/TIFF/Gray16/100-8        19916          20041          +0.63%\r\nBenchmark/TIFF/Gray16/1000-8       1682497        1682254        -0.01%\r\nBenchmark/TIFF/Paletted/10-8       4276           4374           +2.29%\r\nBenchmark/TIFF/Paletted/100-8      4759           4690           -1.45%\r\nBenchmark/TIFF/Paletted/1000-8     39673          39281          -0.99%\r\nBenchmark/TIFF/YCbCr/10-8          5862           2863           -51.16%\r\nBenchmark/TIFF/YCbCr/100-8         383112         90709          -76.32%\r\nBenchmark/TIFF/YCbCr/1000-8        37969567       8576337        -77.41%\r\nBenchmark/TIFF/NYCbCrA/10-8        6511           3511           -46.08%\r\nBenchmark/TIFF/NYCbCrA/100-8       454029         125287         -72.41%\r\nBenchmark/TIFF/NYCbCrA/1000-8      45109329       11977360       -73.45%\r\nBenchmark/TIFF/CMYK/10-8           5431           3017           -44.45%\r\nBenchmark/TIFF/CMYK/100-8          331066         96960          -70.71%\r\nBenchmark/TIFF/CMYK/1000-8         33648362       9402967        -72.06%\r\n\r\nbenchmark                          old allocs     new allocs     delta\r\nBenchmark/JPEG/RGBA/10-8           4              5              +25.00%\r\nBenchmark/JPEG/RGBA/100-8          4              5              +25.00%\r\nBenchmark/JPEG/RGBA/1000-8         4              5              +25.00%\r\nBenchmark/JPEG/RGBA64/10-8         260            5              -98.08%\r\nBenchmark/JPEG/RGBA64/100-8        12548          5              -99.96%\r\nBenchmark/JPEG/RGBA64/1000-8       1016068        5              -100.00%\r\nBenchmark/JPEG/NRGBA/10-8          260            5              -98.08%\r\nBenchmark/JPEG/NRGBA/100-8         12548          5              -99.96%\r\nBenchmark/JPEG/NRGBA/1000-8        1016068        5              -100.00%\r\nBenchmark/JPEG/NRGBA64/10-8        260            5              -98.08%\r\nBenchmark/JPEG/NRGBA64/100-8       12548          5              -99.96%\r\nBenchmark/JPEG/NRGBA64/1000-8      1016068        5              -100.00%\r\nBenchmark/JPEG/Alpha/10-8          260            5              -98.08%\r\nBenchmark/JPEG/Alpha/100-8         12548          5              -99.96%\r\nBenchmark/JPEG/Alpha/1000-8        1016068        5              -100.00%\r\nBenchmark/JPEG/Alpha16/10-8        260            5              -98.08%\r\nBenchmark/JPEG/Alpha16/100-8       12548          5              -99.96%\r\nBenchmark/JPEG/Alpha16/1000-8      1016068        5              -100.00%\r\nBenchmark/JPEG/Gray/10-8           4              4              +0.00%\r\nBenchmark/JPEG/Gray/100-8          4              4              +0.00%\r\nBenchmark/JPEG/Gray/1000-8         4              4              +0.00%\r\nBenchmark/JPEG/Gray16/10-8         260            5              -98.08%\r\nBenchmark/JPEG/Gray16/100-8        12548          5              -99.96%\r\nBenchmark/JPEG/Gray16/1000-8       1016068        5              -100.00%\r\nBenchmark/JPEG/Paletted/10-8       4              6              +50.00%\r\nBenchmark/JPEG/Paletted/100-8      4              6              +50.00%\r\nBenchmark/JPEG/Paletted/1000-8     4              6              +50.00%\r\nBenchmark/JPEG/YCbCr/10-8          260            5              -98.08%\r\nBenchmark/JPEG/YCbCr/100-8         12548          5              -99.96%\r\nBenchmark/JPEG/YCbCr/1000-8        1016068        5              -100.00%\r\nBenchmark/JPEG/NYCbCrA/10-8        260            5              -98.08%\r\nBenchmark/JPEG/NYCbCrA/100-8       12548          5              -99.96%\r\nBenchmark/JPEG/NYCbCrA/1000-8      1016068        5              -100.00%\r\nBenchmark/JPEG/CMYK/10-8           260            5              -98.08%\r\nBenchmark/JPEG/CMYK/100-8          12548          5              -99.96%\r\nBenchmark/JPEG/CMYK/1000-8         1016068        5              -100.00%\r\nBenchmark/PNG/RGBA/10-8            232            233            +0.43%\r\nBenchmark/PNG/RGBA/100-8           20032          20033          +0.00%\r\nBenchmark/PNG/RGBA/1000-8          2000032        2000033        +0.00%\r\nBenchmark/PNG/RGBA64/10-8          232            233            +0.43%\r\nBenchmark/PNG/RGBA64/100-8         20032          20033          +0.00%\r\nBenchmark/PNG/RGBA64/1000-8        2000032        2000033        +0.00%\r\nBenchmark/PNG/NRGBA/10-8           32             33             +3.12%\r\nBenchmark/PNG/NRGBA/100-8          32             33             +3.12%\r\nBenchmark/PNG/NRGBA/1000-8         32             33             +3.12%\r\nBenchmark/PNG/NRGBA64/10-8         132            133            +0.76%\r\nBenchmark/PNG/NRGBA64/100-8        10032          10033          +0.01%\r\nBenchmark/PNG/NRGBA64/1000-8       1000032        1000033        +0.00%\r\nBenchmark/PNG/Alpha/10-8           232            233            +0.43%\r\nBenchmark/PNG/Alpha/100-8          20032          20033          +0.00%\r\nBenchmark/PNG/Alpha/1000-8         2000032        2000033        +0.00%\r\nBenchmark/PNG/Alpha16/10-8         232            233            +0.43%\r\nBenchmark/PNG/Alpha16/100-8        20032          20033          +0.00%\r\nBenchmark/PNG/Alpha16/1000-8       2000032        2000033        +0.00%\r\nBenchmark/PNG/Gray/10-8            32             33             +3.12%\r\nBenchmark/PNG/Gray/100-8           32             33             +3.12%\r\nBenchmark/PNG/Gray/1000-8          32             33             +3.12%\r\nBenchmark/PNG/Gray16/10-8          132            133            +0.76%\r\nBenchmark/PNG/Gray16/100-8         10032          10033          +0.01%\r\nBenchmark/PNG/Gray16/1000-8        1000032        1000033        +0.00%\r\nBenchmark/PNG/Paletted/10-8        38             40             +5.26%\r\nBenchmark/PNG/Paletted/100-8       38             40             +5.26%\r\nBenchmark/PNG/Paletted/1000-8      38             40             +5.26%\r\nBenchmark/PNG/YCbCr/10-8           132            33             -75.00%\r\nBenchmark/PNG/YCbCr/100-8          10032          33             -99.67%\r\nBenchmark/PNG/YCbCr/1000-8         1000032        33             -100.00%\r\nBenchmark/PNG/NYCbCrA/10-8         232            233            +0.43%\r\nBenchmark/PNG/NYCbCrA/100-8        20032          20033          +0.00%\r\nBenchmark/PNG/NYCbCrA/1000-8       2000032        2000033        +0.00%\r\nBenchmark/PNG/CMYK/10-8            132            33             -75.00%\r\nBenchmark/PNG/CMYK/100-8           10032          33             -99.67%\r\nBenchmark/PNG/CMYK/1000-8          1000032        33             -100.00%\r\nBenchmark/BMP/RGBA/10-8            33             33             +0.00%\r\nBenchmark/BMP/RGBA/100-8           33             33             +0.00%\r\nBenchmark/BMP/RGBA/1000-8          33             33             +0.00%\r\nBenchmark/BMP/RGBA64/10-8          133            34             -74.44%\r\nBenchmark/BMP/RGBA64/100-8         10033          34             -99.66%\r\nBenchmark/BMP/RGBA64/1000-8        1000033        34             -100.00%\r\nBenchmark/BMP/NRGBA/10-8           133            34             -74.44%\r\nBenchmark/BMP/NRGBA/100-8          10033          34             -99.66%\r\nBenchmark/BMP/NRGBA/1000-8         1000033        34             -100.00%\r\nBenchmark/BMP/NRGBA64/10-8         133            34             -74.44%\r\nBenchmark/BMP/NRGBA64/100-8        10033          34             -99.66%\r\nBenchmark/BMP/NRGBA64/1000-8       1000033        34             -100.00%\r\nBenchmark/BMP/Alpha/10-8           133            34             -74.44%\r\nBenchmark/BMP/Alpha/100-8          10033          34             -99.66%\r\nBenchmark/BMP/Alpha/1000-8         1000033        34             -100.00%\r\nBenchmark/BMP/Alpha16/10-8         133            34             -74.44%\r\nBenchmark/BMP/Alpha16/100-8        10033          34             -99.66%\r\nBenchmark/BMP/Alpha16/1000-8       1000033        34             -100.00%\r\nBenchmark/BMP/Gray/10-8            37             37             +0.00%\r\nBenchmark/BMP/Gray/100-8           36             36             +0.00%\r\nBenchmark/BMP/Gray/1000-8          36             36             +0.00%\r\nBenchmark/BMP/Gray16/10-8          133            34             -74.44%\r\nBenchmark/BMP/Gray16/100-8         10033          34             -99.66%\r\nBenchmark/BMP/Gray16/1000-8        1000033        34             -100.00%\r\nBenchmark/BMP/Paletted/10-8        37             37             +0.00%\r\nBenchmark/BMP/Paletted/100-8       36             36             +0.00%\r\nBenchmark/BMP/Paletted/1000-8      36             36             +0.00%\r\nBenchmark/BMP/YCbCr/10-8           133            34             -74.44%\r\nBenchmark/BMP/YCbCr/100-8          10033          34             -99.66%\r\nBenchmark/BMP/YCbCr/1000-8         1000033        34             -100.00%\r\nBenchmark/BMP/NYCbCrA/10-8         133            34             -74.44%\r\nBenchmark/BMP/NYCbCrA/100-8        10033          34             -99.66%\r\nBenchmark/BMP/NYCbCrA/1000-8       1000033        34             -100.00%\r\nBenchmark/BMP/CMYK/10-8            133            34             -74.44%\r\nBenchmark/BMP/CMYK/100-8           10033          34             -99.66%\r\nBenchmark/BMP/CMYK/1000-8          1000033        34             -100.00%\r\nBenchmark/TIFF/RGBA/10-8           25             25             +0.00%\r\nBenchmark/TIFF/RGBA/100-8          25             25             +0.00%\r\nBenchmark/TIFF/RGBA/1000-8         25             25             +0.00%\r\nBenchmark/TIFF/RGBA64/10-8         27             27             +0.00%\r\nBenchmark/TIFF/RGBA64/100-8        27             27             +0.00%\r\nBenchmark/TIFF/RGBA64/1000-8       27             27             +0.00%\r\nBenchmark/TIFF/NRGBA/10-8          25             25             +0.00%\r\nBenchmark/TIFF/NRGBA/100-8         25             25             +0.00%\r\nBenchmark/TIFF/NRGBA/1000-8        25             25             +0.00%\r\nBenchmark/TIFF/NRGBA64/10-8        27             27             +0.00%\r\nBenchmark/TIFF/NRGBA64/100-8       27             27             +0.00%\r\nBenchmark/TIFF/NRGBA64/1000-8      27             27             +0.00%\r\nBenchmark/TIFF/Alpha/10-8          126            27             -78.57%\r\nBenchmark/TIFF/Alpha/100-8         10026          27             -99.73%\r\nBenchmark/TIFF/Alpha/1000-8        1000026        27             -100.00%\r\nBenchmark/TIFF/Alpha16/10-8        126            27             -78.57%\r\nBenchmark/TIFF/Alpha16/100-8       10026          27             -99.73%\r\nBenchmark/TIFF/Alpha16/1000-8      1000026        27             -100.00%\r\nBenchmark/TIFF/Gray/10-8           24             24             +0.00%\r\nBenchmark/TIFF/Gray/100-8          24             24             +0.00%\r\nBenchmark/TIFF/Gray/1000-8         24             24             +0.00%\r\nBenchmark/TIFF/Gray16/10-8         25             25             +0.00%\r\nBenchmark/TIFF/Gray16/100-8        25             25             +0.00%\r\nBenchmark/TIFF/Gray16/1000-8       25             25             +0.00%\r\nBenchmark/TIFF/Paletted/10-8       27             27             +0.00%\r\nBenchmark/TIFF/Paletted/100-8      27             27             +0.00%\r\nBenchmark/TIFF/Paletted/1000-8     27             27             +0.00%\r\nBenchmark/TIFF/YCbCr/10-8          126            27             -78.57%\r\nBenchmark/TIFF/YCbCr/100-8         10026          27             -99.73%\r\nBenchmark/TIFF/YCbCr/1000-8        1000026        27             -100.00%\r\nBenchmark/TIFF/NYCbCrA/10-8        126            27             -78.57%\r\nBenchmark/TIFF/NYCbCrA/100-8       10026          27             -99.73%\r\nBenchmark/TIFF/NYCbCrA/1000-8      1000026        27             -100.00%\r\nBenchmark/TIFF/CMYK/10-8           126            27             -78.57%\r\nBenchmark/TIFF/CMYK/100-8          10026          27             -99.73%\r\nBenchmark/TIFF/CMYK/1000-8         1000026        27             -100.00%\r\n\r\nbenchmark                          old bytes     new bytes     delta\r\nBenchmark/JPEG/RGBA/10-8           4400          4416          +0.36%\r\nBenchmark/JPEG/RGBA/100-8          4400          4416          +0.36%\r\nBenchmark/JPEG/RGBA/1000-8         4400          4416          +0.36%\r\nBenchmark/JPEG/RGBA64/10-8         6448          4416          -31.51%\r\nBenchmark/JPEG/RGBA64/100-8        104752        4416          -95.78%\r\nBenchmark/JPEG/RGBA64/1000-8       8132924       4416          -99.95%\r\nBenchmark/JPEG/NRGBA/10-8          5424          4416          -18.58%\r\nBenchmark/JPEG/NRGBA/100-8         54576         4416          -91.91%\r\nBenchmark/JPEG/NRGBA/1000-8        4068676       4416          -99.89%\r\nBenchmark/JPEG/NRGBA64/10-8        6448          4416          -31.51%\r\nBenchmark/JPEG/NRGBA64/100-8       104752        4416          -95.78%\r\nBenchmark/JPEG/NRGBA64/1000-8      8132924       4416          -99.95%\r\nBenchmark/JPEG/Alpha/10-8          4656          4416          -5.15%\r\nBenchmark/JPEG/Alpha/100-8         16944         4416          -73.94%\r\nBenchmark/JPEG/Alpha/1000-8        1020471       4416          -99.57%\r\nBenchmark/JPEG/Alpha16/10-8        4912          4416          -10.10%\r\nBenchmark/JPEG/Alpha16/100-8       29488         4416          -85.02%\r\nBenchmark/JPEG/Alpha16/1000-8      2036550       4416          -99.78%\r\nBenchmark/JPEG/Gray/10-8           4400          4400          +0.00%\r\nBenchmark/JPEG/Gray/100-8          4400          4400          +0.00%\r\nBenchmark/JPEG/Gray/1000-8         4400          4400          +0.00%\r\nBenchmark/JPEG/Gray16/10-8         4912          4416          -10.10%\r\nBenchmark/JPEG/Gray16/100-8        29488         4416          -85.02%\r\nBenchmark/JPEG/Gray16/1000-8       2036550       4416          -99.78%\r\nBenchmark/JPEG/Paletted/10-8       4400          4512          +2.55%\r\nBenchmark/JPEG/Paletted/100-8      4400          4512          +2.55%\r\nBenchmark/JPEG/Paletted/1000-8     4400          4512          +2.55%\r\nBenchmark/JPEG/YCbCr/10-8          5219          4416          -15.39%\r\nBenchmark/JPEG/YCbCr/100-8         44541         4416          -90.09%\r\nBenchmark/JPEG/YCbCr/1000-8        3255826       4416          -99.86%\r\nBenchmark/JPEG/NYCbCrA/10-8        5424          4416          -18.58%\r\nBenchmark/JPEG/NYCbCrA/100-8       54576         4416          -91.91%\r\nBenchmark/JPEG/NYCbCrA/1000-8      4068676       4416          -99.89%\r\nBenchmark/JPEG/CMYK/10-8           5424          4416          -18.58%\r\nBenchmark/JPEG/CMYK/100-8          54576         4416          -91.91%\r\nBenchmark/JPEG/CMYK/1000-8         4068674       4416          -99.89%\r\nBenchmark/PNG/RGBA/10-8            848947        848963        +0.00%\r\nBenchmark/PNG/RGBA/100-8           930357        930373        +0.00%\r\nBenchmark/PNG/RGBA/1000-8          8872468       8872480       +0.00%\r\nBenchmark/PNG/RGBA64/10-8          850035        850051        +0.00%\r\nBenchmark/PNG/RGBA64/100-8         1013234       1013249       +0.00%\r\nBenchmark/PNG/RGBA64/1000-8        16897030      16897052      +0.00%\r\nBenchmark/PNG/NRGBA/10-8           848147        848163        +0.00%\r\nBenchmark/PNG/NRGBA/100-8          850356        850372        +0.00%\r\nBenchmark/PNG/NRGBA/1000-8         872433        872450        +0.00%\r\nBenchmark/PNG/NRGBA64/10-8         849235        849251        +0.00%\r\nBenchmark/PNG/NRGBA64/100-8        933237        933253        +0.00%\r\nBenchmark/PNG/NRGBA64/1000-8       8897022       8897035       +0.00%\r\nBenchmark/PNG/Alpha/10-8           848946        848963        +0.00%\r\nBenchmark/PNG/Alpha/100-8          930357        930372        +0.00%\r\nBenchmark/PNG/Alpha/1000-8         8872497       8872518       +0.00%\r\nBenchmark/PNG/Alpha16/10-8         850027        850043        +0.00%\r\nBenchmark/PNG/Alpha16/100-8        1013228       1013245       +0.00%\r\nBenchmark/PNG/Alpha16/1000-8       16897088      16897084      -0.00%\r\nBenchmark/PNG/Gray/10-8            847955        847971        +0.00%\r\nBenchmark/PNG/Gray/100-8           848531        848548        +0.00%\r\nBenchmark/PNG/Gray/1000-8          854008        854023        +0.00%\r\nBenchmark/PNG/Gray16/10-8          848251        848267        +0.00%\r\nBenchmark/PNG/Gray16/100-8         869107        869123        +0.00%\r\nBenchmark/PNG/Gray16/1000-8        2860163       2860184       +0.00%\r\nBenchmark/PNG/Paletted/10-8        848019        848131        +0.01%\r\nBenchmark/PNG/Paletted/100-8       848595        848708        +0.01%\r\nBenchmark/PNG/Paletted/1000-8      854069        854183        +0.01%\r\nBenchmark/PNG/YCbCr/10-8           848563        848259        -0.04%\r\nBenchmark/PNG/YCbCr/100-8          883701        851716        -3.62%\r\nBenchmark/PNG/YCbCr/1000-8         4084742       884739        -78.34%\r\nBenchmark/PNG/NYCbCrA/10-8         850027        850043        +0.00%\r\nBenchmark/PNG/NYCbCrA/100-8        1013226       1013242       +0.00%\r\nBenchmark/PNG/NYCbCrA/1000-8       16897044      16897067      +0.00%\r\nBenchmark/PNG/CMYK/10-8            848643        848259        -0.05%\r\nBenchmark/PNG/CMYK/100-8           891701        851717        -4.48%\r\nBenchmark/PNG/CMYK/1000-8          4884737       884741        -81.89%\r\nBenchmark/BMP/RGBA/10-8            400           400           +0.00%\r\nBenchmark/BMP/RGBA/100-8           688           688           +0.00%\r\nBenchmark/BMP/RGBA/1000-8          3440          3440          +0.00%\r\nBenchmark/BMP/RGBA64/10-8          1200          416           -65.33%\r\nBenchmark/BMP/RGBA64/100-8         80688         704           -99.13%\r\nBenchmark/BMP/RGBA64/1000-8        8003450       3456          -99.96%\r\nBenchmark/BMP/NRGBA/10-8           800           416           -48.00%\r\nBenchmark/BMP/NRGBA/100-8          40688         704           -98.27%\r\nBenchmark/BMP/NRGBA/1000-8         4003453       3456          -99.91%\r\nBenchmark/BMP/NRGBA64/10-8         1200          416           -65.33%\r\nBenchmark/BMP/NRGBA64/100-8        80688         704           -99.13%\r\nBenchmark/BMP/NRGBA64/1000-8       8003451       3456          -99.96%\r\nBenchmark/BMP/Alpha/10-8           504           416           -17.46%\r\nBenchmark/BMP/Alpha/100-8          10688         704           -93.41%\r\nBenchmark/BMP/Alpha/1000-8         1003446       3456          -99.66%\r\nBenchmark/BMP/Alpha16/10-8         600           416           -30.67%\r\nBenchmark/BMP/Alpha16/100-8        20688         704           -96.60%\r\nBenchmark/BMP/Alpha16/1000-8       2003451       3456          -99.83%\r\nBenchmark/BMP/Gray/10-8            2464          2464          +0.00%\r\nBenchmark/BMP/Gray/100-8           2456          2456          +0.00%\r\nBenchmark/BMP/Gray/1000-8          2456          2456          +0.00%\r\nBenchmark/BMP/Gray16/10-8          600           416           -30.67%\r\nBenchmark/BMP/Gray16/100-8         20688         704           -96.60%\r\nBenchmark/BMP/Gray16/1000-8        2003450       3456          -99.83%\r\nBenchmark/BMP/Paletted/10-8        2464          2464          +0.00%\r\nBenchmark/BMP/Paletted/100-8       2456          2456          +0.00%\r\nBenchmark/BMP/Paletted/1000-8      2456          2456          +0.00%\r\nBenchmark/BMP/YCbCr/10-8           720           416           -42.22%\r\nBenchmark/BMP/YCbCr/100-8          32688         704           -97.85%\r\nBenchmark/BMP/YCbCr/1000-8         3203455       3456          -99.89%\r\nBenchmark/BMP/NYCbCrA/10-8         800           416           -48.00%\r\nBenchmark/BMP/NYCbCrA/100-8        40688         704           -98.27%\r\nBenchmark/BMP/NYCbCrA/1000-8       4003454       3456          -99.91%\r\nBenchmark/BMP/CMYK/10-8            800           416           -48.00%\r\nBenchmark/BMP/CMYK/100-8           40688         704           -98.27%\r\nBenchmark/BMP/CMYK/1000-8          4003453       3456          -99.91%\r\nBenchmark/TIFF/RGBA/10-8           2800          2800          +0.00%\r\nBenchmark/TIFF/RGBA/100-8          2800          2800          +0.00%\r\nBenchmark/TIFF/RGBA/1000-8         2800          2800          +0.00%\r\nBenchmark/TIFF/RGBA64/10-8         2896          2896          +0.00%\r\nBenchmark/TIFF/RGBA64/100-8        3712          3712          +0.00%\r\nBenchmark/TIFF/RGBA64/1000-8       11008         11008         +0.00%\r\nBenchmark/TIFF/NRGBA/10-8          2800          2800          +0.00%\r\nBenchmark/TIFF/NRGBA/100-8         2800          2800          +0.00%\r\nBenchmark/TIFF/NRGBA/1000-8        2800          2800          +0.00%\r\nBenchmark/TIFF/NRGBA64/10-8        2896          2896          +0.00%\r\nBenchmark/TIFF/NRGBA64/100-8       3712          3712          +0.00%\r\nBenchmark/TIFF/NRGBA64/1000-8      11008         11008         +0.00%\r\nBenchmark/TIFF/Alpha/10-8          2960          2864          -3.24%\r\nBenchmark/TIFF/Alpha/100-8         13216         3232          -75.54%\r\nBenchmark/TIFF/Alpha/1000-8        1006898       6912          -99.31%\r\nBenchmark/TIFF/Alpha16/10-8        3056          2864          -6.28%\r\nBenchmark/TIFF/Alpha16/100-8       23216         3232          -86.08%\r\nBenchmark/TIFF/Alpha16/1000-8      2006901       6912          -99.66%\r\nBenchmark/TIFF/Gray/10-8           1784          1784          +0.00%\r\nBenchmark/TIFF/Gray/100-8          1784          1784          +0.00%\r\nBenchmark/TIFF/Gray/1000-8         1784          1784          +0.00%\r\nBenchmark/TIFF/Gray16/10-8         1816          1816          +0.00%\r\nBenchmark/TIFF/Gray16/100-8        1992          1992          +0.00%\r\nBenchmark/TIFF/Gray16/1000-8       3832          3832          +0.00%\r\nBenchmark/TIFF/Paletted/10-8       7928          7928          +0.00%\r\nBenchmark/TIFF/Paletted/100-8      7928          7928          +0.00%\r\nBenchmark/TIFF/Paletted/1000-8     7928          7928          +0.00%\r\nBenchmark/TIFF/YCbCr/10-8          3184          2864          -10.05%\r\nBenchmark/TIFF/YCbCr/100-8         35232         3232          -90.83%\r\nBenchmark/TIFF/YCbCr/1000-8        3206914       6912          -99.78%\r\nBenchmark/TIFF/NYCbCrA/10-8        3248          2864          -11.82%\r\nBenchmark/TIFF/NYCbCrA/100-8       43216         3232          -92.52%\r\nBenchmark/TIFF/NYCbCrA/1000-8      4006906       6912          -99.83%\r\nBenchmark/TIFF/CMYK/10-8           3248          2864          -11.82%\r\nBenchmark/TIFF/CMYK/100-8          43216         3232          -92.52%\r\nBenchmark/TIFF/CMYK/1000-8         4006903       6912          -99.83%\r\n```\r\n\r\nMy library should also speed up \"copy\" function (from an image type to another).\r\n\r\nThe modifications in the standard library and x/image are really straightforward:\r\n- replace all `\\.At\\(.*\\)\\.RGBA\\(\\)` to a call to a `AtFunc`\r\n- call `NewAtFunc()` before a \"y/x\" loop\r\n\r\nThe `image/jpeg.toYCbCr()` is tricky.\r\nYou need to call `NewAtFunc` in `image/jpeg.encoder.writeSOS()` and pass the `AtFunc` to `toYCbCr()`.\r\n\r\nI also had to move my library to the standard library, because the go tool complained about bad imports...\r\n\r\nAs you can see: https://github.com/pierrre/imageutil\r\nmy code is tested and it returns the same results as the standard library.",
	"user": {
		"login": "pierrre",
		"id": 131535,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "Performance"
		}
	],
	"assignee": {
		"login": "nigeltao",
		"id": 8565232,
		"type": "User",
		"site_admin": false
	},
	"comments": 4,
	"created_at": "2016-05-19T21:57:19Z",
	"updated_at": "2016-05-23T10:04:11Z",
	"milestone": {
		"id": 1055141,
		"number": 6,
		"title": "Unplanned"
	}
}
