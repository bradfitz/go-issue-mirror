{
	"id": 163683231,
	"body": "@ianlancetaylor I built a C++ file with a static constructor and it looks like the address of that function was put into a section called \".ctors\" on Windows.  Also https://gcc.gnu.org/onlinedocs/gccint/Initialization.html seems to indicate this is the correct place for this information.\r\n\r\nThe C++ .o file looks like this:\r\n\r\n```\r\nobjdump -h\r\nconst.o:     file format pe-x86-64\r\n\r\nSections:\r\nIdx Name          Size      VMA               LMA               File off  Algn\r\n  0 .text         00000080  0000000000000000  0000000000000000  0000021c  2**4\r\n                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, CODE\r\n  1 .data         00000000  0000000000000000  0000000000000000  00000000  2**4\r\n                  ALLOC, LOAD, DATA\r\n  2 .bss          00000010  0000000000000000  0000000000000000  00000000  2**4\r\n                  ALLOC\r\n  3 .text$_ZN4testC1Ev 00000010  0000000000000000  0000000000000000  0000029c  2**4\r\n                  CONTENTS, ALLOC, LOAD, READONLY, CODE, LINK_ONCE_DISCARD (COMDAT _ZN4testC1Ev 4)\r\n  4 .xdata$_ZN4testC1Ev 00000008  0000000000000000  0000000000000000  000002ac  2**2\r\n                  CONTENTS, ALLOC, LOAD, READONLY, DATA, LINK_ONCE_DISCARD\r\n  5 .pdata$_ZN4testC1Ev 0000000c  0000000000000000  0000000000000000  000002b4  2**2\r\n                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, DATA, LINK_ONCE_DISCARD\r\n  6 .text$_ZN4testD1Ev 00000010  0000000000000000  0000000000000000  000002c0  2**4\r\n                  CONTENTS, ALLOC, LOAD, READONLY, CODE, LINK_ONCE_DISCARD (COMDAT _ZN4testD1Ev 8)\r\n  7 .xdata$_ZN4testD1Ev 00000008  0000000000000000  0000000000000000  000002d0  2**2\r\n                  CONTENTS, ALLOC, LOAD, READONLY, DATA, LINK_ONCE_DISCARD\r\n  8 .pdata$_ZN4testD1Ev 0000000c  0000000000000000  0000000000000000  000002d8  2**2\r\n                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, DATA, LINK_ONCE_DISCARD\r\n  9 .xdata        00000024  0000000000000000  0000000000000000  000002e4  2**2\r\n                  CONTENTS, ALLOC, LOAD, READONLY, DATA\r\n 10 .pdata        00000024  0000000000000000  0000000000000000  00000308  2**2\r\n                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, DATA\r\n 11 .ctors        00000008  0000000000000000  0000000000000000  0000032c  2**3\r\n                  CONTENTS, ALLOC, LOAD, RELOC, DATA\r\n 12 .rdata$zzz    00000020  0000000000000000  0000000000000000  00000334  2**4\r\n                  CONTENTS, ALLOC, LOAD, READONLY, DATA\r\n```\r\n\r\nBut the go.o file looks like this:\r\n\r\n```\r\ntmpo/go.o:     file format pe-x86-64\r\n\r\nSections:\r\nIdx Name          Size      VMA               LMA               File off  Algn\r\n  0 .text         000c1200  0000000000001000  0000000000001000  00000600  2**5\r\n                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, CODE, DATA\r\n  1 .data         00001200  00000000000c3000  00000000000c3000  000c1800  2**5\r\n                  CONTENTS, ALLOC, LOAD, RELOC, DATA\r\n  2 .bss          0001f4c0  00000000000c5000  00000000000c5000  00000000  2**5\r\n                  ALLOC\r\n```\r\n\r\nOn Linux it looks like this:\r\n\r\n```\r\ntmpo/go.o:     file format elf64-x86-64\r\n\r\nSections:\r\nIdx Name          Size      VMA               LMA               File off  Algn\r\n  0 .text         00052650  0000000000000000  0000000000000000  00001000  2**4\r\n                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, CODE\r\n  1 .rodata       00040dd3  0000000000000000  0000000000000000  00053660  2**5\r\n                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, DATA\r\n  2 .typelink     000009f0  0000000000000000  0000000000000000  00094438  2**3\r\n                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, DATA\r\n  3 .gosymtab     00000000  0000000000000000  0000000000000000  00094e28  2**0\r\n                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, DATA\r\n  4 .gopclntab    00028a6b  0000000000000000  0000000000000000  00094e40  2**5\r\n                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, DATA\r\n  5 .note.go.buildid 00000038  0000000000000000  0000000000000000  000bd8c0  2**5\r\n                  CONTENTS, ALLOC, LOAD, READONLY, DATA\r\n  6 .noptrdata    000003b0  0000000000000000  0000000000000000  000be000  2**5\r\n                  CONTENTS, ALLOC, LOAD, RELOC, DATA\r\n  7 .init_array   00000008  0000000000000000  0000000000000000  000be3b0  2**3\r\n                  CONTENTS, ALLOC, LOAD, RELOC, DATA\r\n  8 .data         000013b0  0000000000000000  0000000000000000  000be3c0  2**5\r\n                  CONTENTS, ALLOC, LOAD, RELOC, DATA\r\n  9 .bss          00023878  0000000000000000  0000000000000000  000bf780  2**5\r\n                  ALLOC\r\n 10 .noptrbss     00004b40  0000000000000000  0000000000000000  000e3000  2**5\r\n                  ALLOC\r\n 11 .tbss         00000008  0000000000000000  0000000000000000  000be000  2**3\r\n                  ALLOC, THREAD_LOCAL\r\n 12 .note.GNU-stack 00000000  0000000000000000  0000000000000000  00000000  2**0\r\n                  CONTENTS, READONLY\r\n 13 .debug_abbrev 000000ff  0000000000000000  0000000000000000  000d0bff  2**0\r\n                  CONTENTS, READONLY, DEBUGGING\r\n 14 .debug_line   0000a793  0000000000000000  0000000000000000  000d0cfe  2**0\r\n                  CONTENTS, RELOC, READONLY, DEBUGGING\r\n 15 .debug_frame  0000a56c  0000000000000000  0000000000000000  000db491  2**0\r\n                  CONTENTS, RELOC, READONLY, DEBUGGING\r\n 16 .debug_info   00027273  0000000000000000  0000000000000000  000e59fd  2**0\r\n                  CONTENTS, RELOC, READONLY, DEBUGGING\r\n 17 .debug_pubnames 00009a03  0000000000000000  0000000000000000  0010cc70  2**0\r\n                  CONTENTS, READONLY, DEBUGGING\r\n 18 .debug_pubtypes 00004c30  0000000000000000  0000000000000000  00116673  2**0\r\n                  CONTENTS, READONLY, DEBUGGING\r\n 19 .debug_aranges 00000030  0000000000000000  0000000000000000  0011b2a3  2**0\r\n                  CONTENTS, RELOC, READONLY, DEBUGGING\r\n 20 .debug_gdb_scripts 0000002a  0000000000000000  0000000000000000  0011b2d3  2**0\r\n                  CONTENTS, READONLY, DEBUGGING\r\n```\r\n\r\nAs an experiment I changed line 1334 in link/internal/ld/data.go to create a section called \".ctors\" instead of \".init_array\". However, the \".ctors\" section never shows up. I added a Diag() call in data.go to make sure that the initarray was actually getting generated, and it is.  \r\n\r\nAt this point, I am not really sure why the .ctor section is not appearing. I read through the doelf() function and the dope() function, but I'm clearly missing something.",
	"user": {
		"login": "nadiasvertex",
		"id": 2034108,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2015-12-10T16:44:35Z",
	"updated_at": "2015-12-10T16:45:41Z"
}
