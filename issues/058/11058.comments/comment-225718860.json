{
	"id": 225718860,
	"body": "Hi, help me please!\r\ni try to use golang dll as a plugin for C++ application.\r\n\r\nsimple C++ app:\r\n```C++\r\n#include \u003ciostream\u003e\r\n#include \u003cchrono\u003e\r\n#include \u003cthread\u003e\r\n#include \u003csstream\u003e\r\n#include \u003cwindows.h\u003e\r\n\r\ntypedef long long GoInt64;\r\ntypedef GoInt64 GoInt;\r\ntypedef GoInt(__stdcall *DoubleIt_Type)(GoInt i);\r\n\r\nunsigned int loop = 0;\r\nbool dll_test() {\r\n\tHINSTANCE hGetProcIDDLL = LoadLibrary(\"C:\\\\temp\\\\tarantool_dll\\\\libdoubler.dll\");\r\n\tif (!hGetProcIDDLL) {\r\n\t\tstd::cout \u003c\u003c \"could not load the dynamic library\" \u003c\u003c std::endl;\r\n\t\treturn false;\r\n\t}\r\n\tstd::this_thread::sleep_for(std::chrono::seconds(3));\r\n\r\n\tDoubleIt_Type DoubleIt = (DoubleIt_Type)GetProcAddress(hGetProcIDDLL, \"DoubleIt\");\r\n\tif (!DoubleIt) {\r\n\t\tstd::cout \u003c\u003c \"could not locate the DoubleIt function\" \u003c\u003c std::endl;\r\n\t\treturn false;\r\n\t}\r\n\r\n\tstd::cout \u003c\u003c \"loop = \" \u003c\u003c loop \u003c\u003c \"    DoubleIt returned \" \u003c\u003c DoubleIt(21) \u003c\u003c std::endl;\r\n\r\n\tFreeLibrary(hGetProcIDDLL);\r\n\tstd::this_thread::sleep_for(std::chrono::seconds(3));\r\n\tloop++;\r\n\treturn true;\r\n}\r\n\r\nint main() {\r\n\twhile (true) {\r\n\t\tdll_test();\r\n\t}\r\n\treturn EXIT_SUCCESS;\r\n}\r\n```\r\n\r\n\"hello, world\" golang dll code:\r\n```Go\r\npackage main\r\n\r\nimport (\r\n    \"C\"\r\n    \"log\"\r\n    )\r\n\r\n//export DoubleIt\r\nfunc DoubleIt(x int) int {\r\n    log.Println(\"DoubleIt: \", x)\r\n    return x * 2\r\n}\r\n\r\nfunc main() {\r\n\r\n}\r\n```\r\nsimple build.bat for golang dll:\r\n```bat\r\ncd C:\\temp\\tarantool_dll\r\nset GOROOT=C:\\go-win-shared-1.6\\\r\nset GOARCH=amd64\r\nset GOPATH=C:\\temp\\tarantool_dll\\app\r\n:: C:\\TDM-GCC-64\\mingwvars.bat\r\nC:\\go-win-shared-1.6\\bin\\go build -o libdoubler.dll -buildmode=c-shared main\r\n```\r\n\r\nwhen i run C++ code with vs2015 in debug, x64 mode my app fails with something like\r\n```\r\nException thrown at 0x0000000067255CED in test_plugin.exe: 0xC0000005: Access violation executing location 0x0000000067255CED.\r\n```\r\nafter ```FreeLibrary(hGetProcIDDLL);``` but an exception was thrown not in Main Thread\r\n\r\nconsole log:\r\n```ShellSession\r\n2016/06/14 00:21:25 DoubleIt:  21\r\nloop = 0    DoubleIt returned 42\r\n```\r\n\r\nfor more complex Golang code i get \"stable\" work for 10-15 loops\r\ni used Telegram bot api (http://github.com/Syfaro/telegram-bot-api) for logs, but i see that memory of my process increases every loop. And after 10-15 loops exception killing my app.\r\n\r\nSorry for my English)",
	"user": {
		"login": "jonywtf",
		"id": 7776600,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2016-06-13T21:47:21Z",
	"updated_at": "2016-06-13T21:52:48Z"
}
