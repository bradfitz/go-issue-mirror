{
	"id": 162980125,
	"body": "I noticed that the c-shared and c-archive are pretty similar. I switched to c-archive mode for the initial implementation to reduce the complexity. When this works I'll move back to c-shared mode.\r\n\r\nI created a small project:\r\n\r\n//calc.go\r\npackage main\r\n\r\nimport \"C\"\r\n\r\n\r\n//export Sum\r\nfunc Sum(x, y int) int {\r\n        return x+y\r\n}\r\n\r\nfunc main() {\r\n\r\n}\r\n\r\n//test_driver.c\r\n#include \"test.h\"\r\n\r\nint main(int argc, char **argv) {\r\n  return Sum(5, 10);\r\n}\r\n\r\nOn Linux this appears to work perfectly:\r\n\r\n// commands\r\ncsnelson@nix-us2ua34705wc:~/meps/projects/test/src/calc$ go build -buildmode=c-archive -o test.a calc.go\r\ncsnelson@nix-us2ua34705wc:~/meps/projects/test/src/calc$ gcc -c test_driver.c -o test_driver.o\r\ncsnelson@nix-us2ua34705wc:~/meps/projects/test/src/calc$ gcc -o test test_driver.o test.a -lpthread\r\ncsnelson@nix-us2ua34705wc:~/meps/projects/test/src/calc$ ./test\r\ncsnelson@nix-us2ua34705wc:~/meps/projects/test/src/calc$ echo $?\r\n15\r\n\r\nOn Windows I get through the Go part of the build without error, but I get undefined references from the C linker:\r\n\r\ncsnelson@nix-us2ua34705wc:~/meps/projects/test/src/calc$ gcc -o test test_driver.o test.a\r\ntest.a(000000.o): In function `Sum':\r\nC:/Users/CHRIST~1/AppData/Local/Temp/go-build344693770/command-line-arguments/_obj/_cgo_export.c:19: undefined reference to `_cgoexp_f070ceaf1261_Sum'\r\nC:/Users/CHRIST~1/AppData/Local/Temp/go-build344693770/command-line-arguments/_obj/_cgo_export.c:19: undefined reference to `crosscall2'\r\ntest.a(000000.o):calc.cgo2.c:(.rdata$.refptr._cgoexp_f070ceaf1261_Sum[.refptr._cgoexp_f070ceaf1261_Sum]+0x0): undefined reference to `_cgoexp_f070ceaf1261_Sum'\r\ncollect2.exe: error: ld returned 1 exit status\r\n\r\nThe contents of the test.a archive:\r\n$ ar -t test.a\r\ngo.o\r\n000000.o\r\n000001.o\r\n\r\n$ nm test.a\r\n000000.o:\r\n0000000000000000 b .bss\r\n0000000000000000 b .bss\r\n0000000000000000 d .data\r\n0000000000000000 d .data\r\n00000000000000f2 N .debug_abbrev\r\n0000000000000000 N .debug_abbrev\r\n0000000000000000 N .debug_aranges\r\n0000000000000030 N .debug_aranges\r\n0000000000000000 N .debug_frame\r\n00000000000002ba N .debug_info\r\n0000000000000000 N .debug_info\r\n0000000000000000 N .debug_line\r\n00000000000000ad N .debug_line\r\n0000000000000000 N .debug_loc\r\n0000000000000000 p .pdata\r\n0000000000000000 r .rdata$.refptr._cgoexp_f070ceaf1261_Sum\r\n0000000000000000 r .rdata$zzz\r\n0000000000000020 r .rdata$zzz\r\n0000000000000000 R .refptr._cgoexp_f070ceaf1261_Sum\r\n0000000000000000 t .text\r\n0000000000000040 t .text\r\n0000000000000000 r .xdata\r\n                 U _cgo_wait_runtime_init_done\r\n                 U _cgoexp_f070ceaf1261_Sum\r\n                 U crosscall2\r\n0000000000000000 T Sum\r\n\r\n000001.o:\r\n0000000000000000 b .bss\r\n0000000000000000 b .bss\r\n0000000000000000 b .bss\r\n0000000000000000 b .bss\r\n0000000000000000 b .bss\r\n0000000000000000 b .bss\r\n0000000000000000 d .data\r\n0000000000000000 d .data\r\n0000000000000000 d .data\r\n0000000000000000 d .data\r\n0000000000000000 d .data\r\n0000000000000000 d .data\r\n0000000000000130 N .debug_abbrev\r\n0000000000000032 N .debug_abbrev\r\n00000000000002ac N .debug_abbrev\r\n0000000000000019 N .debug_abbrev\r\n0000000000000000 N .debug_abbrev\r\n0000000000000447 N .debug_abbrev\r\n00000000000000d0 N .debug_aranges\r\n00000000000000a0 N .debug_aranges\r\n0000000000000070 N .debug_aranges\r\n0000000000000020 N .debug_aranges\r\n0000000000000000 N .debug_aranges\r\n0000000000000040 N .debug_aranges\r\n0000000000000000 N .debug_frame\r\n0000000000000068 N .debug_frame\r\n00000000000000f8 N .debug_frame\r\n0000000000000a19 N .debug_info\r\n000000000000018b N .debug_info\r\n00000000000005ae N .debug_info\r\n00000000000002e2 N .debug_info\r\n0000000000000000 N .debug_info\r\n0000000000000ea2 N .debug_info\r\n0000000000000298 N .debug_line\r\n00000000000000e9 N .debug_line\r\n000000000000003a N .debug_line\r\n000000000000001d N .debug_line\r\n00000000000001bd N .debug_line\r\n0000000000000000 N .debug_line\r\n0000000000000000 N .debug_loc\r\n0000000000000072 N .debug_loc\r\n0000000000000211 N .debug_loc\r\n000000000000000c N .debug_str\r\n0000000000000000 N .debug_str\r\n0000000000000048 p .pdata\r\n0000000000000024 p .pdata\r\n0000000000000000 p .pdata\r\n0000000000000000 r .rdata\r\n0000000000000060 r .rdata\r\n0000000000000030 r .rdata\r\n0000000000000080 r .rdata$zzz\r\n0000000000000020 r .rdata$zzz\r\n0000000000000040 r .rdata$zzz\r\n0000000000000000 r .rdata$zzz\r\n0000000000000060 r .rdata$zzz\r\n0000000000000110 t .text\r\n0000000000000050 t .text\r\n0000000000000000 t .text\r\n00000000000001f0 t .text\r\n0000000000000000 t .text\r\n0000000000000000 t .text\r\n0000000000000000 r .xdata\r\n0000000000000010 r .xdata\r\n0000000000000028 r .xdata\r\n                 U __imp___iob_func\r\n                 U __imp__beginthread\r\n                 U __imp__errno\r\n00000000000001a0 T _cgo_sys_thread_start\r\n0000000000000030 T _cgo_wait_runtime_init_done\r\n                 U abort\r\n00000000000001f0 T crosscall_amd64\r\n                 U fprintf\r\n                 U free\r\n                 U fwrite\r\n                 U malloc\r\n0000000000000110 t threadentry\r\n0000000000000090 T x_cgo_free\r\n0000000000000180 T x_cgo_init\r\n0000000000000050 T x_cgo_malloc\r\n0000000000000040 T x_cgo_notify_runtime_init_done\r\n0000000000000000 T x_cgo_sys_thread_create\r\n00000000000000a0 T x_cgo_thread_start\r\nnm: go.o: File format not recognized\r\n",
	"user": {
		"login": "nadiasvertex",
		"id": 2034108,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2015-12-08T18:53:30Z",
	"updated_at": "2015-12-08T18:53:30Z"
}
