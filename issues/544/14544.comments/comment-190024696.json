{
	"id": 190024696,
	"body": "BTW, if I throw a `-x` in there I get:\r\n\r\n```\r\n+ go test -x\r\nWORK=/tmp/go-build194267605\r\nmkdir -p $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_/Users/tsuna/src/go/misc/cgo/\r\nmkdir -p $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/\r\ncd /Users/tsuna/src/go/misc/cgo/fortran\r\nCGO_LDFLAGS=\"-g\" \"-O2\" \"-lgfortran\" /Users/tsuna/src/go/pkg/tool/darwin_amd64/cgo -objdir $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/ -importpath _/Users/tsuna/src/go/misc/cgo/fortran -- -I $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/ fortran.go\r\ncd $WORK\r\nclang -fdebug-prefix-map=a=b -c trivial.c\r\nclang -gno-record-gcc-switches -c trivial.c\r\ncd /Users/tsuna/src/go/misc/cgo/fortran\r\nclang -I . -fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -gno-record-gcc-switches -fno-common -I $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/ -g -O2 -o $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/_cgo_main.o -c $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/_cgo_main.c\r\nclang -I . -fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -gno-record-gcc-switches -fno-common -I $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/ -g -O2 -o $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/_cgo_export.o -c $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/_cgo_export.c\r\nclang -I . -fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -gno-record-gcc-switches -fno-common -I $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/ -g -O2 -o $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/fortran.cgo2.o -c $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/fortran.cgo2.c\r\ngfortran -I . -fPIC -m64 -pthread -fmessage-length=0 -gno-record-gcc-switches -fno-common -I $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/ -g -O2 -o $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/answer.f90.o -c ./answer.f90\r\n[gfortran -I /Users/tsuna/src/go/misc/cgo/fortran -fPIC -m64 -pthread -fmessage-length=0 -gno-record-gcc-switches -fno-common -I /tmp/go-build194267605/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/ -g -O2 -o /tmp/go-build194267605/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/answer.f90.o -c /Users/tsuna/src/go/misc/cgo/fortran/answer.f90]\r\n[GOHOSTARCH=amd64 TERM=dumb GOROOT_BOOTSTRAP=/usr/local/Cellar/go/1.6/libexec GOTOOLDIR=/Users/tsuna/src/go/pkg/tool/darwin_amd64 GOGCCFLAGS=-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -gno-record-gcc-switches -fno-common PATH=/Users/tsuna/src/go/bin:/Users/tsuna/bin:/usr/bin:/bin:/usr/sbin:/sbin:/usr/local/bin:/opt/X11/bin:/usr/texbin:/usr/local/sbin GOARM=7 PWD=/Users/tsuna/src/go/misc/cgo/fortran GOARCH=amd64 LANG=C CXX=clang++ CGO_ENABLED=1 GO386=sse2 SHLVL=3 GOROOT=/Users/tsuna/src/go LANGUAGE=en_US.UTF8 GOOS=darwin GOHOSTOS=darwin CC=clang _=/Users/tsuna/src/go/bin/go]\r\nclang -I . -fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -gno-record-gcc-switches -fno-common -o $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/_cgo_.o $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/_cgo_main.o $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/_cgo_export.o $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/fortran.cgo2.o $WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/_obj_test/answer.f90.o -g -O2 -lgfortran\r\n# _/Users/tsuna/src/go/misc/cgo/fortran\r\nld: library not found for -lgfortran\r\nclang: error: linker command failed with exit code 1 (use -v to see invocation)\r\n$WORK/_/Users/tsuna/src/go/misc/cgo/fortran/_test/fortran.test\r\nFAIL\t_/Users/tsuna/src/go/misc/cgo/fortran [build failed]\r\n```\r\n\r\nWe can see that `clang` is given `-lgfortran` without any `-L` flags, so this is assuming that `clang` can find it in its default search paths.  This is a very reasonable assumption but here the problem stems from the fact that `clang` is the Apple-provided `/usr/bin/clang`, not the Homebrew-installed `gcc` that provided `gfortran`.  Actually in the case of Homebrew, `gcc` isn't even installed as `gcc` by default, but as `/usr/local/bin/gcc-5`.\r\n\r\nIf I re-run the test as shown above but I override the environment variables `CXX=g++-5 CC=gcc-5` (only the latter actually matters in this case) then the test passes.\r\n\r\nYou could argue that this setup is messed up (\"what, your default C compiler is completely unrelated to your FORTRAN compiler?!\") but since this is going to be a common problem given the number of people using Fink / MacPorts / Homebrew, it would be nice to find a way to fix this.  Potentially using something along the lines of `gfortran -print-file-name=libgfortran.dylib` to find where the library is and add the dirname of that output as a `-L` flag (or adding all the library paths returned by `gfortran -print-search-dirs`).\r\n\r\nSince we're in 2016 and I personally couldn't care less about FORTRAN, I simply removed `gfortran` from my `$PATH` so that this test doesn't run.",
	"user": {
		"login": "tsuna",
		"id": 128281,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2016-02-29T03:38:08Z",
	"updated_at": "2016-02-29T03:39:59Z"
}
