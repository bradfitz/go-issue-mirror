{
	"id": 66077276,
	"body": "\u003ca id=\"c19\"\u003e\u003c/a\u003eComment 19 by **tylor@torbit.com**:\n\n\u003cpre\u003eHere is an example of a common crash I am seeing. The GOB encoder object in question is\nlocal to the crashing goroutine, so something like a race condition seems very unlikely.\n\nThis crash has occurred with tip: 3bc1ecb89e30, bb8b458a479c and probably others. I have\nbeen unable to reproduce it with simple programs. The problem appears to be on line 35\nof encoding/gob/encode.go and involve the free list:\n\n    29\tfunc (enc *Encoder) newEncoderState(b *bytes.Buffer) *encoderState {\n    30\t\te := enc.freeList\n    31\t\tif e == nil {\n    32\t\t\te = new(encoderState)\n    33\t\t\te.enc = enc\n    34\t\t} else {\n    35\t\t\tenc.freeList = e.next\n    36\t\t}\n    37\t\te.sendZero = false\n    38\t\te.fieldnum = 0\n    39\t\te.b = b\n    40\t\treturn e\n    41\t}\n\nHere is the actual stack trace:\n\n panic: runtime error: invalid memory address or nil pointer dereference [recovered]\n       panic: runtime error: invalid memory address or nil pointer dereference\n [signal 0xb code=0x1 addr=0x40 pc=0x5a5764]\n\n goroutine 99545 [running]:\n encoding/gob.catchError(0xc2004453a8)\n       /home/user/go/src/pkg/encoding/gob/error.go:38 +0x8d\n encoding/gob.(*Encoder).newEncoderState(0xc2000d20f0, 0xc200445338, 0x18)\n       /home/user/go/src/pkg/encoding/gob/encode.go:35 +0x64\n encoding/gob.(*Encoder).encodeArray(0xc2000d20f0, 0xc200445338, 0xc200625700, 0x8267e0, 0x10, ...)\n       /home/user/go/src/pkg/encoding/gob/encode.go:377 +0x34\n encoding/gob.func·013(0x0, 0xc200617910, 0xc2004a80a0)\n       /home/user/go/src/pkg/encoding/gob/encode.go:585 +0xf2\n encoding/gob.encodeReflectValue(0xc200617910, 0x682280, 0xc2004a8080, 0x172, 0xc20014ad00, ...)\n       /home/user/go/src/pkg/encoding/gob/encode.go:404 +0x105\n encoding/gob.(*Encoder).encodeMap(0xc2006b7a80, 0xc200445338, 0x762260, 0xc200aba450, 0x156, ...)\n       /home/user/go/src/pkg/encoding/gob/encode.go:418 +0x1e0\n encoding/gob.func·015(0xc2001d92a0, 0xc2006b7940, 0xc200aba450)\n       /home/user/go/src/pkg/encoding/gob/encode.go:609 +0x18e\n encoding/gob.(*Encoder).encodeStruct(0xc200445300, 0xc200445338, 0xc20014acc0, 0xc200aba410)\n       /home/user/go/src/pkg/encoding/gob/encode.go:370 +0x118\n encoding/gob.func·016(0xc2001cc700, 0xc2006b7900, 0xc200aba410)\n       /home/user/go/src/pkg/encoding/gob/encode.go:618 +0x6d\n encoding/gob.(*Encoder).encodeStruct(0xc200445300, 0xc200445338, 0xc20014ac80, 0xc200aba410)\n       /home/user/go/src/pkg/encoding/gob/encode.go:370 +0x118\n encoding/gob.(*Encoder).encode(0xc200445300, 0xc200445338, 0x736320, 0xc200aba410, 0x196, ...)\n       /home/user/go/src/pkg/encoding/gob/encode.go:746 +0x182\n encoding/gob.(*Encoder).EncodeValue(0xc200445300, 0x70ce40, 0xc200aba410, 0x160, 0x0, ...)\n       /home/user/go/src/pkg/encoding/gob/encoder.go:252 +0x387\n encoding/gob.(*Encoder).Encode(0xc200445300, 0x70ce40, 0xc200aba410, 0x1, 0x0, ...)\n       /home/user/go/src/pkg/encoding/gob/encoder.go:177 +0x5b\n xxx/yyy.(*GobEndpointClient).requestStrmWorker(0xc2005a71e0)\n       /home/user/code/go/src/xxx/yyy/GobEndpointClient.go:101 +0x141\n created by xxx/yyy.NewGobEndpointClient\n       /home/user/code/go/src/xxx/yyy/GobEndpointClient.go:46 +0xf1\n.....\n\nPlease let me know if there is any additional information I can supply or steps I should\ntake. (Or if this should be a separate issue) Thanks!\u003c/pre\u003e",
	"user": {
		"login": "gopherbot",
		"id": 8566911,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2013-04-04T16:20:36Z",
	"updated_at": "2014-12-08T10:27:49Z"
}
