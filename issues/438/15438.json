{
	"id": 150934715,
	"number": 15438,
	"state": "closed",
	"title": "runtime: wrong goroutine in newstack",
	"body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What version of Go are you using (`go version`)?\r\n\r\n1.6.2\r\n\r\n2. What operating system and processor architecture are you using (`go env`)?\r\n\r\nBuild on MacOS, run on linux x64. Running [prometheus/node_exporter](https://github.com/prometheus/node_exporter) build with 1.6.2 ended up with an unresponsive.\r\n\r\n```\r\ntime curl 127.0.0.1:9100/metrics\r\ncurl: (56) Recv failure: Connection reset by peer\r\n\r\nreal\t1m48.762s\r\n```\r\n\r\nHere's some info from gdb:\r\n\r\n```gdb\r\n(gdb) thread apply all bt\r\n\r\nThread 1 (process 47084):\r\n#0  runtime.futex () at /usr/local/Cellar/go/1.6.2/libexec/src/runtime/sys_linux_amd64.s:307\r\n#1  0x000000000042c473 in runtime.futexsleep (addr=0xd73828 \u003cruntime.m0+264\u003e, val=0, ns=-1) at /usr/local/Cellar/go/1.6.2/libexec/src/runtime/os1_linux.go:40\r\n#2  0x0000000000410cf4 in runtime.notesleep (n=0xd73828 \u003cruntime.m0+264\u003e) at /usr/local/Cellar/go/1.6.2/libexec/src/runtime/lock_futex.go:145\r\n#3  0x0000000000434a2b in runtime.stopm () at /usr/local/Cellar/go/1.6.2/libexec/src/runtime/proc.go:1538\r\n#4  0x0000000000435488 in runtime.gcstopm () at /usr/local/Cellar/go/1.6.2/libexec/src/runtime/proc.go:1742\r\n#5  0x000000000043628c in runtime.schedule () at /usr/local/Cellar/go/1.6.2/libexec/src/runtime/proc.go:2039\r\n#6  0x0000000000436834 in runtime.goschedImpl (gp=0xc820a41c80) at /usr/local/Cellar/go/1.6.2/libexec/src/runtime/proc.go:2155\r\n#7  0x00000000004368d2 in runtime.gopreempt_m (gp=0xc820a41c80) at /usr/local/Cellar/go/1.6.2/libexec/src/runtime/proc.go:2170\r\n#8  0x00000000004479cc in runtime.newstack () at /usr/local/Cellar/go/1.6.2/libexec/src/runtime/stack.go:932\r\n#9  0x000000000045e81f in runtime.morestack () at /usr/local/Cellar/go/1.6.2/libexec/src/runtime/asm_amd64.s:359\r\n#10 0x0000000000d73100 in runtime.work ()\r\n#11 0x00007ffcfc0e9b00 in ?? ()\r\n#12 0x0000000000d73180 in runtime.work ()\r\n#13 0x0000000000433912 in runtime.mstart () at /usr/local/Cellar/go/1.6.2/libexec/src/runtime/proc.go:1068\r\n#14 0x000000000045e568 in runtime.rt0_go () at /usr/local/Cellar/go/1.6.2/libexec/src/runtime/asm_amd64.s:149\r\n#15 0x0000000000000003 in ?? ()\r\n#16 0x00007ffcfc0e9b48 in ?? ()\r\n#17 0x0000000000000003 in ?? ()\r\n#18 0x00007ffcfc0e9b48 in ?? ()\r\n#19 0x0000000000000000 in ?? ()\r\n```\r\n\r\n```\r\n(gdb) info goroutines\r\n  1 runnable runtime.createfing\r\n  2 runnable runtime.gopark\r\n  17 waiting  runtime.gopark\r\n  18 waiting  runtime.gopark\r\n  38 waiting  runtime.gopark\r\n  82 waiting  runtime.gopark\r\n  65 waiting  runtime.gopark\r\n  81 waiting  runtime.gopark\r\n  53261 runnable runtime.convT2E\r\n  39 waiting  runtime.gopark\r\n  40 waiting  runtime.gopark\r\n  41 waiting  runtime.gopark\r\n  42 waiting  runtime.gopark\r\n  43 waiting  runtime.gopark\r\n  44 waiting  runtime.gopark\r\n  45 waiting  runtime.gopark\r\n  46 waiting  runtime.gopark\r\n  66 waiting  runtime.gopark\r\n  47 waiting  runtime.gopark\r\n  97 waiting  runtime.gopark\r\n  98 waiting  runtime.gopark\r\n  99 waiting  runtime.gopark\r\n  100 waiting  runtime.gopark\r\n  101 waiting  runtime.gopark\r\n  102 waiting  runtime.gopark\r\n  103 waiting  runtime.gopark\r\n  67 waiting  runtime.gopark\r\n  104 waiting  runtime.gopark\r\n  83 waiting  runtime.gopark\r\n  84 waiting  runtime.gopark\r\n  85 waiting  runtime.gopark\r\n  86 waiting  runtime.gopark\r\n  87 waiting  runtime.gopark\r\n  88 waiting  runtime.gopark\r\n  89 waiting  runtime.gopark\r\n  113 waiting  runtime.gopark\r\n  114 waiting  runtime.gopark\r\n  53289 runnable runtime.slicebytetostring\r\n* 53282 running  runtime.systemstack_switch\r\n  53283 runnable runtime.slicebytetostring\r\n```\r\n\r\n```\r\n(gdb) goroutine 53282 bt\r\n#0  runtime.systemstack_switch () at /usr/local/Cellar/go/1.6.2/libexec/src/runtime/asm_amd64.s:245\r\n#1  0x000000000042f334 in runtime.startpanic () at /usr/local/Cellar/go/1.6.2/libexec/src/runtime/panic.go:525\r\n#2  0x000000000042f433 in runtime.throw (s=\"unexpected signal during runtime execution\") at /usr/local/Cellar/go/1.6.2/libexec/src/runtime/panic.go:546\r\n#3  0x0000000000443bca in runtime.sigpanic () at /usr/local/Cellar/go/1.6.2/libexec/src/runtime/sigpanic_unix.go:12\r\n#4  0x00000000000011fd in ?? ()\r\n#5  0x0000000000000000 in ?? ()\r\n```\r\n\r\nAnd here's the panic log:\r\n\r\n```\r\nfatal error: unexpected signal during runtime execution\r\nfatal error: unexpected signal during runtime execution\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: unexpected signal during runtime execution\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nruntime: unexpected return pc for sort.quickSort called from 0x0\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: unknown caller pc\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: systemstack called from unexpected goroutine\r\nfatal error: runtime·unlock: lock count\r\nfatal error: systemstack called from unexpected goroutine\r\nfatal error: systemstack called from unexpected goroutine\r\nfatal error: runtime·unlock: lock count\r\nfatal error: systemstack called from unexpected goroutine\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: systemstack called from unexpected goroutine\r\nfatal error: systemstack called from unexpected goroutine\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: runtime·unlock: lock count\r\nfatal error: systemstack called from unexpected goroutine\r\nfatal error: runtime·unlock: lock count\r\nfatal error: systemstack called from unexpected goroutine\r\nfatal error: runtime·unlock: lock count\r\nfatal error: systemstack called from unexpected goroutine\r\nfatal error: systemstack called from unexpected goroutine\r\nfatal error: runtime·unlock: lock count\r\nfatal error: systemstack called from unexpected goroutine\r\nfatal error: runtime·unlock: lock count\r\nruntime: newstack called from g=0xc820991980\r\n\tm=0xc820549c00 m-\u003ecurg=0x0 m-\u003eg0=0xc820580300 m-\u003egsignal=0xc820580180\r\nstrings.Join(0xc820230ac8, 0x2, 0x2, 0xa61978, 0x1, 0x0, 0x0)\r\n\t/usr/local/Cellar/go/1.6.2/libexec/src/strings/strings.go:363 +0xee\r\npath.Join(0xc820230ac8, 0x2, 0x2, 0x0, 0x0)\r\n\t/usr/local/Cellar/go/1.6.2/libexec/src/path/path.go:153 +0xfa\r\ngithub.com/prometheus/node_exporter/collector.procFilePath(0xa69eb8, 0x4, 0x0, 0x0)\r\n\t/Users/hryamzik/gopath/src/github.com/prometheus/node_exporter/collector/paths.go:30 +0xd2\r\ngithub.com/prometheus/node_exporter/collector.(*statCollector).Update(0xc820196d40, 0xc820471b60, 0x0, 0x0)\r\n\t/Users/hryamzik/gopath/src/github.com/prometheus/node_exporter/collector/stat_linux.go:89 +0x6f\r\nmain.execute(0x7ffcfc0e9f34, 0x4, 0x7f8157c87130, 0xc820196d40, 0xc820471b60)\r\n\t/Users/hryamzik/gopath/src/github.com/prometheus/node_exporter/node_exporter.go:96 +0x82\r\nmain.NodeCollector.Collect.func1(0xc820471b60, 0xc820a06000, 0x7ffcfc0e9f34, 0x4, 0x7f8157c87130, 0xc820196d40)\r\n\t/Users/hryamzik/gopath/src/github.com/prometheus/node_exporter/node_exporter.go:75 +0x49\r\ncreated by main.NodeCollector.Collect\r\n\t/Users/hryamzik/gopath/src/github.com/prometheus/node_exporter/node_exporter.go:77 +0x137\r\nfatal error: runtime: wrong goroutine in newstack\r\n```\r\n",
	"user": {
		"login": "hryamzik",
		"id": 1643962,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "WaitingForInfo"
		}
	],
	"comments": 6,
	"closed_at": "2016-06-22T18:40:27Z",
	"created_at": "2016-04-25T17:43:12Z",
	"updated_at": "2016-06-22T21:14:11Z",
	"milestone": {
		"id": 1055141,
		"number": 6,
		"title": "Unplanned"
	}
}
