{
	"id": 178839505,
	"number": 17207,
	"state": "closed",
	"title": "strange panic depending on struct field order or 32bit-64bit arch",
	"body": "### What version of Go are you using (`go version`)?\r\nboth 1.7.1 and 1.4.3 behave the same, not tested anything else. yet.\r\n\r\n### What operating system and processor architecture are you using (`go env`)?\r\n32 bit architectures seems to be affected\r\ntested:\r\npanic on: 32 bit windows 7 and raspbian on a pi2\r\nno panic (normal, expected behaviour) on 64bit freebsd and linux\r\n\r\n### What did you do?\r\nLinks to playground are only for easier copy-pasting. Playground is working correctly, probably because play.golang.org is running on 64 bit arch.\r\n\r\nMinimal full runnable repro program:\r\nhttps://play.golang.org/p/EtJre5AGtw\r\nTo reproduce please check on 32 bit windows 7 or 32 bit raspbian.\r\nI suspect the bug probably depends on if the test program is running on 32bit or 64bit architectures, though I could not test on the same os and on different architectures.\r\n\r\nAlso working correctly:\r\ni.) when int64 and AddInt64() are changed to int32 and AddInt32() respectively the panic goes away\r\nhttps://play.golang.org/p/gk2IacMYBU\r\nii.) when *a and i int64 order is changed, panic goes away:\r\nhttps://play.golang.org/p/T0VbE_-bBb\r\n\r\n### What did you expect to see?\r\nThe minimal repro program should finish normally and print the log message, like it does on the playground or when run on 64bit linux or 64bit freebsd.\r\n\r\nThese are the errors I get:\r\non 32bit raspbian with go1.7.1:\r\n\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x4 pc=0x6b5a8]\r\n\r\ngoroutine 1 [running]:\r\npanic(0xb2ce0, 0x1040a010)\r\n        /src/go/src/runtime/panic.go:500 +0x33c\r\nsync/atomic.addUint64(0x1046a054, 0x1, 0x0, 0x1, 0x0)\r\n        /src/go/src/sync/atomic/64bit_arm.go:31 +0x68\r\nmain.main()\r\n        /home/pi/src/a.go:19 +0x64\r\nexit status 2\r\n--- end of 32bit raspbian error with go1.7.1\r\n\r\non 32bit raspbian with go1.4.3:\r\n\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal 0xb code=0x1 addr=0x4 pc=0x4a374]\r\n\r\ngoroutine 1 [running]:\r\nsync/atomic.addUint64(0x10338034, 0x1, 0x0, 0x1, 0x0)\r\n        /src/go/src/sync/atomic/64bit_arm.go:31 +0x70\r\nmain.main()\r\n        /home/pi/src/a.go:19 +0x78\r\n\r\ngoroutine 2 [runnable]:\r\nruntime.forcegchelper()\r\n        /src/go/src/runtime/proc.go:90\r\nruntime.goexit()\r\n        /src/go/src/runtime/asm_arm.s:1322 +0x4\r\n\r\ngoroutine 3 [runnable]:\r\nruntime.bgsweep()\r\n        /src/go/src/runtime/mgc0.go:82\r\nruntime.goexit()\r\n        /src/go/src/runtime/asm_arm.s:1322 +0x4\r\n\r\ngoroutine 4 [runnable]:\r\nruntime.runfinq()\r\n        /src/go/src/runtime/malloc.go:712\r\nruntime.goexit()\r\n        /src/go/src/runtime/asm_arm.s:1322 +0x4\r\nexit status 2\r\n--- end of 32bit raspbian go1.4.3 error message\r\n\r\non 32bit windows 7 with go1.7.1:\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal 0xb code=0x1 addr=0x4 pc=0x4a374]\r\n\r\ngoroutine 1 [running]:\r\nsync/atomic.addUint64(0x10338034, 0x1, 0x0, 0x1, 0x0)\r\n        /src/go/src/sync/atomic/64bit_arm.go:31 +0x70\r\nmain.main()\r\n        /home/pi/src/a.go:19 +0x78\r\n\r\ngoroutine 2 [runnable]:\r\nruntime.forcegchelper()\r\n        /src/go/src/runtime/proc.go:90\r\nruntime.goexit()\r\n        /src/go/src/runtime/asm_arm.s:1322 +0x4\r\n\r\ngoroutine 3 [runnable]:\r\nruntime.bgsweep()\r\n        /src/go/src/runtime/mgc0.go:82\r\nruntime.goexit()\r\n        /src/go/src/runtime/asm_arm.s:1322 +0x4\r\n\r\ngoroutine 4 [runnable]:\r\nruntime.runfinq()\r\n        /src/go/src/runtime/malloc.go:712\r\nruntime.goexit()\r\n        /src/go/src/runtime/asm_arm.s:1322 +0x4\r\nexit status 2\r\n-- end of 32bit windows 7 error message\r\n\r\n\r\n\r\n",
	"user": {
		"login": "fgergo",
		"id": 5156576,
		"type": "User",
		"site_admin": false
	},
	"comments": 2,
	"closed_at": "2016-09-23T10:30:47Z",
	"created_at": "2016-09-23T10:19:46Z",
	"updated_at": "2016-09-23T10:30:47Z"
}
