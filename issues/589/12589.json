{
	"id": 106055640,
	"number": 12589,
	"state": "closed",
	"title": "go build crash: \"fatal error: missing stackmap\"",
	"body": "my code does not compile, but _how_ it fails is interesting - go build crashes.\r\nsomething about gc, i gather. sample stack traces below.\r\nevery now and then it succeeds.\r\nnot a virtual machine, Ubuntu 15.04 x86-64\r\n\r\n```\r\n$ uname -a\r\nLinux nbt.rojer.me 3.19.0-26-generic #28-Ubuntu SMP Tue Aug 11 14:16:32 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux\r\n$ go version\r\ngo version go1.5 linux/amd64\r\n$ go build                                                                                                                                                            \r\n# ...\r\nruntime: frame runtime.runfinq untyped locals 0xc82002b750+0x68\r\nfatal error: missing stackmap\r\n\r\nruntime stack:\r\nruntime.throw(0x841f30, 0x10)\r\n        /usr/local/go/src/runtime/panic.go:527 +0x90\r\nruntime.scanframeworker(0x7ffc39ad8260, 0x0, 0xc82001f220)\r\n        /usr/local/go/src/runtime/mgcmark.go:453 +0x694\r\nruntime.scanstack.func1(0x7ffc39ad8260, 0x0, 0x1)\r\n        /usr/local/go/src/runtime/mgcmark.go:384 +0x65\r\nruntime.gentraceback(0x42b033, 0xc82002b6f0, 0x0, 0xc820001080, 0x0, 0x0, 0x7fffffff, 0x7ffc39ad8380, 0x0, 0x0, ...)\r\n        /usr/local/go/src/runtime/traceback.go:336 +0xa69\r\nruntime.scanstack(0xc820001080)\r\n        /usr/local/go/src/runtime/mgcmark.go:406 +0x38b\r\nruntime.scang(0xc820001080)\r\n        /usr/local/go/src/runtime/proc1.go:422 +0xf3\r\nruntime.markroot(0xc82001c000, 0x7ffc00000008)\r\n        /usr/local/go/src/runtime/mgcmark.go:133 +0x1ba\r\nruntime.parfordo(0xc82001c000)\r\n        /usr/local/go/src/runtime/parfor.go:95 +0x12a\r\nruntime.gcscan_m()\r\n        /usr/local/go/src/runtime/mgcmark.go:36 +0xc6\r\nruntime.gc.func1()\r\n        /usr/local/go/src/runtime/mgc.go:996 +0xdd\r\nruntime.systemstack(0xc80c20)\r\n        /usr/local/go/src/runtime/asm_amd64.s:262 +0x79\r\nruntime.mstart()\r\n        /usr/local/go/src/runtime/proc1.go:674\r\n\r\ngoroutine 5 [garbage collection scan]:\r\nruntime.systemstack_switch()\r\n        /usr/local/go/src/runtime/asm_amd64.s:216 fp=0xc82002bc98 sp=0xc82002bc90\r\nruntime.gc(0x0)\r\n        /usr/local/go/src/runtime/mgc.go:1005 +0x1db fp=0xc82002bf90 sp=0xc82002bc98\r\nruntime.backgroundgc()\r\n        /usr/local/go/src/runtime/mgc.go:896 +0x3d fp=0xc82002bfc0 sp=0xc82002bf90\r\nruntime.goexit()\r\n        /usr/local/go/src/runtime/asm_amd64.s:1696 +0x1 fp=0xc82002bfc8 sp=0xc82002bfc0\r\ncreated by runtime.startGC\r\n        /usr/local/go/src/runtime/mgc.go:869 +0x186\r\n\r\ngoroutine 1 [runnable]:\r\ncmd/compile/internal/gc.(*Pkg).LookupBytes(0xc820014370, 0xc82000b320, 0x8, 0x103, 0x7)\r\n        /usr/local/go/src/cmd/compile/internal/gc/subr.go:302 +0x4bd\r\ncmd/compile/internal/gc.LookupBytes(0xc82000b320, 0x8, 0x103, 0x0)\r\n        /usr/local/go/src/cmd/compile/internal/gc/subr.go:266 +0x41\r\ncmd/compile/internal/gc._yylex(0xc820019080, 0xc80000002e)\r\n        /usr/local/go/src/cmd/compile/internal/gc/lex.go:1411 +0x351\r\ncmd/compile/internal/gc.yylex(0xc820019080, 0x2e)\r\n        /usr/local/go/src/cmd/compile/internal/gc/lex.go:1859 +0x25\r\ncmd/compile/internal/gc.yy.Lex(0xc820019080, 0x2e)\r\n        /usr/local/go/src/cmd/compile/internal/gc/lex.go:1841 +0x21\r\ncmd/compile/internal/gc.(*yy).Lex(0xda67e0, 0xc820019080, 0x2e)\r\n        \u003cautogenerated\u003e:11 +0x97\r\ncmd/compile/internal/gc.yylex1(0x7f0138bc07f8, 0xda67e0, 0xc820019080, 0x2e, 0x0)\r\n        yaccpar:120 +0x52\r\ncmd/compile/internal/gc.(*yyParserImpl).Parse(0xc82002e050, 0x7f0138bc07f8, 0xda67e0, 0x0)\r\n        yaccpar:206 +0x1a9c3\r\ncmd/compile/internal/gc.yyparse()\r\n        /usr/local/go/src/cmd/compile/internal/gc/lex.go:1854 +0xb4\r\ncmd/compile/internal/gc.Main()\r\n        /usr/local/go/src/cmd/compile/internal/gc/lex.go:348 +0x1b6f\r\ncmd/compile/internal/amd64.Main()\r\n        /usr/local/go/src/cmd/compile/internal/amd64/galign.go:127 +0x58d\r\nmain.main()\r\n        /usr/local/go/src/cmd/compile/main.go:26 +0x189\r\nrojer@nbt:~/go/src/cesanta.com/projects/quantex/tcpuart/test/data_test q3$ go build \r\n# ...\r\nruntime: frame runtime.runfinq untyped locals 0xc82002b750+0x68\r\nfatal error: missing stackmap\r\n\r\nruntime stack:\r\nruntime.throw(0x841f30, 0x10)\r\n        /usr/local/go/src/runtime/panic.go:527 +0x90\r\nruntime.scanframeworker(0x7fffdf6059f0, 0x0, 0xc820020720)\r\n        /usr/local/go/src/runtime/mgcmark.go:453 +0x694\r\nruntime.scanstack.func1(0x7fffdf6059f0, 0x0, 0x1)\r\n        /usr/local/go/src/runtime/mgcmark.go:384 +0x65\r\nruntime.gentraceback(0x42b033, 0xc82002b6f0, 0x0, 0xc820001080, 0x0, 0x0, 0x7fffffff, 0x7fffdf605b10, 0x0, 0x0, ...)\r\n        /usr/local/go/src/runtime/traceback.go:336 +0xa69\r\nruntime.scanstack(0xc820001080)\r\n        /usr/local/go/src/runtime/mgcmark.go:406 +0x38b\r\nruntime.scang(0xc820001080)\r\n        /usr/local/go/src/runtime/proc1.go:422 +0xf3\r\nruntime.markroot(0xc82001c000, 0x7fff00000008)\r\n        /usr/local/go/src/runtime/mgcmark.go:133 +0x1ba\r\nruntime.parfordo(0xc82001c000)\r\n        /usr/local/go/src/runtime/parfor.go:95 +0x12a\r\nruntime.gcscan_m()\r\n        /usr/local/go/src/runtime/mgcmark.go:36 +0xc6\r\nruntime.gc.func1()\r\n        /usr/local/go/src/runtime/mgc.go:996 +0xdd\r\nruntime.systemstack(0xc80c20)\r\n        /usr/local/go/src/runtime/asm_amd64.s:262 +0x79\r\nruntime.mstart()\r\n        /usr/local/go/src/runtime/proc1.go:674\r\n\r\ngoroutine 5 [garbage collection scan]:\r\nruntime.systemstack_switch()\r\n        /usr/local/go/src/runtime/asm_amd64.s:216 fp=0xc82002bc98 sp=0xc82002bc90\r\nruntime.gc(0x0)\r\n        /usr/local/go/src/runtime/mgc.go:1005 +0x1db fp=0xc82002bf90 sp=0xc82002bc98\r\nruntime.backgroundgc()\r\n        /usr/local/go/src/runtime/mgc.go:896 +0x3d fp=0xc82002bfc0 sp=0xc82002bf90\r\nruntime.goexit()\r\n        /usr/local/go/src/runtime/asm_amd64.s:1696 +0x1 fp=0xc82002bfc8 sp=0xc82002bfc0\r\ncreated by runtime.startGC\r\n        /usr/local/go/src/runtime/mgc.go:869 +0x186\r\n\r\ngoroutine 1 [runnable]:\r\ncmd/compile/internal/gc.yylex1(0x7ff48afe8728, 0xda67e0, 0xc820019080, 0x28, 0x3c)\r\n        yaccpar:118\r\ncmd/compile/internal/gc.(*yyParserImpl).Parse(0xc82002e040, 0x7ff48afe8728, 0xda67e0, 0x0)\r\n        yaccpar:206 +0x1a9c3\r\ncmd/compile/internal/gc.yyparse()\r\n        /usr/local/go/src/cmd/compile/internal/gc/lex.go:1854 +0xb4\r\ncmd/compile/internal/gc.Main()\r\n        /usr/local/go/src/cmd/compile/internal/gc/lex.go:348 +0x1b6f\r\ncmd/compile/internal/amd64.Main()\r\n        /usr/local/go/src/cmd/compile/internal/amd64/galign.go:127 +0x58d\r\nmain.main()\r\n        /usr/local/go/src/cmd/compile/main.go:26 +0x189\r\n```\r\n\r\nafter a few attempts:\r\n\r\n```\r\n$ go build \r\n# ...\r\n./main.go:33: missing return at end of function\r\n./main.go:37: undefined: rand in rand.Seed\r\n./main.go:37: undefined: time in time.Now\r\n```\r\n",
	"user": {
		"login": "rojer",
		"id": 531307,
		"type": "User",
		"site_admin": false
	},
	"comments": 1,
	"closed_at": "2015-09-11T17:29:59Z",
	"created_at": "2015-09-11T17:19:49Z",
	"updated_at": "2015-09-11T17:29:59Z"
}
