{
	"id": 101210618,
	"body": "Here is another missed constant propagation which I believe is more common:\r\n\r\n```\r\ngo version devel +51021cc Tue May 12 14:28:40 2015 +0000 linux/amd64\r\n```\r\n\r\n```go\r\npackage test\r\nfunc S() int {\r\n        a := 1\r\n        a += 5\r\n        if a \u003e 1 {\r\n                return 0\r\n        }\r\n        return 9\r\n}      \r\n```\r\n\r\nGenerated code is\r\n```asm\r\n        0x0000 00000 (a.go:2)   TEXT    \"\".S(SB), $0-8\r\n        0x0000 00000 (a.go:2)   NOP\r\n        0x0000 00000 (a.go:2)   NOP\r\n        0x0000 00000 (a.go:2)   FUNCDATA        $0, gclocals路5184031d3a32a42d85027f073f873668(SB)\r\n        0x0000 00000 (a.go:2)   FUNCDATA        $1, gclocals路33cdeccccebe80329f1fdbee7f5874cb(SB)\r\n        0x0000 00000 (a.go:3)   MOVQ    $1, BX\r\n        0x0007 00007 (a.go:4)   ADDQ    $5, BX\r\n        0x000b 00011 (a.go:4)   NOP\r\n        0x000b 00011 (a.go:5)   CMPQ    BX, $1\r\n        0x000f 00015 (a.go:5)   JLE     27\r\n        0x0011 00017 (a.go:6)   MOVQ    $0, \"\".~r0+8(FP)\r\n        0x001a 00026 (a.go:6)   RET\r\n        0x001b 00027 (a.go:8)   MOVQ    $9, \"\".~r0+8(FP)\r\n        0x0024 00036 (a.go:8)   RET\r\n```\r\n\r\nThere are two missed propagation: `a += 5` and `a \u003e 1`. The whole function's body can be replaced with `return 9`.\r\n\r\nAnother example involving nil check:\r\n```go\r\npackage test\r\nfunc S() int {\r\n        a := 0\r\n        if \u0026a == nil {\r\n                return 0\r\n        }\r\n        return 9\r\n}      \r\n```\r\n\r\n```asm\r\n        0x0000 00000 (a.go:2)   TEXT    \"\".S(SB), $8-8\r\n        0x0000 00000 (a.go:2)   SUBQ    $8, SP\r\n        0x0004 00004 (a.go:2)   FUNCDATA        $0, gclocals路5184031d3a32a42d85027f073f873668(SB)\r\n        0x0004 00004 (a.go:2)   FUNCDATA        $1, gclocals路33cdeccccebe80329f1fdbee7f5874cb(SB)\r\n        0x0004 00004 (a.go:3)   MOVQ    $0, \"\".a(SP)\r\n        0x000c 00012 (a.go:4)   LEAQ    \"\".a(SP), BX\r\n        0x0010 00016 (a.go:4)   MOVQ    $0, BP\r\n        0x0012 00018 (a.go:4)   CMPQ    BX, BP\r\n        0x0015 00021 (a.go:4)   JNE     37\r\n        0x0017 00023 (a.go:5)   MOVQ    $0, \"\".~r0+16(FP)\r\n        0x0020 00032 (a.go:5)   ADDQ    $8, SP\r\n        0x0024 00036 (a.go:5)   RET\r\n        0x0025 00037 (a.go:7)   MOVQ    $9, \"\".~r0+16(FP)\r\n        0x002e 00046 (a.go:7)   ADDQ    $8, SP\r\n        0x0032 00050 (a.go:7)   RET\r\n```\r\n\r\nAgain `\u0026a == nil` is always false, so `a` is unused (dead store) so the whole function's body can be replaced with `return 9`.\r\n",
	"user": {
		"login": "brtzsnr",
		"id": 57079,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2015-05-12T09:26:07Z",
	"updated_at": "2015-05-12T14:43:24Z"
}
