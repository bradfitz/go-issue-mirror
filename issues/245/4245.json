{
	"id": 51281859,
	"number": 4245,
	"state": "closed",
	"title": "cmd/gc: racewalk doubles expressions",
	"body": "\u003cpre\u003e14628:3e39b4ebe5b1 tip\n\nCan be reproduced on:\ngo test -bench=.* -benchtime=.1s -cpu=2 net/rpc\n\nWARNING: DATA RACE\nWrite by goroutine 8:\n  encoding/gob.decInt64()\n      /usr/local/go/src/pkg/encoding/gob/decode.go:287 +0xcb\n  encoding/gob.(*Decoder).decodeStruct()\n      /usr/local/go/src/pkg/encoding/gob/decode.go:518 +0x336\n  encoding/gob.(*Decoder).decodeValue()\n      /usr/local/go/src/pkg/encoding/gob/decode.go:1233 +0x3a3\n  encoding/gob.(*Decoder).DecodeValue()\n      /usr/local/go/src/pkg/encoding/gob/decoder.go:225 +0x1a1\n  encoding/gob.(*Decoder).Decode()\n      /usr/local/go/src/pkg/encoding/gob/decoder.go:202 +0x239\n  net/rpc.(*gobClientCodec).ReadResponseBody()\n      /usr/local/go/src/pkg/net/rpc/client.go:218 +0x54\n  net/rpc.(*Client).input()\n      /usr/local/go/src/pkg/net/rpc/client.go:141 +0x8c6\n\nPrevious read by goroutine 9:\n  net/rpc.funcÂ·003()\n      /usr/local/go/src/pkg/net/rpc/server_test.go:526 +0x1a7\n\nGoroutine 8 (running) created at:\n  net/rpc.NewClientWithCodec()\n      /usr/local/go/src/pkg/net/rpc/client.go:192 +0xb7\n  net/rpc.NewClient()\n      /usr/local/go/src/pkg/net/rpc/client.go:182 +0x19a\n  net/rpc.Dial()\n      /usr/local/go/src/pkg/net/rpc/client.go:265 +0xac\n  net/rpc.dialDirect()\n      /usr/local/go/src/pkg/net/rpc/server_test.go:430 +0x4a\n  net/rpc.benchmarkEndToEnd()\n      /usr/local/go/src/pkg/net/rpc/server_test.go:505 +0xa9\n  net/rpc.BenchmarkEndToEnd()\n      /usr/local/go/src/pkg/net/rpc/server_test.go:584 +0x33\n  testing.(*B).runN()\n      /usr/local/go/src/pkg/testing/benchmark.go:111 +0xb2\n  testing.(*B).launch()\n      /usr/local/go/src/pkg/testing/benchmark.go:179 +0x5c\n\nGoroutine 9 (finished) created at:\n  net/rpc.benchmarkEndToEnd()\n      /usr/local/go/src/pkg/net/rpc/server_test.go:531 +0x34c\n  net/rpc.BenchmarkEndToEnd()\n      /usr/local/go/src/pkg/net/rpc/server_test.go:584 +0x33\n  testing.(*B).runN()\n      /usr/local/go/src/pkg/testing/benchmark.go:111 +0xb2\n  testing.(*B).launch()\n      /usr/local/go/src/pkg/testing/benchmark.go:179 +0x5c\n==================\n\nThe crux is (2 calls of makechan() and Client.Go()):\n\n        call := \u0026lt;-client.Go(serviceMethod, args, reply, make(chan *Call, 1)).Done\n  441751:       48 c7 04 24 40 6c 66    movq   $0x666c40,(%rsp)\n  441758:       00 \n  441759:       48 c7 44 24 08 01 00    movq   $0x1,0x8(%rsp)\n  441760:       00 00 \n  441762:       e8 29 17 fc ff          callq  402e90 \u0026lt;runtime.makechan\u0026gt;\n  441767:       48 8b 5c 24 10          mov    0x10(%rsp),%rbx\n  44176c:       48 89 5c 24 38          mov    %rbx,0x38(%rsp)\n  441771:       48 8b 5c 24 58          mov    0x58(%rsp),%rbx\n  441776:       48 89 1c 24             mov    %rbx,(%rsp)\n  44177a:       48 8b 5c 24 60          mov    0x60(%rsp),%rbx\n  44177f:       48 89 5c 24 08          mov    %rbx,0x8(%rsp)\n  441784:       48 8b 5c 24 68          mov    0x68(%rsp),%rbx\n  441789:       48 89 5c 24 10          mov    %rbx,0x10(%rsp)\n  44178e:       48 8b 5c 24 70          mov    0x70(%rsp),%rbx\n  441793:       48 89 5c 24 18          mov    %rbx,0x18(%rsp)\n  441798:       48 8b 5c 24 78          mov    0x78(%rsp),%rbx\n  44179d:       48 89 5c 24 20          mov    %rbx,0x20(%rsp)\n  4417a2:       48 8b 9c 24 80 00 00    mov    0x80(%rsp),%rbx\n  4417a9:       00 \n  4417aa:       48 89 5c 24 28          mov    %rbx,0x28(%rsp)\n  4417af:       48 8b 9c 24 88 00 00    mov    0x88(%rsp),%rbx\n  4417b6:       00 \n  4417b7:       48 89 5c 24 30          mov    %rbx,0x30(%rsp)\n  4417bc:       e8 df fc ff ff          callq  4414a0 \u0026lt;net/rpc.(*Client).Go\u0026gt;\n  4417c1:       48 8b 5c 24 40          mov    0x40(%rsp),%rbx\n  4417c6:       48 89 1c 24             mov    %rbx,(%rsp)\n  4417ca:       48 83 04 24 40          addq   $0x40,(%rsp)\n  4417cf:       e8 1c 24 fd ff          callq  413bf0 \u0026lt;runtime.raceread\u0026gt;\n  4417d4:       48 c7 04 24 40 6c 66    movq   $0x666c40,(%rsp)\n  4417db:       00 \n  4417dc:       48 c7 44 24 08 01 00    movq   $0x1,0x8(%rsp)\n  4417e3:       00 00 \n  4417e5:       e8 a6 16 fc ff          callq  402e90 \u0026lt;runtime.makechan\u0026gt;\n  4417ea:       48 8b 6c 24 10          mov    0x10(%rsp),%rbp\n  4417ef:       48 89 6c 24 38          mov    %rbp,0x38(%rsp)\n  4417f4:       48 8b 6c 24 58          mov    0x58(%rsp),%rbp\n  4417f9:       48 89 2c 24             mov    %rbp,(%rsp)\n  4417fd:       48 8b 6c 24 60          mov    0x60(%rsp),%rbp\n  441802:       48 89 6c 24 08          mov    %rbp,0x8(%rsp)\n  441807:       48 8b 6c 24 68          mov    0x68(%rsp),%rbp\n  44180c:       48 89 6c 24 10          mov    %rbp,0x10(%rsp)\n  441811:       48 8b 6c 24 70          mov    0x70(%rsp),%rbp\n  441816:       48 89 6c 24 18          mov    %rbp,0x18(%rsp)\n  44181b:       48 8b 6c 24 78          mov    0x78(%rsp),%rbp\n  441820:       48 89 6c 24 20          mov    %rbp,0x20(%rsp)\n  441825:       48 8b ac 24 80 00 00    mov    0x80(%rsp),%rbp\n  44182c:       00 \n  44182d:       48 89 6c 24 28          mov    %rbp,0x28(%rsp)\n  441832:       48 8b ac 24 88 00 00    mov    0x88(%rsp),%rbp\n  441839:       00 \n  44183a:       48 89 6c 24 30          mov    %rbp,0x30(%rsp)\n  44183f:       e8 5c fc ff ff          callq  4414a0 \u0026lt;net/rpc.(*Client).Go\u0026gt;\n  441844:       48 8b 5c 24 40          mov    0x40(%rsp),%rbx\n  441849:       48 8b 6b 40             mov    0x40(%rbx),%rbp\n  44184d:       48 89 6c 24 08          mov    %rbp,0x8(%rsp)\n  441852:       48 c7 04 24 40 6c 66    movq   $0x666c40,(%rsp)\n  441859:       00 \n  44185a:       e8 d1 22 fc ff          callq  403b30 \u0026lt;runtime.chanrecv1\u0026gt;\n  44185f:       48 8b 5c 24 10          mov    0x10(%rsp),%rbx\n  441864:       48 89 5c 24 48          mov    %rbx,0x48(%rsp)\u003c/pre\u003e",
	"user": {
		"login": "dvyukov",
		"id": 1095328,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		},
		{
			"name": "RaceDetector"
		}
	],
	"comments": 1,
	"closed_at": "2014-12-08T10:22:36Z",
	"created_at": "2012-10-15T14:46:39Z",
	"updated_at": "2016-06-24T22:26:34Z",
	"milestone": {
		"id": 1067199,
		"number": 11,
		"title": "Go1.1"
	}
}
