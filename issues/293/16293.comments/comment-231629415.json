{
	"id": 231629415,
	"body": "@aclements thanks for taking a look. I'll patch in CL 23540 and report back in a week or so. As for the rest of your questions:\r\n\r\n\u003e is the vast majority of your heap non-pointer data? What's the type of your map?\r\n\r\nYes. The vast majority of the heap is that single map. The type is `map[keyHash]RecordRef`:\r\n\r\n``` go\r\ntype keyHash [12]byte\r\n\r\ntype RecordRef struct {\r\n\tseq    uint32\r\n\toffset uint32\r\n}\r\n```\r\n\r\n(This server is a later version of the same program that caused me to file #9477 a couple of years ago; at that time it was important to eliminate all pointers in order to keep pause times under control.)\r\n\r\nIf your theory is correct, it sounds like I could simply shard the map to partially work around the problem.\r\n\r\n\u003e Would it also be possible to post a longer gctrace? I'm particularly interested in whether things have obviously changed between when the server has recently started and has low latency and when it's older and exhibiting high latency. Some snippets of the gctrace/gcpacertrace at different ages would also be fine.\r\n\r\nI restarted the process at around 2016-07-02T00:55:17Z. Here are some snippets from the log from each day between then and the logs I posted above:\r\n\r\n```\r\n2016/07/02 12:01:40 GC forced\r\n2016/07/02 12:01:40 pacer: assist ratio=+2.138854e-003 (scan 17 MB in 8485-\u003e16878 MB) workers=2+0\r\n2016/07/02 12:01:40 pacer: H_m_prev=8849114144 h_t=+9.500000e-001 H_T=17255772580 h_a=+5.442970e-003 H_a=8897279608 h_g=+1.000000e+000 H_g=17698228288 u_a=+2.503884e-001 u_g=+2.500000e-001 W_a=18793824 goalΔ=+5.000000e-002 actualΔ=-9.445570e-001 u_a/u_g=+1.001554e+000\r\n2016/07/02 12:01:40 gc 339 @40015.564s 0%: 0.12+101+0.51 ms clock, 0.98+0.31/6.0/110+4.1 ms cpu, 8485-\u003e8485-\u003e8436 MB, 16878 MB goal, 8 P\r\n2016/07/02 12:01:40 pacer: sweep done at heap size 8436MB; allocated 0MB of spans; swept 1086754 pages\r\n2016/07/02 12:02:15 scvg266: inuse: 8462, idle: 5311, sys: 13774, released: 5260, consumed: 8513 (MB)\r\n...\r\n2016/07/03 12:01:35 GC forced\r\n2016/07/03 12:01:35 pacer: assist ratio=+3.950049e-003 (scan 34 MB in 8738-\u003e17379 MB) workers=2+0\r\n2016/07/03 12:01:36 pacer: H_m_prev=9111766208 h_t=+9.500000e-001 H_T=17767944105 h_a=+5.644927e-003 H_a=9163201464 h_g=+1.000000e+000 H_g=18223532416 u_a=+2.500166e-001 u_g=+2.500000e-001 W_a=35753936 goalΔ=+5.000000e-002 actualΔ=-9.443551e-001 u_a/u_g=+1.000066e+000\r\n2016/07/03 12:01:36 gc 1058 @126411.045s 0%: 0.34+197+0.91 ms clock, 2.7+0.026/6.4/208+7.3 ms cpu, 8738-\u003e8738-\u003e8693 MB, 17379 MB goal, 8 P\r\n2016/07/03 12:01:36 pacer: sweep done at heap size 8694MB; allocated 0MB of spans; swept 1119763 pages\r\n2016/07/03 12:02:15 scvg842: 1 MB released\r\n2016/07/03 12:02:15 scvg842: inuse: 8722, idle: 5572, sys: 14295, released: 5511, consumed: 8783 (MB)\r\n...\r\n2016/07/04 12:00:55 GC forced\r\n2016/07/04 12:00:55 pacer: assist ratio=+5.573086e-003 (scan 52 MB in 9556-\u003e19028 MB) workers=2+0\r\n2016/07/04 12:00:55 pacer: H_m_prev=9976379976 h_t=+9.500000e-001 H_T=19453940953 h_a=+4.495774e-003 H_a=10021231528 h_g=+1.000000e+000 H_g=19952759952 u_a=+2.500208e-001 u_g=+2.500000e-001 W_a=55319360 goalΔ=+5.000000e-002 actualΔ=-9.455042e-001 u_a/u_g=+1.000083e+000\r\n2016/07/04 12:00:55 gc 1776 @212770.689s 0%: 0.13+333+1.0 ms clock, 1.1+0.055/336/13+8.3 ms cpu, 9556-\u003e9556-\u003e9514 MB, 19028 MB goal, 8 P\r\n2016/07/04 12:00:55 pacer: sweep done at heap size 9515MB; allocated 0MB of spans; swept 1225150 pages\r\n2016/07/04 12:02:16 scvg1418: 3 MB released\r\n2016/07/04 12:02:16 scvg1418: inuse: 9564, idle: 4730, sys: 14295, released: 4716, consumed: 9578 (MB)\r\n...\r\n2016/07/05 12:01:45 GC forced\r\n2016/07/05 12:01:45 pacer: assist ratio=+8.636990e-003 (scan 81 MB in 9576-\u003e19057 MB) workers=2+0\r\n2016/07/05 12:01:46 pacer: H_m_prev=9991664936 h_t=+9.500000e-001 H_T=19483746625 h_a=+4.967289e-003 H_a=10041296424 h_g=+1.000000e+000 H_g=19983329872 u_a=+2.501286e-001 u_g=+2.500000e-001 W_a=85842496 goalΔ=+5.000000e-002 actualΔ=-9.450327e-001 u_a/u_g=+1.000515e+000\r\n2016/07/05 12:01:46 gc 2494 @299221.000s 0%: 0.27+436+0.80 ms clock, 2.1+0.44/7.8/442+6.4 ms cpu, 9576-\u003e9576-\u003e9528 MB, 19057 MB goal, 8 P\r\n2016/07/05 12:01:46 pacer: sweep done at heap size 9529MB; allocated 0MB of spans; swept 1228103 pages\r\n2016/07/05 12:02:17 scvg1994: 3 MB released\r\n2016/07/05 12:02:17 scvg1994: inuse: 9563, idle: 4731, sys: 14295, released: 4692, consumed: 9602 (MB)\r\n...\r\n2016/07/06 12:01:29 GC forced\r\n2016/07/06 12:01:29 pacer: assist ratio=+8.515688e-003 (scan 81 MB in 9701-\u003e19318 MB) workers=2+0\r\n2016/07/06 12:01:30 pacer: H_m_prev=10128628744 h_t=+9.500000e-001 H_T=19750826050 h_a=+4.366870e-003 H_a=10172859152 h_g=+1.000000e+000 H_g=20257257488 u_a=+2.500632e-001 u_g=+2.500000e-001 W_a=85846568 goalΔ=+5.000000e-002 actualΔ=-9.456331e-001 u_a/u_g=+1.000253e+000\r\n2016/07/06 12:01:30 gc 3211 @385604.769s 0%: 0.36+498+0.97 ms clock, 2.9+0.25/8.7/502+7.8 ms cpu, 9701-\u003e9701-\u003e9655 MB, 19318 MB goal, 8 P\r\n2016/07/06 12:01:30 pacer: sweep done at heap size 9655MB; allocated 0MB of spans; swept 1244427 pages\r\n2016/07/06 12:02:18 scvg2570: 0 MB released\r\n2016/07/06 12:02:18 scvg2570: inuse: 9699, idle: 4595, sys: 14295, released: 4560, consumed: 9734 (MB)\r\n```",
	"user": {
		"login": "cespare",
		"id": 318501,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2016-07-11T02:30:41Z",
	"updated_at": "2016-07-11T02:30:41Z"
}
