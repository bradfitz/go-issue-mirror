{
	"id": 66090770,
	"body": "\u003ca id=\"c34\"\u003e\u003c/a\u003eComment 34:\n\n\u003cpre\u003eThank you for your patience and please pardon the lack of mine.\n\nI've been able to create a smaller standalone program that triggers this issue and which\ndoes not invoke sigaltstack (and not setjmp neither), so I believe that path is a red\nherring. Please see \u003ca href=\"http://play.golang.org/p/d4YCDD7Qa6\"\u003ehttp://play.golang.org/p/d4YCDD7Qa6\u003c/a\u003e which in short overrides SIGCHLD\nvia sigaction, but also calls into the old signal handler from the new one.\n\nOutput of running that piece of code on my machine is:\n\n17:38 ~/code/go/src/7227 $ go version\ngo version devel +83227883e5d0 Thu Mar 13 19:04:00 2014 +0400 darwin/amd64\n17:38 ~/code/go/src/7227 $ GOTRACEBACK=2 go run 7227.go\nhere\nI'm evil\nfatal error: runtime: stack split during syscall\n\nruntime stack:\nruntime.throw(0x41abf5e)\n   /Users/quarnster/code/3rdparty/go/src/pkg/runtime/panic.c:519 +0x69\nruntime.newstack()\n   /Users/quarnster/code/3rdparty/go/src/pkg/runtime/stack.c:641 +0x7a3\nruntime.morestack()\n   /Users/quarnster/code/3rdparty/go/src/pkg/runtime/asm_amd64.s:228 +0x61\n\ngoroutine 16 [stack split]:\nsyscall.Syscall6(0x7, 0x188, 0xc208021bd4, 0x0, 0xc2080423f0, ...)\n   /Users/quarnster/code/3rdparty/go/src/pkg/syscall/asm_darwin_amd64.s:41 +0x5 fp=0xc208021b38\nsyscall.wait4(0x188, 0xc208021bd4, 0x0, 0xc2080423f0, 0x4021f62, ...)\n   /Users/quarnster/code/3rdparty/go/src/pkg/syscall/zsyscall_darwin_amd64.go:32 +0x95 fp=0xc208021b98\nsyscall.Wait4(0x188, 0xc208021c1c, 0x0, 0xc2080423f0, 0xc208016280, ...)\n   /Users/quarnster/code/3rdparty/go/src/pkg/syscall/syscall_bsd.go:129 +0x76 fp=0xc208021be0\nos.(*Process).wait(0xc208050320, 0x0, 0x0, 0x0)\n   /Users/quarnster/code/3rdparty/go/src/pkg/os/exec_unix.go:22 +0x121 fp=0xc208021c98\nos.(*Process).Wait(0xc208050320, 0xc208050000, 0x0, 0x0)\n   /Users/quarnster/code/3rdparty/go/src/pkg/os/doc.go:45 +0x39 fp=0xc208021cc0\nos/exec.(*Cmd).Wait(0xc208052140, 0x0, 0x0)\n   /Users/quarnster/code/3rdparty/go/src/pkg/os/exec/exec.go:320 +0x1bd fp=0xc208021d78\nos/exec.(*Cmd).Run(0xc208052140, 0x0, 0x0)\n   /Users/quarnster/code/3rdparty/go/src/pkg/os/exec/exec.go:237 +0x78 fp=0xc208021da8\nos/exec.(*Cmd).CombinedOutput(0xc208052140, 0x0, 0x0, 0x0, 0x0, ...)\n   /Users/quarnster/code/3rdparty/go/src/pkg/os/exec/exec.go:364 +0x269 fp=0xc208021e28\nmain.main()\n   /Users/quarnster/code/go/src/7227/7227.go:54 +0x237 fp=0xc208021f50\nruntime.main()\n   /Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:243 +0x11a fp=0xc208021fa8\nruntime.goexit()\n   /Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:1446 fp=0xc208021fb0\ncreated by _rt0_go\n   /Users/quarnster/code/3rdparty/go/src/pkg/runtime/asm_amd64.s:97 +0x120\n\ngoroutine 17 [runnable]:\nruntime.MHeap_Scavenger()\n   /Users/quarnster/code/3rdparty/go/src/pkg/runtime/mheap.c:507\nruntime.goexit()\n   /Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:1446\ncreated by runtime.main\n   /Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:203\n\ngoroutine 18 [runnable]:\nbgsweep()\n   /Users/quarnster/code/3rdparty/go/src/pkg/runtime/mgc0.c:1891\nruntime.goexit()\n   /Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:1446\ncreated by runtime.gc\n   /Users/quarnster/code/3rdparty/go/src/pkg/runtime/mgc0.c:2179\n\ngoroutine 19 [runnable]:\nos/signal.loop()\n   /Users/quarnster/code/3rdparty/go/src/pkg/os/signal/signal_unix.go:19\nruntime.goexit()\n   /Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:1446\ncreated by os/signal.init·1\n   /Users/quarnster/code/3rdparty/go/src/pkg/os/signal/signal_unix.go:27 +0x32\n\ngoroutine 17 [syscall]:\nruntime.goexit()\n   /Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:1446\n\ngoroutine 20 [runnable]:\nos/exec.func·004(0xc2080500c0)\n   /Users/quarnster/code/3rdparty/go/src/pkg/os/exec/exec.go:283\nruntime.goexit()\n   /Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:1446\ncreated by os/exec.(*Cmd).Start\n   /Users/quarnster/code/3rdparty/go/src/pkg/os/exec/exec.go:285 +0x8db\nexit status 2\n17:38 ~/code/go/src/7227 $\n\n\n\nIn case setjmp is still of interest, the disassembly of it on my machine matches this\nversion exactly:\n\u003ca href=\"http://www.opensource.apple.com/source/Libc/Libc-825.40.1/x86_64/sys/setjmp.s\"\u003ehttp://www.opensource.apple.com/source/Libc/Libc-825.40.1/x86_64/sys/setjmp.s\u003c/a\u003e\u003c/pre\u003e",
	"user": {
		"login": "quarnster",
		"id": 1230389,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2014-04-04T15:39:59Z",
	"updated_at": "2014-12-08T10:40:09Z"
}
