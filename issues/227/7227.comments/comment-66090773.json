{
	"id": 66090773,
	"body": "\u003ca id=\"c37\"\u003e\u003c/a\u003eComment 37:\n\n\u003cpre\u003eHmm, your amended version doesn't run here, though the error I'm receiving changed for\ndarwin amd64, but darwin 386 is still the same. BTW I tried the version in #35 on Linux\nwhich worked fine for both amd64 and 386 with go 1.2.\n\nBut ignoring that for now, how much stack space would be required to check if we've got\nenough stack space?\n\n\n20:59 ~/code/go/src/7227 $ cat 7227.go\npackage main\n\n/*\n#include \u003cstdio.h\u003e\n#include \u003csignal.h\u003e\n#include \u003cstring.h\u003e\n\nstruct sigaction old_action;\nvoid evil_c_sig_handler(int signum, siginfo_t *info, void *context) {\n\t// First do my own stuff\n\tprintf(\"I'm evil\\n\");\n\n\t// Then call the old signal handler\n\tvolatile struct sigaction *vsa = \u0026old_action;\n\n\tif (old_action.sa_flags \u0026 SA_SIGINFO) {\n\t\tvoid (*oldAction)(int, siginfo_t *, void *) = vsa-\u003esa_sigaction;\n\n\t\tif (oldAction)\n\t\t\toldAction(signum, info, context);\n\t} else {\n\t\tvoid (*oldAction)(int) = vsa-\u003esa_handler;\n\n\t\tif (oldAction \u0026\u0026 oldAction != SIG_IGN)\n\t\t\toldAction(signum);\n\t}\n}\n\nvoid test() {\n\tstruct sigaction action;\n\tsigaction(SIGCHLD, NULL, \u0026action);\n\tmemset(\u0026action, 0, sizeof action);\n\tsigfillset(\u0026action.sa_mask);\n\taction.sa_sigaction = evil_c_sig_handler;\n\taction.sa_flags = SA_NOCLDSTOP | SA_SIGINFO | SA_ONSTACK;\n\tsigaction(SIGCHLD, \u0026action, \u0026old_action);\n}\n*/\nimport \"C\"\n\nimport (\n\t\"os/exec\"\n)\n\nfunc main() {\n\tC.test()\n\tfor {\n\t\tcmd := exec.Command(\"echo\", \"hello\")\n\t\tcmd.CombinedOutput()\n\t\tcmd.Wait()\n\t}\n}\n21:00 ~/code/go/src/7227 $ GOTRACEBACK=2 go run 7227.go\nI'm evil\nruntime: newstack framesize=0x0 argsize=0x20 sp=0xc20800baa0 stack=[0xc208039000,\n0xc208039fa8]\n\tmorebuf={pc:0x7fff87db85aa sp:0xc20800bab0 lr:0x0}\n\tsched={pc:0x4016ca0 sp:0xc20800baa8 lr:0x0 ctxt:0x0}\nruntime: split stack overflow: 0xc20800baa0 \u003c 0xc208039000\nfatal error: runtime: split stack overflow\n\nruntime stack:\nruntime.throw(0x40fc59b)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/panic.c:519 +0x69\nruntime.newstack()\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/stack.c:627 +0x1eb\nruntime.morestack()\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/asm_amd64.s:228 +0x61\n\ngoroutine 16 [stack split]:\nsyscall.Syscall6(0x7, 0x1303, 0xc208039c84, 0x0, 0xc20804c000, ...)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/syscall/asm_darwin_amd64.s:41 +0x5 fp=0xc208039be8\nsyscall.wait4(0x1303, 0xc208039c84, 0x0, 0xc20804c000, 0x401fae2, ...)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/syscall/zsyscall_darwin_amd64.go:32 +0x95 fp=0xc208039c48\nsyscall.Wait4(0x1303, 0xc208039ccc, 0x0, 0xc20804c000, 0xc2080161e0, ...)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/syscall/syscall_bsd.go:129 +0x76 fp=0xc208039c90\nos.(*Process).wait(0xc208048320, 0x0, 0x0, 0x0)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/os/exec_unix.go:22 +0x121 fp=0xc208039d48\nos.(*Process).Wait(0xc208048320, 0xc208048000, 0x0, 0x0)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/os/doc.go:45 +0x39 fp=0xc208039d70\nos/exec.(*Cmd).Wait(0xc20804a140, 0x0, 0x0)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/os/exec/exec.go:320 +0x1bd fp=0xc208039e28\nos/exec.(*Cmd).Run(0xc20804a140, 0x0, 0x0)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/os/exec/exec.go:237 +0x78 fp=0xc208039e58\nos/exec.(*Cmd).CombinedOutput(0xc20804a140, 0x0, 0x0, 0x0, 0x0, ...)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/os/exec/exec.go:364 +0x269 fp=0xc208039ed8\nmain.main()\n\t/Users/quarnster/code/go/src/7227/7227.go:49 +0xc0 fp=0xc208039f50\nruntime.main()\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:243 +0x11a fp=0xc208039fa8\nruntime.goexit()\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:1446 fp=0xc208039fb0\ncreated by _rt0_go\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/asm_amd64.s:97 +0x120\n\ngoroutine 17 [syscall]:\nruntime.notetsleepg(0x41c8f68, 0xdf8475800)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/lock_sema.c:263 +0x71\nruntime.MHeap_Scavenger()\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/mheap.c:531 +0xa3\nruntime.goexit()\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:1446\ncreated by runtime.main\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:203\n\ngoroutine 18 [GC sweep wait]:\nruntime.park(0x40127e0, 0x4115248, 0x40fd1ac)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:1370 +0x89\nruntime.parkunlock(0x4115248, 0x40fd1ac)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:1386 +0x3b\nbgsweep()\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/mgc0.c:1910 +0xc2\nruntime.goexit()\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:1446\ncreated by runtime.gc\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/mgc0.c:2179\n\ngoroutine 17 [syscall]:\nruntime.goexit()\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:1446\nexit status 2\n21:00 ~/code/go/src/7227 $\n21:01 ~/code/go/src/7227 $ CGO_ENABLED=1 GOARCH=386 GOTRACEBACK=2 go run 7227.go\nI'm evil\nfatal error: runtime: stack split during syscall\n\nruntime stack:\nruntime.throw(0x40cd9de)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/panic.c:519 +0x5f\nruntime.newstack()\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/stack.c:641 +0x631\nruntime.morestack()\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/asm_386.s:246 +0x5e\n\ngoroutine 16 [stack split]:\nsyscall.Syscall6(0x139f, 0x4169e0c, 0x0, 0x151280f0, 0x0, ...)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/syscall/asm_darwin_386.s:41 +0x5 fp=0x4169dbc\nsyscall.wait4(0x139f, 0x4169e0c, 0x0, 0x151280f0, 0x401cf0d, ...)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/syscall/zsyscall_darwin_386.go:32 +0x85 fp=0x4169df0\nsyscall.Wait4(0x139f, 0x4169e30, 0x0, 0x151280f0, 0x1512c2c0, ...)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/syscall/syscall_bsd.go:129 +0x68 fp=0x4169e14\nos.(*Process).wait(0x1512a170, 0x0, 0x0, 0x0)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/os/exec_unix.go:22 +0xd9 fp=0x4169e78\nos.(*Process).Wait(0x1512a170, 0x0, 0x0, 0x0)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/os/doc.go:45 +0x38 fp=0x4169e8c\nos/exec.(*Cmd).Wait(0x15102820, 0x0, 0x0)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/os/exec/exec.go:320 +0x142 fp=0x4169ef4\nos/exec.(*Cmd).Run(0x15102820, 0x0, 0x0)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/os/exec/exec.go:237 +0x6a fp=0x4169f0c\nos/exec.(*Cmd).CombinedOutput(0x15102820, 0x0, 0x0, 0x0, 0x0, ...)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/os/exec/exec.go:364 +0x1d5 fp=0x4169f5c\nmain.main()\n\t/Users/quarnster/code/go/src/7227/7227.go:49 +0x95 fp=0x4169f9c\nruntime.main()\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:243 +0xfa fp=0x4169fd0\nruntime.goexit()\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:1446 fp=0x4169fd4\ncreated by _rt0_go\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/asm_386.s:101 +0xf7\n\ngoroutine 17 [syscall]:\nruntime.notetsleepg(0x4178fa0, 0xf8475800, 0xd)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/lock_sema.c:263 +0x66\nruntime.MHeap_Scavenger()\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/mheap.c:531 +0xbc\nruntime.goexit()\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:1446\ncreated by runtime.main\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:203\n\ngoroutine 18 [GC sweep wait]:\nruntime.park(0x4010c00, 0x40ddd00, 0x40cdeac)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:1370 +0x76\nruntime.parkunlock(0x40ddd00, 0x40cdeac)\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:1386 +0x39\nbgsweep()\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/mgc0.c:1910 +0xad\nruntime.goexit()\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:1446\ncreated by runtime.gc\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/mgc0.c:2179\n\ngoroutine 17 [syscall]:\nruntime.goexit()\n\t/Users/quarnster/code/3rdparty/go/src/pkg/runtime/proc.c:1446\nexit status 2\u003c/pre\u003e",
	"user": {
		"login": "quarnster",
		"id": 1230389,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2014-04-04T19:25:51Z",
	"updated_at": "2014-12-08T10:40:09Z"
}
