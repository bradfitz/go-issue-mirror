{
	"id": 66054171,
	"body": "\u003ca id=\"c15\"\u003e\u003c/a\u003eComment 15 by **m@capitanio.org**:\n\n\u003cpre\u003e\u003eFor now you can work around this by calling runtime.LockOSThread.\n\nruntime.GOMAXPROCS(1)\nruntime.LockOSThread()\nls, _ := net.Listen(\"tcp\", \"localhost:42\")\nsyscall.Setuid(uid)\nhttp.Serve(ls, nil)\n\nWas that what you meant? It's actually impossible ;)\nThere is always +1 thread spawned by Listen that keeps\nrunning as root.\n\nps -efL| grep setuid\nmc       19213 24745 19213  0    2 22:41 pts/4    00:00:00 /tmp/setuid 1001 1001\nroot     19213 24745 19215  0    2 22:41 pts/4    00:00:00 /tmp/setuid 1001 1001\n\n^\\SIGQUIT: quit\nPC=0x411b25\n\nruntime.futex+0x23 /data4/soft/go/go/src/pkg/runtime/linux/amd64/sys.s:137\n\truntime.futex()\nfutexsleep+0x50 /data4/soft/go/go/src/pkg/runtime/linux/thread.c:51\n\tfutexsleep(0x664c18, 0x300000003, 0x0, 0x0)\nfutexlock+0x85 /data4/soft/go/go/src/pkg/runtime/linux/thread.c:119\n\tfutexlock(0x664c18, 0x100000000)\nruntime.notesleep+0x25 /data4/soft/go/go/src/pkg/runtime/linux/thread.c:204\n\truntime.notesleep(0x664c18, 0x7fffa0812498)\nnextgandunlock+0x146 /data4/soft/go/go/src/pkg/runtime/proc.c:343\n\tnextgandunlock()\nscheduler+0x16f /data4/soft/go/go/src/pkg/runtime/proc.c:536\n\tscheduler()\nruntime.mstart+0x74 /data4/soft/go/go/src/pkg/runtime/proc.c:393\n\truntime.mstart()\n_rt0_amd64+0x95 /data4/soft/go/go/src/pkg/runtime/amd64/asm.s:69\n\t_rt0_amd64()\n\ngoroutine 2 [3]:\nruntime.entersyscall+0x28 /data4/soft/go/go/src/pkg/runtime/proc.c:577\n\truntime.entersyscall()\nsyscall.Syscall6+0x5 /data4/soft/go/go/src/pkg/syscall/asm_linux_amd64.s:40\n\tsyscall.Syscall6()\nsyscall.EpollWait+0x8d /data4/soft/go/go/src/pkg/syscall/zsyscall_linux_amd64.go:188\n\tsyscall.EpollWait(0x7f6600000006, 0x7f669eb58950, 0x100000001, 0xffffffff, 0xc, ...)\nnet.*pollster·WaitFD+0xfe /data4/soft/go/go/src/pkg/net/fd_linux.go:116\n\tnet.*pollster·WaitFD(0x7f669eb587a0, 0x0, 0x6400000000, 0x0, 0x0, ...)\nnet.*pollServer·Run+0xa3 /data4/soft/go/go/src/pkg/net/fd.go:207\n\tnet.*pollServer·Run(0x7f669eb27600, 0x0)\nruntime.goexit /data4/soft/go/go/src/pkg/runtime/proc.c:149\n\truntime.goexit()\n\ngoroutine 1 [4]:\nruntime.gosched+0x77 /data4/soft/go/go/src/pkg/runtime/proc.c:558\n\truntime.gosched()\nruntime.chanrecv+0x18b /data4/soft/go/go/src/pkg/runtime/chan.c:364\n\truntime.chanrecv(0x7f669eb3eea0, 0x7f669eb13da8, 0x0, 0x0, 0x0, ...)\nruntime.chanrecv1+0x41 /data4/soft/go/go/src/pkg/runtime/chan.c:444\n\truntime.chanrecv1(0x7f669eb3eea0, 0x7f669eb123c0)\nnet.*pollServer·WaitRead+0x52 /data4/soft/go/go/src/pkg/net/fd.go:247\n\tnet.*pollServer·WaitRead(0x7f669eb27600, 0x7f669eb123c0, 0x0, 0x0)\nnet.*netFD·accept+0x39a /data4/soft/go/go/src/pkg/net/fd.go:579\n\tnet.*netFD·accept(0x7f669eb123c0, 0x43efe8, 0x0, 0x0, 0x0, ...)\nnet.*TCPListener·AcceptTCP+0x71 /data4/soft/go/go/src/pkg/net/tcpsock.go:261\n\tnet.*TCPListener·AcceptTCP(0x7f669eb0f178, 0x7f669eb13ee0, 0x0, 0x0, 0x1007f6600000001, ...)\nnet.*TCPListener·Accept+0x49 /data4/soft/go/go/src/pkg/net/tcpsock.go:271\n\tnet.*TCPListener·Accept(0x7f669eb0f178, 0x0, 0x0, 0x0, 0x0, ...)\nhttp.Serve+0x7a /data4/soft/go/go/src/pkg/http/server.go:665\n\thttp.Serve(0x7f669eb27b40, 0x7f669eb0f178, 0x7f669eb4b030, 0x7f669eb0f0a8, 0x0, ...)\nmain.main+0x886 /home/mc/server/go/tests/setuid2.go:73\n\tmain.main()\nruntime.mainstart+0xf /data4/soft/go/go/src/pkg/runtime/amd64/asm.s:77\n\truntime.mainstart()\nruntime.goexit /data4/soft/go/go/src/pkg/runtime/proc.c:149\n\truntime.goexit()\nrax     0xfffffffffffffffc\nrbx     0x664c18\nrcx     0xffffffffffffffff\nrdx     0x3\nrdi     0x664c18\nrsi     0x0\nrbp     0x7f669eb13c98\nrsp     0x7fffa08123e8\nr8      0x0\nr9      0x0\nr10     0x6601b0\nr11     0x206\nr12     0x250\nr13     0x7fffa0812500\nr14     0x0\nr15     0x0\nrip     0x411b25\nrflags  0x206\ncs      0x33\nfs      0x0\ngs      0x0\nTrace/breakpoint trap\u003c/pre\u003e",
	"user": {
		"login": "gopherbot",
		"id": 8566911,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2011-01-21T22:11:48Z",
	"updated_at": "2014-12-08T10:08:19Z"
}
