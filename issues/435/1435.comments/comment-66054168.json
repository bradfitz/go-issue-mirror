{
	"id": 66054168,
	"body": "\u003ca id=\"c12\"\u003e\u003c/a\u003eComment 12 by **ziutek@Lnet.pl**:\n\n\u003cpre\u003eI probably found workaround for my web application:\n\npackage main\n\nimport (\n    \"os\"\n    \"net\"\n    \"http\"\n    \"fmt\"\n    \"syscall\"\n    \"runtime\"\n    \"log\"\n)\n\nfunc lockUidGid(new_uid, new_gid int) {\n    runtime.LockOSThread()\n\n    uid := syscall.Getuid()\n    gid := syscall.Getgid()\n\n    if  uid == new_uid \u0026\u0026 gid == new_gid {\n        return\n    }\n    if en := syscall.Setgid(new_uid); en != 0 {\n        log.Exitln(\"Setgid error:\", os.Errno(en))\n    }\n    if en := syscall.Setuid(new_gid); en != 0 {\n        log.Exitln(\"Setuid error:\", os.Errno(en))\n    }\n}\n\ntype Handler string\n\nfunc (hh *Handler) ServeHTTP(con http.ResponseWriter, req *http.Request) {\n    lockUidGid(65534, 65534)\n\n    fmt.Fprintf(con, \"Hello! I am %s. My UID/GID is %d/%d. Bye!\\n\", *hh,\n        syscall.Getuid(), syscall.Getgid())\n}\n\nfunc main() {\n    // To listen on port 80 we need root privileges\n    ls, err := net.Listen(\"tcp\", \"127.0.0.1:80\")\n    if err != nil {\n        log.Exitln(\"Can't listen:\", err)\n    }\n\n    // We don't need root privileges any more\n    lockUidGid(65534, 65534)\n\n    // Run http service without root privileges\n    handler := Handler(\"Test handler\")\n    if err = http.Serve(ls, \u0026handler); err != nil {\n        log.Exitln(\"Http server:\", err)\n    }\n}\n\nAfter running siege there is no threads with root privileges:\n\n$ siege 127.0.0.1 -c25 -d0 -t10s\n** SIEGE 2.69\n** Preparing 25 concurrent users for battle.\nThe server is now under siege...\nLifting the server siege..      done.\nTransactions:\t\t       28782 hits\nAvailability:\t\t      100.00 %\nElapsed time:\t\t        9.79 secs\nData transferred:\t        1.59 MB\nResponse time:\t\t        0.01 secs\nTransaction rate:\t     2939.94 trans/sec\nThroughput:\t\t        0.16 MB/sec\nConcurrency:\t\t       24.86\nSuccessful transactions:       28782\nFailed transactions:\t           0\nLongest transaction:\t        0.04\nShortest transaction:\t        0.00\n\n$ ps -efL|egrep 'http|UID'|egrep -v egrep\nUID        PID  PPID   LWP  C NLWP STIME TTY          TIME CMD\nnobody    4109  2928  4109  1   10 23:00 pts/1    00:00:04 ./http\nnobody    4109  2928  4110  0   10 23:00 pts/1    00:00:02 ./http\nnobody    4109  2928  4112  0   10 23:00 pts/1    00:00:02 ./http\nnobody    4109  2928  4153  0   10 23:01 pts/1    00:00:01 ./http\nnobody    4109  2928  4154  0   10 23:01 pts/1    00:00:00 ./http\nnobody    4109  2928  4155  0   10 23:01 pts/1    00:00:00 ./http\nnobody    4109  2928  4156  0   10 23:01 pts/1    00:00:01 ./http\nnobody    4109  2928  4157  0   10 23:01 pts/1    00:00:00 ./http\nnobody    4109  2928  4158  0   10 23:01 pts/1    00:00:01 ./http\nnobody    4109  2928  4159  0   10 23:01 pts/1    00:00:01 ./http\n\n\nnobody    4109  2928  4109  1   10 23:00 pts/1    00:00:04 ./http\nnobody    4109  2928  4110  0   10 23:00 pts/1    00:00:02 ./http\nnobody    4109  2928  4112  0   10 23:00 pts/1    00:00:02 ./http\nnobody    4109  2928  4153  0   10 23:01 pts/1    00:00:01 ./http\nnobody    4109  2928  4154  0   10 23:01 pts/1    00:00:00 ./http\nnobody    4109  2928  4155  0   10 23:01 pts/1    00:00:00 ./http\nnobody    4109  2928  4156  0   10 23:01 pts/1    00:00:01 ./http\nnobody    4109  2928  4157  0   10 23:01 pts/1    00:00:00 ./http\nnobody    4109  2928  4158  0   10 23:01 pts/1    00:00:01 ./http\nnobody    4109  2928  4159  0   10 23:01 pts/1    00:00:01 ./http\n\nThanks!\u003c/pre\u003e",
	"user": {
		"login": "gopherbot",
		"id": 8566911,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2011-01-21T22:07:19Z",
	"updated_at": "2014-12-08T10:08:19Z"
}
