{
	"id": 66054160,
	"body": "\u003ca id=\"c5\"\u003e\u003c/a\u003eComment 5 by **ziutek@Lnet.pl**:\n\n\u003cpre\u003eExample code which shows how I discovered this problem:\n\npackage main\n\nimport (\n    \"os\"\n    \"net\"\n    \"http\"\n    \"fmt\"\n    \"syscall\"\n    \"log\"\n)\n\ntype Handler string\n\nfunc (hh *Handler) ServeHTTP(con http.ResponseWriter, req *http.Request) {\n    fmt.Fprint(con, \"Hello! I am %s. My UID/GID is %d/%d. Bye!\\n\", *hh,\n        syscall.Getuid(), syscall.Getgid())\n}\n\nfunc main() {\n    // To listen on port 80 we need root privileges\n    ls, err := net.Listen(\"tcp\", \"127.0.0.1:80\")\n    if err != nil {\n        log.Exitln(\"Can't listen:\", err)\n    }\n\n    // We don't need root privileges any more\n    if en := syscall.Setgid(65534); en != 0 {\n        log.Exitln(\"Setgid error:\", os.Errno(en))\n    }\n    if en := syscall.Setuid(65534); en != 0 {\n        log.Exitln(\"Setuid error:\", os.Errno(en))\n    }\n\n    // Run http service without root privileges\n    handler := Handler(\"Test handler\")\n    if err = http.Serve(ls, \u0026handler); err != nil {\n        log.Exitln(\"Http server:\", err)\n    }\n}\n\nCompile it and run as root. Then use ps -efL to show threads:\n\nUID        PID  PPID   LWP  C NLWP STIME TTY          TIME CMD\nnobody   32401 32333 32401  0    2 18:48 pts/2    00:00:00 ./http\nroot     32401 32333 32402  0    2 18:48 pts/2    00:00:00 ./http\n\nThere is two threads. But I didn't create any gorutine explicitly. Use curl to send\nrequest to the application:\n\n$ curl 127.0.0.1\nHello! I am Test handler. My UID/GID is 65534/65534. Bye!\n\nNow ps shows:\n\nUID        PID  PPID   LWP  C NLWP STIME TTY          TIME CMD\nnobody   32401 32333 32401  0    3 18:48 pts/2    00:00:00 ./http\nroot     32401 32333 32402  0    3 18:48 pts/2    00:00:00 ./http\nnobody   32401 32333 32406  0    3 18:49 pts/2    00:00:00 ./http\n\nUse siege stress test:\n\n$ siege 127.0.0.1 -c25 -d0 -t 10s\n** SIEGE 2.70\n** Preparing 25 concurrent users for battle.\nThe server is now under siege...\nLifting the server siege..      done.                                                   \n Transactions:\t\t       12543 hits\nAvailability:\t\t      100.00 %\nElapsed time:\t\t        9.99 secs\nData transferred:\t        0.65 MB\nResponse time:\t\t        0.02 secs\nTransaction rate:\t     1255.56 trans/sec\nThroughput:\t\t        0.06 MB/sec\nConcurrency:\t\t       24.79\nSuccessful transactions:       12544\nFailed transactions:\t           0\nLongest transaction:\t        0.04\nShortest transaction:\t        0.01\n \nNow ps shows:\n\nUID        PID  PPID   LWP  C NLWP STIME TTY          TIME CMD\nnobody   32401 32333 32401  0   11 18:48 pts/2    00:00:01 ./http\nroot     32401 32333 32402  0   11 18:48 pts/2    00:00:01 ./http\nnobody   32401 32333 32406  0   11 18:49 pts/2    00:00:01 ./http\nnobody   32401 32333 32553  0   11 18:51 pts/2    00:00:00 ./http\nnobody   32401 32333 32554  2   11 18:51 pts/2    00:00:01 ./http\nroot     32401 32333 32555  3   11 18:51 pts/2    00:00:01 ./http\nroot     32401 32333 32556  3   11 18:51 pts/2    00:00:01 ./http\nroot     32401 32333 32557  0   11 18:51 pts/2    00:00:00 ./http\nroot     32401 32333 32558  3   11 18:51 pts/2    00:00:01 ./http\nnobody   32401 32333 32559  3   11 18:51 pts/2    00:00:01 ./http\nnobody   32401 32333 32560  3   11 18:51 pts/2    00:00:01 ./http\n\nUse curl a few times:\n\n$ curl 127.0.0.1\nHello! I am Test handler. My UID/GID is 0/0. Bye!\n$ curl 127.0.0.1\nHello! I am Test handler. My UID/GID is 0/0. Bye!\n$ curl 127.0.0.1\nHello! I am Test handler. My UID/GID is 0/0. Bye!\n\nIt's nice! I talking with root on your server!\u003c/pre\u003e",
	"user": {
		"login": "gopherbot",
		"id": 8566911,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2011-01-21T17:57:29Z",
	"updated_at": "2014-12-08T10:08:19Z"
}
