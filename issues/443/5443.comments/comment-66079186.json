{
	"id": 66079186,
	"body": "\u003ca id=\"c3\"\u003e\u003c/a\u003eComment 3:\n\n\u003cpre\u003eI can reproduce this now even without concurrent access.\n\nI added these lines to my code (paraphrased as):\n\n\tfunc logR(calldepth uint8, ctx interface{}, level Level, message string, params ...interface{},\n\t) (err error) {\n\t//snip ...\n\n\t\tfmt.Printf(\"====\u0026gt; Params: len: %d\\n\", len(params))\n\t\tfmt.Printf(\"====\u0026gt; %#v\\n\", params)\n\t\tr.Message = fmt.Sprintf(message, params...)\n\t//snip ...\n\t}\n\n#### I attached logging.go in case that will help.\n\nIn my code, I print out the arguments to Sprintf. Since it's always the same request,\nthe same sequence of lines should be printed. I then request a page in a loop. T\n\nNotice that, at the time the crash happens, we should have been printing out \n\n[]interface {}{interface {}(nil)}\n\nBut at a certain point, accessing that within fmt.Sprintf crashes with a unexpected\nfault address 0x0.\n\nLike I mentioned earlier, this is not limited to fmt.Sprintf. The crash point has\nchanged a number of \ntimes, but has been constant at this point the last few days.\n\nI've tried to trigger this standalone (ie code that loops forever and does this sprintf\nof a []interface{}{nil}... and calls runtime.GC() each time, but can't trigger it\nstandalone. This last time during my longevity test, it triggered it with no concurrent\nrequests after 47275 requests.\n\n====\u0026gt; []interface {}{\"/p/core/topic/1688849860329472\"}\n====\u0026gt; Params: len: 1\n====\u0026gt; []interface {}{\"topic\"}\n====\u0026gt; Params: len: 4\n====\u0026gt; []interface {}{\"TP\", \"\", 1688849860329472, interface {}(nil)}\n====\u0026gt; Params: len: 4\n====\u0026gt; []interface {}{1688849860329472, 0x6, 0x1, 1688849860329472}\n====\u0026gt; Params: len: 2\n====\u0026gt; []interface {}{(*ndb.Key)(0xc2003bdb90), []uint8{0x20, 0x6, 0x0, 0x0, 0x0, 0x1,\n0x8e, 0x2}}\n====\u0026gt; Params: len: 2\n====\u0026gt; []interface {}{\"TC\", \"\"}\n====\u0026gt; Params: len: 2\n====\u0026gt; []interface {}{\"TC\", \"\"}\n====\u0026gt; Params: len: 0\n====\u0026gt; []interface {}(nil)\n====\u0026gt; Params: len: 4\n====\u0026gt; []interface {}{(*ndb.Key)(0xc2003bdb90), \"TC\", (*app.QueryOpts)(nil),\n[]*app.QueryFilter(nil)}\n====\u0026gt; Params: len: 1\n====\u0026gt; []interface {}{[]uint8{0x20, 0x6, 0x0, 0x0, 0x0, 0x1, 0x8e, 0x2}}\n====\u0026gt; Params: len: 2\n====\u0026gt; []interface {}{1, []uint8{0x20, 0x6, 0x0, 0x0, 0x0, 0x1, 0x8e, 0x2}}\n====\u0026gt; Params: len: 2\n====\u0026gt; []interface {}{8, []uint8{0x6, 0x0, 0x8}}\n====\u0026gt; Params: len: 2\n====\u0026gt; []interface {}{0, []uint8{0x6, 0x0, 0x0}}\n====\u0026gt; Params: len: 1\n====\u0026gt; []interface {}{interface {}(nil)}\n\n\u0026lt;snip\u0026gt;\n\n====\u0026gt; []interface {}{\"/p/core/topic/1688849860329472\"}\n====\u0026gt; Params: len: 1\n====\u0026gt; []interface {}{\"topic\"}\n====\u0026gt; Params: len: 4\n====\u0026gt; []interface {}{\"TP\", \"\", 1688849860329472, interface {}(nil)}\n====\u0026gt; Params: len: 4\n====\u0026gt; []interface {}{1688849860329472, 0x6, 0x1, 1688849860329472}\n====\u0026gt; Params: len: 2\n====\u0026gt; []interface {}{(*ndb.Key)(0xc200585190), []uint8{0x20, 0x6, 0x0, 0x0, 0x0, 0x1,\n0x8e, 0x2}}\n====\u0026gt; Params: len: 2\n====\u0026gt; []interface {}{\"TC\", \"\"}\n====\u0026gt; Params: len: 2\n====\u0026gt; []interface {}{\"TC\", \"\"}\n====\u0026gt; Params: len: 0\n====\u0026gt; []interface {}(nil)\n====\u0026gt; Params: len: 4\n====\u0026gt; []interface {}{(*ndb.Key)(0xc200585190), \"TC\", (*app.QueryOpts)(nil),\n[]*app.QueryFilter(nil)}\n====\u0026gt; Params: len: 1\n====\u0026gt; []interface {}{[]uint8{0x20, 0x6, 0x0, 0x0, 0x0, 0x1, 0x8e, 0x2}}\n====\u0026gt; Params: len: 2\n====\u0026gt; []interface {}{1, []uint8{0x20, 0x6, 0x0, 0x0, 0x0, 0x1, 0x8e, 0x2}}\n====\u0026gt; Params: len: 2\n====\u0026gt; []interface {}{8, []uint8{0x6, 0x0, 0x8}}\n====\u0026gt; Params: len: 2\n====\u0026gt; []interface {}{0, []uint8{0x6, 0x0, 0x0}}\n====\u0026gt; Params: len: 1\n\nunexpected fault address 0x0\nfatal error: fault\n[signal 0xb code=0x80 addr=0x0 pc=0x409682]\n\ngoroutine 47300 [running]:\n[fp=0x7f6e2f967328] runtime.throw(0x9c5297)\n\t/opt/go-tip/src/pkg/runtime/panic.c:473 +0x67\n[fp=0x7f6e2f967340] runtime.sigpanic()\n\t/opt/go-tip/src/pkg/runtime/os_linux.c:239 +0xe7\n[fp=0x7f6e2f9673d8] itab(0x6fe1a0, 0xdeaddeaddeaddead, 0x1)\n\t/opt/go-tip/src/pkg/runtime/iface.c:46 +0x62\n[fp=0x7f6e2f9673f8] runtime.assertE2I2(0x6fe1a0, 0xdeaddeaddeaddead, 0xdeaddeaddeaddead,\n0x0, 0x0, ...)\n\t/opt/go-tip/src/pkg/runtime/iface.c:507 +0x5c\n[fp=0x7f6e2f967480] fmt.(*pp).handleMethods(0xc2003570d0, 0x10000000076, 0x1,\n0xdeaddeaddead0000)\n\t/opt/go-tip/src/pkg/fmt/print.go:673 +0x69\n[fp=0x7f6e2f9674f8] fmt.(*pp).printValue(0xc2003570d0, 0x69f860, 0xc2003bd030, 0x146,\n0x10000000076, ...)\n\t/opt/go-tip/src/pkg/fmt/print.go:847 +0x26e\n[fp=0x7f6e2f967f80] fmt.(*pp).printReflectValue(0xc2003570d0, 0x692e40, 0xc200587040,\n0x172, 0x10000000076, ...)\n\t/opt/go-tip/src/pkg/fmt/print.go:985 +0xfa4\n----- stack segment boundary -----\n[fp=0x7f6e1c0262f0] fmt.(*pp).printField(0xc2003570d0, 0x692e40, 0xc200587040,\n0x10000000076, 0x0, ...)\n\t/opt/go-tip/src/pkg/fmt/print.go:813 +0x3d1\n[fp=0x7f6e1c026670] fmt.(*pp).doPrintf(0xc2003570d0, 0x7af6d0, 0xa, 0x7f6e1c0267b0, 0x1,\n...)\n\t/opt/go-tip/src/pkg/fmt/print.go:1111 +0x1276\n[fp=0x7f6e1c0266c0] fmt.Fprintf(0xc2000f44b0, 0xc200000008, 0x7af6d0, 0xa,\n0x7f6e1c0267b0, ...)\n\t/opt/go-tip/src/pkg/fmt/print.go:214 +0x80\n[fp=0x7f6e1c026718] fmt.Printf(0x7af6d0, 0xa, 0x7f6e1c0267b0, 0x1, 0x1, ...)\n\t/opt/go-tip/src/pkg/fmt/print.go:223 +0x8c\n[fp=0x7f6e1c0269d8] ugorji.net/logging.logR(0xc2001cee02, 0x76c340, 0xc200358d20,\n0xc2001c03e9, 0x80ef70, ...)\n\t/home/ugorji/depot/repo/src/ugorji.net/logging/logging.go:277 +0x79f\n[fp=0x7f6e1c026a38] ugorji.net/logging.Trace(0x76c340, 0xc200358d20, 0x80ef70, 0x2f,\n0xc2003bd030, ...)\n\t/home/ugorji/depot/repo/src/ugorji.net/logging/logging.go:303 +0x83\n[fp=0x7f6e1c026e70] ugorji.net/ndb.(*Db).SvrQuery(0xc2001aa240, 0x76c340, 0xc200358d20,\n0xc200585190, 0x7a0a00, ...)\n\t/home/ugorji/depot/repo/src/ugorji.net/ndb/client.go:423 +0x922\n[fp=0x7f6e1c026f88] ugorji.net/ndb.func·001(0x0, 0x0, 0x0, 0x0, 0x0, ...)\n\t/home/ugorji/depot/repo/src/ugorji.net/ndb/low_level_driver.go:195 +0x16c\n----- stack segment boundary -----\n[fp=0x7f6e2fa73420] ugorji.net/db.QuerySupport(0xc2001e8640, 0xc200358d20, 0xc200298be0,\n0x19, 0x7a0a00, ...)\n\t/home/ugorji/depot/repo/src/ugorji.net/db/datastore.go:760 +0xac0\n[fp=0x7f6e2fa73580] ugorji.net/ndb.LowLevelDriver.Query(0xc2001ca080, 0xc2001a8400,\n0xc2001aa240, 0xc2001c39a0, 0xc2001c39a0, ...)\n\t/home/ugorji/depot/repo/src/ugorji.net/ndb/low_level_driver.go:208 +0x434\n[fp=0x7f6e2fa73638] ugorji.net/ndb.(*LowLevelDriver).Query(0xc2001c9420, 0xc2001e8640,\n0xc200358d20, 0xc20023b240, 0xc200585190, ...)\n\t/home/ugorji/depot/repo/src/ugorji.net/ndb/blob.go:0 +0x173\n[fp=0x7f6e2fa736d0] ugorji.net/baseapp.(*tlld).Query(0xc200124e20, 0xc2001e8640,\n0xc200358d20, 0xc20023b240, 0xc200585190, ...)\n\t/home/ugorji/depot/repo/src/ugorji.net/baseapp/baseapp.go:0 +0x117\n[fp=0x7f6e2fa738f8] ugorji.net/richapp.TopicView(0xc2001e8640, 0xc200358d20,\n0xc2001e8680, 0xc200358d50, 0xc2003571a0, ...)\n\t/home/ugorji/depot/repo/src/ugorji.net/richapp/actions.go:106 +0x2a3\n[fp=0x7f6e2fa73938] ugorji.net/web.HandlerFunc.HandleHttp(0x833f58, 0xc2001e8640,\n0xc200358d20, 0xc2001e8680, 0xc200358d50, ...)\n\t/home/ugorji/depot/repo/src/ugorji.net/web/webrouter.go:132 +0x57\n[fp=0x7f6e2fa739b0] ugorji.net/web.Dispatch(0xc2001e8640, 0xc200358d20, 0xc2001b42a0,\n0xc2001e8680, 0xc200358d50, ...)\n\t/home/ugorji/depot/repo/src/ugorji.net/web/webrouter.go:290 +0x191\n[fp=0x7f6e2fa73ae0] ugorji.net/baseapp.HTTPHandler.ServeHTTP(0xc2001a95a0, 0xc2001d2bb0,\n0xc2002149c0, 0x0, 0xc2003c2840, ...)\n\t/home/ugorji/depot/repo/src/ugorji.net/baseapp/baseapp.go:338 +0x627\n[fp=0x7f6e2fa73b20] ugorji.net/baseapp.(*HTTPHandler).ServeHTTP(0xc2002149e0,\n0xc2003c2840, 0xc2004498c0, 0xc2003571a0)\n\t/home/ugorji/depot/repo/src/ugorji.net/baseapp/baseapp.go:0 +0xa8\n[fp=0x7f6e2fa73da8] ugorji.net/blackannex/server.func·003(0xc2003c2840, 0xc2004498c0,\n0xc2003571a0)\n\t/home/ugorji/depot/repo/src/ugorji.net/blackannex/server/local.go:156 +0xa6c\n[fp=0x7f6e2fa73dc8] net/http.HandlerFunc.ServeHTTP(0xc200206c90, 0xc2003c2840,\n0xc2004498c0, 0xc2003571a0)\n\t/opt/go-tip/src/pkg/net/http/server.go:1149 +0x3e\n[fp=0x7f6e2fa73e10] ugorji.net/web.(*Server).ServeHTTP(0xc2001ee180, 0xc2003c2840,\n0xc2004498c0, 0xc2003571a0)\n\t/home/ugorji/depot/repo/src/ugorji.net/web/server.go:88 +0x1a5\n[fp=0x7f6e2fa73e50] net/http.serverHandler.ServeHTTP(0xc2001ce4b0, 0xc2003c2840,\n0xc2004498c0, 0xc2003571a0)\n\t/opt/go-tip/src/pkg/net/http/server.go:1517 +0x16c\n[fp=0x7f6e2fa73fb0] net/http.(*conn).serve(0xc20035a240)\n\t/opt/go-tip/src/pkg/net/http/server.go:1096 +0x765\n[fp=0x7f6e2fa73fb8] runtime.goexit()\n\t/opt/go-tip/src/pkg/runtime/proc.c:1223\ncreated by net/http.(*Server).Serve\n\t/opt/go-tip/src/pkg/net/http/server.go:1564 +0x266\n\n\u0026lt;snip\u0026gt;\n\n##### gdb bt output from the core file\n\n#0  runtime.raise (sig=void) at /opt/go-tip/src/pkg/runtime/sys_linux_amd64.s:85\n#1  0x000000000041aa1f in runtime.crash ()\n#2  0x0000000000413bd7 in runtime.dopanic (unused=void) at\n/opt/go-tip/src/pkg/runtime/panic.c:434\n#3  0x0000000000413d17 in runtime.throw (s=void) at\n/opt/go-tip/src/pkg/runtime/panic.c:472\n#4  0x0000000000412cc7 in runtime.sigpanic () at\n/opt/go-tip/src/pkg/runtime/os_linux.c:239\n#5  0x0000000000409682 in itab (inter=void, type=void, canfail=void) at\n/opt/go-tip/src/pkg/runtime/iface.c:43\n#6  0x000000000040a3dc in runtime.assertE2I2 (inter=void, e=void, ret=void, ok=void)\n    at /opt/go-tip/src/pkg/runtime/iface.c:507\n#7  0x000000000042ea89 in fmt.(*pp).handleMethods (p=0xc2003570d0, verb=118, plus=false,\ngoSyntax=true, depth=1, \n    wasString=false, handled=false) at /opt/go-tip/src/pkg/fmt/print.go:673\n#8  0x000000000042fcbe in fmt.(*pp).printValue (p=..., value=..., verb=118, plus=false,\ngoSyntax=true, depth=1, \n    wasString=70) at /opt/go-tip/src/pkg/fmt/print.go:847\n#9  0x0000000000430d14 in fmt.(*pp).printReflectValue (p=..., value=..., verb=118,\nplus=false, goSyntax=true, \n    depth=0, wasString=false) at /opt/go-tip/src/pkg/fmt/print.go:985\n#10 0x00000000004232e0 in ?? () at /opt/go-tip/src/pkg/runtime/asm_amd64.s:278\n#11 0x000000c2003570d0 in ?? ()\n#12 0x0000000000692e40 in egcdata ()\n#13 0x000000c200587040 in ?? ()\n#14 0x0000000000000172 in ?? ()\n#15 0x0000010000000076 in ?? ()\n#16 0x0000000000000000 in ?? ()\n(gdb) q\u003c/pre\u003e\n\n\n\n\n\nAttachments:\n\n1. \u003ca href=\"https://storage.googleapis.com/go-attachment/5443/3/logging.go\"\u003elogging.go\u003c/a\u003e (8780 bytes)",
	"user": {
		"login": "ugorji",
		"id": 1222082,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2013-05-12T19:33:35Z",
	"updated_at": "2014-12-22T06:25:06Z"
}
