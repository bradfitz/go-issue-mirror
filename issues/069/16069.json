{
	"id": 160371081,
	"number": 16069,
	"state": "closed",
	"title": "runtime: process stuck while referencing x.f when x is nil",
	"body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What version of Go are you using (`go version`)?\r\n\r\n`go version go1.5.4 linux/amd64`\r\n\r\n2. What operating system and processor architecture are you using (`go env`)?\r\n\r\n```\r\nGOARCH=\"amd64\"\r\nGOBIN=\"\"\r\nGOEXE=\"\"\r\nGOHOSTARCH=\"amd64\"\r\nGOHOSTOS=\"linux\"\r\nGOOS=\"linux\"\r\nGOPATH=\"/root/go\"\r\nGORACE=\"\"\r\nGOROOT=\"/usr/local/go\"\r\nGOTOOLDIR=\"/usr/local/go/pkg/tool/linux_amd64\"\r\nGO15VENDOREXPERIMENT=\"\"\r\nCC=\"gcc\"\r\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0\"\r\nCXX=\"g++\"\r\nCGO_ENABLED=\"1\"\r\n```\r\n\r\n3. What did you do?\r\n\r\n```\r\nfunc (dm *driverWithMeta) ReadFile() {\r\n\tprintln(\"dm\", dm)\r\n\tprintln(\"name\", dm.name)\r\n\tprintln(\"cb\", dm.cb)\r\n\t// ....\r\n}\r\n```\r\n\r\n4. What did you expect to see?\r\n\r\n```\r\ndm 0x0\r\npanic: runtime error: invalid memory address or nil pointer dereference\r\n```\r\n\r\n5. What did you see instead?\r\n\r\n```\r\ndm 0x0\r\n```\r\nSome info got from delve.\r\n```\r\n(dlv) goroutine\r\nThread 1949 at /usr/local/go/src/runtime/sys_linux_amd64.s:289\r\n\r\n(dlv) goroutines\r\n[11 goroutines]\r\n  Goroutine 1 - User: /usr/local/go/src/runtime/netpoll.go:157 net.runtime_pollWait (0x43e5cc)\r\n  Goroutine 2 - User: /usr/local/go/src/runtime/proc.go:186 runtime.gopark (0x445003)\r\n  Goroutine 3 - User: /usr/local/go/src/runtime/proc.go:186 runtime.gopark (0x445003)\r\n  Goroutine 4 - User: /usr/local/go/src/runtime/proc.go:186 runtime.gopark (0x445003)\r\n  Goroutine 6 - User: /usr/local/go/src/os/signal/signal_unix.go:22 os/signal.loop (0x4c5443)\r\n  Goroutine 7 - User: /usr/local/go/src/runtime/sys_linux_amd64.s:229 runtime.sigtramp (0x4777e0)\r\n  Goroutine 8 - User: /usr/local/go/src/runtime/proc.go:186 runtime.gopark (0x445003)\r\n  Goroutine 9 - User: ./app/cloud/application.go:81 backend/app/cloud.Start.func1 (0x47920f)\r\n  Goroutine 10 - User: ./xvendor/src/github.com/braintree/manners/server.go:159 github.com/braintree/manners.(*GracefulServer).Serve.func1 (0x4d22e7)\r\n  Goroutine 11 - User: /usr/local/go/src/runtime/proc.go:186 runtime.gopark (0x445003)\r\n  Goroutine 17 - User: /usr/local/go/src/runtime/asm_amd64.s:1722 runtime.goexit (0x4765c1)\r\n\r\n(dlv) threads\r\n* Thread 1949 at 0x4778c3 /usr/local/go/src/runtime/sys_linux_amd64.s:289 runtime.futex\r\n  Thread 1950 at 0x4775fd /usr/local/go/src/runtime/sys_linux_amd64.s:95 runtime.usleep\r\n  Thread 1951 at 0x4778c3 /usr/local/go/src/runtime/sys_linux_amd64.s:289 runtime.futex\r\n  Thread 1952 at 0x4777e0 /usr/local/go/src/runtime/sys_linux_amd64.s:229 runtime.sigtramp\r\n  Thread 1953 at 0x4778c3 /usr/local/go/src/runtime/sys_linux_amd64.s:289 runtime.futex\r\n  Thread 1954 at 0x477a49 /usr/local/go/src/runtime/sys_linux_amd64.s:420 runtime.epollwait\r\n\r\n(dlv) stack\r\n0  0x00000000004778c3 in runtime.futex\r\n   at /usr/local/go/src/runtime/sys_linux_amd64.s:289\r\n1  0x000000000043fc44 in runtime.futexsleep\r\n   at /usr/local/go/src/runtime/os1_linux.go:39\r\n2  0x000000000042564f in runtime.notesleep\r\n   at /usr/local/go/src/runtime/lock_futex.go:142\r\n3  0x0000000000449179 in runtime.stoplockedm\r\n   at /usr/local/go/src/runtime/proc1.go:1276\r\n4  0x000000000044a1a9 in runtime.schedule\r\n   at /usr/local/go/src/runtime/proc1.go:1598\r\n5  0x000000000044a626 in runtime.park_m\r\n   at /usr/local/go/src/runtime/proc1.go:1706\r\n6  0x0000000000473e79 in runtime.mcall\r\n   at /usr/local/go/src/runtime/asm_amd64.s:204\r\n\r\n(dlv) list\r\n\u003e runtime.futex() /usr/local/go/src/runtime/sys_linux_amd64.s:289 (PC: 0x4778c3)\r\n   284:\t\tMOVQ\tts+16(FP), R10\r\n   285:\t\tMOVQ\taddr2+24(FP), R8\r\n   286:\t\tMOVL\tval3+32(FP), R9\r\n   287:\t\tMOVL\t$202, AX\r\n   288:\t\tSYSCALL\r\n=\u003e 289:\t\tMOVL\tAX, ret+40(FP)\r\n   290:\t\tRET\r\n   291:\t\r\n   292:\t// int32 clone(int32 flags, void *stack, M *mp, G *gp, void (*fn)(void));\r\n   293:\tTEXT runtimeÂ·clone(SB),NOSPLIT,$0\r\n   294:\t\tMOVL\tflags+0(FP), DI\r\n```\r\n\r\n\r\nAnd then cpu usage is 99.9%. And I can not term process without `kill -9`.\r\nI tried to write a simple piece of code to reproduce this but I can't.\r\nCould you give me some clues of this?\r\n",
	"user": {
		"login": "zh-lab",
		"id": 11348478,
		"type": "User",
		"site_admin": false
	},
	"comments": 23,
	"closed_at": "2016-06-16T16:04:54Z",
	"created_at": "2016-06-15T08:57:21Z",
	"updated_at": "2016-06-16T16:04:54Z"
}
