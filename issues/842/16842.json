{
	"id": 172579685,
	"number": 16842,
	"state": "closed",
	"title": "cmd/link: regression in handling of linker flags",
	"body": "Commit fa8a28d55940adbf797e54a9ca6fa68f1e341a93 introduced a regression where -ldflags doesn't quite work like it used to.\r\n\r\nReproduction:\r\n```\r\n$ GO_LDFLAGS='-I /lib/x86_64-linux-gnu/ld-linux-x86-64.so.2' ./make.bash\r\n```\r\n\u003cdetails\u003e\r\n\u003csummary\u003e\r\n```cmd/pprof\r\n# cmd/go\r\n/home/rawr/Projects/go/pkg/tool/linux_amd64/link: conflict dynlinker: /lib/x86_64-linux-gnu/ld-linux-x86-64.so.2 and /lib64/ld-linux-x86-64.so.2\r\nruntime/cgo(.text): stderr: not defined\r\nruntime/cgo(.text): fwrite: not defined\r\nruntime/cgo(.text): __vfprintf_chk: not defined\r\nruntime/cgo(.text): fputc: not defined\r\nruntime/cgo(.text): abort: not defined\r\nruntime/cgo(.text): pthread_create: not defined\r\nruntime/cgo(.text): strerror: not defined\r\nruntime/cgo(.text): stderr: not defined\r\nruntime/cgo(.text): __fprintf_chk: not defined\r\nruntime/cgo(.text): abort: not defined\r\nruntime/cgo(.text): pthread_mutex_lock: not defined\r\nruntime/cgo(.text): pthread_cond_wait: not defined\r\nruntime/cgo(.text): pthread_mutex_unlock: not defined\r\nruntime/cgo(.text): pthread_mutex_lock: not defined\r\nruntime/cgo(.text): pthread_cond_broadcast: not defined\r\nruntime/cgo(.text): pthread_mutex_unlock: not defined\r\nruntime/cgo(.text): pthread_mutex_lock: not defined\r\nruntime/cgo(.text): pthread_mutex_unlock: not defined\r\nruntime/cgo(.text): pthread_mutex_lock: not defined\r\nruntime/cgo(.text): pthread_mutex_unlock: not defined\r\n/home/rawr/Projects/go/pkg/tool/linux_amd64/link: too many errors\r\n```\r\n\u003c/summary\u003e\r\n```\r\n##### Building Go bootstrap tool.\r\ncmd/dist\r\n\r\n##### Building Go toolchain using /usr/local/go1.4.3.\r\nbootstrap/internal/dwarf\r\nbootstrap/internal/sys\r\nbootstrap/asm/internal/flags\r\nbootstrap/internal/bio\r\nbootstrap/compile/internal/big\r\nbootstrap/internal/obj\r\nbootstrap/compile/internal/syntax\r\nbootstrap/internal/gcprog\r\nbootstrap/internal/obj/arm\r\nbootstrap/internal/obj/arm64\r\nbootstrap/internal/obj/mips\r\nbootstrap/internal/obj/ppc64\r\nbootstrap/internal/obj/s390x\r\nbootstrap/internal/obj/x86\r\nbootstrap/asm/internal/lex\r\nbootstrap/link/internal/ld\r\nbootstrap/compile/internal/ssa\r\nbootstrap/asm/internal/arch\r\nbootstrap/asm/internal/asm\r\nbootstrap/asm\r\nbootstrap/link/internal/amd64\r\nbootstrap/link/internal/arm\r\nbootstrap/link/internal/arm64\r\nbootstrap/link/internal/mips64\r\nbootstrap/link/internal/ppc64\r\nbootstrap/link/internal/s390x\r\nbootstrap/link/internal/x86\r\nbootstrap/link\r\nbootstrap/compile/internal/gc\r\nbootstrap/compile/internal/amd64\r\nbootstrap/compile/internal/arm\r\nbootstrap/compile/internal/arm64\r\nbootstrap/compile/internal/mips64\r\nbootstrap/compile/internal/ppc64\r\nbootstrap/compile/internal/s390x\r\nbootstrap/compile/internal/x86\r\nbootstrap/compile\r\n\r\n##### Building go_bootstrap for host, linux/amd64.\r\nruntime/internal/sys\r\nruntime/internal/atomic\r\nruntime\r\nencoding\r\nerrors\r\ninternal/race\r\ninternal/syscall/windows/sysdll\r\nmath\r\nsort\r\nsync/atomic\r\nunicode\r\nunicode/utf16\r\nunicode/utf8\r\nsync\r\ncontainer/heap\r\ninternal/singleflight\r\nio\r\nsyscall\r\nbytes\r\nhash\r\nstrings\r\nstrconv\r\nhash/adler32\r\nbufio\r\nreflect\r\nencoding/base64\r\ncrypto\r\npath\r\nregexp/syntax\r\ncrypto/sha1\r\ninternal/syscall/windows\r\ninternal/syscall/windows/registry\r\ntime\r\nregexp\r\nos\r\nos/signal\r\npath/filepath\r\nio/ioutil\r\nencoding/binary\r\nfmt\r\ncontext\r\nflag\r\ngo/token\r\nlog\r\nnet/url\r\ntext/template/parse\r\ncompress/flate\r\nencoding/json\r\ndebug/dwarf\r\ngo/scanner\r\nos/exec\r\ngo/ast\r\ndebug/macho\r\ncompress/zlib\r\ndebug/elf\r\ntext/template\r\ngo/parser\r\ngo/doc\r\ngo/build\r\ncmd/go\r\n\r\n##### Building packages and commands for linux/amd64.\r\nruntime/internal/sys\r\nruntime/internal/atomic\r\nruntime\r\nerrors\r\ninternal/race\r\nsync/atomic\r\nunicode\r\nunicode/utf8\r\nmath\r\nsort\r\nsync\r\ncontainer/heap\r\ncontainer/list\r\nio\r\nsyscall\r\ncontainer/ring\r\ncrypto/subtle\r\nbytes\r\nstrings\r\npath\r\nbufio\r\nhash\r\nhash/adler32\r\ntext/tabwriter\r\nhash/crc32\r\ncompress/bzip2\r\nstrconv\r\ncrypto/cipher\r\ntime\r\nmath/rand\r\ncrypto/hmac\r\ninternal/syscall/unix\r\ninternal/nettrace\r\ninternal/singleflight\r\nencoding\r\nunicode/utf16\r\nvendor/golang_org/x/net/lex/httplex\r\nhash/crc64\r\nreflect\r\nregexp/syntax\r\ncrypto\r\ncrypto/aes\r\nos\r\ncrypto/sha512\r\npath/filepath\r\ncrypto/md5\r\ncrypto/rc4\r\nregexp\r\ncrypto/sha1\r\nio/ioutil\r\ncrypto/sha256\r\nencoding/base64\r\nencoding/pem\r\nencoding/ascii85\r\nencoding/base32\r\nhash/fnv\r\nhtml\r\nimage/color\r\ninternal/syscall/windows/sysdll\r\nruntime/debug\r\nruntime/trace\r\nimage\r\nimage/color/palette\r\nmath/cmplx\r\nos/signal\r\nruntime/race\r\ncmd/compile/internal/test\r\ncmd/internal/pprof/svg\r\ncmd/vet/internal/whitelist\r\nfmt\r\nencoding/binary\r\nimage/internal/imageutil\r\nimage/draw\r\nimage/jpeg\r\ncmd/internal/sys\r\ncrypto/des\r\nindex/suffixarray\r\ncmd/internal/dwarf\r\nlog\r\nflag\r\ndebug/dwarf\r\ncompress/flate\r\ndebug/gosym\r\ndebug/plan9obj\r\ncmd/internal/obj\r\ncmd/vendor/golang.org/x/arch/arm/armasm\r\ncompress/zlib\r\ndebug/macho\r\ndebug/pe\r\ndebug/elf\r\ncmd/vendor/golang.org/x/arch/x86/x86asm\r\narchive/tar\r\ncmd/internal/goobj\r\narchive/zip\r\ncompress/gzip\r\ncompress/lzw\r\ncontext\r\ncmd/internal/objfile\r\nmath/big\r\nencoding/hex\r\ngo/token\r\nos/exec\r\ncmd/addr2line\r\ngo/scanner\r\ngo/ast\r\ndatabase/sql/driver\r\nencoding/csv\r\nencoding/gob\r\ndatabase/sql\r\ncrypto/dsa\r\ncrypto/elliptic\r\nencoding/asn1\r\ncrypto/rand\r\ngo/parser\r\ncrypto/rsa\r\ngo/printer\r\ncrypto/ecdsa\r\ncrypto/x509/pkix\r\nencoding/json\r\nencoding/xml\r\nvendor/golang_org/x/net/http2/hpack\r\nmime\r\nmime/quotedprintable\r\ncmd/cgo\r\nnet/http/internal\r\nnet/url\r\ntext/template/parse\r\ngo/constant\r\ngo/format\r\ntext/scanner\r\nimage/gif\r\ngo/types\r\nimage/png\r\ntext/template\r\nruntime/pprof\r\ntesting\r\nruntime/cgo\r\ngo/doc\r\nhtml/template\r\ngo/build\r\ninternal/testenv\r\ninternal/trace\r\nnet/internal/socktest\r\nnet\r\nos/user\r\ntesting/iotest\r\ntesting/quick\r\ncmd/internal/obj/arm\r\ngo/internal/gccgoimporter\r\ngo/internal/gcimporter\r\ngo/importer\r\ncmd/api\r\ncmd/internal/obj/arm64\r\ncmd/internal/obj/mips\r\ncmd/internal/obj/ppc64\r\ncmd/internal/obj/s390x\r\ncmd/internal/obj/x86\r\ncmd/asm/internal/flags\r\ncmd/asm/internal/lex\r\ncmd/internal/bio\r\ncmd/compile/internal/big\r\ncmd/compile/internal/ssa\r\ncrypto/x509\r\nnet/textproto\r\nmime/multipart\r\ncrypto/tls\r\nnet/http/httptrace\r\nlog/syslog\r\nnet/mail\r\ncmd/asm/internal/arch\r\ncmd/compile/internal/syntax\r\ncmd/asm/internal/asm\r\ncmd/asm\r\nnet/http\r\nnet/smtp\r\ncmd/internal/gcprog\r\ncmd/cover\r\ncmd/dist\r\ncmd/doc\r\ncmd/fix\r\ncmd/gofmt\r\ncmd/internal/pprof/profile\r\ncmd/internal/pprof/tempfile\r\ncmd/link/internal/ld\r\ncmd/internal/pprof/plugin\r\ncmd/internal/pprof/report\r\nexpvar\r\nnet/http/cgi\r\nnet/http/cookiejar\r\nnet/http/fcgi\r\nnet/http/httptest\r\nnet/http/httputil\r\nnet/http/pprof\r\nnet/rpc\r\ncmd/go\r\nnet/rpc/jsonrpc\r\ncmd/internal/pprof/commands\r\ncmd/internal/pprof/driver\r\ncmd/internal/pprof/fetch\r\ncmd/internal/pprof/symbolizer\r\ncmd/internal/pprof/symbolz\r\ncmd/link/internal/amd64\r\ncmd/link/internal/arm\r\ncmd/link/internal/arm64\r\ncmd/link/internal/mips64\r\ncmd/link/internal/ppc64\r\ncmd/link/internal/s390x\r\ncmd/link/internal/x86\r\ncmd/nm\r\ncmd/link\r\ncmd/objdump\r\ncmd/pack\r\ncmd/pprof\r\n# cmd/go\r\n/home/rawr/Projects/go/pkg/tool/linux_amd64/link: conflict dynlinker: /lib/x86_64-linux-gnu/ld-linux-x86-64.so.2 and /lib64/ld-linux-x86-64.so.2\r\nruntime/cgo(.text): stderr: not defined\r\nruntime/cgo(.text): fwrite: not defined\r\nruntime/cgo(.text): __vfprintf_chk: not defined\r\nruntime/cgo(.text): fputc: not defined\r\nruntime/cgo(.text): abort: not defined\r\nruntime/cgo(.text): pthread_create: not defined\r\nruntime/cgo(.text): strerror: not defined\r\nruntime/cgo(.text): stderr: not defined\r\nruntime/cgo(.text): __fprintf_chk: not defined\r\nruntime/cgo(.text): abort: not defined\r\nruntime/cgo(.text): pthread_mutex_lock: not defined\r\nruntime/cgo(.text): pthread_cond_wait: not defined\r\nruntime/cgo(.text): pthread_mutex_unlock: not defined\r\nruntime/cgo(.text): pthread_mutex_lock: not defined\r\nruntime/cgo(.text): pthread_cond_broadcast: not defined\r\nruntime/cgo(.text): pthread_mutex_unlock: not defined\r\nruntime/cgo(.text): pthread_mutex_lock: not defined\r\nruntime/cgo(.text): pthread_mutex_unlock: not defined\r\nruntime/cgo(.text): pthread_mutex_lock: not defined\r\nruntime/cgo(.text): pthread_mutex_unlock: not defined\r\n/home/rawr/Projects/go/pkg/tool/linux_amd64/link: too many errors\r\ncmd/trace\r\ncmd/vet/internal/cfg\r\ncmd/vet\r\n# cmd/pprof\r\n/home/rawr/Projects/go/pkg/tool/linux_amd64/link: conflict dynlinker: /lib/x86_64-linux-gnu/ld-linux-x86-64.so.2 and /lib64/ld-linux-x86-64.so.2\r\nruntime/cgo(.text): stderr: not defined\r\nruntime/cgo(.text): fwrite: not defined\r\nruntime/cgo(.text): __vfprintf_chk: not defined\r\nruntime/cgo(.text): fputc: not defined\r\nruntime/cgo(.text): abort: not defined\r\nruntime/cgo(.text): pthread_create: not defined\r\nruntime/cgo(.text): strerror: not defined\r\nruntime/cgo(.text): stderr: not defined\r\nruntime/cgo(.text): __fprintf_chk: not defined\r\nruntime/cgo(.text): abort: not defined\r\nruntime/cgo(.text): pthread_mutex_lock: not defined\r\nruntime/cgo(.text): pthread_cond_wait: not defined\r\nruntime/cgo(.text): pthread_mutex_unlock: not defined\r\nruntime/cgo(.text): pthread_mutex_lock: not defined\r\nruntime/cgo(.text): pthread_cond_broadcast: not defined\r\nruntime/cgo(.text): pthread_mutex_unlock: not defined\r\nruntime/cgo(.text): pthread_mutex_lock: not defined\r\nruntime/cgo(.text): pthread_mutex_unlock: not defined\r\nruntime/cgo(.text): pthread_mutex_lock: not defined\r\nruntime/cgo(.text): pthread_mutex_unlock: not defined\r\n/home/rawr/Projects/go/pkg/tool/linux_amd64/link: too many errors\r\n# cmd/trace\r\n/home/rawr/Projects/go/pkg/tool/linux_amd64/link: conflict dynlinker: /lib/x86_64-linux-gnu/ld-linux-x86-64.so.2 and /lib64/ld-linux-x86-64.so.2\r\nruntime/cgo(.text): stderr: not defined\r\nruntime/cgo(.text): fwrite: not defined\r\nruntime/cgo(.text): __vfprintf_chk: not defined\r\nruntime/cgo(.text): fputc: not defined\r\nruntime/cgo(.text): abort: not defined\r\nruntime/cgo(.text): pthread_create: not defined\r\nruntime/cgo(.text): strerror: not defined\r\nruntime/cgo(.text): stderr: not defined\r\nruntime/cgo(.text): __fprintf_chk: not defined\r\nruntime/cgo(.text): abort: not defined\r\nruntime/cgo(.text): pthread_mutex_lock: not defined\r\nruntime/cgo(.text): pthread_cond_wait: not defined\r\nruntime/cgo(.text): pthread_mutex_unlock: not defined\r\nruntime/cgo(.text): pthread_mutex_lock: not defined\r\nruntime/cgo(.text): pthread_cond_broadcast: not defined\r\nruntime/cgo(.text): pthread_mutex_unlock: not defined\r\nruntime/cgo(.text): pthread_mutex_lock: not defined\r\nruntime/cgo(.text): pthread_mutex_unlock: not defined\r\nruntime/cgo(.text): pthread_mutex_lock: not defined\r\nruntime/cgo(.text): pthread_mutex_unlock: not defined\r\n/home/rawr/Projects/go/pkg/tool/linux_amd64/link: too many errors\r\ncmd/compile/internal/gc\r\ncmd/compile/internal/amd64\r\ncmd/compile/internal/arm\r\ncmd/compile/internal/mips64\r\ncmd/compile/internal/arm64\r\ncmd/compile/internal/ppc64\r\ncmd/compile/internal/s390x\r\ncmd/compile/internal/x86\r\ncmd/compile\r\n```\r\n\u003c/details\u003e\r\n\r\n/cc @matloob @crawshaw ",
	"user": {
		"login": "dsnet",
		"id": 6354026,
		"type": "User",
		"site_admin": false
	},
	"assignee": {
		"login": "dsnet",
		"id": 6354026,
		"type": "User",
		"site_admin": false
	},
	"comments": 2,
	"closed_at": "2016-08-29T21:44:26Z",
	"created_at": "2016-08-22T23:36:11Z",
	"updated_at": "2016-08-29T21:44:26Z",
	"milestone": {
		"id": 1709363,
		"number": 38,
		"title": "Go1.8"
	}
}
