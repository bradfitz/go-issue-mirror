{
	"id": 51282699,
	"number": 4830,
	"state": "closed",
	"title": "net/http: TestHandlerPanic hangs",
	"body": "\u003cpre\u003eparent: 15771:0adf91947752 tip\ndarwin/amd64\n\n$ while ./http.test -test.v -test.cpu=1,2,3,4,5,6,7,8 -test.run=HandlerPanic; do true;\ndone;\n\neventually hangs with (even after increasing the timeout to 10sec):\n=== RUN TestHandlerPanic-2\n--- PASS: TestHandlerPanic-2 (0.00 seconds)\n=== RUN TestHandlerPanicWithHijack-2\n--- PASS: TestHandlerPanicWithHijack-2 (0.00 seconds)\n=== RUN TestHandlerPanicNil-3\n--- PASS: TestHandlerPanicNil-3 (0.00 seconds)\n=== RUN TestHandlerPanic-3\n--- PASS: TestHandlerPanic-3 (18.86 seconds)\nserve_test.go:1067: \texpected server handler to log an error\n\nThe stack dump is:\ngoroutine 48 [running]:\ntesting.func·004(0x5cdfa8, 0x5cd100)\n\t/Users/dvyukov/src/go2/src/pkg/testing/testing.go:310 +0xb3\nnet/http_test.testHandlerPanic(0xc20016fea0, 0x374200, 0x230720, 0xc2000a0ed0,\n0xc2000a0ed0, ...)\n\t/Users/dvyukov/src/go2/src/pkg/net/http/serve_test.go:1067 +0x337\nnet/http_test.TestHandlerPanic(0xc20016fea0, 0xc22f54c30a)\n\t/Users/dvyukov/src/go2/src/pkg/net/http/serve_test.go:1000 +0x62\ntesting.tRunner(0xc20016fea0, 0x5104c0, 0x0, 0x0)\n\t/Users/dvyukov/src/go2/src/pkg/testing/testing.go:315 +0x6c\ncreated by testing.RunTests\n\t/Users/dvyukov/src/go2/src/pkg/testing/testing.go:430 +0x875\n\ngoroutine 1 [chan receive]:\ntesting.RunTests(0x2000, 0x50fb60, 0x8f, 0x8f, 0x5c3f01, ...)\n\t/Users/dvyukov/src/go2/src/pkg/testing/testing.go:431 +0x898\ntesting.Main(0x2000, 0x50fb60, 0x8f, 0x8f, 0x5092f8, ...)\n\t/Users/dvyukov/src/go2/src/pkg/testing/testing.go:327 +0x8a\nmain.main()\n\tnet/http/_test/_testmain.go:349 +0x9a\n\ngoroutine 49 [runnable]:\nnet.(*pollServer).WaitRead(0xc20013c6f0, 0xc20011edd0, 0xc200000c60, 0x23, 0xc200000c01,\n...)\n\t/Users/dvyukov/src/go2/src/pkg/net/fd_unix.go:244 +0x63\nnet.(*netFD).accept(0xc20011edd0, 0x15d290, 0x0, 0xc200000c60, 0x23, ...)\n\t/Users/dvyukov/src/go2/src/pkg/net/fd_unix.go:631 +0x171\nnet.(*TCPListener).AcceptTCP(0xc2000b73d0, 0xc20018af00, 0x0, 0x0, 0xc0, ...)\n\t/Users/dvyukov/src/go2/src/pkg/net/tcpsock_posix.go:232 +0x57\nnet.(*TCPListener).Accept(0xc2000b73d0, 0x0, 0x0, 0x0, 0x0, ...)\n\t/Users/dvyukov/src/go2/src/pkg/net/tcpsock_posix.go:242 +0x49\nnet/http/httptest.(*historyListener).Accept(0xc20013c840, 0x0, 0x0, 0x0, 0x0, ...)\n\t/Users/dvyukov/src/go2/src/pkg/net/http/httptest/server.go:48 +0x54\nnet/http.(*Server).Serve(0xc20016d8c0, 0xc200095980, 0xc20013c840, 0x0, 0x0, ...)\n\t/Users/dvyukov/src/go2/src/pkg/net/http/server.go:1316 +0x85\ncreated by net/http/httptest.(*Server).Start\n\t/Users/dvyukov/src/go2/src/pkg/net/http/httptest/server.go:109 +0x21a\n\ngoroutine 4 [syscall]:\nsyscall.Syscall6()\n\t/Users/dvyukov/src/go2/src/pkg/syscall/asm_darwin_amd64.s:38 +0x5\nsyscall.kevent(0x6, 0x0, 0x0, 0xc200096c08, 0xa, ...)\n\t/Users/dvyukov/src/go2/src/pkg/syscall/zsyscall_darwin_amd64.go:199 +0x83\nsyscall.Kevent(0x6, 0x0, 0x0, 0x0, 0xc200096c08, ...)\n\t/Users/dvyukov/src/go2/src/pkg/syscall/syscall_bsd.go:554 +0x9b\nnet.(*pollster).WaitFD(0xc200096c00, 0xc200000db0, 0x0, 0x0, 0x0, ...)\n\t/Users/dvyukov/src/go2/src/pkg/net/fd_darwin.go:101 +0x187\nnet.(*pollServer).Run(0xc200000db0, 0x0)\n\t/Users/dvyukov/src/go2/src/pkg/net/fd_unix.go:212 +0x10a\ncreated by net.newPollServer\n\t/Users/dvyukov/src/go2/src/pkg/net/newpollserver_unix.go:33 +0x2d5\n\ngoroutine 24 [syscall]:\nsyscall.Syscall6()\n\t/Users/dvyukov/src/go2/src/pkg/syscall/asm_darwin_amd64.s:38 +0x5\nsyscall.kevent(0x9, 0x0, 0x0, 0xc20014d008, 0xa, ...)\n\t/Users/dvyukov/src/go2/src/pkg/syscall/zsyscall_darwin_amd64.go:199 +0x83\nsyscall.Kevent(0x9, 0x0, 0x0, 0x0, 0xc20014d008, ...)\n\t/Users/dvyukov/src/go2/src/pkg/syscall/syscall_bsd.go:554 +0x9b\nnet.(*pollster).WaitFD(0xc20014d000, 0xc20013c6f0, 0x0, 0x0, 0x0, ...)\n\t/Users/dvyukov/src/go2/src/pkg/net/fd_darwin.go:101 +0x187\nnet.(*pollServer).Run(0xc20013c6f0, 0x0)\n\t/Users/dvyukov/src/go2/src/pkg/net/fd_unix.go:212 +0x10a\ncreated by net.newPollServer\n\t/Users/dvyukov/src/go2/src/pkg/net/newpollserver_unix.go:33 +0x2d5\n\ngoroutine 6 [semacquire]:\nsync.runtime_Semacquire(0xc2000b73a0, 0xc2000b73a0)\n\t/Users/dvyukov/src/go2/src/pkg/runtime/zsema_darwin_amd64.c:165 +0x2e\nsync.(*Cond).Wait(0xc2000c0030, 0x0)\n\t/Users/dvyukov/src/go2/src/pkg/sync/cond.go:73 +0x95\nio.(*pipe).read(0xc2000c0000, 0xc2000fa000, 0x1000, 0x1000, 0x0, ...)\n\t/Users/dvyukov/src/go2/src/pkg/io/pipe.go:52 +0x1f2\nio.(*PipeReader).Read(0xc2000b7330, 0xc2000fa000, 0x1000, 0x1000, 0x1000, ...)\n\t/Users/dvyukov/src/go2/src/pkg/io/pipe.go:130 +0x5d\nnet/http_test.func·063(0xc2000b7328, 0xc2000b7318, 0xc2000b7398, 0x0, 0x0, ...)\n\t/Users/dvyukov/src/go2/src/pkg/net/http/serve_test.go:1046 +0x68\ncreated by net/http_test.testHandlerPanic\n\t/Users/dvyukov/src/go2/src/pkg/net/http/serve_test.go:1052 +0x20c\n\ngoroutine 26 [semacquire]:\nsync.runtime_Semacquire(0xc2000b7898, 0xc2000b7898)\n\t/Users/dvyukov/src/go2/src/pkg/runtime/zsema_darwin_amd64.c:165 +0x2e\nsync.(*Cond).Wait(0xc2001400f0, 0xc2000a01c0)\n\t/Users/dvyukov/src/go2/src/pkg/sync/cond.go:73 +0x95\nio.(*pipe).read(0xc2001400c0, 0xc20014e000, 0x1000, 0x1000, 0x0, ...)\n\t/Users/dvyukov/src/go2/src/pkg/io/pipe.go:52 +0x1f2\nio.(*PipeReader).Read(0xc2000b7828, 0xc20014e000, 0x1000, 0x1000, 0x1000, ...)\n\t/Users/dvyukov/src/go2/src/pkg/io/pipe.go:130 +0x5d\nnet/http_test.func·063(0xc2000b7820, 0xc2000b7810, 0xc2000b7890, 0x0, 0x0, ...)\n\t/Users/dvyukov/src/go2/src/pkg/net/http/serve_test.go:1046 +0x68\ncreated by net/http_test.testHandlerPanic\n\t/Users/dvyukov/src/go2/src/pkg/net/http/serve_test.go:1052 +0x20c\n\ngoroutine 44 [semacquire]:\nsync.runtime_Semacquire(0xc2000b7de8, 0xc2000b7de8)\n\t/Users/dvyukov/src/go2/src/pkg/runtime/zsema_darwin_amd64.c:165 +0x2e\nsync.(*Cond).Wait(0xc200140030, 0xc200000000)\n\t/Users/dvyukov/src/go2/src/pkg/sync/cond.go:73 +0x95\nio.(*pipe).read(0xc200140000, 0xc200110000, 0x1000, 0x1000, 0x0, ...)\n\t/Users/dvyukov/src/go2/src/pkg/io/pipe.go:52 +0x1f2\nio.(*PipeReader).Read(0xc2000b7ca0, 0xc200110000, 0x1000, 0x1000, 0x1000, ...)\n\t/Users/dvyukov/src/go2/src/pkg/io/pipe.go:130 +0x5d\nnet/http_test.func·063(0xc2000b7ca8, 0xc2000b7cb8, 0xc2000b7098, 0x0, 0x0, ...)\n\t/Users/dvyukov/src/go2/src/pkg/net/http/serve_test.go:1046 +0x68\ncreated by net/http_test.testHandlerPanic\n\t/Users/dvyukov/src/go2/src/pkg/net/http/serve_test.go:1052 +0x20c\n\ngoroutine 50 [semacquire]:\nsync.runtime_Semacquire(0xc2000b7dd0, 0xc2000b7dd0)\n\t/Users/dvyukov/src/go2/src/pkg/runtime/zsema_darwin_amd64.c:165 +0x2e\nsync.(*Cond).Wait(0xc200165f30, 0xc2000a01c0)\n\t/Users/dvyukov/src/go2/src/pkg/sync/cond.go:73 +0x95\nio.(*pipe).read(0xc200165f00, 0xc20011f000, 0x1000, 0x1000, 0x0, ...)\n\t/Users/dvyukov/src/go2/src/pkg/io/pipe.go:52 +0x1f2\nio.(*PipeReader).Read(0xc2000b7388, 0xc20011f000, 0x1000, 0x1000, 0x1000, ...)\n\t/Users/dvyukov/src/go2/src/pkg/io/pipe.go:130 +0x5d\nnet/http_test.func·063(0xc2000b7380, 0xc2000b7370, 0xc2000b73f8, 0x0, 0x0, ...)\n\t/Users/dvyukov/src/go2/src/pkg/net/http/serve_test.go:1046 +0x68\ncreated by net/http_test.testHandlerPanic\n\t/Users/dvyukov/src/go2/src/pkg/net/http/serve_test.go:1052 +0x20c\u003c/pre\u003e",
	"user": {
		"login": "dvyukov",
		"id": 1095328,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"comments": 2,
	"closed_at": "2014-12-08T10:25:41Z",
	"created_at": "2013-02-17T09:30:40Z",
	"updated_at": "2016-06-24T22:33:08Z",
	"milestone": {
		"id": 1067199,
		"number": 11,
		"title": "Go1.1"
	}
}
