{
	"id": 51285647,
	"number": 6733,
	"state": "closed",
	"title": "cmd/go: windows 7;  cgo compile link error",
	"body": "by **anwar.root**:\n\n\u003cpre\u003eD:\\0go\\src\\astyle\u0026gt;dir\n2013/11/07  16:42    \u0026lt;DIR\u0026gt;          .\n2013/11/07  16:42    \u0026lt;DIR\u0026gt;          ..\n2013/11/02  04:31             4,946 ASLocalizer.h\n2013/11/07  16:26             1,236 astyle.go\n2013/11/02  04:31            35,358 astyle.h\n2013/11/07  14:46             7,212 AstyleFormat.cpp\n2013/09/29  09:38               168 AstyleFormat.h\n2013/09/29  09:40               326 AstyleFormatCppExprot.cpp\n2013/09/29  09:40               234 AstyleFormatCppExprot.h\n2013/11/07  14:51            19,046 astyle_main.h\n2013/11/07  16:46           358,844 libastyle.a\n\nD:\\0go\\src\\astyle\u0026gt;go version\ngo version go1.2rc3 windows/amd64\n\nD:\\0go\\src\\astyle\u0026gt;go build    ------\u0026gt; build package is ok \n\nD:\\0go\\src\\use_astyle\u0026gt;go build astyleExample.go    ------\u0026gt;   Generation program\n'astyleExample.go' can not be linked through\n# command-line-arguments\n__cxa_pure_virtual(0): not defined\n_ZTVN10__cxxabiv120__si_class_type_infoE(0): not defined\n_ZTVN10__cxxabiv117__class_type_infoE(0): not defined\n__gxx_personality_seh0(0): not defined\n_ZNSt8ios_base4InitC1Ev(0): not defined\n_ZNSi5seekgESt4fposIiE(0): not defined\n_ZNSi5tellgEv(0): not defined\n_ZNSi3getEv(0): not defined\n_ZNSi4peekEv(0): not defined\n_ZNSs6appendEyc(0): not defined\n_ZNSi3getERc(0): not defined\n_ZNSs9_M_mutateEyyy(0): not defined\n_ZNSt8ios_base4InitD1Ev(0): not defined\n_ZNSo5flushEv(0): not defined\n_ZdaPv(0): not defined\n_ZNSdD2Ev(0): not defined\n_ZNSt19basic_ostringstreamIcSt11char_traitsIcESaIcEED1Ev(0): not defined\n_ZNSt18basic_stringstreamIcSt11char_traitsIcESaIcEED1Ev(0): not defined\n_ZNSt19basic_istringstreamIcSt11char_traitsIcESaIcEED1Ev(0): not defined\n_ZN6astyle9ASOptions15getOptionErrorsEv(0): not defined\n_ZN6astyle11ASFormatterD1Ev(0): not defined\ntoo many errors\n\nD:\\0go\\src\\use_astyle\u0026gt;dir\n2013/11/07  16:56    \u0026lt;DIR\u0026gt;          .\n2013/11/07  16:56    \u0026lt;DIR\u0026gt;          ..\n2013/11/07  16:56         2,281,984 astyleExample.exe    ------\u0026gt;  But the binary file\nhas been generated\n2013/11/07  15:31               113 astyleExample.go\n\nD:\\0go\\src\\use_astyle\u0026gt;astyleExample.exe       \npanic: invalid memory address or nil pointer dereference\nfatal error: panic during malloc\n[signal 0xc0000005 code=0x0 addr=0x50 pc=0x41d27a]\n\nruntime stack:\n\n\nastyle.go\n++++++++++++++++++++++++++++++++++++\npackage astyle\n\n// #cgo windows LDFLAGS: -L. -fpermissive  -static -lws2_32 -lmingwex -lmingw32 -lwinmm\n-mwindows -lpthread -lastyle  -lm -mthreads\n// #cgo windows CFLAGS: -I. -fno-stack-check -fno-stack-protector -mno-stack-arg-probe\n-Wall -Werror\n// #include \u0026lt;stdlib.h\u0026gt;\n// #include \u0026lt;string.h\u0026gt;\n// #include \u0026quot;AstyleFormatCppExprot.h\u0026quot;\nimport \u0026quot;C\u0026quot;\nimport \u0026quot;unsafe\u0026quot;\n\nfunc FormatCode(fileName string) int {\n\tcFileName := C.CString(fileName)\n\tret := C.astyleCodeFormat(cFileName)\n\tC.free(unsafe.Pointer(cFileName))\n\treturn int(ret)\n}\n\nfunc GoFormatCode(file, buf string) int {\n\tcFile := C.CString(file)\n\tcBuf := C.CString(buf)\n\tret := C.goAstyleCodeFormat(cFile, cBuf)\n\tC.free(unsafe.Pointer(cFile))\n\tC.free(unsafe.Pointer(cBuf))\n\treturn int(ret)\n}\n\nfunc GoOutFormatCode(buf string) string {\n\tcBuf := C.CString(buf)\n\tdefer C.free(unsafe.Pointer(cBuf))\n\tret := C.goOutAstyleCodeFormat(cBuf)\n\tgRet:=C.GoString(ret)\n\tdefer C.free(unsafe.Pointer(ret))\n\treturn gRet\n}\n\nastyleExample.go\n+++++++++++++++++++++++++++++++++\npackage main\n\nimport (\n\t\u0026quot;astyle\u0026quot;\n\t\u0026quot;fmt\u0026quot;\n)\n\nfunc main() {\n\ta := astyle.GoOutFormatCode(\u0026quot;printf(\u0026quot;ok\u0026quot;);\u0026quot;)\n\tfmt.Println(a)\n}\u003c/pre\u003e\n\n\n\n\n\nAttachments:\n\n1. \u003ca href=\"https://storage.googleapis.com/go-attachment/6733/0/win_cgo_error.rar\"\u003ewin_cgo_error.rar\u003c/a\u003e (622561 bytes)",
	"user": {
		"login": "gopherbot",
		"id": 8566911,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"comments": 8,
	"closed_at": "2014-12-08T10:37:25Z",
	"created_at": "2013-11-07T09:10:58Z",
	"updated_at": "2016-06-25T01:22:03Z"
}
