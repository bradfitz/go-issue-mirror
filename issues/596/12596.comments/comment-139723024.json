{
	"id": 139723024,
	"body": "Randall, thanks for giving it a try. I checked, and the machine is not swapping (no kswap to be seen, the go process gets \u003e 100% cpu). Even preallocating the slice doesn't help, although it changes things at the beginning of the execution.\r\n\r\nUlimits are not an issue here as allocations beyond limits fail, do not hang which is the behavior I'm seeing.\r\n\r\n**TL:DR; Even preallocation does not help, preallocating 4GB+ hangs the process.**\r\n\r\nI modified the program to print cumulative stats every second. I tried preallocating from 0 to a lot of memory (8GB). The behavior is that when it hits the wall it will stop progressing.  Preallocating space for the slice highlights a deeper issue (see below). Here's the code I'm using:\r\n```\r\npackage main\r\n\r\nimport (\r\n\t\"fmt\"\r\n\t\"time\"\r\n)\r\n\r\nfunc main() {\r\n\t//\tdefer profile.Start(profile.CPUProfile).Stop()\r\n\r\n\tslimslice := make([]uint64, 256, 256)\r\n\tfatslice := make([]uint64, 0,1024*1024*1024/8)\r\n\ti := 0\r\n\tstart := time.Now()\r\n\tgo func() {\r\n\t\tfor {\r\n\t\t\ttime.Sleep(time.Second)\r\n\t\t\tsize := (uint64(len(fatslice)) * 8) / 1024 / 1024\r\n\t\t\tfmt.Println(\"written \", size, \"MB total. Average speed since start: \", float64(size)/time.Since(start).Seconds(), \"MB/s\")\r\n\t\t}\r\n\t}()\t\r\n\tfor {\r\n\t\ti++\r\n\t\tfatslice = append(fatslice, slimslice...)\r\n\t}\r\n}\r\n```\r\n\r\n\r\nOutput with 1GB preallocated:\r\n```\r\n$ ./slowappend \r\nwritten  1024 MB total. Average speed since start:  936.4751236023931 MB/s\r\nwritten  1024 MB total. Average speed since start:  483.77856183038585 MB/s\r\nwritten  1280 MB total. Average speed since start:  410.652703013525 MB/s\r\nwritten  1280 MB total. Average speed since start:  310.8820116860208 MB/s\r\nwritten  1280 MB total. Average speed since start:  250.11781047154787 MB/s\r\nwritten  1280 MB total. Average speed since start:  209.21983321553577 MB/s\r\nwritten  1280 MB total. Average speed since start:  179.81955967230124 MB/s\r\nwritten  1280 MB total. Average speed since start:  157.6632726556781 MB/s\r\nwritten  1280 MB total. Average speed since start:  140.36683865712325 MB/s\r\n```\r\nand so on.\r\n\r\nThis is with 2GB preallocated:\r\n```\r\n$ ./slowappend \r\nwritten  2048 MB total. Average speed since start:  2046.9358676382342 MB/s\r\nwritten  2048 MB total. Average speed since start:  1023.4573572801545 MB/s\r\nwritten  2048 MB total. Average speed since start:  682.2518109450716 MB/s\r\nwritten  2048 MB total. Average speed since start:  511.71980475059 MB/s\r\nwritten  2048 MB total. Average speed since start:  409.3896411100044 MB/s\r\nwritten  2048 MB total. Average speed since start:  341.1667580950821 MB/s\r\nwritten  2048 MB total. Average speed since start:  292.436268329878 MB/s\r\n``` and so on.\r\n\r\nWith 4GB preallocated it completely hangs.\r\n\r\n",
	"user": {
		"login": "m-m-f",
		"id": 9353884,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2015-09-12T05:29:00Z",
	"updated_at": "2015-09-12T05:29:00Z"
}
