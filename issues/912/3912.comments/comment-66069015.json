{
	"id": 66069015,
	"body": "\u003ca id=\"c7\"\u003e\u003c/a\u003eComment 7:\n\n\u003cpre\u003eI started this to get a sense of what it entailed. The work so far is in CL 6549052. I\njust copied and pasted from 6g/6l until the compiler and linker stopped crashing, and\nincredibly it seems to mostly work. In particular math passes and strconv passes, except\nthat strconv and fmt both complain about the malloc counts being wrong, which I can't\nunderstand. I will probably put this aside for a week at least, if anyone wants to\nfinish it, but I do plan to have this ready for Go 1.1 one way or another.\n\nBesides passing the tests, we need to worry a little about about switching between use\nof SSE2 and use of the 387. When you move from one to the other I believe you have to\nassume you just lost all the registers. In general that's not a problem, since there are\nno live registers at entry to a new function, so the 387 assembly functions in package\nmath and the 387 code generated by 8c can continue to coexist with new SSE2-only\nfunctions. The place where it gets a little tricky is that some of the conversions\nbetween integers and floating point in gmove must continue to use the old 387\ninstructions. We need to check that there are no live SSE2 registers allocated, with the\npossibly exception of the destination register, at the times when gmove uses 387\ninstructions. Perhaps that is the reason for the weird behavior, but perhaps not.\n\n# Testing packages.\nok  \tcmd/api\t0.056s\n?   \tcmd/cgo\t[no test files]\nok  \tcmd/fix\t4.231s\nok  \tcmd/go\t0.078s\n?   \tcmd/godoc\t[no test files]\nok  \tcmd/gofmt\t0.144s\n?   \tcmd/vet\t[no test files]\n?   \tcmd/yacc\t[no test files]\nok  \tarchive/tar\t0.032s\nok  \tarchive/zip\t0.173s\nok  \tbufio\t0.139s\nok  \tbytes\t0.378s\nok  \tcompress/bzip2\t0.321s\nok  \tcompress/flate\t3.161s\nok  \tcompress/gzip\t0.039s\nok  \tcompress/lzw\t0.575s\nok  \tcompress/zlib\t7.374s\nok  \tcontainer/heap\t0.031s\nok  \tcontainer/list\t0.029s\nok  \tcontainer/ring\t0.075s\n?   \tcrypto\t[no test files]\nok  \tcrypto/aes\t0.113s\nok  \tcrypto/cipher\t0.034s\nok  \tcrypto/des\t0.178s\nok  \tcrypto/dsa\t0.057s\nok  \tcrypto/ecdsa\t0.254s\nok  \tcrypto/elliptic\t0.090s\nok  \tcrypto/hmac\t0.029s\nok  \tcrypto/md5\t0.035s\nok  \tcrypto/rand\t0.104s\nok  \tcrypto/rc4\t0.028s\nok  \tcrypto/rsa\t0.547s\nok  \tcrypto/sha1\t0.032s\nok  \tcrypto/sha256\t0.032s\nok  \tcrypto/sha512\t0.039s\nok  \tcrypto/subtle\t0.041s\nok  \tcrypto/tls\t0.746s\nok  \tcrypto/x509\t2.472s\n?   \tcrypto/x509/pkix\t[no test files]\nok  \tdatabase/sql\t0.048s\nok  \tdatabase/sql/driver\t0.028s\nok  \tdebug/dwarf\t0.035s\nok  \tdebug/elf\t0.048s\nok  \tdebug/gosym\t0.034s\nok  \tdebug/macho\t0.034s\nok  \tdebug/pe\t0.057s\nok  \tencoding/ascii85\t0.033s\nok  \tencoding/asn1\t0.041s\nok  \tencoding/base32\t0.034s\nok  \tencoding/base64\t0.031s\nok  \tencoding/binary\t0.037s\nok  \tencoding/csv\t0.025s\nok  \tencoding/gob\t0.096s\nok  \tencoding/hex\t0.028s\nok  \tencoding/json\t0.157s\nok  \tencoding/pem\t0.041s\nok  \tencoding/xml\t0.054s\nok  \terrors\t0.028s\nok  \texp/ebnf\t0.031s\nok  \texp/ebnflint\t0.039s\nok  \texp/gotype\t2.813s\nok  \texp/html\t0.298s\nok  \texp/html/atom\t0.028s\nok  \texp/locale/collate\t0.054s\nok  \texp/locale/collate/build\t0.030s\nok  \texp/norm\t6.449s\nok  \texp/types\t2.204s\n?   \texp/types/staging\t[no test files]\nok  \texp/utf8string\t0.030s\nok  \texpvar\t0.065s\nok  \tflag\t0.029s\n--- FAIL: TestCountMallocs (0.00 seconds)\nfmt_test.go:589: \tSprintf(\"%x\"): expected 1 mallocs, got 2\nfmt_test.go:589: \tSprintf(\"%s\"): expected 2 mallocs, got 3\nfmt_test.go:589: \tSprintf(\"%x %x\"): expected 1 mallocs, got 2\nfmt_test.go:589: \tSprintf(\"%g\"): expected 2 mallocs, got 7\nfmt_test.go:589: \tFprintf(buf, \"%x %x %x\"): expected 0 mallocs, got 1\nfmt_test.go:589: \tFprintf(buf, \"%s\"): expected 1 mallocs, got 2\nFAIL\nFAIL\tfmt\t0.139s\nok  \tgo/ast\t0.039s\nok  \tgo/build\t0.324s\nok  \tgo/doc\t0.154s\nok  \tgo/parser\t0.128s\nok  \tgo/printer\t1.045s\nok  \tgo/scanner\t0.036s\nok  \tgo/token\t0.167s\n?   \thash\t[no test files]\nok  \thash/adler32\t0.072s\nok  \thash/crc32\t0.019s\nok  \thash/crc64\t0.038s\nok  \thash/fnv\t0.030s\nok  \thtml\t0.044s\nok  \thtml/template\t0.142s\nok  \timage\t0.410s\nok  \timage/color\t0.063s\nok  \timage/draw\t0.143s\n?   \timage/gif\t[no test files]\nok  \timage/jpeg\t0.390s\nok  \timage/png\t0.180s\nok  \tindex/suffixarray\t0.051s\nok  \tio\t0.046s\nok  \tio/ioutil\t0.034s\nok  \tlog\t0.030s\nok  \tlog/syslog\t0.448s\n# math/rand\npkg/math/rand/rand_test.go:218: internal compiler error: regalloc64\nok  \tmath\t0.038s\nok  \tmath/big\t0.608s\nok  \tmath/cmplx\t0.030s\nFAIL\tmath/rand [build failed]\nok  \tmime\t0.030s\nok  \tmime/multipart\t0.454s\nok  \tnet\t0.960s\nok  \tnet/http\t5.837s\nok  \tnet/http/cgi\t0.700s\nok  \tnet/http/fcgi\t0.062s\nok  \tnet/http/httptest\t0.068s\nok  \tnet/http/httputil\t0.069s\n?   \tnet/http/pprof\t[no test files]\nok  \tnet/mail\t0.024s\nok  \tnet/rpc\t0.126s\nok  \tnet/rpc/jsonrpc\t0.064s\nok  \tnet/smtp\t0.051s\nok  \tnet/textproto\t0.020s\nok  \tnet/url\t0.020s\nok  \told/netchan\t0.060s\nok  \tos\t0.093s\nok  \tos/exec\t1.141s\nok  \tos/signal\t0.028s\nok  \tos/user\t0.030s\n--- FAIL: TestClean (0.00 seconds)\npath_test.go:88: \tClean cleaned paths: 36 allocations per test round, want zero\nFAIL\nFAIL\tpath\t0.033s\n--- FAIL: TestClean (0.00 seconds)\npath_test.go:122: \tClean cleaned paths: 37 allocations per test round, want zero\nFAIL\nFAIL\tpath/filepath\t0.833s\n--- FAIL: TestAllocations (0.00 seconds)\nall_test.go:1982: \t100 mallocs after 100 iterations\nFAIL\nFAIL\treflect\t0.073s\nok  \tregexp\t0.254s\nok  \tregexp/syntax\t3.871s\nok  \truntime\t2.111s\n?   \truntime/cgo\t[no test files]\nok  \truntime/debug\t0.029s\nok  \truntime/pprof\t2.680s\nok  \tsort\t0.225s\n--- FAIL: TestCountMallocs (0.11 seconds)\nstrconv_test.go:58: \tAppendInt(localBuf[:0], 123, 10): expected 1 mallocs, got 2\nstrconv_test.go:58: \tAppendInt(globalBuf[:0], 123, 10): expected 0 mallocs, got 1\nstrconv_test.go:58: \tAppendFloat(localBuf[:0], 1.23, 'g', 5, 64): expected 1 mallocs,\ngot 4\nstrconv_test.go:58: \tAppendFloat(globalBuf[:0], 1.23, 'g', 5, 64): expected 0 mallocs,\ngot 3\nstrconv_test.go:58: \tParseFloat(\"123.456789123456789\", 64): expected 0 mallocs, got 1\nstrconv_test.go:58:\n\tParseFloat(\"1.000000000000000111022302462515654042363166809082031251\", 64): expected 0\nmallocs, got 2\nstrconv_test.go:58:\n\tParseFloat(\"1.0000000000000001110223024625156540423631668090820312500...001\", 64):\nexpected 0 mallocs, got 2\nFAIL\nFAIL\tstrconv\t2.823s\nok  \tstrings\t0.297s\nok  \tsync\t0.088s\nok  \tsync/atomic\t0.054s\nok  \tsyscall\t0.058s\n?   \ttesting\t[no test files]\n?   \ttesting/iotest\t[no test files]\nok  \ttesting/quick\t0.096s\nok  \ttext/scanner\t0.035s\nok  \ttext/tabwriter\t0.033s\nok  \ttext/template\t0.061s\n--- FAIL: TestNumberParse (0.00 seconds)\nparse_test.go:109: \texpected integer for \"0i\"\nparse_test.go:109: \texpected integer for \"-12+0i\"\nparse_test.go:112: \tint64 for \"-12+0i\" should be -12 Is 0\nparse_test.go:109: \texpected integer for \"13+0i\"\nparse_test.go:112: \tint64 for \"13+0i\" should be 13 Is 0\nFAIL\nFAIL\ttext/template/parse\t0.047s\nok  \ttime\t2.331s\nok  \tunicode\t0.031s\nok  \tunicode/utf16\t0.029s\nok  \tunicode/utf8\t0.033s\n?   \tunsafe\t[no test files]\u003c/pre\u003e",
	"user": {
		"login": "rsc",
		"id": 104030,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2012-09-22T23:57:04Z",
	"updated_at": "2014-12-08T10:20:43Z"
}
