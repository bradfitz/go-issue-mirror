{
	"id": 66077489,
	"body": "\u003ca id=\"c13\"\u003e\u003c/a\u003eComment 13:\n\n\u003cpre\u003eIt's a rare-ish occurrence and the map is populated in the first few requests and only\nread subsequently. Admittedly I can't be sure, but that's my intuition. Here's the\nrelevant race (I'm also working on fixing it):\n\nApr 05 17:53:40 daaku.org rell[8799]: WARNING: DATA RACE\nApr 05 17:53:40 daaku.org rell[8799]: Write by goroutine 67:\nApr 05 17:53:40 daaku.org rell[8799]: runtime.mapassign1()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/runtime/hashmap.c:1280 +0x0\nApr 05 17:53:40 daaku.org rell[8799]:\ngithub.com/daaku/go%2estatic.(*Handler).CombinedURL()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go/src/github.com/daaku/go.static/static.go:129 +0x7c1\nApr 05 17:53:40 daaku.org rell[8799]: github.com/daaku/go%2estatic.(*Handler).URL()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go/src/github.com/daaku/go.static/static.go:93 +0xb1\nApr 05 17:53:40 daaku.org rell[8799]:\ngithub.com/daaku/rell/og.(*Object).generateDefaults()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go/src/github.com/daaku/rell/og/og.go:185 +0x166\nApr 05 17:53:40 daaku.org rell[8799]: github.com/daaku/rell/og.NewFromBase64()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go/src/github.com/daaku/rell/og/og.go:125 +0xe90\nApr 05 17:53:40 daaku.org rell[8799]: github.com/daaku/rell/og/viewog.Base64()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go/src/github.com/daaku/rell/og/viewog/og.go:61 +0x303\nApr 05 17:53:40 daaku.org rell[8799]: net/http.HandlerFunc.ServeHTTP()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/net/http/server.go:1149 +0x4b\nApr 05 17:53:40 daaku.org rell[8799]: net/http.(*ServeMux).ServeHTTP()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/net/http/server.go:1416 +0x145\nApr 05 17:53:40 daaku.org rell[8799]:\ngithub.com/daaku/go%2ehttpstats.(*Handler).ServeHTTP()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go/src/github.com/daaku/go.httpstats/httpstats.go:32 +0x162\nApr 05 17:53:40 daaku.org rell[8799]:\ngithub.com/daaku/go.signedrequest/appdata.(*Handler).ServeHTTP()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go/src/github.com/daaku/go.signedrequest/appdata/appdata.go:34 +0x270\nApr 05 17:53:40 daaku.org rell[8799]: github.com/daaku/go%2ehttpgzip.func路001()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go/src/github.com/daaku/go.httpgzip/httpgzip.go:39 +0x2ad\nApr 05 17:53:40 daaku.org rell[8799]: net/http.HandlerFunc.ServeHTTP()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/net/http/server.go:1149 +0x4b\nApr 05 17:53:40 daaku.org rell[8799]: net/http.serverHandler.ServeHTTP()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/net/http/server.go:1517 +0x1c8\nApr 05 17:53:40 daaku.org rell[8799]: net/http.(*conn).serve()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/net/http/server.go:1096 +0xc6f\nApr 05 17:53:40 daaku.org rell[8799]: gosched0()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/runtime/proc.c:1209 +0x9f\nApr 05 17:53:40 daaku.org rell[8799]: Previous write by goroutine 28:\nApr 05 17:53:40 daaku.org rell[8799]: runtime.mapassign1()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/runtime/hashmap.c:1280 +0x0\nApr 05 17:53:40 daaku.org rell[8799]:\ngithub.com/daaku/go%2estatic.(*Handler).CombinedURL()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go/src/github.com/daaku/go.static/static.go:129 +0x7c1\nApr 05 17:53:40 daaku.org rell[8799]: github.com/daaku/go%2estatic.(*Handler).URL()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go/src/github.com/daaku/go.static/static.go:93 +0xb1\nApr 05 17:53:40 daaku.org rell[8799]:\ngithub.com/daaku/rell/og.(*Object).generateDefaults()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go/src/github.com/daaku/rell/og/og.go:185 +0x166\nApr 05 17:53:40 daaku.org rell[8799]: github.com/daaku/rell/og.NewFromBase64()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go/src/github.com/daaku/rell/og/og.go:125 +0xe90\nApr 05 17:53:40 daaku.org rell[8799]: github.com/daaku/rell/og/viewog.Base64()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go/src/github.com/daaku/rell/og/viewog/og.go:61 +0x303\nApr 05 17:53:40 daaku.org rell[8799]: net/http.HandlerFunc.ServeHTTP()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/net/http/server.go:1149 +0x4b\nApr 05 17:53:40 daaku.org rell[8799]: net/http.(*ServeMux).ServeHTTP()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/net/http/server.go:1416 +0x145\nApr 05 17:53:40 daaku.org rell[8799]:\ngithub.com/daaku/go%2ehttpstats.(*Handler).ServeHTTP()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go/src/github.com/daaku/go.httpstats/httpstats.go:32 +0x162\nApr 05 17:53:40 daaku.org rell[8799]:\ngithub.com/daaku/go.signedrequest/appdata.(*Handler).ServeHTTP()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go/src/github.com/daaku/go.signedrequest/appdata/appdata.go:34 +0x270\nApr 05 17:53:40 daaku.org rell[8799]: github.com/daaku/go%2ehttpgzip.func路001()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go/src/github.com/daaku/go.httpgzip/httpgzip.go:39 +0x2ad\nApr 05 17:53:40 daaku.org rell[8799]: net/http.HandlerFunc.ServeHTTP()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/net/http/server.go:1149 +0x4b\nApr 05 17:53:40 daaku.org rell[8799]: net/http.serverHandler.ServeHTTP()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/net/http/server.go:1517 +0x1c8\nApr 05 17:53:40 daaku.org rell[8799]: net/http.(*conn).serve()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/net/http/server.go:1096 +0xc6f\nApr 05 17:53:40 daaku.org rell[8799]: gosched0()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/runtime/proc.c:1209 +0x9f\nApr 05 17:53:40 daaku.org rell[8799]: Goroutine 67 (running) created at:\nApr 05 17:53:40 daaku.org rell[8799]: net/http.(*Server).Serve()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/net/http/server.go:1564 +0x29c\nApr 05 17:53:40 daaku.org rell[8799]: net/http.Serve()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/net/http/server.go:1481 +0x10d\nApr 05 17:53:40 daaku.org rell[8799]: github.com/daaku/go.grace/gracehttp.func路001()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go/src/github.com/daaku/go.grace/gracehttp/http.go:55 +0xe2\nApr 05 17:53:40 daaku.org rell[8799]: gosched0()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/runtime/proc.c:1209 +0x9f\nApr 05 17:53:40 daaku.org rell[8799]: Goroutine 28 (running) created at:\nApr 05 17:53:40 daaku.org rell[8799]: net/http.(*Server).Serve()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/net/http/server.go:1564 +0x29c\nApr 05 17:53:40 daaku.org rell[8799]: net/http.Serve()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/net/http/server.go:1481 +0x10d\nApr 05 17:53:40 daaku.org rell[8799]: github.com/daaku/go.grace/gracehttp.func路001()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go/src/github.com/daaku/go.grace/gracehttp/http.go:55 +0xe2\nApr 05 17:53:40 daaku.org rell[8799]: gosched0()\nApr 05 17:53:40 daaku.org rell[8799]:\n/home/naitik/usr/go-tip/src/pkg/runtime/proc.c:1209 +0x9f\u003c/pre\u003e",
	"user": {
		"login": "daaku",
		"id": 593,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2013-04-05T21:34:16Z",
	"updated_at": "2014-12-08T10:27:59Z"
}
