{
	"id": 73348763,
	"body": "@jeffallen Hmmm... something is strange and I am confused and need help in tracing this, before submitting the patch.\r\n\r\nLet me show what I'm seeing.  Here's a reduced program to demonstrate the issue:\r\n\r\n```\r\npackage main\r\n\r\nimport \"encoding/xml\"\r\n\r\ntype Family struct {\r\n\tMembers []Person `xml:\"members\u003emember\"`\r\n}\r\n\r\ntype Person struct{}\r\n\r\nfunc ToXml() []byte {\r\n\tp := []Person{Person{}, Person{}}\r\n\tfamily := Family{Members: p}\r\n\txml, _ := xml.Marshal(family)\r\n\treturn xml\r\n}\r\n\r\nfunc AsyncExecute() \u003c-chan []byte {\r\n\tch := make(chan []byte)\r\n\tgo func() {\r\n\t\tresponse := ToXml()\r\n\t\tch \u003c- response\r\n\t\tclose(ch)\r\n\t}()\r\n\treturn ch\r\n}\r\n\r\nfunc main() {\r\n\tconst N = 2\r\n\tchlist := make([]\u003c-chan []byte, N)\r\n\tfor i := 0; i \u003c N; i++ {\r\n\t\tchlist[i] = AsyncExecute()\r\n\t}\r\n\tfor _, ch := range chlist {\r\n\t\t\u003c-ch\r\n\t}\r\n}\r\n```\r\n\r\nAs of commit bcadab9, which is the last time that src/runtime/slice.go has been touched according to git history, I can still see the data race:\r\n\r\n```\r\ndannyyoo@melchior:~/work/go/src$ git branch\r\n* (detached from bcadab9)\r\n  data-race\r\n  datarace\r\n  master\r\ndannyyoo@melchior:~/work/go/src$ ../bin/go run -race ~/tmp/xml-data-race.go\r\n==================\r\nWARNING: DATA RACE\r\nWrite by goroutine 6:\r\n  runtime.slicecopy()\r\n      /usr/local/google/home/dannyyoo/work/go/src/runtime/slice.go:98 +0x0\r\n  encoding/xml.(*parentStack).push()\r\n      /usr/local/google/home/dannyyoo/work/go/src/encoding/xml/marshal.go:908 +0x2fb\r\n  encoding/xml.(*printer).marshalStruct()\r\n      /usr/local/google/home/dannyyoo/work/go/src/encoding/xml/marshal.go:826 +0x5b2\r\n  encoding/xml.(*printer).marshalValue()\r\n      /usr/local/google/home/dannyyoo/work/go/src/encoding/xml/marshal.go:531 +0x1499\r\n  encoding/xml.(*Encoder).Encode()\r\n      /usr/local/google/home/dannyyoo/work/go/src/encoding/xml/marshal.go:153 +0xb8\r\n  encoding/xml.Marshal()\r\n      /usr/local/google/home/dannyyoo/work/go/src/encoding/xml/marshal.go:72 +0xfb\r\n  main.ToXml()\r\n      /usr/local/google/home/dannyyoo/tmp/xml-data-race.go:14 +0x108\r\n[output omitted]\r\n```\r\n\r\n\r\nHowever, when I get to master (ac90d9ab473adcb2dc209d168c5b038583bed566), I'm not seeing the reporting of the data race anymore, as you note!  But the data race is still logically there, right?  Unless I'm misunderstanding something.  Did something break in terms of error reporting the data race?\r\n\r\n\r\nUnfortunately, I ran out of time tonight to binary search exactly at what point things erroneously succeed.  I'll try to check it out when I have time during the weekend.",
	"user": {
		"login": "dannyyoo",
		"id": 7536863,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2015-02-07T04:06:32Z",
	"updated_at": "2015-02-07T04:06:32Z"
}
