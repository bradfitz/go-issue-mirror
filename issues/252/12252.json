{
	"id": 102309244,
	"number": 12252,
	"state": "closed",
	"title": "cmd/go: Using `-a` causes rebuild of packages that are part of standard library",
	"body": "Using `go 1.5` on linux x86_64:\r\n\r\n```\r\n$ go version\r\ngo version go1.5 linux/amd64\r\n```\r\n\r\nSpecifying the `-a` option appears to result in rebuilding of packages that are a part of the standard library.  This wasn't the case with 1.4.2.\r\n\r\nAn example follows:\r\n\r\n```\r\nmkdir -p /tmp/go/src/main\r\ncat \u003e /tmp/go/src/main/main.go \u003c\u003cEOF\r\npackage main\r\n\r\nimport \"fmt\"\r\n\r\nfunc main() {\r\n    fmt.Println(\"Hello, World!\")\r\n}\r\nEOF\r\n```\r\n\r\nBuilding it _without_ `-a`:\r\n\r\n```\r\n$ GOPATH=$PWD go install -x -v main\r\nWORK=/tmp/go-build931772473\r\nmain\r\nmkdir -p $WORK/main/_obj/\r\nmkdir -p $WORK/main/_obj/exe/\r\ncd /tmp/go/src/main\r\n/usr/local/go/pkg/tool/linux_amd64/compile -o $WORK/main.a -trimpath $WORK -p main -complete -buildid 1e181453ce618a324c8d5ace4d5e2ce17ce0648c -D _/tmp/go/src/main -I $WORK -pack ./main.go\r\ncd .\r\n/usr/local/go/pkg/tool/linux_amd64/link -o $WORK/main/_obj/exe/a.out -L $WORK -extld=gcc -buildmode=exe -buildid=1e181453ce618a324c8d5ace4d5e2ce17ce0648c $WORK/main.a\r\nmkdir -p /tmp/go/bin/\r\nmv $WORK/main/_obj/exe/a.out /tmp/go/bin/main\r\n```\r\n\r\nAll well!  Now specify the `-a` flag:\r\n\r\n```\r\n$ GOPATH=$PWD go install -a -x -v main\r\nWORK=/tmp/go-build932117395\r\nruntime\r\nmkdir -p $WORK/runtime/_obj/\r\nmkdir -p $WORK/\r\ncd /usr/local/go/src/runtime\r\n/usr/local/go/pkg/tool/linux_amd64/compile -o $WORK/runtime.a -trimpath $WORK -p runtime -+ -buildid 6d5354bd14cc24df376bca66e501e715c0c9847b -D _/usr/local/go/src/runtime -I $WORK -pack -asmhdr $WORK/runtime/_obj/go_asm.h ./alg.go ./arch1_amd64.go ./arch_amd64.go ./atomic_amd64x.go ./atomic_pointer.go ./cgo.go ./cgocall.go ./cgocallback.go ./chan.go ./compiler.go ./complex.go ./cpuprof.go ./cputicks.go ./debug.go ./defs_linux_amd64.go ./env_posix.go ./error.go ./extern.go ./hash64.go ./hashmap.go ./hashmap_fast.go ./heapdump.go ./iface.go ./lfstack.go ./lfstack_amd64.go ./lock_futex.go ./malloc.go ./mbarrier.go ./mbitmap.go ./mcache.go ./mcentral.go ./mem_linux.go ./mfinal.go ./mfixalloc.go ./mgc.go ./mgcmark.go ./mgcsweep.go ./mgcwork.go ./mheap.go ./mprof.go ./msize.go ./mstats.go ./netpoll.go ./netpoll_epoll.go ./os1_linux.go ./os2_linux.go ./os_linux.go ./panic.go ./panic1.go ./parfor.go ./print1.go ./print1_write.go ./proc.go ./proc1.go ./race0.go ./rdebug.go ./rune.go ./runtime.go ./runtime1.go ./runtime2.go ./select.go ./sema.go ./signal1_unix.go ./signal_amd64x.go ./signal_linux.go ./signal_linux_amd64.go ./signal_unix.go ./sigpanic_unix.go ./sigqueue.go ./slice.go ./softfloat64.go ./sqrt.go ./stack1.go ./stack2.go ./string.go ./string1.go ./stubs.go ./stubs2.go ./symtab.go ./sys_x86.go ./time.go ./trace.go ./traceback.go ./type.go ./typekind.go ./typekind1.go ./unaligned1.go ./vdso_linux_amd64.go ./wbfat.go ./zgoarch_amd64.go ./zgoos_linux.go ./zversion.go\r\n/usr/local/go/pkg/tool/linux_amd64/asm -o $WORK/runtime/_obj/asm.o -trimpath $WORK -I $WORK/runtime/_obj/ -I /usr/local/go/pkg/include -D GOOS_linux -D GOARCH_amd64 ./asm.s\r\n/usr/local/go/pkg/tool/linux_amd64/asm -o $WORK/runtime/_obj/asm_amd64.o -trimpath $WORK -I $WORK/runtime/_obj/ -I /usr/local/go/pkg/include -D GOOS_linux -D GOARCH_amd64 ./asm_amd64.s\r\n/usr/local/go/pkg/tool/linux_amd64/asm -o $WORK/runtime/_obj/duff_amd64.o -trimpath $WORK -I $WORK/runtime/_obj/ -I /usr/local/go/pkg/include -D GOOS_linux -D GOARCH_amd64 ./duff_amd64.s\r\n/usr/local/go/pkg/tool/linux_amd64/asm -o $WORK/runtime/_obj/memclr_amd64.o -trimpath $WORK -I $WORK/runtime/_obj/ -I /usr/local/go/pkg/include -D GOOS_linux -D GOARCH_amd64 ./memclr_amd64.s\r\n/usr/local/go/pkg/tool/linux_amd64/asm -o $WORK/runtime/_obj/memmove_amd64.o -trimpath $WORK -I $WORK/runtime/_obj/ -I /usr/local/go/pkg/include -D GOOS_linux -D GOARCH_amd64 ./memmove_amd64.s\r\n/usr/local/go/pkg/tool/linux_amd64/asm -o $WORK/runtime/_obj/rt0_linux_amd64.o -trimpath $WORK -I $WORK/runtime/_obj/ -I /usr/local/go/pkg/include -D GOOS_linux -D GOARCH_amd64 ./rt0_linux_amd64.s\r\n/usr/local/go/pkg/tool/linux_amd64/asm -o $WORK/runtime/_obj/sys_linux_amd64.o -trimpath $WORK -I $WORK/runtime/_obj/ -I /usr/local/go/pkg/include -D GOOS_linux -D GOARCH_amd64 ./sys_linux_amd64.s\r\npack r $WORK/runtime.a $WORK/runtime/_obj/asm.o $WORK/runtime/_obj/asm_amd64.o $WORK/runtime/_obj/duff_amd64.o $WORK/runtime/_obj/memclr_amd64.o $WORK/runtime/_obj/memmove_amd64.o $WORK/runtime/_obj/rt0_linux_amd64.o $WORK/runtime/_obj/sys_linux_amd64.o # internal\r\nmkdir -p /usr/local/go/pkg/linux_amd64/\r\ncp $WORK/runtime.a /usr/local/go/pkg/linux_amd64/runtime.a\r\ngo install runtime: open /usr/local/go/pkg/linux_amd64/runtime.a: permission denied\r\n```\r\n\r\nWhat causes packages such as `runtime` to be rebuilt?  The [docs](http://golang.org/cmd/go/) don't indicate that this should be expected now.\r\n\r\nFWIW, the same using `go 1.4.2` works:\r\n\r\n```\r\n$ GOPATH=$PWD go install -a -x -v main\r\nWORK=/tmp/go-build171887605\r\nmain\r\nmkdir -p $WORK/main/_obj/\r\nmkdir -p $WORK/main/_obj/exe/\r\ncd /tmp/go/src/main\r\n/usr/local/go/pkg/tool/linux_amd64/6g -o $WORK/main.a -trimpath $WORK -p main -complete -D _/tmp/go/src/main -I $WORK -pack ./main.go\r\ncd .\r\n/usr/local/go/pkg/tool/linux_amd64/6l -o $WORK/main/_obj/exe/a.out -L $WORK -extld=gcc $WORK/main.a\r\nmkdir -p /tmp/go/bin/\r\nmv $WORK/main/_obj/exe/a.out /tmp/go/bin/main\r\n```\r\n",
	"user": {
		"login": "0xmohit",
		"id": 8176079,
		"type": "User",
		"site_admin": false
	},
	"comments": 1,
	"closed_at": "2015-08-21T06:29:51Z",
	"created_at": "2015-08-21T06:27:58Z",
	"updated_at": "2015-08-21T06:29:51Z"
}
