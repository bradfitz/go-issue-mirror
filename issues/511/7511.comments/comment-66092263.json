{
	"id": 66092263,
	"body": "\u003ca id=\"c4\"\u003e\u003c/a\u003eComment 4:\n\n\u003cpre\u003eThis program:\n    \n    package main\n    \n    import (\n    \t\"fmt\"\n    \t\"runtime\"\n    )\n    \n    func main() {\n    \truntime.GOMAXPROCS(1)\n    \tmemstats := new(runtime.MemStats)\n    \truntime.GC()\n    \truntime.ReadMemStats(memstats)\n    \tsys := memstats.Sys\n    \n    \truntime.MemProfileRate = 0 // disable profiler\n    \n    \titercount := 1000000\n    \n    \titercount = 100000\n    \n    \tfor i := 0; i \u0026lt; itercount; i++ {\n    \t\tworkthegc()\n    \t}\n    \n    \t// Should only be using a few MB.\n    \t// We allocated 100 MB or (if not short) 1 GB.\n    \truntime.ReadMemStats(memstats)\n    \tif sys \u0026gt; memstats.Sys {\n    \t\tsys = 0\n    \t} else {\n    \t\tsys = memstats.Sys - sys\n    \t}\n    \tif sys \u0026gt; 16\u0026lt;\u0026lt;20 {\n    \t\tfmt.Printf(\"using too much memory: %d bytes\\n\", sys)\n    \t\treturn\n    \t}\n    \tfmt.Printf(\"OK\\n\")\n    }\n    \n    func workthegc() []byte {\n    \treturn make([]byte, 1029)\n    }\n\nHas this crashdump:\n\n    --- FAIL: TestGcSys-2 (257.96 seconds)\n    \tgc_test.go:22: expected \"OK\\n\", but got \"SIGABRT: used by abort, replace SIGIOT in the future\\nPC=0xfffffd7fff2d37a7\\nsignal arrived during cgo execution\\n\\ngoroutine 22 [runnable]:\\ncreated by main.(*builder).do\\n\\t/home/aram/go/src/cmd/go/build.go:745 +0x416\\n\\ngoroutine 16 [semacquire, 4 minutes]:\\nsync.runtime_Semacquire(0xc2080fdcd0)\\n\\t/home/aram/go/src/pkg/runtime/sema.goc:199 +0x30\\nsync.(*WaitGroup).Wait(0xc2080f4e20)\\n\\t/home/aram/go/src/pkg/sync/waitgroup.go:127 +0x15d\\nmain.(*builder).do(0xc208102000, 0xc208001ba0)\\n\\t/home/aram/go/src/cmd/go/build.go:748 +0x440\\nmain.runRun(0xb098c0, 0xc20800c020, 0x1, 0x1)\\n\\t/home/aram/go/src/cmd/go/run.go:115 +0x84f\\nmain.main()\\n\\t/home/aram/go/src/cmd/go/main.go:161 +0x4fa\\n\\ngoroutine 19 [syscall, 4 minutes]:\\nos/signal.loop()\\n\\t/home/aram/go/src/pkg/os/signal/signal_unix.go:21 +0x1e\\ncreated by os/signal.init·1\\n\\t/home/aram/go/src/pkg/os/signal/signal_unix.go:27 +0x32\\n\\ngoroutine 21 [select, 4 minutes]:\\nmain.func·006()\\n\\t/home/aram/go/src/cmd/go/build.go:729 +0x1a7\\ncreated by main.(*builder).do\\n\\t/home/aram/go/src/cmd/go/build.go:745 +0x416\\n\\ngoroutine 32 [running]:\\n\\tgoroutine running on other thread; stack unavailable\\n\\nrax     0x5b\\nrbx     0xfffffd7fff192a40\\nrcx     0xfffffd7ffee0d000\\nrdx     0x0\\nrdi     0x0\\nrsi     0x0\\nrbp     0xfffffd7fffdfef50\\nrsp     0xfffffd7fffdfeee8\\nr8      0xfffffd7ffef9c140\\nr9      0x2e\\nr10     0xfffffd7ffee0d000\\nr11     0x286\\nr12     0xb32280\\nr13     0xfffffd7fff34ca00\\nr14     0x0\\nr15     0x0\\nrip     0xfffffd7fff2d37a7\\nrflags  0x247\\ncs      0x53\\nfs      0x0\\ngs      0x0\\ngo build command-line-arguments: exit status 2\\n\"\n\nSorry for the mangling, I guess I can use DTrace to extract it directly\nfrom the write to the fd.\n\nThis other program:\n    \n    package main\n    \n    import (\n    \t\"runtime\"\n    \t\"runtime/debug\"\n    )\n    \n    func main() {\n    \tdebug.SetMaxThreads(10)\n    \tc := make(chan int)\n    \tfor i := 0; i \u0026lt; 100; i++ {\n    \t\tgo func() {\n    \t\t\truntime.LockOSThread()\n    \t\t\tc \u0026lt;- 0\n    \t\t\tselect{}\n    \t\t}()\n    \t\t\u0026lt;-c\n    \t}\n    }\n\nhas this crashdump:\n\n    --- FAIL: TestThreadExhaustion-4 (74.58 seconds)\n    \tcrash_test.go:131: output does not start with \"runtime: program exceeds 10-thread limit\\nfatal error: thread exhaustion\":\n    \t\tSIGABRT: used by abort, replace SIGIOT in the future\n    \t\tPC=0xfffffd7fff2d37a7\n    \t\tsignal arrived during cgo execution\n    \t\t\n    \t\tgoroutine 22 [runnable]:\n    \t\tcreated by main.(*builder).do\n    \t\t\t/home/aram/go/src/cmd/go/build.go:745 +0x416\n    \t\t\n    \t\tgoroutine 16 [semacquire, 1 minutes]:\n    \t\tsync.runtime_Semacquire(0xc20804fbc8)\n    \t\t\t/home/aram/go/src/pkg/runtime/sema.goc:199 +0x30\n    \t\tsync.(*WaitGroup).Wait(0xc208170a20)\n    \t\t\t/home/aram/go/src/pkg/sync/waitgroup.go:127 +0x15d\n    \t\tmain.(*builder).do(0xc208110d20, 0xc2080e9c70)\n    \t\t\t/home/aram/go/src/cmd/go/build.go:748 +0x440\n    \t\tmain.runRun(0xb098c0, 0xc20800c020, 0x1, 0x1)\n    \t\t\t/home/aram/go/src/cmd/go/run.go:115 +0x84f\n    \t\tmain.main()\n    \t\t\t/home/aram/go/src/cmd/go/main.go:161 +0x4fa\n    \t\t\n    \t\tgoroutine 19 [syscall, 1 minutes]:\n    \t\tos/signal.loop()\n    \t\t\t/home/aram/go/src/pkg/os/signal/signal_unix.go:21 +0x1e\n    \t\tcreated by os/signal.init·1\n    \t\t\t/home/aram/go/src/pkg/os/signal/signal_unix.go:27 +0x32\n    \t\t\n    \t\tgoroutine 21 [select, 1 minutes]:\n    \t\tmain.func·006()\n    \t\t\t/home/aram/go/src/cmd/go/build.go:729 +0x1a7\n    \t\tcreated by main.(*builder).do\n    \t\t\t/home/aram/go/src/cmd/go/build.go:745 +0x416\n    \t\t\n    \t\tgoroutine 32 [chan receive, 1 minutes]:\n    \t\tmain.func·028()\n    \t\t\t/home/aram/go/src/cmd/go/signal.go:21 +0x3b\n    \t\tcreated by main.processSignals\n    \t\t\t/home/aram/go/src/cmd/go/signal.go:23 +0xc3\n    \t\t\n    \t\tgoroutine 33 [running]:\n    \t\t\tgoroutine running on other thread; stack unavailable\n    \t\t\n    \t\trax     0x5b\n    \t\trbx     0xfffffd7ffef52240\n    \t\trcx     0xfffffd7ffee02000\n    \t\trdx     0x0\n    \t\trdi     0x0\n    \t\trsi     0x0\n    \t\trbp     0xfffffd7ffddffe70\n    \t\trsp     0xfffffd7ffddffe08\n    \t\tr8      0xfffffd7ffefa6140\n    \t\tr9      0x68\n    \t\tr10     0xfffffd7ffee02000\n    \t\tr11     0x286\n    \t\tr12     0xb32380\n    \t\tr13     0xfffffd7fff34ca00\n    \t\tr14     0x0\n    \t\tr15     0x0\n    \t\trip     0xfffffd7fff2d37a7\n    \t\trflags  0x247\n    \t\tcs      0x53\n    \t\tfs      0x0\n    \t\tgs      0x0\n    \t\texit status 2\u003c/pre\u003e",
	"user": {
		"login": "4ad",
		"id": 1331747,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2014-03-12T09:12:28Z",
	"updated_at": "2014-12-22T06:33:12Z"
}
