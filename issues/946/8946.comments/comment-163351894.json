{
	"id": 163351894,
	"body": "This appears to be fixed.\r\n\r\nWith a client of:\r\n```go\r\nfunc main() {\r\n        cli := http.Client{}\r\n\r\n        for {\r\n                url := \"http://localhost:8080/foo\"\r\n                resp, rerr := cli.Get(url)\r\n                fmt.Printf(\"Get = %#v, %v\\n\", resp, rerr)\r\n                if rerr != nil {\r\n                        continue\r\n                }\r\n\r\n                body, berr := ioutil.ReadAll(resp.Body)\r\n                fmt.Printf(\"ReadAll = %q, %v\\n\", body, berr)\r\n                resp.Body.Close()\r\n        }\r\n}\r\n```\r\n\r\nI get the same thing each time:\r\n```\r\nGet = \u0026http.Response{Status:\"200 OK\", StatusCode:200, Proto:\"HTTP/1.1\", ProtoMajor:1, ProtoMinor:1, Header:http.Header{\"Date\":[]string{\"Wed, 09 Dec 2015 18:34:18 GMT\"}, \"Content-Type\":[]string{\"text/plain; charset=utf-8\"}}, Body:(*http.bodyEOFSignal)(0xc8200e0040), ContentLength:-1, TransferEncoding:[]string{\"chunked\"}, Close:false, Trailer:http.Header(nil), Request:(*http.Request)(0xc8200c2000), TLS:(*tls.ConnectionState)(nil)}, \u003cnil\u003e\r\nReadAll = \"\", \u003cnil\u003e\r\nGet = \u0026http.Response{Status:\"200 OK\", StatusCode:200, Proto:\"HTTP/1.1\", ProtoMajor:1, ProtoMinor:1, Header:http.Header{\"Date\":[]string{\"Wed, 09 Dec 2015 18:34:19 GMT\"}, \"Content-Type\":[]string{\"text/plain; charset=utf-8\"}}, Body:(*http.bodyEOFSignal)(0xc8200e02c0), ContentLength:-1, TransferEncoding:[]string{\"chunked\"}, Close:false, Trailer:http.Header(nil), Request:(*http.Request)(0xc8200fa000), TLS:(*tls.ConnectionState)(nil)}, \u003cnil\u003e\r\nReadAll = \"\", \u003cnil\u003e\r\nGet = \u0026http.Response{Status:\"200 OK\", StatusCode:200, Proto:\"HTTP/1.1\", ProtoMajor:1, ProtoMinor:1, Header:http.Header{\"Content-Type\":[]string{\"text/plain; charset=utf-8\"}, \"Date\":[]string{\"Wed, 09 Dec 2015 18:34:20 GMT\"}}, Body:(*http.bodyEOFSignal)(0xc8200e0400), ContentLength:-1, TransferEncoding:[]string{\"chunked\"}, Close:false, Trailer:http.Header(nil), Request:(*http.Request)(0xc8200c20e0), TLS:(*tls.ConnectionState)(nil)}, \u003cnil\u003e\r\nReadAll = \"\", \u003cnil\u003e\r\nGet = \u0026http.Response{Status:\"200 OK\", StatusCode:200, Proto:\"HTTP/1.1\", ProtoMajor:1, ProtoMinor:1, Header:http.Header{\"Content-Type\":[]string{\"text/plain; charset=utf-8\"}, \"Date\":[]string{\"Wed, 09 Dec 2015 18:34:21 GMT\"}}, Body:(*http.bodyEOFSignal)(0xc820016800), ContentLength:-1, TransferEncoding:[]string{\"chunked\"}, Close:false, Trailer:http.Header(nil), Request:(*http.Request)(0xc8200fa0e0), TLS:(*tls.ConnectionState)(nil)}, \u003cnil\u003e\r\nReadAll = \"\", \u003cnil\u003e\r\nGet = \u0026http.Response{Status:\"200 OK\", StatusCode:200, Proto:\"HTTP/1.1\", ProtoMajor:1, ProtoMinor:1, Header:http.Header{\"Date\":[]string{\"Wed, 09 Dec 2015 18:34:22 GMT\"}, \"Content-Type\":[]string{\"text/plain; charset=utf-8\"}}, Body:(*http.bodyEOFSignal)(0xc8200e0640), ContentLength:-1, TransferEncoding:[]string{\"chunked\"}, Close:false, Trailer:http.Header(nil), Request:(*http.Request)(0xc8200fa1c0), TLS:(*tls.ConnectionState)(nil)}, \u003cnil\u003e\r\nReadAll = \"\", \u003cnil\u003e\r\nGet = \u0026http.Response{Status:\"200 OK\", StatusCode:200, Proto:\"HTTP/1.1\", ProtoMajor:1, ProtoMinor:1, Header:http.Header{\"Date\":[]string{\"Wed, 09 Dec 2015 18:34:23 GMT\"}, \"Content-Type\":[]string{\"text/plain; charset=utf-8\"}}, Body:(*http.bodyEOFSignal)(0xc8200e0740), ContentLength:-1, TransferEncoding:[]string{\"chunked\"}, Close:false, Trailer:http.Header(nil), Request:(*http.Request)(0xc8200fa2a0), TLS:(*tls.ConnectionState)(nil)}, \u003cnil\u003e\r\nReadAll = \"\", \u003cnil\u003e\r\nGet = \u0026http.Response{Status:\"200 OK\", StatusCode:200, Proto:\"HTTP/1.1\", ProtoMajor:1, ProtoMinor:1, Header:http.Header{\"Date\":[]string{\"Wed, 09 Dec 2015 18:34:24 GMT\"}, \"Content-Type\":[]string{\"text/plain; charset=utf-8\"}}, Body:(*http.bodyEOFSignal)(0xc820016b00), ContentLength:-1, TransferEncoding:[]string{\"chunked\"}, Close:false, Trailer:http.Header(nil), Request:(*http.Request)(0xc8200c21c0), TLS:(*tls.ConnectionState)(nil)}, \u003cnil\u003e\r\nReadAll = \"\", \u003cnil\u003e\r\n```\r\n\r\nAt first I was expecting the ioutil.ReadAll to return an UnexpectedEOF from the chunked reader, but looking at strace, it does appear the server manages to send out the EOF chunk before the connection is closed:\r\n```\r\n[pid  5598] write(3, \"GET /foo HTTP/1.1\\r\\nHost: localhost:8080\\r\\nUser-Agent: Go-http-client/1.1\\r\\nAccept-Encoding: gzip\\r\\n\\r\\n\", 98 \u003cunfinished ...\u003e\r\n[pid  5594] \u003c... select resumed\u003e )      = 0 (Timeout)\r\n[pid  5598] \u003c... write resumed\u003e )       = 98\r\n[pid  5597] \u003c... epoll_wait resumed\u003e {{EPOLLIN|EPOLLOUT, {u32=453330488, u64=140321329858104}}}, 128, 4294967295) = 1\r\n[pid  5595] \u003c... select resumed\u003e )      = 0 (Timeout)\r\n[pid  5597] clock_gettime(CLOCK_MONOTONIC, {4241936, 78474169}) = 0\r\n[pid  5594] futex(0x915c28, FUTEX_WAIT, 0, NULL \u003cunfinished ...\u003e\r\n[pid  5598] futex(0x915c28, FUTEX_WAKE, 1 \u003cunfinished ...\u003e\r\n[pid  5594] \u003c... futex resumed\u003e )       = -1 EAGAIN (Resource temporarily unavailable)\r\n[pid  5598] \u003c... futex resumed\u003e )       = 0\r\n[pid  5594] select(0, NULL, NULL, NULL, {0, 100} \u003cunfinished ...\u003e\r\n[pid  5595] clock_gettime(CLOCK_MONOTONIC,  \u003cunfinished ...\u003e\r\n[pid  5598] futex(0xc8200a8908, FUTEX_WAIT, 0, NULL \u003cunfinished ...\u003e\r\n[pid  5595] \u003c... clock_gettime resumed\u003e {4241936, 78537336}) = 0\r\n[pid  5595] clock_gettime(CLOCK_REALTIME,  \u003cunfinished ...\u003e\r\n[pid  5597] read(3, \"HTTP/1.1 200 OK\\r\\nDate: Wed, 09 Dec 2015 18:30:35 GMT\\r\\nContent-Type: text/plain; charset=utf-8\\r\\nTransfer-Encoding: chunked\\r\\n\\r\\n\", 4096) = 125\r\n[pid  5595] \u003c... clock_gettime resumed\u003e {1449685835, 408091488}) = 0\r\n[pid  5594] \u003c... select resumed\u003e )      = 0 (Timeout)\r\n[pid  5595] select(0, NULL, NULL, NULL, {0, 20} \u003cunfinished ...\u003e\r\n[pid  5594] epoll_wait(4,  \u003cunfinished ...\u003e\r\n[pid  5597] clock_gettime(CLOCK_REALTIME, {1449685835, 408276297}) = 0\r\n[pid  5597] write(2, \"2015/12/09 18:30:35 Get = \u0026http.Response{Status:\\\"200 OK\\\", StatusCode:200, Proto:\\\"HTTP/1.1\\\", ProtoMajor:1, ProtoMinor:1, Header:http.Header{\\\"Date\\\":[]string{\\\"Wed, 09 Dec 2015 18:30:35 GMT\\\"}, \\\"Content\r\n-Type\\\":[]string{\\\"text/plain; charset=utf-8\\\"}}, Body:(*http.bodyEOFSignal)(0xc8200184c0), ContentLength:-1, TransferEncoding:[]string{\\\"chunked\\\"}, Close:false, Trailer:http.Header(nil), Request:(*http.Requ\"..., 460 \u003cunfinishe\r\nd ...\u003e\r\n[pid  5595] \u003c... select resumed\u003e )      = 0 (Timeout)\r\n[pid  5595] clock_gettime(CLOCK_MONOTONIC, {4241936, 78841051}) = 0\r\n[pid  5595] clock_gettime(CLOCK_REALTIME, {1449685835, 408362768}) = 0\r\n[pid  5595] select(0, NULL, NULL, NULL, {0, 20}2015/12/09 18:30:35 Get = \u0026http.Response{Status:\"200 OK\", StatusCode:200, Proto:\"HTTP/1.1\", ProtoMajor:1, ProtoMinor:1, Header:http.Header{\"Date\":[]string{\"Wed, 09 Dec 2015 18:30:35 GMT\"}, \"Content-Type\":[]string{\"text/plain; charset=utf-8\"}}, Body:(*http.bodyEOFSignal)(0xc8200184c0), ContentLength:-1, TransferEncoding:[]string{\"chunked\"}, Close:false, Trailer:http.Header(nil), Request:(*http.Request)(0xc8200d6380), TLS:(*tls.ConnectionState)(nil)}, \u003cnil\u003e\r\n \u003cunfinished ...\u003e\r\n[pid  5597] \u003c... write resumed\u003e )       = 460\r\n[pid  5597] read(3, 0xc820116000, 4096) = -1 EAGAIN (Resource temporarily unavailable)\r\n[pid  5597] futex(0xc820028d08, FUTEX_WAIT, 0, NULL \u003cunfinished ...\u003e\r\n[pid  5595] \u003c... select resumed\u003e )      = 0 (Timeout)\r\n[pid  5595] clock_gettime(CLOCK_MONOTONIC, {4241936, 78964304}) = 0\r\n[pid  5595] futex(0x915460, FUTEX_WAIT, 0, {60, 0} \u003cunfinished ...\u003e\r\n[pid  5594] \u003c... epoll_wait resumed\u003e {{EPOLLIN|EPOLLOUT, {u32=453330488, u64=140321329858104}}}, 128, 4294967295) = 1\r\n[pid  5594] clock_gettime(CLOCK_MONOTONIC, {4241937, 77657115}) = 0\r\n[pid  5594] futex(0xc820028d08, FUTEX_WAKE, 1) = 1\r\n[pid  5594] futex(0x915460, FUTEX_WAKE, 1) = 1\r\n[pid  5595] \u003c... futex resumed\u003e )       = 0\r\n[pid  5594] read(3,  \u003cunfinished ...\u003e\r\n[pid  5595] clock_gettime(CLOCK_MONOTONIC,  \u003cunfinished ...\u003e\r\n[pid  5594] \u003c... read resumed\u003e \"0\\r\\n\\r\\n\", 4096) = 5\r\n[pid  5597] \u003c... futex resumed\u003e )       = 0\r\n[pid  5594] read(3,  \u003cunfinished ...\u003e\r\n[pid  5597] epoll_wait(4,  \u003cunfinished ...\u003e\r\n[pid  5594] \u003c... read resumed\u003e \"\", 4096) = 0\r\n[pid  5597] \u003c... epoll_wait resumed\u003e {{EPOLLIN|EPOLLOUT|0x2000, {u32=453330488, u64=140321329858104}}}, 128, 0) = 1\r\n[pid  5594] epoll_ctl(4, EPOLL_CTL_DEL, 3, {0, {u32=0, u64=0}} \u003cunfinished ...\u003e\r\n[pid  5595] \u003c... clock_gettime resumed\u003e {4241937, 77996995}) = 0\r\n[pid  5594] \u003c... epoll_ctl resumed\u003e )   = 0\r\n[pid  5594] close(3)                    = 0\r\n[pid  5595] clock_gettime(CLOCK_REALTIME,  \u003cunfinished ...\u003e\r\n[pid  5594] write(1, \"ReadAll = \\\"\\\", \u003cnil\u003e\\n\", 20ReadAll = \"\", \u003cnil\u003e\r\n) = 20\r\n[pid  5597] epoll_wait(4,  \u003cunfinished ...\u003e\r\n```\r\n\r\nAnd if I add to the Server's Handler:\r\n\r\n```go\r\n                println(\"Hello\", r.RemoteAddr)\r\n                defer println(\"Bye\", r.RemoteAddr)\r\n```\r\n\r\nI see a new connection for each one:\r\n\r\n```\r\nHello 127.0.0.1:45172\r\nBye 127.0.0.1:45172\r\nHello 127.0.0.1:45173\r\nBye 127.0.0.1:45173\r\nHello 127.0.0.1:45174\r\nBye 127.0.0.1:45174\r\nHello 127.0.0.1:45175\r\nBye 127.0.0.1:45175\r\nHello 127.0.0.1:45176\r\nBye 127.0.0.1:45176\r\nHello 127.0.0.1:45177\r\nBye 127.0.0.1:45177\r\nHello 127.0.0.1:45178\r\n```",
	"user": {
		"login": "bradfitz",
		"id": 2621,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2015-12-09T18:36:47Z",
	"updated_at": "2015-12-09T18:36:47Z"
}
