{
	"id": 51284954,
	"number": 6283,
	"state": "open",
	"title": "cmd/link: error in linker when building go-opencv on OSX",
	"body": "by **ngaloppo**:\n\n\u003cpre\u003eWhat steps will reproduce the problem?\n\nBuild go-opencv as such: \ngo build -a -x code.google.com/p/go-opencv/trunk/opencv\n\nWhat is the expected output?\nSuccessful build of the opencv package\n\nWhat do you see instead?\nAssertion failure in the linker: \nld: Assertion failed: (_machoSection != 0), function machoSection, file\n/SourceCache/ld64/ld64-136/src/ld/ld.hpp, line 641.\n\nThis is when running: \ngcc -I . -g -O2 -fPIC -m64 -pthread -fno-common -o\n$WORK/code.google.com/p/go-opencv/trunk/opencv/_obj/_all.o\n$WORK/code.google.com/p/go-opencv/trunk/opencv/_obj/_cgo_export.o\n$WORK/code.google.com/p/go-opencv/trunk/opencv/_obj/cv.cgo2.o\n$WORK/code.google.com/p/go-opencv/trunk/opencv/_obj/cvaux.cgo2.o\n$WORK/code.google.com/p/go-opencv/trunk/opencv/_obj/cxcore.cgo2.o\n$WORK/code.google.com/p/go-opencv/trunk/opencv/_obj/cxtype.cgo2.o\n$WORK/code.google.com/p/go-opencv/trunk/opencv/_obj/highgui.cgo2.o\n$WORK/code.google.com/p/go-opencv/trunk/opencv/_obj/opencv.o\n/usr/local/Cellar/opencv/2.4.5/lib/libopencv_calib3d.dylib\n/usr/local/Cellar/opencv/2.4.5/lib/libopencv_contrib.dylib\n/usr/local/Cellar/opencv/2.4.5/lib/libopencv_core.dylib\n/usr/local/Cellar/opencv/2.4.5/lib/libopencv_features2d.dylib\n/usr/local/Cellar/opencv/2.4.5/lib/libopencv_flann.dylib\n/usr/local/Cellar/opencv/2.4.5/lib/libopencv_gpu.dylib\n/usr/local/Cellar/opencv/2.4.5/lib/libopencv_highgui.dylib\n/usr/local/Cellar/opencv/2.4.5/lib/libopencv_imgproc.dylib\n/usr/local/Cellar/opencv/2.4.5/lib/libopencv_legacy.dylib\n/usr/local/Cellar/opencv/2.4.5/lib/libopencv_ml.dylib\n/usr/local/Cellar/opencv/2.4.5/lib/libopencv_nonfree.dylib\n/usr/local/Cellar/opencv/2.4.5/lib/libopencv_objdetect.dylib\n/usr/local/Cellar/opencv/2.4.5/lib/libopencv_ocl.dylib\n/usr/local/Cellar/opencv/2.4.5/lib/libopencv_photo.dylib\n/usr/local/Cellar/opencv/2.4.5/lib/libopencv_stitching.dylib\n/usr/local/Cellar/opencv/2.4.5/lib/libopencv_superres.dylib\n/usr/local/Cellar/opencv/2.4.5/lib/libopencv_ts.dylib\n/usr/local/Cellar/opencv/2.4.5/lib/libopencv_video.dylib\n/usr/local/Cellar/opencv/2.4.5/lib/libopencv_videostab.dylib -Wl,-r -nostdlib\n/usr/llvm-gcc-4.2/bin/../lib/gcc/i686-apple-darwin11/4.2.1/x86_64/libgcc.a\n\nThese warnings from ld are interesting: \n\nld: warning: unexpected dylib\n(/usr/local/Cellar/opencv/2.4.5/lib/libopencv_calib3d.dylib) on link line\nld: warning: unexpected dylib\n(/usr/local/Cellar/opencv/2.4.5/lib/libopencv_contrib.dylib) on link line\nld: warning: unexpected dylib (/usr/local/Cellar/opencv/2.4.5/lib/libopencv_core.dylib)\non link line\nld: warning: unexpected dylib\n(/usr/local/Cellar/opencv/2.4.5/lib/libopencv_features2d.dylib) on link line\nld: warning: unexpected dylib (/usr/local/Cellar/opencv/2.4.5/lib/libopencv_flann.dylib)\non link line\nld: warning: unexpected dylib (/usr/local/Cellar/opencv/2.4.5/lib/libopencv_gpu.dylib)\non link line\nld: warning: unexpected dylib\n(/usr/local/Cellar/opencv/2.4.5/lib/libopencv_highgui.dylib) on link line\nld: warning: unexpected dylib\n(/usr/local/Cellar/opencv/2.4.5/lib/libopencv_imgproc.dylib) on link line\nld: warning: unexpected dylib\n(/usr/local/Cellar/opencv/2.4.5/lib/libopencv_legacy.dylib) on link line\nld: warning: unexpected dylib (/usr/local/Cellar/opencv/2.4.5/lib/libopencv_ml.dylib) on\nlink line\nld: warning: unexpected dylib\n(/usr/local/Cellar/opencv/2.4.5/lib/libopencv_nonfree.dylib) on link line\nld: warning: unexpected dylib\n(/usr/local/Cellar/opencv/2.4.5/lib/libopencv_objdetect.dylib) on link line\nld: warning: unexpected dylib (/usr/local/Cellar/opencv/2.4.5/lib/libopencv_ocl.dylib)\non link line\nld: warning: unexpected dylib (/usr/local/Cellar/opencv/2.4.5/lib/libopencv_photo.dylib)\non link line\nld: warning: unexpected dylib\n(/usr/local/Cellar/opencv/2.4.5/lib/libopencv_stitching.dylib) on link line\nld: warning: unexpected dylib\n(/usr/local/Cellar/opencv/2.4.5/lib/libopencv_superres.dylib) on link line\nld: warning: unexpected dylib (/usr/local/Cellar/opencv/2.4.5/lib/libopencv_ts.dylib) on\nlink line\nld: warning: unexpected dylib (/usr/local/Cellar/opencv/2.4.5/lib/libopencv_video.dylib)\non link line\nld: warning: unexpected dylib\n(/usr/local/Cellar/opencv/2.4.5/lib/libopencv_videostab.dylib) on link line\n\nI found that removing the $LDFLAGS as below successfully results in building:\n\ngcc -I . -g -O2 -fPIC -m64 -pthread -fno-common -o\n$WORK/code.google.com/p/go-opencv/trunk/opencv/_obj/_all.o\n$WORK/code.google.com/p/go-opencv/trunk/opencv/_obj/_cgo_export.o\n$WORK/code.google.com/p/go-opencv/trunk/opencv/_obj/cv.cgo2.o\n$WORK/code.google.com/p/go-opencv/trunk/opencv/_obj/cvaux.cgo2.o\n$WORK/code.google.com/p/go-opencv/trunk/opencv/_obj/cxcore.cgo2.o\n$WORK/code.google.com/p/go-opencv/trunk/opencv/_obj/cxtype.cgo2.o\n$WORK/code.google.com/p/go-opencv/trunk/opencv/_obj/highgui.cgo2.o\n$WORK/code.google.com/p/go-opencv/trunk/opencv/_obj/opencv.o  -Wl,-r -nostdlib\n/usr/llvm-gcc-4.2/bin/../lib/gcc/i686-apple-darwin11/4.2.1/x86_64/libgcc.a\n\n\nWhich compiler are you using (5g, 6g, 8g, gccgo)?\n6g\n\nWhich operating system are you using?\nOSX\n\nWhich version are you using?  (run 'go version')\n1.1.2\n\nPlease provide any additional information below: \n\nFull output of \u0026quot;go build -a -x code.google.com/p/go-opencv/trunk/opencv\u0026quot;\nattached.\u003c/pre\u003e\n\n\n\n\n\nAttachments:\n\n1. \u003ca href=\"https://storage.googleapis.com/go-attachment/6283/0/_all.o-2013-07-29-105717.ld-snapshot.zip\"\u003e_all.o-2013-07-29-105717.ld-snapshot.zip\u003c/a\u003e (43304 bytes)\n1. \u003ca href=\"https://storage.googleapis.com/go-attachment/6283/0/build.log\"\u003ebuild.log\u003c/a\u003e (38175 bytes)",
	"user": {
		"login": "gopherbot",
		"id": 8566911,
		"type": "User",
		"site_admin": false
	},
	"comments": 4,
	"created_at": "2013-08-29T18:10:13Z",
	"updated_at": "2015-06-08T06:25:56Z",
	"milestone": {
		"id": 1055141,
		"number": 6,
		"title": "Unplanned"
	}
}
