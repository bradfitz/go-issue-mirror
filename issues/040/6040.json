{
	"id": 51284586,
	"number": 6040,
	"state": "closed",
	"title": "cmd/cgo: godefs intermittently panics in go/printer",
	"body": "\u003cpre\u003ePresent on:\n\ngo version devel +52e26bb34741 Sun Aug 04 23:32:40 2013 +0400 freebsd/amd64\n\nand\n\ngo version go1.1.1 freebsd/amd64\n\nWhat steps will reproduce the problem?\nThis doesn't run on the playground as it is a go tool issue; the input source is:\n\u003ca href=\"http://play.golang.org/p/eZMYWmns3n\"\u003ehttp://play.golang.org/p/eZMYWmns3n\u003c/a\u003e\n1. Run go tool cgo -godefs types_freebsd.go\n\n\nWhat is the expected output?\nSometimes this output (which I think is correct) is produced:\n\n// Created by cgo -godefs - DO NOT EDIT\n// cgo -godefs types_freebsd.go\n\npackage main\n\ntype Xtcpcb struct {\n        Len     uint64\n        Inp     Inpcb\n        Tp      _Ctype_struct_tcpcb\n        Socket  _Ctype_struct_xsocket\n        Alignment_hack  uint64\n}\ntype Inpcb struct {\n        Hash    _Ctype_struct___4\n        List    _Ctype_struct___5\n        Ppcb    *byte\n        Pcbinfo *Inpcbinfo\n        Socket  *Socket\n        Cred    *Ucred\n        Flow    uint32\n        Flags   int32\n        Flags2  int32\n        Vflag   uint8\n        Ip_ttl  uint8\n        Ip_p    uint8\n        Ip_minttl       uint8\n        Flowid  uint32\n        Refcount        uint32\n        Pspare  [4]unsafe.Pointer\n        Ispare  [4]uint32\n        Inc     InConninfo\n        Label   *[0]byte\n        Sp      *[0]byte\n        Depend4 _Ctype_struct___9\n        Depend6 _Ctype_struct___10\n        Portlist        _Ctype_struct___11\n        Phd     *_Ctype_struct_inpcbport\n        Gencnt  uint64\n        Lle     *[0]byte\n        Rt      *[0]byte\n        Lock    Rwlock\n}\ntype Inpcbinfo struct {\n        Listhead        *_Ctype_struct_inpcbhead\n        Count   uint32\n        Pad_cgo_0       [4]byte\n        Hashbase        *_Ctype_struct_inpcbhead\n        Hashmask        uint64\n        Porthashbase    *_Ctype_struct_inpcbporthead\n        Porthashmask    uint64\n        Lastport        uint16\n        Lastlow uint16\n        Lasthi  uint16\n        Pad_cgo_1       [2]byte\n        Zone    *[0]byte\n        Gencnt  uint64\n        Lock    Rwlock\n        Vnet    *[0]byte\n        Pspare  [2]unsafe.Pointer\n}\n \ntype InConninfo struct {\n        Flags   uint8\n        Len     uint8\n        Fibnum  uint16\n        Ie      InEndpoints\n}\ntype InEndpoints struct {\n        Fport   uint16\n        Lport   uint16\n        Dependfaddr     [16]byte\n        Dependladdr     [16]byte\n}\ntype Socket struct {\n        Count   int32\n        Type    int16\n        Options int16\n        Linger  int16\n        State   int16\n        Qstate  int32\n        Pcb     *byte\n        Vnet    *[0]byte\n        Proto   *[0]byte\n        Head    *Socket\n        Incomp  _Ctype_struct___2\n        Comp    _Ctype_struct___3\n        List    _Ctype_struct___4\n        Qlen    uint16\n        Incqlen uint16\n        Qlimit  uint16\n        Timeo   int16\n        Error   uint16\n        Pad_cgo_0       [6]byte\n        Sigio   *[0]byte\n        Oobmark uint64\n        Aiojobq _Ctype_struct___5\n        Rcv     _Ctype_struct_sockbuf\n        Snd     _Ctype_struct_sockbuf\n        Cred    *Ucred\n        Label   *[0]byte\n        Peerlabel       *[0]byte\n        Gencnt  uint64\n        Emuldata        *byte\n        Accf    *_Ctype_struct_so_accf\n        Fibnum  int32\n        Pad_cgo_1       [4]byte\n}\ntype Ucred struct {\n        Ref     uint32\n        Uid     uint32\n        Ruid    uint32\n        Svuid   uint32\n        Ngroups int32\n        Rgid    uint32\n        Svgid   uint32\n        Pad_cgo_0       [4]byte\n        Uidinfo *[0]byte\n        Ruidinfo        *[0]byte\n        Prison  *[0]byte\n        Pspare  *byte\n        Flags   uint32\n        Pad_cgo_1       [4]byte\n        Pspare2 [2]unsafe.Pointer\n        Label   *[0]byte\n        Audit   AuditinfoAddr\n        Groups  *uint32\n        Agroups int32\n        Pad_cgo_2       [4]byte\n}\ntype Rwlock struct {\n        Lock_object     LockObject\n        Rw_lock uint64\n}\ntype LockObject struct {\n        Name    *int8\n        Flags   uint32\n        Data    uint32\n        Witness *[0]byte\n}\ntype AuditinfoAddr struct {\n        Auid    uint32\n        Mask    AuMask\n        Termid  AuTidAddr\n        Asid    int32\n        Flags   uint64\n}\ntype AuMask struct {\n        Success uint32\n        Failure uint32\n}\ntype AuTidAddr struct {\n        Port    uint32\n        Type    uint32\n        Addr    [4]uint32\n}\n\nconst SizeofXtcpcb = 0x448\nconst SizeofInpcb = 0x150\nconst SizeofInpcbinfo = 0x80\nconst SizeofUcred = 0xa0\n\n\n\n\nWhat do you see instead?\nSometimes I get:\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xb code=0x1 addr=0x28 pc=0x4c73f3]\n\ngoroutine 1 [running]:\ngo/printer.(*printer).expr1(0xc200197780, 0x0, 0x0, 0x0, 0x1, ...)\n        /home/wathiede/Downloads/go/src/pkg/go/printer/nodes.go:676 +0x33\ngo/printer.(*printer).expr(0xc200197780, 0x0, 0x0)\n        /home/wathiede/Downloads/go/src/pkg/go/printer/nodes.go:883 +0x4b\ngo/printer.(*printer).expr1(0xc200197780, 0xc200178240, 0xc200182e80, 0x0, 0x1, ...)\n        /home/wathiede/Downloads/go/src/pkg/go/printer/nodes.go:708 +0x2771\ngo/printer.(*printer).expr(0xc200197780, 0xc200178240, 0xc200182e80)\n        /home/wathiede/Downloads/go/src/pkg/go/printer/nodes.go:883 +0x4b\ngo/printer.(*printer).fieldList(0xc200197780, 0xc2001839c0, 0x1)\n        /home/wathiede/Downloads/go/src/pkg/go/printer/nodes.go:442 +0xb11\ngo/printer.(*printer).expr1(0xc200197780, 0xc200178600, 0xc200182f60, 0x0, 0x1, ...)\n        /home/wathiede/Downloads/go/src/pkg/go/printer/nodes.go:842 +0x2bf3\ngo/printer.(*printer).expr(0xc200197780, 0xc200178600, 0xc200182f60)\n        /home/wathiede/Downloads/go/src/pkg/go/printer/nodes.go:883 +0x4b\ngo/printer.(*printer).spec(0xc200197780, 0xc200077f00, 0xc200061bd0, 0x1, 0x810719101,\n...)\n        /home/wathiede/Downloads/go/src/pkg/go/printer/nodes.go:1349 +0x862\ngo/printer.(*printer).genDecl(0xc200197780, 0xc2000a26c0)\n        /home/wathiede/Downloads/go/src/pkg/go/printer/nodes.go:1394 +0x820\ngo/printer.(*printer).decl(0xc200197780, 0xc200077e40, 0xc2000a26c0)\n        /home/wathiede/Downloads/go/src/pkg/go/printer/nodes.go:1522 +0xf8\ngo/printer.(*printer).declList(0xc200197780, 0xc2000a3600, 0x10, 0x20)\n        /home/wathiede/Downloads/go/src/pkg/go/printer/nodes.go:1565 +0x172\ngo/printer.(*printer).file(0xc200197780, 0xc20009c500)\n        /home/wathiede/Downloads/go/src/pkg/go/printer/nodes.go:1573 +0x16d\ngo/printer.(*printer).printNode(0xc200197780, 0x582340, 0xc20009c500, 0xc2001a9800,\n0x43ac9f, ...)\n        /home/wathiede/Downloads/go/src/pkg/go/printer/printer.go:1026 +0x7b2\ngo/printer.(*Config).fprint(0x69e5b0, 0xc2000ab2a0, 0xc20018ec40, 0xc200077480,\n0x582340, ...)\n        /home/wathiede/Downloads/go/src/pkg/go/printer/printer.go:1165 +0xa6\ngo/printer.(*Config).Fprint(0x69e5b0, 0xc2000ab2a0, 0xc20018ec40, 0xc200077480,\n0x582340, ...)\n        /home/wathiede/Downloads/go/src/pkg/go/printer/printer.go:1223 +0x7c\nmain.(*Package).godefs(0xc20007e750, 0xc20009c000, 0x7fffffffea24, 0x10, 0x0, ...)\n        /home/wathiede/Downloads/go/src/cmd/cgo/godefs.go:112 +0xd81\nmain.main()\n        /home/wathiede/Downloads/go/src/cmd/cgo/main.go:274 +0x10dc\n\n\n\nWhich compiler are you using (5g, 6g, 8g, gccgo)?\ncgo built for FreeBSD/amd64\n\nWhich operating system are you using?\n$  uname -a \nFreeBSD sagan.sf.xinu.tv 8.3-RELEASE-p9 FreeBSD 8.3-RELEASE-p9 #0: Fri Jul 26 23:07:20\nUTC 2013     root@amd64-builder.daemonology.net:/usr/obj/usr/src/sys/GENERIC  amd64\n\n\n\nWhich version are you using?  (run 'go version')\nPresent in:\n\n go version devel +52e26bb34741 Sun Aug 04 23:32:40 2013 +0400 freebsd/amd64\n\nand\n\n  go version go1.1.1 freebsd/amd64\n\nPlease provide any additional information below.\u003c/pre\u003e",
	"user": {
		"login": "wathiede",
		"id": 1043363,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		},
		{
			"name": "Suggested"
		}
	],
	"comments": 12,
	"closed_at": "2014-12-08T10:33:14Z",
	"created_at": "2013-08-05T01:36:42Z",
	"updated_at": "2016-06-24T22:53:38Z"
}
