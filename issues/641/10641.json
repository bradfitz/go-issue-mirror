{
	"id": 72205576,
	"number": 10641,
	"state": "closed",
	"title": "runtime: math.Sqrt mishandled when GOARM=5",
	"body": "Currently GOARM=5 platforms (on at least the linux-arm-arm5 and openbsd-arm builders) are failing the `test/bench/shootout/nbody` test due to invalid floating point results - this appears to be caused by a compiler or softfloat related bug. The failure is reproducible with the following:\r\n```\r\npackage main\r\n\r\nimport (\r\n        \"fmt\"\r\n        \"math\"\r\n)\r\n\r\nfunc main() {\r\n        dt := 0.1\r\n\r\n        dx := -4.841431442464721\r\n        dy := 1.1603200440274284\r\n        dz := 0.10362204447112311\r\n\r\n        dSquared := dx*dx + dy*dy + dz*dz\r\n        distance := math.Sqrt(dSquared)\r\n        mag := dt / (dSquared * distance)\r\n\r\n        fmt.Println(mag)\r\n}\r\n```\r\nAdding a `fmt.Println(dSquared)` immediately after dSquared is assigned \"fixes\" the problem and produces correct results.\r\n\r\nThe main from `go tool objdump` of the broken version contains:\r\n```\r\nTEXT main.main(SB) /tmp/nbody.go\r\n        nbody.go:8      0x10c00 e59a1008        MOVW 0x8(R10), R1\r\n        nbody.go:8      0x10c04 e15d0001        CMP R1, R13\r\n        nbody.go:8      0x10c08 91a0300e        MOVW.LS R14, R3\r\n        nbody.go:8      0x10c0c 9b0151bd        BL.LS runtime.morestack_noctxt(SB)\r\n        nbody.go:8      0x10c10 9afffffa        B.LS main.main(SB)\r\n        nbody.go:8      0x10c14 e52de040        MOVW.W R14, -0x40(R13)\r\n        nbody.go:9      0x10c18 eb015ead        BL _sfloat(SB)\r\n        nbody.go:9      0x10c1c e59fb0e4        MOVW 0xe4(R15), R11\r\n        nbody.go:9      0x10c20 ed9b5b00        VLDR [R11], D5\r\n        nbody.go:11     0x10c24 e59fb0e0        MOVW 0xe0(R15), R11\r\n        nbody.go:11     0x10c28 ed9b2b00        VLDR [R11], D2\r\n        nbody.go:12     0x10c2c e59fb0dc        MOVW 0xdc(R15), R11\r\n        nbody.go:12     0x10c30 ed9b4b00        VLDR [R11], D4\r\n        nbody.go:13     0x10c34 e59fb0d8        MOVW 0xd8(R15), R11\r\n        nbody.go:13     0x10c38 ed9b3b00        VLDR [R11], D3\r\n        nbody.go:15     0x10c3c ee220b02        VMUL.F64 D2, D2, D0\r\n        nbody.go:15     0x10c40 ee241b04        VMUL.F64 D4, D4, D1\r\n        nbody.go:15     0x10c44 ee300b01        VADD.F64 D1, D0, D0\r\n        nbody.go:15     0x10c48 ee231b03        VMUL.F64 D3, D3, D1\r\n        nbody.go:15     0x10c4c ee300b01        VADD.F64 D1, D0, D0\r\n        nbody.go:15     0x10c50 eeb02b40        VMOV.F64 D0, D2\r\n        nbody.go:16     0x10c54 eeb10bc0        VSQRT.F64 D0, D0\r\n        nbody.go:16     0x10c58 eeb03b40        VMOV.F64 D0, D3\r\n        nbody.go:17     0x10c5c eb015e9c        BL _sfloat(SB)\r\n        nbody.go:17     0x10c60 ee220b00        VMUL.F64 D0, D2, D0\r\n        nbody.go:17     0x10c64 ee851b00        VDIV.F64 D0, D5, D1\r\n        nbody.go:17     0x10c68 eeb02b41        VMOV.F64 D1, D2\r\n        nbody.go:19     0x10c6c ed8d1b07        VSTR [SP, #28], D1\r\n        nbody.go:19     0x10c70 e3a00000        MOVW $0, R0\r\n        nbody.go:19     0x10c74 e58d002c        MOVW R0, 0x2c(R13)\r\n        nbody.go:19     0x10c78 e58d0030        MOVW R0, 0x30(R13)\r\n        nbody.go:19     0x10c7c e28d202c        ADD $44, R13, R2\r\n        nbody.go:19     0x10c80 e3520000        CMP $0, R2\r\n        nbody.go:19     0x10c84 05822000        MOVW.EQ R2, (R2)\r\n        nbody.go:19     0x10c88 e3a04001        MOVW $1, R4\r\n        nbody.go:19     0x10c8c e3a03001        MOVW $1, R3\r\n        nbody.go:19     0x10c90 e58d2034        MOVW R2, 0x34(R13)\r\n        nbody.go:19     0x10c94 e58d4038        MOVW R4, 0x38(R13)\r\n        nbody.go:19     0x10c98 e58d303c        MOVW R3, 0x3c(R13)\r\n        nbody.go:19     0x10c9c e59f0074        MOVW 0x74(R15), R0\r\n        nbody.go:19     0x10ca0 e58d0004        MOVW R0, 0x4(R13)\r\n        nbody.go:19     0x10ca4 e28d001c        ADD $28, R13, R0\r\n        nbody.go:19     0x10ca8 e58d0008        MOVW R0, 0x8(R13)\r\n        nbody.go:19     0x10cac e3a00000        MOVW $0, R0\r\n        nbody.go:19     0x10cb0 e58d000c        MOVW R0, 0xc(R13)\r\n        nbody.go:19     0x10cb4 eb002812        BL runtime.convT2E(SB)\r\n        nbody.go:19     0x10cb8 e59d3010        MOVW 0x10(R13), R3\r\n        nbody.go:19     0x10cbc e59d2014        MOVW 0x14(R13), R2\r\n        nbody.go:19     0x10cc0 e28d0034        ADD $52, R13, R0\r\n        nbody.go:19     0x10cc4 e5900000        MOVW (R0), R0\r\n        nbody.go:19     0x10cc8 e2800000        ADD $0, R0, R0\r\n        nbody.go:19     0x10ccc e58d0004        MOVW R0, 0x4(R13)\r\n        nbody.go:19     0x10cd0 e58d3024        MOVW R3, 0x24(R13)\r\n        nbody.go:19     0x10cd4 e58d3008        MOVW R3, 0x8(R13)\r\n        nbody.go:19     0x10cd8 e58d2028        MOVW R2, 0x28(R13)\r\n        nbody.go:19     0x10cdc e58d200c        MOVW R2, 0xc(R13)\r\n        nbody.go:19     0x10ce0 eb0035d5        BL runtime.writebarrieriface(SB)\r\n        nbody.go:19     0x10ce4 e59d0034        MOVW 0x34(R13), R0\r\n        nbody.go:19     0x10ce8 e58d0004        MOVW R0, 0x4(R13)\r\n        nbody.go:19     0x10cec e59d0038        MOVW 0x38(R13), R0\r\n        nbody.go:19     0x10cf0 e58d0008        MOVW R0, 0x8(R13)\r\n        nbody.go:19     0x10cf4 e59d003c        MOVW 0x3c(R13), R0\r\n        nbody.go:19     0x10cf8 e58d000c        MOVW R0, 0xc(R13)\r\n        nbody.go:19     0x10cfc eb017223        BL fmt.Println(SB)\r\n        nbody.go:20     0x10d00 e49df040        RET #64\r\n        nbody.go:20     0x10d04 eafffffe        B 0x10d04\r\n        nbody.go:20     0x10d08 0011e368        AND.S.EQ R8@\u003e$6, R1, R14\r\n        nbody.go:20     0x10d0c 0011e3e8        AND.S.EQ R8@\u003e$7, R1, R14\r\n        nbody.go:20     0x10d10 0011e3a0        AND.S.EQ R0\u003e\u003e$7, R1, R14\r\n        nbody.go:20     0x10d14 0011e370        AND.S.EQ R0@\u003eR3, R1, R14\r\n        nbody.go:20     0x10d18 000cec78        AND.EQ R8@\u003eR12, R12, R14\r\n```\r\n\r\nWhile the working version with the additional `fmt.Println` has:\r\n```\r\nTEXT main.main(SB) /tmp/nbody.go\r\n        nbody.go:8      0x10c00 e59a1008        MOVW 0x8(R10), R1\r\n        nbody.go:8      0x10c04 e15d0001        CMP R1, R13\r\n        nbody.go:8      0x10c08 91a0300e        MOVW.LS R14, R3\r\n        nbody.go:8      0x10c0c 9b0151e6        BL.LS runtime.morestack_noctxt(SB)\r\n        nbody.go:8      0x10c10 9afffffa        B.LS main.main(SB)\r\n        nbody.go:8      0x10c14 e52de05c        MOVW.W R14, -0x5c(R13)\r\n        nbody.go:9      0x10c18 eb015ed6        BL _sfloat(SB)\r\n        nbody.go:9      0x10c1c e59fb188        MOVW 0x188(R15), R11\r\n        nbody.go:9      0x10c20 ed9b0b00        VLDR [R11], D0\r\n        nbody.go:9      0x10c24 ed8d0b07        VSTR [SP, #28], D0\r\n        nbody.go:11     0x10c28 e59fb180        MOVW 0x180(R15), R11\r\n        nbody.go:11     0x10c2c ed9b2b00        VLDR [R11], D2\r\n        nbody.go:12     0x10c30 e59fb17c        MOVW 0x17c(R15), R11\r\n        nbody.go:12     0x10c34 ed9b4b00        VLDR [R11], D4\r\n        nbody.go:13     0x10c38 e59fb178        MOVW 0x178(R15), R11\r\n        nbody.go:13     0x10c3c ed9b3b00        VLDR [R11], D3\r\n        nbody.go:15     0x10c40 ee220b02        VMUL.F64 D2, D2, D0\r\n        nbody.go:15     0x10c44 ee241b04        VMUL.F64 D4, D4, D1\r\n        nbody.go:15     0x10c48 ee300b01        VADD.F64 D1, D0, D0\r\n        nbody.go:15     0x10c4c ee231b03        VMUL.F64 D3, D3, D1\r\n        nbody.go:15     0x10c50 ee300b01        VADD.F64 D1, D0, D0\r\n        nbody.go:15     0x10c54 eeb02b40        VMOV.F64 D0, D2\r\n        nbody.go:16     0x10c58 ed8d0b09        VSTR [SP, #36], D0\r\n        nbody.go:16     0x10c5c ed8d0b0b        VSTR [SP, #44], D0\r\n        nbody.go:16     0x10c60 e3a00000        MOVW $0, R0\r\n        nbody.go:16     0x10c64 e58d003c        MOVW R0, 0x3c(R13)\r\n        nbody.go:16     0x10c68 e58d0040        MOVW R0, 0x40(R13)\r\n        nbody.go:16     0x10c6c e28d203c        ADD $60, R13, R2\r\n        nbody.go:16     0x10c70 e3520000        CMP $0, R2\r\n        nbody.go:16     0x10c74 05822000        MOVW.EQ R2, (R2)\r\n        nbody.go:16     0x10c78 e3a04001        MOVW $1, R4\r\n        nbody.go:16     0x10c7c e3a03001        MOVW $1, R3\r\n        nbody.go:16     0x10c80 e58d2050        MOVW R2, 0x50(R13)\r\n        nbody.go:16     0x10c84 e58d4054        MOVW R4, 0x54(R13)\r\n        nbody.go:16     0x10c88 e58d3058        MOVW R3, 0x58(R13)\r\n        nbody.go:16     0x10c8c e59f0128        MOVW 0x128(R15), R0\r\n        nbody.go:16     0x10c90 e58d0004        MOVW R0, 0x4(R13)\r\n        nbody.go:16     0x10c94 e28d002c        ADD $44, R13, R0\r\n        nbody.go:16     0x10c98 e58d0008        MOVW R0, 0x8(R13)\r\n        nbody.go:16     0x10c9c e3a00000        MOVW $0, R0\r\n        nbody.go:16     0x10ca0 e58d000c        MOVW R0, 0xc(R13)\r\n        nbody.go:16     0x10ca4 eb00283f        BL runtime.convT2E(SB)\r\n        nbody.go:16     0x10ca8 e59d3010        MOVW 0x10(R13), R3\r\n        nbody.go:16     0x10cac e59d2014        MOVW 0x14(R13), R2\r\n        nbody.go:16     0x10cb0 e28d0050        ADD $80, R13, R0\r\n        nbody.go:16     0x10cb4 e5900000        MOVW (R0), R0\r\n        nbody.go:16     0x10cb8 e2800000        ADD $0, R0, R0\r\n        nbody.go:16     0x10cbc e58d0004        MOVW R0, 0x4(R13)\r\n        nbody.go:16     0x10cc0 e58d3034        MOVW R3, 0x34(R13)\r\n        nbody.go:16     0x10cc4 e58d3008        MOVW R3, 0x8(R13)\r\n        nbody.go:16     0x10cc8 e58d2038        MOVW R2, 0x38(R13)\r\n        nbody.go:16     0x10ccc e58d200c        MOVW R2, 0xc(R13)\r\n        nbody.go:16     0x10cd0 eb003602        BL runtime.writebarrieriface(SB)\r\n        nbody.go:16     0x10cd4 e59d0050        MOVW 0x50(R13), R0\r\n        nbody.go:16     0x10cd8 e58d0004        MOVW R0, 0x4(R13)\r\n        nbody.go:16     0x10cdc e59d0054        MOVW 0x54(R13), R0\r\n        nbody.go:16     0x10ce0 e58d0008        MOVW R0, 0x8(R13)\r\n        nbody.go:16     0x10ce4 e59d0058        MOVW 0x58(R13), R0\r\n        nbody.go:16     0x10ce8 e58d000c        MOVW R0, 0xc(R13)\r\n        nbody.go:16     0x10cec eb017250        BL fmt.Println(SB)\r\n        nbody.go:16     0x10cf0 eb015ea0        BL _sfloat(SB)\r\n        nbody.go:16     0x10cf4 ed9d3b09        VLDR [SP, #36], D3\r\n        nbody.go:18     0x10cf8 eeb10bc3        VSQRT.F64 D3, D0\r\n        nbody.go:19     0x10cfc eb015e9d        BL _sfloat(SB)\r\n        nbody.go:19     0x10d00 ee230b00        VMUL.F64 D0, D3, D0\r\n        nbody.go:19     0x10d04 ed9d2b07        VLDR [SP, #28], D2\r\n        nbody.go:19     0x10d08 ee822b00        VDIV.F64 D0, D2, D2\r\n        nbody.go:19     0x10d0c eeb01b42        VMOV.F64 D2, D1\r\n        nbody.go:21     0x10d10 ed8d2b0b        VSTR [SP, #44], D2\r\n        nbody.go:21     0x10d14 e3a00000        MOVW $0, R0\r\n        nbody.go:21     0x10d18 e58d003c        MOVW R0, 0x3c(R13)\r\n        nbody.go:21     0x10d1c e58d0040        MOVW R0, 0x40(R13)\r\n        nbody.go:21     0x10d20 e28d203c        ADD $60, R13, R2\r\n        nbody.go:21     0x10d24 e3520000        CMP $0, R2\r\n        nbody.go:21     0x10d28 05822000        MOVW.EQ R2, (R2)\r\n        nbody.go:21     0x10d2c e3a03001        MOVW $1, R3\r\n        nbody.go:21     0x10d30 e3a04001        MOVW $1, R4\r\n        nbody.go:21     0x10d34 e58d2044        MOVW R2, 0x44(R13)\r\n        nbody.go:21     0x10d38 e58d3048        MOVW R3, 0x48(R13)\r\n        nbody.go:21     0x10d3c e58d404c        MOVW R4, 0x4c(R13)\r\n        nbody.go:21     0x10d40 e59f0074        MOVW 0x74(R15), R0\r\n        nbody.go:21     0x10d44 e58d0004        MOVW R0, 0x4(R13)\r\n        nbody.go:21     0x10d48 e28d002c        ADD $44, R13, R0\r\n        nbody.go:21     0x10d4c e58d0008        MOVW R0, 0x8(R13)\r\n        nbody.go:21     0x10d50 e3a00000        MOVW $0, R0\r\n        nbody.go:21     0x10d54 e58d000c        MOVW R0, 0xc(R13)\r\n        nbody.go:21     0x10d58 eb002812        BL runtime.convT2E(SB)\r\n        nbody.go:21     0x10d5c e59d3010        MOVW 0x10(R13), R3\r\n        nbody.go:21     0x10d60 e59d2014        MOVW 0x14(R13), R2\r\n        nbody.go:21     0x10d64 e28d0044        ADD $68, R13, R0\r\n        nbody.go:21     0x10d68 e5900000        MOVW (R0), R0\r\n        nbody.go:21     0x10d6c e2800000        ADD $0, R0, R0\r\n        nbody.go:21     0x10d70 e58d0004        MOVW R0, 0x4(R13)\r\n        nbody.go:21     0x10d74 e58d3034        MOVW R3, 0x34(R13)\r\n        nbody.go:21     0x10d78 e58d3008        MOVW R3, 0x8(R13)\r\n        nbody.go:21     0x10d7c e58d2038        MOVW R2, 0x38(R13)\r\n        nbody.go:21     0x10d80 e58d200c        MOVW R2, 0xc(R13)\r\n        nbody.go:21     0x10d84 eb0035d5        BL runtime.writebarrieriface(SB)\r\n        nbody.go:21     0x10d88 e59d0044        MOVW 0x44(R13), R0\r\n        nbody.go:21     0x10d8c e58d0004        MOVW R0, 0x4(R13)\r\n        nbody.go:21     0x10d90 e59d0048        MOVW 0x48(R13), R0\r\n        nbody.go:21     0x10d94 e58d0008        MOVW R0, 0x8(R13)\r\n        nbody.go:21     0x10d98 e59d004c        MOVW 0x4c(R13), R0\r\n        nbody.go:21     0x10d9c e58d000c        MOVW R0, 0xc(R13)\r\n        nbody.go:21     0x10da0 eb017223        BL fmt.Println(SB)\r\n        nbody.go:22     0x10da4 e49df05c        RET #92\r\n        nbody.go:22     0x10da8 eafffffe        B 0x10da8\r\n        nbody.go:22     0x10dac 0011e368        AND.S.EQ R8@\u003e$6, R1, R14\r\n        nbody.go:22     0x10db0 0011e3e8        AND.S.EQ R8@\u003e$7, R1, R14\r\n        nbody.go:22     0x10db4 0011e3a0        AND.S.EQ R0\u003e\u003e$7, R1, R14\r\n        nbody.go:22     0x10db8 0011e370        AND.S.EQ R0@\u003eR3, R1, R14\r\n        nbody.go:22     0x10dbc 000cec78        AND.EQ R8@\u003eR12, R12, R14\r\n```",
	"user": {
		"login": "4a6f656c",
		"id": 8142769,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"comments": 10,
	"closed_at": "2015-05-05T07:33:13Z",
	"created_at": "2015-04-30T16:07:35Z",
	"updated_at": "2016-06-25T02:07:01Z",
	"milestone": {
		"id": 905105,
		"number": 1,
		"title": "Go1.5"
	}
}
