{
	"id": 184701898,
	"body": "Thanks for the full log.\r\n\r\nI think I see an unlikely race condition.  In cmd/go, each test sets `cmd.Env` to the result of envForDir(cmd.Dir,`envForDir(cmd.Dir, origEnv)`.  The `envForDir` function calls `mergeEnvLists`, which appends to its second argument.  Multiple tests are run in parallel.  This means that there is a race condition changing the environment used to run the tests.  On Windows, the environment is converted into a block of NUL-terminated strings by looping over the environment slice twice.  A very precisely timed race could cause the environment slice to change between the two loops, which could cause this error.\r\n\r\nI build a version of cmd/go using -race (`go build -race -o gorace cmd/go`) and then ran `gorace test std`.  I got this, which is the race I am describing.\r\n\r\n    ==================\r\n    WARNING: DATA RACE\r\n    Read by goroutine 14:\r\n      main.mergeEnvLists()\r\n          /home/iant/go/src/cmd/go/main.go:461 +0x1cc\r\n      main.envForDir()\r\n          /home/iant/go/src/cmd/go/main.go:452 +0x131\r\n      main.(*builder).runTest()\r\n          /home/iant/go/src/cmd/go/test.go:1077 +0x82b\r\n      main.(*builder).do.func1()\r\n          /home/iant/go/src/cmd/go/build.go:1257 +0x56f\r\n      main.(*builder).do.func2()\r\n          /home/iant/go/src/cmd/go/build.go:1314 +0x181\r\n    \r\n    Previous write by goroutine 13:\r\n      main.mergeEnvLists()\r\n          /home/iant/go/src/cmd/go/main.go:463 +0x2aa\r\n      main.envForDir()\r\n          /home/iant/go/src/cmd/go/main.go:452 +0x131\r\n      main.(*builder).runTest()\r\n          /home/iant/go/src/cmd/go/test.go:1077 +0x82b\r\n      main.(*builder).do.func1()\r\n          /home/iant/go/src/cmd/go/build.go:1257 +0x56f\r\n      main.(*builder).do.func2()\r\n          /home/iant/go/src/cmd/go/build.go:1314 +0x181\r\n    \r\n    Goroutine 14 (running) created at:\r\n      main.(*builder).do()\r\n          /home/iant/go/src/cmd/go/build.go:1320 +0x68e\r\n      main.runTest()\r\n          /home/iant/go/src/cmd/go/test.go:595 +0x33f3\r\n      main.main()\r\n          /home/iant/go/src/cmd/go/main.go:181 +0xa38\r\n    \r\n    Goroutine 13 (running) created at:\r\n      main.(*builder).do()\r\n          /home/iant/go/src/cmd/go/build.go:1320 +0x68e\r\n      main.runTest()\r\n          /home/iant/go/src/cmd/go/test.go:595 +0x33f3\r\n      main.main()\r\n          /home/iant/go/src/cmd/go/main.go:181 +0xa38\r\n    ==================",
	"user": {
		"login": "ianlancetaylor",
		"id": 3194333,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2016-02-16T14:30:35Z",
	"updated_at": "2016-02-16T14:30:35Z"
}
