{
	"id": 254091015,
	"body": "Faster (and more debuggable) way to reproduce:\r\n\r\n```sh\r\ncd misc/cgo/test\r\ngo test -c -ldflags -linkmode=auto\r\nwhile GOGC=10 GODEBUG=gccheckmark=1 GOTRACEBACK=2 ./test.test; do; done\r\n```\r\n\r\nThe panic happens almost immediately, but then the process wedges hard in the middle of printing the traceback (doesn't even respond to SIGINT). It's stuck on the `lock(\u0026allglock)` in `tracebackothers`.\r\n\r\nPoking around in gdb, the missed G is indeed not on the rescan list and its g.gcRescan is -1.\r\n\r\nIf I force it past the lock, I get the following traceback:\r\n\r\n\u003cpre\u003e\r\ngp 0xc420074d00 goid 84 status 3 gcscandone false gcscanvalid true\r\nfatal error: scan missed a g\r\n\r\nruntime stack:\r\nruntime.throw(0x5ae8b3, 0xf)\r\n\t/home/austin/go.dev/src/runtime/panic.go:587 +0x95 fp=0x7ff9c999ddd0 sp=0x7ff9c999ddb0\r\nruntime.gcMarkRootCheck()\r\n\t/home/austin/go.dev/src/runtime/mgcmark.go:126 +0x20c fp=0x7ff9c999de20 sp=0x7ff9c999ddd0\r\nruntime.gcMark(0xbd9385843f3e)\r\n\t/home/austin/go.dev/src/runtime/mgc.go:1599 +0x4e3 fp=0x7ff9c999de68 sp=0x7ff9c999de20\r\nruntime.gcMarkTermination.func1()\r\n\t/home/austin/go.dev/src/runtime/mgc.go:1194 +0x2d fp=0x7ff9c999de80 sp=0x7ff9c999de68\r\nruntime.systemstack(0xc420030000)\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:298 +0x79 fp=0x7ff9c999de88 sp=0x7ff9c999de80\r\nruntime.mstart()\r\n\t/home/austin/go.dev/src/runtime/proc.go:1081 fp=0x7ff9c999de90 sp=0x7ff9c999de88\r\n\r\ngoroutine 18 [garbage collection]:\r\nruntime.systemstack_switch()\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:252 fp=0xc420036540 sp=0xc420036538\r\nruntime.gcMarkTermination()\r\n\t/home/austin/go.dev/src/runtime/mgc.go:1202 +0x141 fp=0xc420036728 sp=0xc420036540\r\nruntime.gcMarkDone()\r\n\t/home/austin/go.dev/src/runtime/mgc.go:1166 +0x1db fp=0xc420036748 sp=0xc420036728\r\nruntime.gcBgMarkWorker(0xc420030000)\r\n\t/home/austin/go.dev/src/runtime/mgc.go:1513 +0x2c6 fp=0xc4200367b8 sp=0xc420036748\r\nruntime.goexit()\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:2158 +0x1 fp=0xc4200367c0 sp=0xc4200367b8\r\ncreated by runtime.gcBgMarkStartWorkers\r\n\t/home/austin/go.dev/src/runtime/mgc.go:1357 +0x98\r\n\r\n\u003cdetails\u003e\u003csummary\u003eMore...\u003c/summary\u003e\r\ngoroutine 1 [chan receive, 16 minutes]:\r\nruntime.gopark(0x5b8fd0, 0xc4200c6a18, 0x5add18, 0xc, 0xc420018317, 0x3)\r\n\t/home/austin/go.dev/src/runtime/proc.go:261 +0x13a fp=0xc42004ab58 sp=0xc42004ab28\r\nruntime.goparkunlock(0xc4200c6a18, 0x5add18, 0xc, 0xc4200c6917, 0x3)\r\n\t/home/austin/go.dev/src/runtime/proc.go:267 +0x5e fp=0xc42004ab98 sp=0xc42004ab58\r\nruntime.chanrecv(0x55c380, 0xc4200c69c0, 0x0, 0xc42004ac01, 0x4d90dc)\r\n\t/home/austin/go.dev/src/runtime/chan.go:496 +0x2fb fp=0xc42004ac20 sp=0xc42004ab98\r\nruntime.chanrecv1(0x55c380, 0xc4200c69c0, 0x0)\r\n\t/home/austin/go.dev/src/runtime/chan.go:378 +0x35 fp=0xc42004ac58 sp=0xc42004ac20\r\ntesting.(*T).Run(0xc4200c4000, 0x5ad896, 0xb, 0x5b61d8, 0x894801)\r\n\t/home/austin/go.dev/src/testing/testing.go:658 +0x2e6 fp=0xc42004ad00 sp=0xc42004ac58\r\ntesting.RunTests.func1(0xc4200c4000)\r\n\t/home/austin/go.dev/src/testing/testing.go:804 +0x67 fp=0xc42004ad50 sp=0xc42004ad00\r\ntesting.tRunner(0xc4200c4000, 0xc42004ae30)\r\n\t/home/austin/go.dev/src/testing/testing.go:621 +0x81 fp=0xc42004ad78 sp=0xc42004ad50\r\ntesting.RunTests(0x5b8c50, 0x881780, 0x46, 0x46, 0x406dc8)\r\n\t/home/austin/go.dev/src/testing/testing.go:810 +0x2bb fp=0xc42004ae60 sp=0xc42004ad78\r\ntesting.(*M).Run(0xc42004aef8, 0xc42005ff30)\r\n\t/home/austin/go.dev/src/testing/testing.go:754 +0x85 fp=0xc42004aee8 sp=0xc42004ae60\r\nmain.main()\r\n\t_/home/austin/go.dev/misc/cgo/test/_test/_testmain.go:194 +0xc6 fp=0xc42004af58 sp=0xc42004aee8\r\nruntime.main()\r\n\t/home/austin/go.dev/src/runtime/proc.go:185 +0x20a fp=0xc42004afb0 sp=0xc42004af58\r\nruntime.goexit()\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:2158 +0x1 fp=0xc42004afb8 sp=0xc42004afb0\r\n\r\ngoroutine 17 [runnable, locked to thread]:\r\nruntime.goexit()\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:2158 +0x1 fp=0xc42004efb8 sp=0xc42004efb0\r\n\r\ngoroutine 2 [force gc (idle), 16 minutes]:\r\nruntime.gopark(0x5b8fd0, 0x894520, 0x5ae7b4, 0xf, 0x5b8e14, 0x1)\r\n\t/home/austin/go.dev/src/runtime/proc.go:261 +0x13a fp=0xc42003a748 sp=0xc42003a718\r\nruntime.goparkunlock(0x894520, 0x5ae7b4, 0xf, 0xc420000114, 0x1)\r\n\t/home/austin/go.dev/src/runtime/proc.go:267 +0x5e fp=0xc42003a788 sp=0xc42003a748\r\nruntime.forcegchelper()\r\n\t/home/austin/go.dev/src/runtime/proc.go:226 +0x9e fp=0xc42003a7c0 sp=0xc42003a788\r\nruntime.goexit()\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:2158 +0x1 fp=0xc42003a7c8 sp=0xc42003a7c0\r\ncreated by runtime.init.4\r\n\t/home/austin/go.dev/src/runtime/proc.go:215 +0x35\r\n\r\ngoroutine 3 [GC sweep wait, 16 minutes]:\r\nruntime.gopark(0x5b8fd0, 0x894700, 0x5adfd8, 0xd, 0x453914, 0x1)\r\n\t/home/austin/go.dev/src/runtime/proc.go:261 +0x13a fp=0xc42003af38 sp=0xc42003af08\r\nruntime.goparkunlock(0x894700, 0x5adfd8, 0xd, 0x14, 0x1)\r\n\t/home/austin/go.dev/src/runtime/proc.go:267 +0x5e fp=0xc42003af78 sp=0xc42003af38\r\nruntime.bgsweep(0xc42001a070)\r\n\t/home/austin/go.dev/src/runtime/mgcsweep.go:79 +0x12e fp=0xc42003afb8 sp=0xc42003af78\r\nruntime.goexit()\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:2158 +0x1 fp=0xc42003afc0 sp=0xc42003afb8\r\ncreated by runtime.gcenable\r\n\t/home/austin/go.dev/src/runtime/mgc.go:213 +0x61\r\n\r\ngoroutine 4 [finalizer wait, 16 minutes]:\r\nruntime.gopark(0x5b8fd0, 0x8f1840, 0x5ae415, 0xe, 0x14, 0x1)\r\n\t/home/austin/go.dev/src/runtime/proc.go:261 +0x13a fp=0xc42003b708 sp=0xc42003b6d8\r\nruntime.goparkunlock(0x8f1840, 0x5ae415, 0xe, 0x14, 0x1)\r\n\t/home/austin/go.dev/src/runtime/proc.go:267 +0x5e fp=0xc42003b748 sp=0xc42003b708\r\nruntime.runfinq()\r\n\t/home/austin/go.dev/src/runtime/mfinal.go:161 +0xaf fp=0xc42003b7c0 sp=0xc42003b748\r\nruntime.goexit()\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:2158 +0x1 fp=0xc42003b7c8 sp=0xc42003b7c0\r\ncreated by runtime.createfing\r\n\t/home/austin/go.dev/src/runtime/mfinal.go:142 +0x62\r\n\r\ngoroutine 5 [runnable]:\r\nruntime.notetsleepg(0x8f1ac0, 0xffffffffffffffff, 0x0)\r\n\t/home/austin/go.dev/src/runtime/lock_futex.go:205 +0x42 fp=0xc42003bf60 sp=0xc42003bf30\r\nos/signal.signal_recv(0x0)\r\n\t/home/austin/go.dev/src/runtime/sigqueue.go:116 +0x104 fp=0xc42003bf88 sp=0xc42003bf60\r\nos/signal.loop()\r\n\t/home/austin/go.dev/src/os/signal/signal_unix.go:22 +0x22 fp=0xc42003bfc0 sp=0xc42003bf88\r\nruntime.goexit()\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:2158 +0x1 fp=0xc42003bfc8 sp=0xc42003bfc0\r\ncreated by os/signal.init.1\r\n\t/home/austin/go.dev/src/os/signal/signal_unix.go:28 +0x41\r\n\r\ngoroutine 75 [runnable, locked to thread]:\r\nruntime.cgocall(0x52fe60, 0xc42003c7b0, 0xc42003c798)\r\n\t/home/austin/go.dev/src/runtime/cgocall.go:130 +0xe2 fp=0xc42003c770 sp=0xc42003c730\r\n_/home/austin/go.dev/misc/cgo/test._Cfunc_usleep(0x2710, 0xc400000000)\r\n\t_/home/austin/go.dev/misc/cgo/test/_test/_obj_test/_cgo_gotypes.go:1802 +0x4d fp=0xc42003c7b0 sp=0xc42003c770\r\nruntime.goexit()\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:2158 +0x1 fp=0xc42003c7b8 sp=0xc42003c7b0\r\ncreated by _/home/austin/go.dev/misc/cgo/test.lockOSThreadCallback\r\n\t/home/austin/go.dev/misc/cgo/test/issue3775.go:37 +0xe0\r\n\r\ngoroutine 19 [GC worker (idle), 16 minutes]:\r\nruntime.gopark(0x5b8e70, 0xc4200c0020, 0x5aea6b, 0x10, 0x14, 0x0)\r\n\t/home/austin/go.dev/src/runtime/proc.go:261 +0x13a fp=0xc420036f48 sp=0xc420036f18\r\nruntime.gcBgMarkWorker(0xc420031300)\r\n\t/home/austin/go.dev/src/runtime/mgc.go:1436 +0x108 fp=0xc420036fb8 sp=0xc420036f48\r\nruntime.goexit()\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:2158 +0x1 fp=0xc420036fc0 sp=0xc420036fb8\r\ncreated by runtime.gcBgMarkStartWorkers\r\n\t/home/austin/go.dev/src/runtime/mgc.go:1357 +0x98\r\n\r\ngoroutine 76 [syscall, 16 minutes, locked to thread]:\r\nruntime.cgocall(0x52f8f0, 0xc420037f08, 0x4529e0)\r\n\t/home/austin/go.dev/src/runtime/cgocall.go:130 +0xe2 fp=0xc420037ec8 sp=0xc420037e88\r\n_/home/austin/go.dev/misc/cgo/test._Cfunc_doAdd(0x60000000a)\r\n\t_/home/austin/go.dev/misc/cgo/test/_test/_obj_test/_cgo_gotypes.go:931 +0x45 fp=0xc420037f08 sp=0xc420037ec8\r\n_/home/austin/go.dev/misc/cgo/test.testCthread(0xc4200c4900)\r\n\t/home/austin/go.dev/misc/cgo/test/cthread.go:38 +0x3f fp=0xc420037f70 sp=0xc420037f08\r\n_/home/austin/go.dev/misc/cgo/test.TestCthread(0xc4200c4900)\r\n\t/home/austin/go.dev/misc/cgo/test/cgo_test.go:39 +0x2b fp=0xc420037f88 sp=0xc420037f70\r\ntesting.tRunner(0xc4200c4900, 0x5b61d8)\r\n\t/home/austin/go.dev/src/testing/testing.go:621 +0x81 fp=0xc420037fb0 sp=0xc420037f88\r\nruntime.goexit()\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:2158 +0x1 fp=0xc420037fb8 sp=0xc420037fb0\r\ncreated by testing.(*T).Run\r\n\t/home/austin/go.dev/src/testing/testing.go:657 +0x2bc\r\n\r\ngoroutine 22 [select, 16 minutes, locked to thread]:\r\nruntime.gopark(0x5b9008, 0x0, 0x5ac46a, 0x6, 0x18, 0x2)\r\n\t/home/austin/go.dev/src/runtime/proc.go:261 +0x13a fp=0xc42004bca0 sp=0xc42004bc70\r\nruntime.selectgoImpl(0xc42004bf20, 0x0, 0x18)\r\n\t/home/austin/go.dev/src/runtime/select.go:423 +0x1198 fp=0xc42004bec0 sp=0xc42004bca0\r\nruntime.selectgo(0xc42004bf20)\r\n\t/home/austin/go.dev/src/runtime/select.go:238 +0x1c fp=0xc42004bee8 sp=0xc42004bec0\r\nruntime.ensureSigM.func1()\r\n\t/home/austin/go.dev/src/runtime/signal_unix.go:408 +0x2dd fp=0xc42004bfb0 sp=0xc42004bee8\r\nruntime.goexit()\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:2158 +0x1 fp=0xc42004bfb8 sp=0xc42004bfb0\r\ncreated by runtime.ensureSigM\r\n\t/home/austin/go.dev/src/runtime/signal_unix.go:421 +0xda\r\n\r\ngoroutine 9 [runnable]:\r\nruntime.notetsleepg(0x8947b8, 0x10c2c9a50, 0x0)\r\n\t/home/austin/go.dev/src/runtime/lock_futex.go:205 +0x42 fp=0xc420061f40 sp=0xc420061f10\r\nruntime.timerproc()\r\n\t/home/austin/go.dev/src/runtime/time.go:209 +0x2ec fp=0xc420061fc0 sp=0xc420061f40\r\nruntime.goexit()\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:2158 +0x1 fp=0xc420061fc8 sp=0xc420061fc0\r\ncreated by runtime.addtimerLocked\r\n\t/home/austin/go.dev/src/runtime/time.go:116 +0xed\r\n\r\ngoroutine 41 [GC worker (idle), 16 minutes]:\r\nruntime.gopark(0x5b8e70, 0xc4200ec7c0, 0x5aea6b, 0x10, 0x4f1d14, 0x0)\r\n\t/home/austin/go.dev/src/runtime/proc.go:261 +0x13a fp=0xc42005d748 sp=0xc42005d718\r\nruntime.gcBgMarkWorker(0xc420032600)\r\n\t/home/austin/go.dev/src/runtime/mgc.go:1436 +0x108 fp=0xc42005d7b8 sp=0xc42005d748\r\nruntime.goexit()\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:2158 +0x1 fp=0xc42005d7c0 sp=0xc42005d7b8\r\ncreated by runtime.gcBgMarkStartWorkers\r\n\t/home/austin/go.dev/src/runtime/mgc.go:1357 +0x98\r\n\r\ngoroutine 42 [GC worker (idle), 16 minutes]:\r\nruntime.gopark(0x5b8e70, 0xc4200ec7d0, 0x5aea6b, 0x10, 0x4f1914, 0x0)\r\n\t/home/austin/go.dev/src/runtime/proc.go:261 +0x13a fp=0xc42003cf48 sp=0xc42003cf18\r\nruntime.gcBgMarkWorker(0xc420033900)\r\n\t/home/austin/go.dev/src/runtime/mgc.go:1436 +0x108 fp=0xc42003cfb8 sp=0xc42003cf48\r\nruntime.goexit()\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:2158 +0x1 fp=0xc42003cfc0 sp=0xc42003cfb8\r\ncreated by runtime.gcBgMarkStartWorkers\r\n\t/home/austin/go.dev/src/runtime/mgc.go:1357 +0x98\r\n\r\ngoroutine 82 [runnable, locked to thread]:\r\nruntime.goexit()\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:2158 +0x1 fp=0xc420606fb8 sp=0xc420606fb0\r\n\r\ngoroutine 83 [syscall, 16 minutes, locked to thread]:\r\nruntime.goexit()\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:2158 +0x1 fp=0xc420607fb8 sp=0xc420607fb0\r\n\r\n\u003c/details\u003e\r\ngoroutine 84 [syscall, locked to thread]:\r\nruntime.goexit()\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:2158 +0x1 fp=0xc42004ffb8 sp=0xc42004ffb0\r\n\r\ngoroutine 85 [runnable, locked to thread]:\r\nruntime.goexit()\r\n\t/home/austin/go.dev/src/runtime/asm_amd64.s:2158 +0x1 fp=0xc420608fb8 sp=0xc420608fb0\r\n\u003c/pre\u003e\r\n\r\nBased on the traceback of goroutine 84, this goroutine is a cgo spare that was created by `oneNewExtraM`. We're probably just putting this G into the wrong state. Most likely this is harmless in reality.\r\n",
	"user": {
		"login": "aclements",
		"id": 2688315,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2016-10-17T01:09:15Z",
	"updated_at": "2016-10-17T01:11:32Z"
}
