{
	"id": 221512380,
	"body": "I hit this race today as well, addReflectOff is protected by a lock in the\nruntime, but maybe the race runtime doesn't understand that lock, or the\nuse of go:linkname is throwing it off.\n\n/cc @dvyukov\n\nOn Wed, May 25, 2016 at 6:50 PM, Roger Peppe \u003cnotifications@github.com\u003e\nwrote:\n\n\u003e Please answer these questions before submitting your issue. Thanks!\n\u003e\n\u003e    1. What version of Go are you using (go version)?\n\u003e\n\u003e go version devel +fa3f484 Wed May 25 01:47:53 2016 +0000 linux/amd64\n\u003e\n\u003e but this problem has been around for at least a couple of weeks on tip.\n\u003e\n\u003e    1.\n\u003e\n\u003e    What operating system and processor architecture are you using (go env\n\u003e    )?\n\u003e    GOARCH=\"amd64\"\n\u003e    GOOS=\"linux\"\n\u003e    2.\n\u003e\n\u003e    What did you do?\n\u003e\n\u003e I ran a test with \"go test -race\".\n\u003e Unfortunately the code to reproduce it is not open source, but\n\u003e most of the dependencies are. I'll try to see whether I can reproduce\n\u003e the issue in a smaller program, but that might be problematic,\n\u003e hence I'm reporting the issue now.\n\u003e\n\u003e    1. What did you expect to see?\n\u003e\n\u003e No races detected. Go 1.6.3 and previous doesn't report a race.\n\u003e\n\u003e    1. What did you see instead?\n\u003e\n\u003e This race detector output (I've removed goroutines that mention\n\u003e the non-open-source project).\n\u003e\n\u003e Note that regardless of what code is calling it, I don't think there should\n\u003e ever be a race between reflect.SliceOf and reflect.Value.Call, which\n\u003e is what appears to be happening.\n\u003e\n\u003e ==================\n\u003e WARNING: DATA RACE\n\u003e Read at 0x00c420390c90 by goroutine 147:\n\u003e   runtime.mapaccess2_fast64()\n\u003e       /home/rog/go/src/runtime/hashmap_fast.go:147 +0x0\n\u003e   reflect.addReflectOff()\n\u003e       /home/rog/go/src/runtime/runtime1.go:518 +0x5c\n\u003e   reflect.SliceOf()\n\u003e       /home/rog/go/src/reflect/type.go:2302 +0x36f\n\u003e   github.com/juju/juju/state.loadAllWatcherEntities()\n\u003e       /home/rog/src/go/src/github.com/juju/juju/state/allwatcher.go:1211 +0x25a\n\u003e   github.com/juju/juju/state.(*allModelWatcherStateBacking).loadAllWatcherEntitiesForModel()\n\u003e       /home/rog/src/go/src/github.com/juju/juju/state/allwatcher.go:1119 +0x177\n\u003e   github.com/juju/juju/state.(*allModelWatcherStateBacking).GetAll()\n\u003e       /home/rog/src/go/src/github.com/juju/juju/state/allwatcher.go:1105 +0xaa\n\u003e   github.com/juju/juju/state.(*storeManager).loop()\n\u003e       /home/rog/src/go/src/github.com/juju/juju/state/multiwatcher.go:221 +0x14c\n\u003e   github.com/juju/juju/state.newStoreManager.func1()\n\u003e       /home/rog/src/go/src/github.com/juju/juju/state/multiwatcher.go:198 +0x66\n\u003e\n\u003e Previous write at 0x00c420390c90 by goroutine 153:\n\u003e   runtime.mapassign1()\n\u003e       /home/rog/go/src/runtime/hashmap.go:442 +0x0\n\u003e   reflect.addReflectOff()\n\u003e       /home/rog/go/src/runtime/runtime1.go:523 +0x120\n\u003e   reflect.funcLayout()\n\u003e       /home/rog/go/src/reflect/type.go:3099 +0x8c1\n\u003e   reflect.Value.call()\n\u003e       /home/rog/go/src/reflect/value.go:399 +0x355\n\u003e   reflect.Value.Call()\n\u003e       /home/rog/go/src/reflect/value.go:302 +0xb3\n\u003e   github.com/juju/juju/rpc/rpcreflect.newMethod.func6()\n\u003e       /home/rog/src/go/src/github.com/juju/juju/rpc/rpcreflect/type.go:323 +0x125\n\u003e   github.com/juju/juju/apiserver.(*srvCaller).Call()\n\u003e       /home/rog/src/go/src/github.com/juju/juju/apiserver/root.go:126 +0x197\n\u003e   github.com/juju/juju/rpc.(*Conn).runRequest()\n\u003e       /home/rog/src/go/src/github.com/juju/juju/rpc/server.go:558 +0xc8\n\u003e ==================\n\u003e ==================\n\u003e WARNING: DATA RACE\n\u003e Write at 0x00c420390c60 by goroutine 147:\n\u003e   runtime.mapassign1()\n\u003e       /home/rog/go/src/runtime/hashmap.go:442 +0x0\n\u003e   reflect.addReflectOff()\n\u003e       /home/rog/go/src/runtime/runtime1.go:522 +0xde\n\u003e   reflect.SliceOf()\n\u003e       /home/rog/go/src/reflect/type.go:2302 +0x36f\n\u003e   github.com/juju/juju/state.loadAllWatcherEntities()\n\u003e       /home/rog/src/go/src/github.com/juju/juju/state/allwatcher.go:1211 +0x25a\n\u003e   github.com/juju/juju/state.(*allModelWatcherStateBacking).loadAllWatcherEntitiesForModel()\n\u003e       /home/rog/src/go/src/github.com/juju/juju/state/allwatcher.go:1119 +0x177\n\u003e   github.com/juju/juju/state.(*allModelWatcherStateBacking).GetAll()\n\u003e       /home/rog/src/go/src/github.com/juju/juju/state/allwatcher.go:1105 +0xaa\n\u003e   github.com/juju/juju/state.(*storeManager).loop()\n\u003e       /home/rog/src/go/src/github.com/juju/juju/state/multiwatcher.go:221 +0x14c\n\u003e   github.com/juju/juju/state.newStoreManager.func1()\n\u003e       /home/rog/src/go/src/github.com/juju/juju/state/multiwatcher.go:198 +0x66\n\u003e\n\u003e Previous write at 0x00c420390c60 by goroutine 153:\n\u003e   runtime.mapassign1()\n\u003e       /home/rog/go/src/runtime/hashmap.go:442 +0x0\n\u003e   reflect.addReflectOff()\n\u003e       /home/rog/go/src/runtime/runtime1.go:522 +0xde\n\u003e   reflect.funcLayout()\n\u003e       /home/rog/go/src/reflect/type.go:3099 +0x8c1\n\u003e   reflect.Value.call()\n\u003e       /home/rog/go/src/reflect/value.go:399 +0x355\n\u003e   reflect.Value.Call()\n\u003e       /home/rog/go/src/reflect/value.go:302 +0xb3\n\u003e   github.com/juju/juju/rpc/rpcreflect.newMethod.func6()\n\u003e       /home/rog/src/go/src/github.com/juju/juju/rpc/rpcreflect/type.go:323 +0x125\n\u003e   github.com/juju/juju/apiserver.(*srvCaller).Call()\n\u003e       /home/rog/src/go/src/github.com/juju/juju/apiserver/root.go:126 +0x197\n\u003e   github.com/juju/juju/rpc.(*Conn).runRequest()\n\u003e       /home/rog/src/go/src/github.com/juju/juju/rpc/server.go:558 +0xc8\n\u003e\n\u003e â€”\n\u003e You are receiving this because you are subscribed to this thread.\n\u003e Reply to this email directly or view it on GitHub\n\u003e \u003chttps://github.com/golang/go/issues/15832\u003e\n\u003e\n",
	"user": {
		"login": "davecheney",
		"id": 7171,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2016-05-25T08:52:01Z",
	"updated_at": "2016-05-25T08:52:01Z"
}
