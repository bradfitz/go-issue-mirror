{
	"id": 177265307,
	"number": 17127,
	"state": "closed",
	"title": "cmd/compile: slow compilation on generated code",
	"body": "### What version of Go are you using (`go version`)?\r\n\r\n```\r\n$ go version\r\ngo version go1.7 darwin/amd64\r\n```\r\n\r\n### What operating system and processor architecture are you using (`go env`)?\r\n\r\n```\r\n$ go env\r\nGOARCH=\"amd64\"\r\nGOBIN=\"\"\r\nGOEXE=\"\"\r\nGOHOSTARCH=\"amd64\"\r\nGOHOSTOS=\"darwin\"\r\nGOOS=\"darwin\"\r\nGOPATH=\"/Users/mschoch/go\"\r\nGORACE=\"\"\r\nGOROOT=\"/Users/mschoch/Documents/research/gosrc\"\r\nGOTOOLDIR=\"/Users/mschoch/Documents/research/gosrc/pkg/tool/darwin_amd64\"\r\nCC=\"clang\"\r\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -gno-record-gcc-switches -fno-common\"\r\nCXX=\"clang++\"\r\nCGO_ENABLED=\"1\"\r\n```\r\n\r\n### What did you do?\r\n\r\n```\r\n$ mkdir /tmp/gp\r\n$ export GOPATH=/tmp/gp\r\n$ go get -tags 'prod' github.com/blevesearch/segment\r\n```\r\n\r\n\r\n\r\n### What did you expect to see?\r\n\r\nUnder 1.6 this runs for several seconds, but compiles successfully in somewhat reasonable time.  It was always slow (due to very large generated source files which is why we protect this version behind the 'prod' build tag).\r\n\r\n\r\n### What did you see instead?\r\n\r\nAt this point it appears to hang for minutes.  Running `top` shows:\r\n\r\n```\r\nPID    COMMAND      %CPU TIME     #TH   #WQ  #PORT MEM    PURG   CMPRS  PGRP  PPID  STATE    BOOSTS         %CPU_ME %CPU_OTHRS UID  FAULTS    COW    MSGSENT   MSGRECV   SYSBSD    SYSMACH   CSW        PAGEINS IDLEW    POWE USER\r\n48037  compile      96.7 18:16.05 5/1   0    17    623M   0B     0B     48033 48033 running  *0[1]          0.00000 0.00000    501  160783    23     78        6         109603+   568       2165690+   10      129      96.7 mschoc\r\n```\r\n\r\nI have given it at least 10 minutes now.\r\n\r\n### Additional Info\r\n\r\nThis repo contains Go source generated by the Ragel state machine compiler.  The file in question `segment_words_prod.go` is 2.57 MB.  Direct link to this file: https://raw.githubusercontent.com/blevesearch/segment/master/segment_words_prod.go  \r\nThis particular version was generated with the `-G2` flags which.  The version produced for use without the `prod` build tag uses`-F1` continues to work fine in 1.7.",
	"user": {
		"login": "mschoch",
		"id": 298143,
		"type": "User",
		"site_admin": false
	},
	"comments": 8,
	"closed_at": "2016-10-04T19:36:15Z",
	"created_at": "2016-09-15T19:22:26Z",
	"updated_at": "2016-10-05T15:55:13Z",
	"milestone": {
		"id": 1709363,
		"number": 38,
		"title": "Go1.8"
	}
}
