{
	"id": 72446772,
	"number": 10656,
	"state": "closed",
	"title": "os/signal: TestStress failing on netbsd-amd64",
	"body": "I got this test failure when running all.bash on netbsd-amd64, during the os/signal test:\r\n\r\n```\r\nruntime: newstack sp=0xc208025ee0 stack=[0xc208025800, 0xc208026000]\r\n        morebuf={pc:0x427f4a sp:0xc208025ee8 lr:0x0}\r\n        sched={pc:0x40ca74 sp:0xc208025ee0 lr:0x0 ctxt:0x0}\r\nsyscall.Syscall(0x25, 0xc4a, 0x1e, 0x0, 0x0, 0x0, 0x0)\r\n        /home/bsiegert/go/src/syscall/asm_netbsd_amd64.s:40 +0x5b\r\nsyscall.Kill(0xc4a, 0x1e, 0x0, 0x0)\r\n        /home/bsiegert/go/src/syscall/zsyscall_netbsd_amd64.go:655 +0x52\r\nos/signal.TestStress.func2(0xc208016600, 0xc208016660)\r\n        /home/bsiegert/go/src/os/signal/signal_test.go:96 +0x90\r\ncreated by os/signal.TestStress\r\n        /home/bsiegert/go/src/os/signal/signal_test.go:101 +0x111\r\nfatal error: runtime: stack split at bad time\r\n\r\nruntime stack:\r\nruntime.throw(0x5dd510, 0x20)\r\n        /home/bsiegert/go/src/runtime/panic.go:543 +0x96\r\nruntime.newstack()\r\n        /home/bsiegert/go/src/runtime/stack1.go:654 +0x5a0\r\nruntime.morestack()\r\n        /home/bsiegert/go/src/runtime/asm_amd64.s:330 +0x82\r\n\r\ngoroutine 10 [syscall]:\r\nruntime.printlock()\r\n        /home/bsiegert/go/src/runtime/print1.go:37 +0x6a fp=0xc208025f00 sp=0xc208025ee8\r\nruntime.throw(0x5deb10, 0x2d)\r\n        /home/bsiegert/go/src/runtime/panic.go:537 +0x9 fp=0xc208025f18 sp=0xc208025f00\r\nruntime.exitsyscall(0x486072)\r\n        /home/bsiegert/go/src/runtime/proc1.go:1953 +0x65 fp=0xc208025f58 sp=0xc208025f18\r\nsyscall.Syscall(0x25, 0xc4a, 0x1e, 0x0, 0x0, 0x0, 0x0)\r\n        /home/bsiegert/go/src/syscall/asm_netbsd_amd64.s:40 +0x5b fp=0xc208025f60 sp=0xc208025f58\r\nsyscall.Kill(0xc4a, 0x1e, 0x0, 0x0)\r\n        /home/bsiegert/go/src/syscall/zsyscall_netbsd_amd64.go:655 +0x52 fp=0xc208025fa0 sp=0xc208025f60\r\nos/signal.TestStress.func2(0xc208016600, 0xc208016660)\r\n        /home/bsiegert/go/src/os/signal/signal_test.go:96 +0x90 fp=0xc208025fd0 sp=0xc208025fa0\r\nruntime.goexit()\r\n        /home/bsiegert/go/src/runtime/asm_amd64.s:1670 +0x1 fp=0xc208025fd8 sp=0xc208025fd0\r\ncreated by os/signal.TestStress\r\n        /home/bsiegert/go/src/os/signal/signal_test.go:101 +0x111\r\n\r\ngoroutine 1 [chan receive]:\r\ntesting.RunTests(0x5fbd30, 0x689fe0, 0x6, 0x6, 0x7f7ff7fc0001)\r\n        /home/bsiegert/go/src/testing/testing.go:561 +0xa6b\r\ntesting.(*M).Run(0xc208039f38, 0x24)\r\n        /home/bsiegert/go/src/testing/testing.go:490 +0x73\r\nmain.main()\r\n        os/signal/_test/_testmain.go:66 +0x119\r\n\r\ngoroutine 5 [syscall]:\r\nos/signal.loop()\r\n        /home/bsiegert/go/src/os/signal/signal_unix.go:22 +0x1f\r\ncreated by os/signal.init.1\r\n        /home/bsiegert/go/src/os/signal/signal_unix.go:28 +0x3f\r\n\r\ngoroutine 8 [chan receive]:\r\nos/signal.TestStress(0xc20807c120)\r\n        /home/bsiegert/go/src/os/signal/signal_test.go:105 +0x173\r\ntesting.tRunner(0xc20807c120, 0x689ff8)\r\n        /home/bsiegert/go/src/testing/testing.go:452 +0x9c\r\ncreated by testing.RunTests\r\n        /home/bsiegert/go/src/testing/testing.go:560 +0xa2b\r\nFAIL    os/signal       0.183s\r\n```\r\n\r\nChanging to the os/signal dir and running `go test` results in\r\n\r\n```\r\nedamame$ go test\r\nruntime: gp: gp=panic during panic\r\n\r\ngoroutine 0 [idle]:\r\nruntime.startpanic_m()\r\n        /home/bsiegert/go/src/runtime/panic1.go:66 +0x154\r\nruntime.systemstack(0x5fc188)\r\n        /home/bsiegert/go/src/runtime/asm_amd64.s:278 +0xab\r\nruntime.startpanic()\r\n        /home/bsiegert/go/src/runtime/panic.go:521 +0x14\r\nruntime.sighandler(0x5, 0xc208083c60, 0xc208083ce0, 0xc208000f00)\r\n        /home/bsiegert/go/src/runtime/signal_amd64x.go:142 +0x2e3\r\nruntime.sigtramp(0x100000005, 0x0, 0x0, 0x1, 0x0, 0xfffffe811224faa0, 0xffffffff808428bf, 0xcc000, 0x300000000, 0xfffffe826e69a848, ...)\r\n        /home/bsiegert/go/src/runtime/sys_netbsd_amd64.s:256 +0x56\r\nruntime.sigreturn_tramp(0x0, 0x0, 0x1, 0x0, 0xfffffe811224faa0, 0xffffffff808428bf, 0xcc000, 0x300000000, 0xfffffe826e69a848, 0xc4000, ...)\r\n        /home/bsiegert/go/src/runtime/sys_netbsd_amd64.s:211\r\n\r\ngoroutine 10 [syscall]:\r\nsyscall.Syscall(0x25, 0x19ae, 0x1e, 0x0, 0x0, 0x428e34, 0x5fc010)\r\n        /home/bsiegert/go/src/syscall/asm_netbsd_amd64.s:21 +0x5 fp=0xc208025f60 sp=0xc208025f58\r\nsyscall.Kill(0x19ae, 0x1e, 0x0, 0x0)\r\n        /home/bsiegert/go/src/syscall/zsyscall_netbsd_amd64.go:655 +0x52 fp=0xc208025fa0 sp=0xc208025f60\r\nos/signal.TestStress.func2(0xc208010600, 0xc208010660)\r\n        /home/bsiegert/go/src/os/signal/signal_test.go:97 +0x95 fp=0xc208025fd0 sp=0xc208025fa0\r\nruntime.goexit()\r\n        /home/bsiegert/go/src/runtime/asm_amd64.s:1670 +0x1 fp=0xc208025fd8 sp=0xc208025fd0\r\ncreated by os/signal.TestStress\r\n        /home/bsiegert/go/src/os/signal/signal_test.go:101 +0x111\r\n\r\ngoroutine 1 [chan receive]:\r\ntesting.RunTests(0x5fbd30, 0x689fe0, 0x6, 0x6, 0x7f7ff7fc0001)\r\n        /home/bsiegert/go/src/testing/testing.go:561 +0xa6b\r\ntesting.(*M).Run(0xc208039f38, 0x24)\r\n        /home/bsiegert/go/src/testing/testing.go:490 +0x73\r\nmain.main()\r\n        os/signal/_test/_testmain.go:66 +0x119\r\n\r\ngoroutine 5 [syscall]:\r\nos/signal.loop()\r\n        /home/bsiegert/go/src/os/signal/signal_unix.go:22 +0x1f\r\ncreated by os/signal.init.1\r\n        /home/bsiegert/go/src/os/signal/signal_unix.go:28 +0x3f\r\n\r\ngoroutine 8 [sleep]:\r\ntime.Sleep(0xb2d05e00)\r\n        /home/bsiegert/go/src/runtime/time.go:59 +0xfc\r\nos/signal.TestStress(0xc20807a120)\r\n        /home/bsiegert/go/src/os/signal/signal_test.go:102 +0x11f\r\ntesting.tRunner(0xc20807a120, 0x689ff8)\r\n        /home/bsiegert/go/src/testing/testing.go:452 +0x9c\r\ncreated by testing.RunTests\r\n        /home/bsiegert/go/src/testing/testing.go:560 +0xa2b\r\n\r\ngoroutine 9 [runnable]:\r\nos/signal.TestStress.func1(0xc208010600, 0xc208010660)\r\n        /home/bsiegert/go/src/os/signal/signal_test.go:81 +0x22e\r\ncreated by os/signal.TestStress\r\n        /home/bsiegert/go/src/os/signal/signal_test.go:88 +0xe4\r\nexit status 2\r\nFAIL    os/signal       0.048s\r\n```\r\n\r\nRunning it a second time just after that, it hangs consuming 100% CPU and not reacting to signals (hah!).\r\n\r\nAny ideas?",
	"user": {
		"login": "bsiegert",
		"id": 866330,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"comments": 4,
	"closed_at": "2015-07-15T03:52:09Z",
	"created_at": "2015-05-01T14:47:34Z",
	"updated_at": "2016-07-18T19:48:06Z",
	"milestone": {
		"id": 905105,
		"number": 1,
		"title": "Go1.5"
	}
}
