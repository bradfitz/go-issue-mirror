{
	"id": 51282841,
	"number": 4928,
	"state": "closed",
	"title": "log/syslog: test panics on freebsd-386",
	"body": "\u003cpre\u003eTo reproduce:\n\nwhile go test log/syslog; do echo ok; done\n\nEventually (after a few dozen iterations) you'll see a panic (trace is below).\n\nLooks to be caused by TestConcurrentReconnect.\n\nThe weird part is that the panic is \u0026quot;send on closed channel\u0026quot;, but by my\nreading of the code any sends to the \u0026quot;done\u0026quot; channel must happen before the\nchannel is closed, because the call to close happens right after a waitgroup.Wait(), and\nall the sends happen before the various calls to waitgroup.Done(). \n\nWhy only on freebsd-386? Weird.\n\npanic: runtime error: send on closed channel\n\ngoroutine 49 [running]:\nlog/syslog.func·001(0x38c5b280, 0x38cd8630)\n\t/home/gopher/go/src/pkg/log/syslog/syslog_test.go:67 +0x151\ncreated by log/syslog.runStreamSyslog\n\t/home/gopher/go/src/pkg/log/syslog/syslog_test.go:70 +0x131\n\ngoroutine 1 [chan receive]:\ntesting.RunTests(0x8163ac0, 0x8218d10, 0x8, 0x8, 0x1, ...)\n\t/home/gopher/go/src/pkg/testing/testing.go:427 +0x69c\ntesting.Main(0x8163ac0, 0x8218d10, 0x8, 0x8, 0x821ba00, ...)\n\t/home/gopher/go/src/pkg/testing/testing.go:358 +0x66\nmain.main()\n\tlog/syslog/_test/_testmain.go:57 +0x7e\n\ngoroutine 0 [syscall]:\n\ngoroutine 34 [syscall]:\nsyscall.Syscall()\n\t/home/gopher/go/src/pkg/syscall/asm_freebsd_386.s:0 +0x5\nsyscall.Unlink(0x38cacdc0, 0x18, 0x0, 0x0)\n\t/home/gopher/go/src/pkg/syscall/bpf_bsd.go:0 +0x7d\nos.Remove(0x38cacdc0, 0x18, 0x38cacd20, 0x18)\n\t/home/gopher/go/src/pkg/os/file_unix.go:235 +0x2e\nlog/syslog.TestConcurrentReconnect(0x38ca7c00)\n\t/home/gopher/go/src/pkg/log/syslog/syslog_test.go:334 +0x267\ntesting.tRunner(0x38ca7c00, 0x8218d64)\n\t/home/gopher/go/src/pkg/testing/testing.go:346 +0x84\ncreated by testing.RunTests\n\t/home/gopher/go/src/pkg/testing/testing.go:426 +0x681\n\ngoroutine 4 [syscall]:\nsyscall.Syscall6()\n\t/home/gopher/go/src/pkg/syscall/asm_freebsd_386.s:0 +0x5\nsyscall.kevent(0x6, 0x0, 0x0, 0x38c71004, 0xa, ...)\n\t/home/gopher/go/src/pkg/syscall/bpf_bsd.go:0 +0x66\nsyscall.Kevent(0x6, 0x0, 0x0, 0x0, 0x38c71004, ...)\n\t/home/gopher/go/src/pkg/syscall/bpf_bsd.go:0 +0x76\nnet.(*pollster).WaitFD(0x38c71000, 0x38c5a860, 0x1cc4e26, 0x0, 0x0, ...)\n\t/home/gopher/go/src/pkg/net/fd_bsd.go:98 +0x193\nnet.(*pollServer).Run(0x38c5a860)\n\t/home/gopher/go/src/pkg/net/fd_unix.go:212 +0x135\ncreated by net.newPollServer\n\t/home/gopher/go/src/pkg/net/newpollserver_unix.go:33 +0x266\n\ngoroutine 5 [chan receive]:\nnet.(*pollServer).WaitRead(0x38c5a860, 0x38c5c100, 0x38c5a900, 0x23)\n\t/home/gopher/go/src/pkg/net/fd_unix.go:244 +0x5a\nnet.(*netFD).accept(0x38c5c100, 0x8163b40, 0x0, 0x38c5a900, 0x23, ...)\n\t/home/gopher/go/src/pkg/net/fd_unix.go:631 +0x11e\nnet.(*UnixListener).AcceptUnix(0x38c6c130, 0x80719d1, 0x58c11f88, 0x80719d1)\n\t/home/gopher/go/src/pkg/net/unixsock_posix.go:282 +0x3f\nnet.(*UnixListener).Accept(0x38c6c130, 0x0, 0x0, 0x0, 0x0, ...)\n\t/home/gopher/go/src/pkg/net/unixsock_posix.go:293 +0x46\nlog/syslog.runStreamSyslog(0x38c5a940, 0x38c6c130, 0x38c57420, 0x38c5a800)\n\t/home/gopher/go/src/pkg/log/syslog/syslog_test.go:53 +0x5e\ncreated by log/syslog.startServer\n\t/home/gopher/go/src/pkg/log/syslog/syslog_test.go:109 +0x3dc\n\ngoroutine 9 [chan receive]:\nnet.(*pollServer).WaitRead(0x38c5a860, 0x38c9d480, 0x38c5a900, 0x23)\n\t/home/gopher/go/src/pkg/net/fd_unix.go:244 +0x5a\nnet.(*netFD).accept(0x38c9d480, 0x8163b30, 0x0, 0x38c5a900, 0x23, ...)\n\t/home/gopher/go/src/pkg/net/fd_unix.go:631 +0x11e\nnet.(*TCPListener).AcceptTCP(0x38c06a60, 0x80719d1, 0x0, 0x0)\n\t/home/gopher/go/src/pkg/net/tcpsock_posix.go:232 +0x4f\nnet.(*TCPListener).Accept(0x38c06a60, 0x0, 0x0, 0x0, 0x0, ...)\n\t/home/gopher/go/src/pkg/net/tcpsock_posix.go:242 +0x46\nlog/syslog.runStreamSyslog(0x38c9a7a0, 0x38c06a60, 0x38c577b0, 0x38c9a6a0)\n\t/home/gopher/go/src/pkg/log/syslog/syslog_test.go:53 +0x5e\ncreated by log/syslog.startServer\n\t/home/gopher/go/src/pkg/log/syslog/syslog_test.go:109 +0x3dc\n\ngoroutine 12 [chan receive]:\nnet.(*pollServer).WaitRead(0x38c5a860, 0x38c9d580, 0x38c5a900, 0x23)\n\t/home/gopher/go/src/pkg/net/fd_unix.go:244 +0x5a\nnet.(*netFD).accept(0x38c9d580, 0x8163b40, 0x0, 0x38c5a900, 0x23, ...)\n\t/home/gopher/go/src/pkg/net/fd_unix.go:631 +0x11e\nnet.(*UnixListener).AcceptUnix(0x38c6c5c0, 0x80719d1, 0x58d25f88, 0x80719d1)\n\t/home/gopher/go/src/pkg/net/unixsock_posix.go:282 +0x3f\nnet.(*UnixListener).Accept(0x38c6c5c0, 0x0, 0x0, 0x0, 0x0, ...)\n\t/home/gopher/go/src/pkg/net/unixsock_posix.go:293 +0x46\nlog/syslog.runStreamSyslog(0x38c5a940, 0x38c6c5c0, 0x38c57840, 0x38c9a920)\n\t/home/gopher/go/src/pkg/log/syslog/syslog_test.go:53 +0x5e\ncreated by log/syslog.startServer\n\t/home/gopher/go/src/pkg/log/syslog/syslog_test.go:109 +0x3dc\n\ngoroutine 23 [chan receive]:\nnet.(*pollServer).WaitRead(0x38c5a860, 0x38c9df80, 0x38c5a900, 0x23)\n\t/home/gopher/go/src/pkg/net/fd_unix.go:244 +0x5a\nnet.(*netFD).ReadFrom(0x38c9df80, 0x38cb1000, 0x1000, 0x1000, 0x0, ...)\n\t/home/gopher/go/src/pkg/net/fd_unix.go:471 +0x296\nnet.(*UDPConn).ReadFromUDP(0x38cae290, 0x38cb1000, 0x1000, 0x1000, 0x80d7b0e, ...)\n\t/home/gopher/go/src/pkg/net/udpsock_posix.go:72 +0xc7\nnet.(*UDPConn).ReadFrom(0x38cae290, 0x38cb1000, 0x1000, 0x1000, 0x821c0a8, ...)\n\t/home/gopher/go/src/pkg/net/udpsock_posix.go:87 +0xb4\nlog/syslog.runPktSyslog(0x38c57750, 0x38cae290, 0x38c57a80)\n\t/home/gopher/go/src/pkg/log/syslog/syslog_test.go:31 +0x102\nlog/syslog.func·002()\n\t/home/gopher/go/src/pkg/log/syslog/syslog_test.go:101 +0x5b\ncreated by log/syslog.startServer\n\t/home/gopher/go/src/pkg/log/syslog/syslog_test.go:102 +0x271\n\ngoroutine 14 [chan receive]:\nnet.(*pollServer).WaitRead(0x38c5a860, 0x38ca8080, 0x38c5a900, 0x23)\n\t/home/gopher/go/src/pkg/net/fd_unix.go:244 +0x5a\nnet.(*netFD).accept(0x38ca8080, 0x8163b40, 0x0, 0x38c5a900, 0x23, ...)\n\t/home/gopher/go/src/pkg/net/fd_unix.go:631 +0x11e\nnet.(*UnixListener).AcceptUnix(0x38c6c630, 0x813275c, 0x1, 0x1)\n\t/home/gopher/go/src/pkg/net/unixsock_posix.go:282 +0x3f\nnet.(*UnixListener).Accept(0x38c6c630, 0x0, 0x0, 0x0, 0x0, ...)\n\t/home/gopher/go/src/pkg/net/unixsock_posix.go:293 +0x46\nlog/syslog.runStreamSyslog(0x38c5a940, 0x38c6c630, 0x38c57840, 0x38c9ac60)\n\t/home/gopher/go/src/pkg/log/syslog/syslog_test.go:53 +0x5e\ncreated by log/syslog.startServer\n\t/home/gopher/go/src/pkg/log/syslog/syslog_test.go:109 +0x3dc\n\ngoroutine 50 [runnable]:\nsyscall.Syscall()\n\t/home/gopher/go/src/pkg/syscall/asm_freebsd_386.s:0 +0x48\nsyscall.Close(0xf, 0x0, 0x0)\n\t/home/gopher/go/src/pkg/syscall/bpf_bsd.go:0 +0x4e\nos.(*file).close(0x38c5af60, 0x0, 0x0)\n\t/home/gopher/go/src/pkg/os/file_unix.go:107 +0x4d\n\ngoroutine 48 [runnable]:\nsyscall.Syscall()\n\t/home/gopher/go/src/pkg/syscall/asm_freebsd_386.s:0 +0x48\nsyscall.read(0x1b, 0x38ce5000, 0x1000, 0x1000, 0xe, ...)\n\t/home/gopher/go/src/pkg/syscall/bpf_bsd.go:0 +0x58\nsyscall.Read(0x1b, 0x38ce5000, 0x1000, 0x1000, 0x12c, ...)\n\t/home/gopher/go/src/pkg/syscall/bpf_bsd.go:0 +0x4e\nnet.(*netFD).Read(0x38ca8200, 0x38ce5000, 0x1000, 0x1000, 0x0, ...)\n\t/home/gopher/go/src/pkg/net/fd_unix.go:437 +0x1dd\nnet.(*conn).Read(0x38cd8610, 0x38ce5000, 0x1000, 0x1000, 0x8050f2e, ...)\n\t/home/gopher/go/src/pkg/net/net.go:123 +0xa6\ncreated by log/syslog.runStreamSyslog\n\t/home/gopher/go/src/pkg/log/syslog/syslog_test.go:70 +0x131\n\ngoroutine 35 [runnable]:\nsyscall.Syscall()\n\t/home/gopher/go/src/pkg/syscall/asm_freebsd_386.s:0 +0x48\nsyscall.accept(0x10, 0x38ce6000, 0x38cae000, 0x1, 0x0, ...)\n\t/home/gopher/go/src/pkg/syscall/bpf_bsd.go:0 +0x4e\nsyscall.Accept(0x10, 0x38c8e780, 0x0, 0x0, 0x0, ...)\n\t/home/gopher/go/src/pkg/syscall/bpf_bsd.go:0 +0x7c\nnet.accept(0x10, 0x38c5a800, 0x0, 0x0, 0x0, ...)\n\t/home/gopher/go/src/pkg/net/sys_cloexec.go:42 +0x26\nnet.(*netFD).accept(0x38c8e780, 0x8163b40, 0x0, 0x0, 0x0, ...)\n\t/home/gopher/go/src/pkg/net/fd_unix.go:628 +0x91\nnet.(*UnixListener).AcceptUnix(0x38c6c3c0, 0x80719d1, 0x58d1af88, 0x80719d1)\n\t/home/gopher/go/src/pkg/net/unixsock_posix.go:282 +0x3f\nnet.(*UnixListener).Accept(0x38c6c3c0, 0x0, 0x0, 0x0, 0x0, ...)\n\t/home/gopher/go/src/pkg/net/unixsock_posix.go:293 +0x46\nlog/syslog.runStreamSyslog(0x38c5a940, 0x38c6c3c0, 0x38c57cc0, 0x38cacda0)\n\t/home/gopher/go/src/pkg/log/syslog/syslog_test.go:53 +0x5e\ncreated by log/syslog.startServer\n\t/home/gopher/go/src/pkg/log/syslog/syslog_test.go:109 +0x3dc\nFAIL\tlog/syslog\t2.320s\u003c/pre\u003e",
	"user": {
		"login": "adg",
		"id": 8446613,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"comments": 3,
	"closed_at": "2014-12-08T10:26:13Z",
	"created_at": "2013-02-27T03:09:49Z",
	"updated_at": "2016-06-24T22:34:16Z",
	"milestone": {
		"id": 1067199,
		"number": 11,
		"title": "Go1.1"
	}
}
