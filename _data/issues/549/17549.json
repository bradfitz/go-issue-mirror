{
	"id": 184606828,
	"number": 17549,
	"state": "open",
	"title": "net: domain name length checks should use wire format",
	"body": "[RFC 1035](https://tools.ietf.org/html/rfc1035#section-2.3.4) specifies a limit on domain names of 255 octets in _wire format_ (a sequence of length-preceded labels ending with the zero-length root label), and even the willful [RFC 6762 Multicast DNS](https://tools.ietf.org/html/rfc6762#appendix-C) tops out at 256 wire-format octets. But Go's `IsDomainName` allows up to 255 _presentation format_ octets, exceeding both. There is also a separate issue of `IsDomainName` rejecting wildcard domains, but that's just #1168 and #12421.\r\n\r\n### What version of Go are you using (`go version`)?\r\ngo1.7.1\r\n\r\n### What operating system and processor architecture are you using (`go env`)?\r\n\u003cdetails\u003e\u003csummary\u003elinux/amd64\u003c/summary\u003e\r\nGOARCH=\"amd64\"\r\nGOHOSTARCH=\"amd64\"\r\nGOHOSTOS=\"linux\"\r\nGOOS=\"linux\"\r\nCC=\"gcc\"\r\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build693750050=/tmp/go-build -gno-record-gcc-switches\"\r\nCXX=\"g++\"\r\nCGO_ENABLED=\"1\"\r\n\u003c/details\u003e\r\n\r\n### What did you do?\r\n\u003cdetails\u003e\u003csummary\u003equery long domain names\u003c/summary\u003e\r\n```go\r\npackage main\r\n\r\nimport (\r\n    \"fmt\"\r\n    \"net\"\r\n    \"strings\"\r\n    \"time\"\r\n)\r\n\r\nfunc main() {\r\n    long_label := strings.Repeat(\"l\", 50)\r\n    long_domain := strings.Repeat(long_label+\".\", 5) + \"golang.org\"\r\n    length := len(long_domain)\r\n    domains := []string{\r\n        // valid domain name, but will be falsely rejected\r\n        \"*.golang.org\",\r\n\r\n        // maximum wire-format length per RFC 1035\r\n        long_domain[length-253:],\r\n\r\n        // too long for public Internet, but will issue and time out\r\n        long_domain[length-254:],\r\n\r\n        // too long for even RFC 6762 Multicast DNS, but will issue and time out\r\n        long_domain[length-255:],\r\n\r\n        // properly rejected as too long\r\n        long_domain[length-256:],\r\n    }\r\n    for _, domain := range domains {\r\n        start := time.Now()\r\n        fmt.Printf(\"\\n%d presentation-format octets: %s\\n\", len(domain), domain)\r\n        fmt.Println(net.LookupHost(domain))\r\n        fmt.Println(time.Since(start))\r\n    }\r\n}\r\n```\r\n\u003c/details\u003e\r\n\r\n### What did you expect to see?\r\n\u003cdetails\u003e\u003csummary\u003eQNAMEs longer than 255 wire-format bytes rejected\u003c/summary\u003e\r\n```\r\n12 presentation-format octets: *.golang.org\r\n[173.194.204.141 2607:f8b0:400d:c07::8d] \u003cnil\u003e\r\n~50ms\r\n\r\n253 presentation-format octets: llllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.golang.org\r\n[173.194.204.141 2607:f8b0:400d:c07::8d] \u003cnil\u003e\r\n~50ms\r\n\r\n254 presentation-format octets: lllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.golang.org\r\n[] lookup lllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.golang.org:\r\ninvalid domain name\r\n\u003c100µs\r\n\r\n255 presentation-format octets: llllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.golang.org\r\n[] lookup llllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.golang.org:\r\ninvalid domain name\r\n\u003c100µs\r\n\r\n256 presentation-format octets: lllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.golang.org\r\n[] lookup lllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.golang.org:\r\ninvalid domain name\r\n\u003c100µs\r\n```\r\n\u003c/details\u003e\r\n\r\n### What did you see instead?\r\n\u003cdetails\u003e\u003csummary\u003enames longer than 255 wire-format bytes were queried and timed out after 20 seconds\u003c/summary\u003e\r\n```\r\n12 presentation-format octets: *.golang.org\r\n[] lookup *.golang.org: invalid domain name\r\n99.551µs\r\n\r\n253 presentation-format octets: llllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.golang.org\r\n[173.194.204.141 2607:f8b0:400d:c07::8d] \u003cnil\u003e\r\n52.282064ms\r\n\r\n254 presentation-format octets: lllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.golang.org\r\n[] lookup lllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.golang.org on 8.8.8.8:53:\r\nread udp 172.19.129.66:49106-\u003e8.8.8.8:53: i/o timeout\r\n20.001165244s\r\n\r\n255 presentation-format octets: llllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.golang.org\r\n[] lookup llllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.golang.org on 8.8.8.8:53:\r\nread udp 172.19.129.66:51603-\u003e8.8.8.8:53: i/o timeout\r\n20.001086372s\r\n\r\n256 presentation-format octets: lllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.golang.org\r\n[] lookup lllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.llllllllllllllllllllllllllllllllllllllllllllllllll.golang.org:\r\ninvalid domain name\r\n60.555µs\r\n```\r\n\u003c/details\u003e\r\n",
	"user": {
		"login": "gibson042",
		"id": 1199584,
		"type": "User",
		"site_admin": false
	},
	"comments": 1,
	"created_at": "2016-10-22T04:16:51Z",
	"updated_at": "2016-10-22T05:48:33Z",
	"milestone": {
		"id": 1709363,
		"number": 38,
		"title": "Go1.8"
	}
}
