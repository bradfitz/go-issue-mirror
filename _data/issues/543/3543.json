{
	"id": 51280773,
	"number": 3543,
	"state": "closed",
	"title": "windows programs compiled with cgo do not set exception handler",
	"body": "\u003cpre\u003eWhat steps will reproduce the problem?\n1.  Compile and run the attached code on Windows 7 or Windows Server 2008 R2.\n2.  The entire Go process will crash when accessing the URL \u003ca href=\"http://localhost:8181/Test\"\u003ehttp://localhost:8181/Test\u003c/a\u003e\n\nWhat is the expected output?\nThe expected output is that a stack trace will be printed from the panic and that the\ngoroutine serving the request will fail but that the entire web server process will not\ncrash.\n\nWhat do you see instead?\nThe web server process crashes.\n\nWhich compiler are you using (5g, 6g, 8g, gccgo)?\n6g\n\nWhich operating system are you using?\nTested on Windows 7 X64, Windows Server 2008 R2 and the web server process crashes. \nTested on Ubuntu X64 and the web server process does not crash and the panic stack trace\nis printed correctly.\n\nWhich version are you using?  (run 'go version')\ngo version weekly.2012-03-27 +99292bad0d6d\n\nPlease provide any additional information below.\nBelow is an output from GDB debugging the program on Windows.  As you can see, the first\ntime the URL was accessed, the program did not crash but correctly printed the stack\ntrace.  However, the second time the URL was accessed, GDB received 2 seg faults and the\nentire program crashed.  The majority of the time the web server process crashes every\ntime.  \nThe problem seems to occur less often if I do not import the mgodbc.go file.  Also, I\nhave been unable to reproduce the problem outside of a web server process.\n\n(gdb) r\nStarting program: C:\\Users\\lmauldin\\Documents\\Eclipse\\TestWebCrash\\bin\\main.exe\n\n[New Thread 4436.0x25f0]\n[New Thread 4436.0x1380]\n[New Thread 4436.0x1e24]\n[New Thread 4436.0xea0]\n[New Thread 4436.0x1c30]\n\nProgram received signal SIGSEGV, Segmentation fault.\nmain.WebTest ()\n    at C:/Users/lmauldin/Documents/Eclipse/TestWebCrash/src/main.go:22\n22              _ = *s\n(gdb) c\nContinuing.\n[New Thread 4436.0x1844]\n2012/04/17 18:24:48 http: panic serving 127.0.0.1:52340: runtime error: invalid\nmemory address or nil pointer dereference\nc:/GoBuild/go/src/pkg/net/http/server.go:576 (0x43f446)\n        _func_003: buf.Write(debug.Stack())\nc:/GoBuild/go/src/pkg/runtime/proc.c:1443 (0x411086)\n        panic: reflect-+call(d-\u0026gt;fn, d-\u0026gt;args, d-\u0026gt;siz);\nc:/GoBuild/go/src/pkg/runtime/runtime.c:129 (0x411bee)\n        panicstring: runtime-+panic(err);\nc:/GoBuild/go/src/pkg/runtime/thread_windows.c:276 (0x414bd5)\n        sigpanic: runtime-+panicstring(\u0026quot;invalid memory address or nil pointer de\nreference\u0026quot;);\nC:/Users/lmauldin/Documents/Eclipse/TestWebCrash/src/main.go:22 (0x401144)\n        WebTest: _ = *s\nc:/GoBuild/go/src/pkg/net/http/server.go:690 (0x4333da)\n        HandlerFunc.ServeHTTP: f(w, r)\nc:/GoBuild/go/src/pkg/net/http/server.go:926 (0x43427d)\n        (*ServeMux).ServeHTTP: mux.handler(r).ServeHTTP(w, r)\nc:/GoBuild/go/src/pkg/net/http/server.go:656 (0x4331e7)\n        (*conn).serve: handler.ServeHTTP(w, w.req)\nc:/GoBuild/go/src/pkg/runtime/proc.c:271 (0x40efc2)\n        goexit: runtime-+goexit(void)\n\nProgram received signal SIGSEGV, Segmentation fault.\n[Switching to Thread 4436.0x1c30]\nmain.WebTest ()\n    at C:/Users/lmauldin/Documents/Eclipse/TestWebCrash/src/main.go:22\n22              _ = *s\n(gdb) c\nContinuing.\n\nProgram received signal SIGSEGV, Segmentation fault.\nmain.WebTest ()\n    at C:/Users/lmauldin/Documents/Eclipse/TestWebCrash/src/main.go:22\n22              _ = *s\n(gdb) c\nContinuing.\n[Inferior 1 (process 4436) exited with code 030000000005]\n(gdb) bt\nNo stack.\n(gdb)\u003c/pre\u003e\n\n\n\n\n\nAttachments:\n\n1. \u003ca href=\"https://storage.googleapis.com/go-attachment/3543/0/main.go\"\u003emain.go\u003c/a\u003e (356 bytes)\n1. \u003ca href=\"https://storage.googleapis.com/go-attachment/3543/0/config.go\"\u003econfig.go\u003c/a\u003e (77 bytes)\n1. \u003ca href=\"https://storage.googleapis.com/go-attachment/3543/0/mgodbc.go\"\u003emgodbc.go\u003c/a\u003e (24860 bytes)",
	"user": {
		"login": "LukeMauldin",
		"id": 1440808,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"comments": 9,
	"closed_at": "2014-12-08T10:18:37Z",
	"created_at": "2012-04-18T00:04:54Z",
	"updated_at": "2016-06-24T22:18:02Z"
}
