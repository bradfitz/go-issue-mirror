{
	"id": 66091262,
	"body": "\u003ca id=\"c3\"\u003e\u003c/a\u003eComment 3:\n\n\u003cpre\u003eYes, that would have been useful, wouldn't it?\n\n(trusty-amd64)mwhudson@narsil:juju-core-1.17.2$ ~/go/bin/go install -compiler gccgo -x\nbin\nWORK=/tmp/go-build895530139\nmkdir -p $WORK/dep/_obj/\nmkdir -p $WORK/\ncd /home/mwhudson/src/juju-core-1.17.2/src/dep\ngccgo -I $WORK -c -g -m64 -fgo-pkgpath=dep\n-fgo-relative-import-path=_/home/mwhudson/src/juju-core-1.17.2/src/dep -o\n$WORK/dep/_obj/dep.o ./dep.go\nar cru $WORK/libdep.a $WORK/dep/_obj/dep.o\nmkdir -p /home/mwhudson/src/juju-core-1.17.2/pkg/gccgo_linux_amd64/\ncp $WORK/libdep.a /home/mwhudson/src/juju-core-1.17.2/pkg/gccgo_linux_amd64/libdep.a\nmkdir -p $WORK/bin/_obj/\nmkdir -p $WORK/bin/_obj/exe/\ncd /home/mwhudson/src/juju-core-1.17.2/src/bin\ngccgo -I $WORK -I /home/mwhudson/src/juju-core-1.17.2/pkg/gccgo_linux_amd64 -c -g -m64\n-fgo-relative-import-path=_/home/mwhudson/src/juju-core-1.17.2/src/bin -o\n$WORK/bin/_obj/main.o ./bin.go\nar cru $WORK/libbin.a $WORK/bin/_obj/main.o\ncd .\ngccgo -o $WORK/bin/_obj/exe/a.out $WORK/bin/_obj/main.o -Wl,-( -m64 $WORK/libdep.a\n/home/mwhudson/src/juju-core-1.17.2/pkg/gccgo_linux_amd64/libdep.a -Wl,-)\n# bin\ngccgo: error: $WORK/libdep.a: No such file or directory\n\nSo it's not that the file doesn't get copied out of the working directory, or even that\nthe installed file is not passed to the link command, it's that the now-deleted\ntemporary location is _also_ passed to the link command.  This is because the target of\nall actions is passed to the link command, even when there is a build and an install\naction for the same library.  This complete hack:\n\ndiff -r 16f0b6d4f8ff src/cmd/go/build.go\n--- a/src/cmd/go/build.go       Tue Feb 11 09:34:43 2014 +0100\n+++ b/src/cmd/go/build.go       Wed Feb 12 09:04:54 2014 +1300\n@@ -1013,6 +1013,7 @@\n        if !buildWork {\n                defer os.RemoveAll(a1.objdir)\n                defer os.Remove(a1.target)\n+               defer func () { a1.target = a.target }()\n        }\n \n        if a.p.usesSwig() {\n\nmakes things work but doesn't really seem like the right fix.  I don't know if there is\na way to tell from an  \"building\" action object if it is followed by an \"installation\"\naction object or if a way needs to be added or ... something else.  BTW, I think this\nwould fail even with -work if /tmp was on the same file system as GOPATH because then\nthe .a file would be moved, not copied...\u003c/pre\u003e",
	"user": {
		"login": "mwhudson",
		"id": 672022,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2014-02-11T20:11:26Z",
	"updated_at": "2014-12-08T10:40:40Z"
}
