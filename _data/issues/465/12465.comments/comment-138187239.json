{
	"id": 138187239,
	"body": "Hi, @ianlancetaylor\r\n\r\nThank you very much for your comment.\r\n\r\nAfter applying this fix (for commit dab0da), `gedit` works well.\r\n```diff\r\ndiff --git a/src/runtime/os1_linux.go b/src/runtime/os1_linux.go\r\nindex c23dc30..99a2560 100644\r\n--- a/src/runtime/os1_linux.go\r\n+++ b/src/runtime/os1_linux.go\r\n@@ -326,7 +326,15 @@ func getsig(i int32) uintptr {\r\n }\r\n \r\n func signalstack(s *stack) {\r\n-       var st sigaltstackt\r\n+       var st, oldst sigaltstackt\r\n+       sigaltstack(nil, \u0026oldst)\r\n+       if oldst.ss_flags \u0026 _SS_ONSTACK != 0 {\r\n+               if s != nil {\r\n+                       s.lo = uintptr(unsafe.Pointer(oldst.ss_sp))\r\n+                       s.hi = s.lo + oldst.ss_size\r\n+               }\r\n+               return\r\n+       }\r\n        if s == nil {\r\n                st.ss_flags = _SS_DISABLE\r\n        } else {\r\ndiff --git a/src/runtime/os2_linux.go b/src/runtime/os2_linux.go\r\nindex 71f36eb..6ce5e40 100644\r\n--- a/src/runtime/os2_linux.go\r\n+++ b/src/runtime/os2_linux.go\r\n@@ -5,6 +5,7 @@\r\n package runtime\r\n \r\n const (\r\n+       _SS_ONSTACK  = 1\r\n        _SS_DISABLE  = 2\r\n        _NSIG        = 65\r\n        _SI_USER     = 0\r\n```\r\n\r\nHowever, `firefox`, `thunderbird` and `google-chrome` still does not work.\r\n\r\nWhen I run these ones with gdb, I can get various kinds of strange error messages.\r\nI suspect this flaky behavior is caused by some C stack corruption.\r\n\r\nCould you please look on this?\r\n\r\n\r\n```\r\n$ LD_PRELOAD=./example.so firefox --debug\r\n(gdb) run\r\nStarting program: /usr/lib/firefox/firefox \r\n/bin/bash: : command not found\r\nDuring startup program exited with code 127.\r\n```\r\n\r\n```\r\n$ LD_PRELOAD=./example.so firefox --debug\r\n(gdb) run\r\nStarting program: /usr/lib/firefox/firefox\r\n\r\nmalloc: unknown:0: assertion botched\r\nmalloc: block on free list clobbered\r\nAborting...SIGABRT: abort\r\nPC=0x7ffff72d6267 m=0\r\n\r\ngoroutine 0 [idle]:\r\n\r\ngoroutine 1 [running]:\r\nruntime.systemstack_switch()\r\n        /home/suda/go/src/runtime/asm_amd64.s:216 fp=0xc82002e770 sp=0xc82002e768\r\nruntime.main()\r\n        /home/suda/go/src/runtime/proc.go:49 +0x66 fp=0xc82002e7c0 sp=0xc82002e770\r\nruntime.goexit()\r\n        /home/suda/go/src/runtime/asm_amd64.s:1744 +0x1 fp=0xc82002e7c8 sp=0xc82002e7c0\r\n\r\ngoroutine 17 [chan receive (nil chan), locked to thread]:\r\nruntime.gopark(0x0, 0x0, 0x7ffff7b74370, 0x17, 0x10, 0x2)\r\n        /home/suda/go/src/runtime/proc.go:185 +0x169\r\nruntime.chanrecv(0x7ffff7b4bb20, 0x0, 0x0, 0x1, 0x0)\r\n        /home/suda/go/src/runtime/chan.go:374 +0x8b\r\nruntime.chanrecv1(0x7ffff7b4bb20, 0x0, 0x0)\r\n        /home/suda/go/src/runtime/chan.go:349 +0x2b\r\nruntime.cgocallbackg1()\r\n        /home/suda/go/src/runtime/cgocall.go:196 +0x94\r\nruntime.cgocallbackg()\r\n        /home/suda/go/src/runtime/cgocall.go:177 +0xd9\r\nruntime.cgocallback_gofunc(0x0, 0x0, 0x0)\r\n        /home/suda/go/src/runtime/asm_amd64.s:799 +0x5d\r\nruntime.goexit()\r\n        /home/suda/go/src/runtime/asm_amd64.s:1744 +0x1\r\n\r\ngoroutine 18 [syscall, locked to thread]:\r\nruntime.goexit()\r\n        /home/suda/go/src/runtime/asm_amd64.s:1744 +0x1\r\n\r\nrax    0x0\r\nrbx    0x4d68f0\r\nrcx    0xffffffffffffffff\r\nrdx    0x6\r\nrdi    0x4cc5\r\nrsi    0x4cc6\r\nrbp    0x3\r\nrsp    0x7ffff7081a48\r\nr8     0x7ffff7667960\r\nr9     0x7ffff7082700\r\nr10    0x8\r\nr11    0x206\r\nr12    0x0\r\nr13    0x0\r\nr14    0x70eb80\r\nr15    0x18\r\nrip    0x7ffff72d6267\r\nrflags 0x206\r\ncs     0x33\r\nfs     0x0\r\ngs     0x0\r\n\r\n-----\r\n\r\nSIGQUIT: quit\r\nPC=0x7ffff7b424da m=0\r\n\r\ngoroutine 0 [idle]:\r\nruntime.rtsigprocmask(0xc800000002, 0xc8200098f8, 0x0)\r\n        /home/suda/go/src/runtime/sys_linux_amd64.s:206 +0x1a\r\nruntime.updatesigmask(0x0, 0x100000000)\r\n        /home/suda/go/src/runtime/os1_linux.go:351 +0xf3\r\nruntime.crash()\r\n        /home/suda/go/src/runtime/signal1_unix.go:193 +0x33\r\nruntime.sighandler(0xc800000006, 0xc820009bb0, 0xc820009a80, 0x7ffff7db0f00)\r\n        /home/suda/go/src/runtime/signal_amd64x.go:200 +0x6b2\r\nruntime.sigtrampgo(0x6, 0xc820009bb0, 0xc820009a80)\r\n        /home/suda/go/src/runtime/signal_linux.go:94 +0x97\r\nruntime.sigtramp(0x1, 0x0, 0xc820002000, 0x0, 0x7fa0, 0x7ffff7667960, 0x7ffff7082700, 0x8, 0x206, 0x0, ...)\r\n        /home/suda/go/src/runtime/sys_linux_amd64.s:234 +0x1b\r\nruntime.sigreturn(0x0, 0xc820002000, 0x0, 0x7fa0, 0x7ffff7667960, 0x7ffff7082700, 0x8, 0x206, 0x0, 0x0, ...)\r\n        /home/suda/go/src/runtime/sys_linux_amd64.s:238\r\ngoroutine 1 [running]:\r\nDuring startup program terminated with signal SIGSEGV, Segmentation fault.\r\n```\r\n\r\n\r\n```\r\n$ LD_PRELOAD=./example.so firefox --debug\r\n(gdb) run\r\nStarting program: /usr/lib/firefox/firefox \r\n\r\nmalloc: .././variables.c:3994: assertion botched\r\nmalloc: block on free list clobbered\r\nAborting...During startup program terminated with signal SIGABRT, Aborted.\r\n```\r\n",
	"user": {
		"login": "AkihiroSuda",
		"id": 9248427,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2015-09-07T05:06:57Z",
	"updated_at": "2015-09-07T05:06:57Z"
}
