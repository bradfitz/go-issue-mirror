{
	"id": 51278030,
	"number": 1591,
	"state": "closed",
	"title": "release.2011.03.07.1: throw: malloc/free - deadlock ",
	"body": "by **wwaites**:\n\n\u003cpre\u003eWill yet need to cut down and refactor some of my code to reproduce a\nbit more minimally, but a traceback is reproduced below for a first\nreport. There is interaction with one C (raptor) and one C++ (kyoto cabinet)\nlibrary. This happens under stress. A large file is read in a goroutine\nwith raptor. Entries (pure go structures created from raptor's internal\nrepresentation, that is the meaning of C.GoString in the traceback)\nare fed over a channel, the reader puts them in a hash table with\nkyoto cabinet. At the point that this happens approximately 20k\nsuch entries have been processed.\n\nthrow: malloc/free - deadlock\n\n[signal 0xb code=0x1 addr=0x10 pc=0x8ad3]\n\nruntime.throw+0x40 /Users/ww/go/src/pkg/runtime/runtime.c:102\n\truntime.throw(0x18f0d8, 0x100000000)\nruntime.mallocgc+0x66 /Users/ww/go/src/pkg/runtime/malloc.c:36\n\truntime.mallocgc(0x10, 0x100000000, 0x1, 0x19fed0, 0x6bb3, ...)\nruntime.mal+0x3f /Users/ww/go/src/pkg/runtime/malloc.c:289\n\truntime.mal(0x10, 0x100000000)\ncopyin+0x6f /Users/ww/go/src/pkg/runtime/iface.c:160\n\tcopyin(0x87d68, 0x2b42bd0, 0x2b42be8, 0x21a49f0, 0x1, ...)\nruntime.convT2E+0x52 /Users/ww/go/src/pkg/runtime/iface.c:209\n\truntime.convT2E(0x87d68, 0x18ec3f)\nruntime.newErrorString+0x38 /Users/ww/go/src/pkg/runtime/error.go:107\n\truntime.newErrorString(0x18ec3f, 0x31, 0x2b42c30, 0xf8ffffffff, 0x18ec3f, ...)\nruntime.panicstring+0x8b /Users/ww/go/src/pkg/runtime/runtime.c:115\n\truntime.panicstring(0x18ec3f, 0xf840000ef8)\nruntime.sigpanic+0x144 /Users/ww/go/src/pkg/runtime/darwin/thread.c:470\n\truntime.sigpanic()\nruntime.MCache_Alloc+0x9e /Users/ww/go/src/pkg/runtime/mcache.c:29\n\truntime.MCache_Alloc(0x2b00000, 0x5, 0x40, 0xf800000001, 0xae8c, ...)\nruntime.mallocgc+0xed /Users/ww/go/src/pkg/runtime/malloc.c:47\n\truntime.mallocgc(0x40, 0x100000000, 0x1, 0x7dc2, 0x11ccd, ...)\nruntime.mal+0x3f /Users/ww/go/src/pkg/runtime/malloc.c:289\n\truntime.mal(0x31, 0x1346e)\nruntime.gostringsize+0x50 /Users/ww/go/src/pkg/runtime/string.c:40\n\truntime.gostringsize(0x2b42d98, 0x30, 0x2cab, 0x21411)\nruntime.gostring+0x3d /Users/ww/go/src/pkg/runtime/string.c:54\n\truntime.gostring(0x2b42de0, 0xa554de0, 0x1, 0x167c5)\nbitbucket%2eorg/ww/gordf._Cfunc_GoString+0x2f /Users/ww/Source/gordf/_obj/_cgo_defun.c:10\n\tbitbucket%2eorg/ww/gordf._Cfunc_GoString(0xa554de0, 0xa554de0, 0xf840014eb0, 0xf840025f60)\nbitbucket%2eorg/ww/gordf.uri_from_term+0x4b\n/Users/ww/Source/gordf/_obj/goraptor.cgo1.go:-1279\n\tbitbucket%2eorg/ww/gordf.uri_from_term(0xa556100, 0xf840025f60, 0xf840014eb0, 0x19885)\nbitbucket%2eorg/ww/gordf.term_to_go+0x4c\n/Users/ww/Source/gordf/_obj/goraptor.cgo1.go:-1322\n\tbitbucket%2eorg/ww/gordf.term_to_go(0xa556100, 0x0, 0x0, 0xf840019b80)\nbitbucket%2eorg/ww/gordf.GoRaptor_handle_statement+0xc6\n/Users/ww/Source/gordf/_obj/goraptor.cgo1.go:-745\n\tbitbucket%2eorg/ww/gordf.GoRaptor_handle_statement(0xf84003ef80, 0x38098d0, 0x192638, 0x410b4)\nruntime.runcgocallback+0x2e /Users/ww/go/src/pkg/runtime/amd64/asm.s:406\n\truntime.runcgocallback(0x12, 0x8a03a40, 0x0, 0x2108b, 0x21141, ...)\n----- goroutine created by -----\nbitbucket%2eorg/ww/gordf.*ParserÂ·ParseFile+0xdc\n/Users/ww/Source/gordf/_obj/goraptor.cgo1.go:-784\n\ngoroutine 2 [4]:\nruntime.gosched+0x77 /Users/ww/go/src/pkg/runtime/proc.c:598\n\truntime.gosched()\nruntime.chanrecv+0x403 /Users/ww/go/src/pkg/runtime/chan.c:324\n\truntime.chanrecv(0xf840025ea0, 0x2b41df8, 0x0, 0x0, 0xf840025ae0, ...)\nruntime.chanrecv1+0x4a /Users/ww/go/src/pkg/runtime/chan.c:416\n\truntime.chanrecv1(0xf840025ea0, 0xf840000cb0)\nbitbucket%2eorg/ww/gordf.TestKCQITiger+0x25c\n/Users/ww/Source/gordf/_obj/goraptor.cgo1.go:-135\n\tbitbucket%2eorg/ww/gordf.TestKCQITiger(0xf84003ef20, 0x0)\ntesting.tRunner+0x2b /Users/ww/go/src/pkg/testing/testing.go:133\n\ttesting.tRunner(0xf84003ef20, 0xf8400224e0, 0x0, 0x0)\nruntime.goexit /Users/ww/go/src/pkg/runtime/proc.c:150\n\truntime.goexit()\n----- goroutine created by -----\ntesting.Main+0x27c /Users/ww/go/src/pkg/testing/testing.go:160\n\ngoroutine 1 [4]:\nruntime.gosched+0x77 /Users/ww/go/src/pkg/runtime/proc.c:598\n\truntime.gosched()\nruntime.chanrecv+0x403 /Users/ww/go/src/pkg/runtime/chan.c:324\n\truntime.chanrecv(0xf8400259c0, 0x2b40f00, 0x0, 0x0, 0x30ff, ...)\nruntime.chanrecv1+0x4a /Users/ww/go/src/pkg/runtime/chan.c:416\n\truntime.chanrecv1(0xf8400259c0, 0xf8400224e0)\ntesting.Main+0x290 /Users/ww/go/src/pkg/testing/testing.go:161\n\ttesting.Main(0x26419, 0xf840022480, 0x600000006, 0x2891)\nmain.main+0x49 /Users/ww/Source/gordf/_testmain.go:21\n\tmain.main()\nruntime.mainstart+0xf /Users/ww/go/src/pkg/runtime/amd64/asm.s:77\n\truntime.mainstart()\nruntime.goexit /Users/ww/go/src/pkg/runtime/proc.c:150\n\truntime.goexit()\n----- goroutine created by -----\n_rt0_amd64+0x8e /Users/ww/go/src/pkg/runtime/amd64/asm.s:64\u003c/pre\u003e",
	"user": {
		"login": "gopherbot",
		"id": 8566911,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"comments": 4,
	"closed_at": "2014-12-08T10:09:00Z",
	"created_at": "2011-03-08T09:46:32Z",
	"updated_at": "2016-06-24T19:26:17Z"
}
