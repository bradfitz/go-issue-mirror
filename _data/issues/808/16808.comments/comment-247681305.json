{
	"id": 247681305,
	"body": "I ran into this issue today. My use case is such where for each test I setup my own transport and http.Client, perform a request, then let the transport/client run out of scope, never to be used again. My application was running out of file descriptors and digging deeper brought me here.\r\n\r\nCode to reproduce issue: https://gist.github.com/sajal/cada559fea365fc2f7468a6e40e82e4b\r\nTested on `go version go1.7 linux/amd64`\r\n\r\nWith http2 disabled(`GODEBUG=http2client=0`), this does not cause in FD leak, but with http2 enabled, it holds onto the connection for ever, does not matter if the client falls out of scope, or if `IdleConnTimeout` has passed.\r\n\r\n```\r\nsajal@sajal-lappy:~$ go version\r\ngo version go1.7 linux/amd64\r\nsajal@sajal-lappy:~$ go run 16808.go https://google.com/ #Running in http/2 mode\r\n2016/09/17 01:59:45 HTTP/2.0\r\n2016/09/17 01:59:45 COMMAND    PID  USER   FD   TYPE    DEVICE SIZE/OFF      NODE NAME\r\n16808   253772 sajal  cwd    DIR     252,1    20480   6946818 /home/sajal\r\n16808   253772 sajal  rtd    DIR     252,1     4096         2 /\r\n16808   253772 sajal  txt    REG     252,1  3791309  12465293 /tmp/go-build656141105/command-line-arguments/_obj/exe/16808\r\n16808   253772 sajal  mem    REG     252,1  1840928   7475996 /lib/x86_64-linux-gnu/libc-2.19.so\r\n16808   253772 sajal  mem    REG     252,1   141574   7475124 /lib/x86_64-linux-gnu/libpthread-2.19.so\r\n16808   253772 sajal  mem    REG     252,1   149120   7475126 /lib/x86_64-linux-gnu/ld-2.19.so\r\n16808   253772 sajal    0u   CHR    136,73      0t0        76 /dev/pts/73\r\n16808   253772 sajal    1u   CHR    136,73      0t0        76 /dev/pts/73\r\n16808   253772 sajal    2u   CHR    136,73      0t0        76 /dev/pts/73\r\n16808   253772 sajal    3u  IPv4 917612799      0t0       TCP 192.168.5.50:52719-\u003esc-in-f139.1e100.net:https (ESTABLISHED)\r\n16808   253772 sajal    4u  0000       0,9        0      8562 anon_inode\r\n16808   253772 sajal    5r   CHR       1,9      0t0      1034 /dev/urandom\r\n16808   253772 sajal    7r  FIFO       0,8      0t0 917612847 pipe\r\n16808   253772 sajal    9r  FIFO       0,8      0t0 917612848 pipe\r\n\r\n2016/09/17 01:59:51 COMMAND    PID  USER   FD   TYPE    DEVICE SIZE/OFF      NODE NAME\r\n16808   253772 sajal  cwd    DIR     252,1    20480   6946818 /home/sajal\r\n16808   253772 sajal  rtd    DIR     252,1     4096         2 /\r\n16808   253772 sajal  txt    REG     252,1  3791309  12465293 /tmp/go-build656141105/command-line-arguments/_obj/exe/16808\r\n16808   253772 sajal  mem    REG     252,1  1840928   7475996 /lib/x86_64-linux-gnu/libc-2.19.so\r\n16808   253772 sajal  mem    REG     252,1   141574   7475124 /lib/x86_64-linux-gnu/libpthread-2.19.so\r\n16808   253772 sajal  mem    REG     252,1   149120   7475126 /lib/x86_64-linux-gnu/ld-2.19.so\r\n16808   253772 sajal    0u   CHR    136,73      0t0        76 /dev/pts/73\r\n16808   253772 sajal    1u   CHR    136,73      0t0        76 /dev/pts/73\r\n16808   253772 sajal    2u   CHR    136,73      0t0        76 /dev/pts/73\r\n16808   253772 sajal    3u  IPv4 917612799      0t0       TCP 192.168.5.50:52719-\u003esc-in-f139.1e100.net:https (ESTABLISHED)\r\n16808   253772 sajal    4u  0000       0,9        0      8562 anon_inode\r\n16808   253772 sajal    5r   CHR       1,9      0t0      1034 /dev/urandom\r\n16808   253772 sajal    7r  FIFO       0,8      0t0 917613464 pipe\r\n16808   253772 sajal    9r  FIFO       0,8      0t0 917613465 pipe\r\n\r\nsajal@sajal-lappy:~$ GODEBUG=http2client=0 go run 16808.go https://google.com/ #Running in http/1.1 mode\r\n2016/09/17 02:00:09 HTTP/1.1\r\n2016/09/17 02:00:09 COMMAND    PID  USER   FD   TYPE DEVICE SIZE/OFF      NODE NAME\r\n16808   253847 sajal  cwd    DIR  252,1    20480   6946818 /home/sajal\r\n16808   253847 sajal  rtd    DIR  252,1     4096         2 /\r\n16808   253847 sajal  txt    REG  252,1  3791309  12465294 /tmp/go-build872584081/command-line-arguments/_obj/exe/16808\r\n16808   253847 sajal  mem    REG  252,1  1840928   7475996 /lib/x86_64-linux-gnu/libc-2.19.so\r\n16808   253847 sajal  mem    REG  252,1   141574   7475124 /lib/x86_64-linux-gnu/libpthread-2.19.so\r\n16808   253847 sajal  mem    REG  252,1   149120   7475126 /lib/x86_64-linux-gnu/ld-2.19.so\r\n16808   253847 sajal    0u   CHR 136,73      0t0        76 /dev/pts/73\r\n16808   253847 sajal    1u   CHR 136,73      0t0        76 /dev/pts/73\r\n16808   253847 sajal    2u   CHR 136,73      0t0        76 /dev/pts/73\r\n16808   253847 sajal    4u  0000    0,9        0      8562 anon_inode\r\n16808   253847 sajal    5r   CHR    1,9      0t0      1034 /dev/urandom\r\n16808   253847 sajal    7r  FIFO    0,8      0t0 917625659 pipe\r\n16808   253847 sajal    9r  FIFO    0,8      0t0 917625660 pipe\r\n\r\n2016/09/17 02:00:15 COMMAND    PID  USER   FD   TYPE DEVICE SIZE/OFF      NODE NAME\r\n16808   253847 sajal  cwd    DIR  252,1    20480   6946818 /home/sajal\r\n16808   253847 sajal  rtd    DIR  252,1     4096         2 /\r\n16808   253847 sajal  txt    REG  252,1  3791309  12465294 /tmp/go-build872584081/command-line-arguments/_obj/exe/16808\r\n16808   253847 sajal  mem    REG  252,1  1840928   7475996 /lib/x86_64-linux-gnu/libc-2.19.so\r\n16808   253847 sajal  mem    REG  252,1   141574   7475124 /lib/x86_64-linux-gnu/libpthread-2.19.so\r\n16808   253847 sajal  mem    REG  252,1   149120   7475126 /lib/x86_64-linux-gnu/ld-2.19.so\r\n16808   253847 sajal    0u   CHR 136,73      0t0        76 /dev/pts/73\r\n16808   253847 sajal    1u   CHR 136,73      0t0        76 /dev/pts/73\r\n16808   253847 sajal    2u   CHR 136,73      0t0        76 /dev/pts/73\r\n16808   253847 sajal    4u  0000    0,9        0      8562 anon_inode\r\n16808   253847 sajal    5r   CHR    1,9      0t0      1034 /dev/urandom\r\n16808   253847 sajal    6r  FIFO    0,8      0t0 917617532 pipe\r\n16808   253847 sajal    8r  FIFO    0,8      0t0 917617533 pipe\r\n\r\nsajal@sajal-lappy:~$ \r\n```\r\n\r\n",
	"user": {
		"login": "sajal",
		"id": 25007,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2016-09-16T19:03:20Z",
	"updated_at": "2016-09-16T19:03:20Z"
}
