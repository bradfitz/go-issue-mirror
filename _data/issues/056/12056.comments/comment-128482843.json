{
	"id": 128482843,
	"body": "The problem here seems to be that the stack trace gathered by the tracing logic is truncated. The one being looked for is:\r\n\r\n\t\t\teventDesc{trace.EvGoSysCall, []frame{\r\n\t\t\t\tframe{\"syscall.read\", 0},\r\n\t\t\t\tframe{\"syscall.Read\", 0},\r\n\t\t\t\tframe{\"os.(*File).read\", 0},\r\n\t\t\t\tframe{\"os.(*File).Read\", 0},\r\n\t\t\t\tframe{\"runtime/trace_test.TestTraceSymbolize.func11\", 101},\r\n\t\t\t}},\r\n\r\nand the one that's available is:\r\n\r\n    trace_stack_test.go:282: ---\r\n    trace_stack_test.go:280:   os.(*File).Read:95\r\n    trace_stack_test.go:280:   runtime/trace_test.TestTraceSymbolize.func11:101\r\n    trace_stack_test.go:282: ---\r\n\r\nWe've lost a few frames somehow. Solaris is special in that it makes all its system calls through asmcgocall, but that should be okay. \r\n\r\nIn fact nearly all the traces are missing frames. If I change syscall.read to syscall.readXXX and run the test on Linux, I get:\r\n\r\n\ttrace_stack_test.go:273: did not match event GoSysCall at syscall.readXXX:0\r\n\ttrace_stack_test.go:274: seen the following events of this type:\r\n\ttrace_stack_test.go:280:   syscall.setsockopt:1655\r\n\ttrace_stack_test.go:280:   syscall.SetsockoptInt:267\r\n\ttrace_stack_test.go:280:   net.setDefaultSockopts:20\r\n\ttrace_stack_test.go:280:   net.socket:42\r\n\ttrace_stack_test.go:280:   net.internetSocket:160\r\n\ttrace_stack_test.go:280:   net.ListenTCP:329\r\n\ttrace_stack_test.go:280:   net.Listen:395\r\n\ttrace_stack_test.go:280:   runtime/trace_test.TestTraceSymbolize:81\r\n\ttrace_stack_test.go:280:   testing.tRunner:456\r\n\ttrace_stack_test.go:282: ---\r\n\ttrace_stack_test.go:280:   syscall.setsockopt:1655\r\n\ttrace_stack_test.go:280:   syscall.SetsockoptInt:267\r\n\ttrace_stack_test.go:280:   net.setDefaultListenerSockopts:25\r\n\ttrace_stack_test.go:280:   net.(*netFD).listenStream:156\r\n\ttrace_stack_test.go:280:   net.socket:76\r\n\ttrace_stack_test.go:280:   net.internetSocket:160\r\n\ttrace_stack_test.go:280:   net.ListenTCP:329\r\n\ttrace_stack_test.go:280:   net.Listen:395\r\n\ttrace_stack_test.go:280:   runtime/trace_test.TestTraceSymbolize:81\r\n\ttrace_stack_test.go:280:   testing.tRunner:456\r\n\ttrace_stack_test.go:282: ---\r\n\ttrace_stack_test.go:280:   syscall.bind:1604\r\n\ttrace_stack_test.go:280:   syscall.Bind:214\r\n\ttrace_stack_test.go:280:   net.(*netFD).listenStream:162\r\n\ttrace_stack_test.go:280:   net.socket:76\r\n\ttrace_stack_test.go:280:   net.internetSocket:160\r\n\ttrace_stack_test.go:280:   net.ListenTCP:329\r\n\ttrace_stack_test.go:280:   net.Listen:395\r\n\ttrace_stack_test.go:280:   runtime/trace_test.TestTraceSymbolize:81\r\n\ttrace_stack_test.go:280:   testing.tRunner:456\r\n\ttrace_stack_test.go:282: ---\r\n\ttrace_stack_test.go:280:   syscall.Listen:1340\r\n\ttrace_stack_test.go:280:   net.(*netFD).listenStream:166\r\n\ttrace_stack_test.go:280:   net.socket:76\r\n\ttrace_stack_test.go:280:   net.internetSocket:160\r\n\ttrace_stack_test.go:280:   net.ListenTCP:329\r\n\ttrace_stack_test.go:280:   net.Listen:395\r\n\ttrace_stack_test.go:280:   runtime/trace_test.TestTraceSymbolize:81\r\n\ttrace_stack_test.go:280:   testing.tRunner:456\r\n\ttrace_stack_test.go:282: ---\r\n\ttrace_stack_test.go:282: ---\r\n\ttrace_stack_test.go:280:   syscall.accept4:1593\r\n\ttrace_stack_test.go:280:   syscall.Accept4:453\r\n\ttrace_stack_test.go:280:   net.accept:54\r\n\ttrace_stack_test.go:280:   net.(*netFD).accept:400\r\n\ttrace_stack_test.go:280:   net.(*TCPListener).AcceptTCP:254\r\n\ttrace_stack_test.go:280:   net.(*TCPListener).Accept:264\r\n\ttrace_stack_test.go:280:   runtime/trace_test.TestTraceSymbolize.func10:86\r\n\ttrace_stack_test.go:282: ---\r\n\ttrace_stack_test.go:280:   syscall.read:783\r\n\ttrace_stack_test.go:280:   syscall.Read:160\r\n\ttrace_stack_test.go:280:   os.(*File).read:211\r\n\ttrace_stack_test.go:280:   os.(*File).Read:95\r\n\ttrace_stack_test.go:280:   runtime/trace_test.TestTraceSymbolize.func11:101\r\n\ttrace_stack_test.go:282: ---\r\n\ttrace_stack_test.go:282: ---\r\n\ttrace_stack_test.go:280:   syscall.setsockopt:1655\r\n\ttrace_stack_test.go:280:   syscall.SetsockoptInt:267\r\n\ttrace_stack_test.go:280:   net.setDefaultSockopts:20\r\n\ttrace_stack_test.go:280:   net.socket:42\r\n\ttrace_stack_test.go:280:   net.internetSocket:160\r\n\ttrace_stack_test.go:280:   net.dialTCP:171\r\n\ttrace_stack_test.go:280:   net.dialSingle:364\r\n\ttrace_stack_test.go:280:   net.dialSerial.func1:336\r\n\ttrace_stack_test.go:280:   net.dial:40\r\n\ttrace_stack_test.go:280:   net.dialSerial:338\r\n\ttrace_stack_test.go:280:   net.(*Dialer).Dial:232\r\n\ttrace_stack_test.go:280:   net.Dial:186\r\n\ttrace_stack_test.go:280:   runtime/trace_test.TestTraceSymbolize:118\r\n\ttrace_stack_test.go:280:   testing.tRunner:456\r\n\ttrace_stack_test.go:282: ---\r\n\ttrace_stack_test.go:280:   syscall.connect:1614\r\n\ttrace_stack_test.go:280:   syscall.Connect:222\r\n\ttrace_stack_test.go:280:   net.(*netFD).connect:75\r\n\ttrace_stack_test.go:280:   net.(*netFD).dial:137\r\n\ttrace_stack_test.go:280:   net.socket:89\r\n\ttrace_stack_test.go:280:   net.internetSocket:160\r\n\ttrace_stack_test.go:280:   net.dialTCP:171\r\n\ttrace_stack_test.go:280:   net.dialSingle:364\r\n\ttrace_stack_test.go:280:   net.dialSerial.func1:336\r\n\ttrace_stack_test.go:280:   net.dial:40\r\n\ttrace_stack_test.go:280:   net.dialSerial:338\r\n\ttrace_stack_test.go:280:   net.(*Dialer).Dial:232\r\n\ttrace_stack_test.go:280:   net.Dial:186\r\n\ttrace_stack_test.go:280:   runtime/trace_test.TestTraceSymbolize:118\r\n\ttrace_stack_test.go:280:   testing.tRunner:456\r\n\ttrace_stack_test.go:282: ---\r\n\ttrace_stack_test.go:280:   syscall.getsockopt:1645\r\n\ttrace_stack_test.go:280:   syscall.GetsockoptInt:237\r\n\ttrace_stack_test.go:280:   net.(*netFD).connect:117\r\n\ttrace_stack_test.go:280:   net.(*netFD).dial:137\r\n\ttrace_stack_test.go:280:   net.socket:89\r\n\ttrace_stack_test.go:280:   net.internetSocket:160\r\n\ttrace_stack_test.go:280:   net.dialTCP:171\r\n\ttrace_stack_test.go:280:   net.dialSingle:364\r\n\ttrace_stack_test.go:280:   net.dialSerial.func1:336\r\n\ttrace_stack_test.go:280:   net.dial:40\r\n\ttrace_stack_test.go:280:   net.dialSerial:338\r\n\ttrace_stack_test.go:280:   net.(*Dialer).Dial:232\r\n\ttrace_stack_test.go:280:   net.Dial:186\r\n\ttrace_stack_test.go:280:   runtime/trace_test.TestTraceSymbolize:118\r\n\ttrace_stack_test.go:280:   testing.tRunner:456\r\n\ttrace_stack_test.go:282: ---\r\n\ttrace_stack_test.go:280:   syscall.setsockopt:1655\r\n\ttrace_stack_test.go:280:   syscall.SetsockoptInt:267\r\n\ttrace_stack_test.go:280:   net.setNoDelay:19\r\n\ttrace_stack_test.go:280:   net.newTCPConn:51\r\n\ttrace_stack_test.go:280:   net.dialTCP:207\r\n\ttrace_stack_test.go:280:   net.dialSingle:364\r\n\ttrace_stack_test.go:280:   net.dialSerial.func1:336\r\n\ttrace_stack_test.go:280:   net.dial:40\r\n\ttrace_stack_test.go:280:   net.dialSerial:338\r\n\ttrace_stack_test.go:280:   net.(*Dialer).Dial:232\r\n\ttrace_stack_test.go:280:   net.Dial:186\r\n\ttrace_stack_test.go:280:   runtime/trace_test.TestTraceSymbolize:118\r\n\ttrace_stack_test.go:280:   testing.tRunner:456\r\n\ttrace_stack_test.go:282: ---\r\n\ttrace_stack_test.go:280:   syscall.Close:296\r\n\ttrace_stack_test.go:280:   net.(*netFD).destroy:135\r\n\ttrace_stack_test.go:280:   net.(*netFD).decref:153\r\n\ttrace_stack_test.go:280:   net.(*netFD).Close:199\r\n\ttrace_stack_test.go:280:   net.(*conn).Close:156\r\n\ttrace_stack_test.go:280:   runtime/trace_test.TestTraceSymbolize:122\r\n\ttrace_stack_test.go:280:   testing.tRunner:456\r\n\ttrace_stack_test.go:282: ---\r\n\ttrace_stack_test.go:280:   syscall.write:1064\r\n\ttrace_stack_test.go:280:   syscall.Write:176\r\n\ttrace_stack_test.go:280:   os.(*File).write:232\r\n\ttrace_stack_test.go:280:   os.(*File).Write:139\r\n\ttrace_stack_test.go:280:   runtime/trace_test.TestTraceSymbolize:124\r\n\ttrace_stack_test.go:280:   testing.tRunner:456\r\n\ttrace_stack_test.go:282: ---\r\n\ttrace_stack_test.go:280:   syscall.accept4:1593\r\n\ttrace_stack_test.go:280:   syscall.Accept4:453\r\n\ttrace_stack_test.go:280:   net.accept:54\r\n\ttrace_stack_test.go:280:   net.(*netFD).accept:400\r\n\ttrace_stack_test.go:280:   net.(*TCPListener).AcceptTCP:254\r\n\ttrace_stack_test.go:280:   net.(*TCPListener).Accept:264\r\n\ttrace_stack_test.go:280:   runtime/trace_test.TestTraceSymbolize.func10:86\r\n\ttrace_stack_test.go:282: ---\r\n\ttrace_stack_test.go:280:   syscall.setsockopt:1655\r\n\ttrace_stack_test.go:280:   syscall.SetsockoptInt:267\r\n\ttrace_stack_test.go:280:   net.setNoDelay:19\r\n\ttrace_stack_test.go:280:   net.newTCPConn:51\r\n\ttrace_stack_test.go:280:   net.(*TCPListener).AcceptTCP:258\r\n\ttrace_stack_test.go:280:   net.(*TCPListener).Accept:264\r\n\ttrace_stack_test.go:280:   runtime/trace_test.TestTraceSymbolize.func10:86\r\n\ttrace_stack_test.go:282: ---\r\n\ttrace_stack_test.go:280:   syscall.Close:296\r\n\ttrace_stack_test.go:280:   net.(*netFD).destroy:135\r\n\ttrace_stack_test.go:280:   net.(*netFD).decref:153\r\n\ttrace_stack_test.go:280:   net.(*netFD).Close:199\r\n\ttrace_stack_test.go:280:   net.(*conn).Close:156\r\n\ttrace_stack_test.go:280:   runtime/trace_test.TestTraceSymbolize.func10:90\r\n\ttrace_stack_test.go:282: ---\r\n\r\nNotice all the frames that Solaris does not have. It seems to be consistently missing the top three frames.\r\n\r\n@4ad do you have any ideas what might be special about Solaris for gathering stack traces?\r\n\r\n",
	"user": {
		"login": "rsc",
		"id": 104030,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2015-08-06T19:39:04Z",
	"updated_at": "2015-08-06T19:39:04Z"
}
