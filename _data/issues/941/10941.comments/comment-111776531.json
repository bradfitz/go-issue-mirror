{
	"id": 111776531,
	"body": "I've patched throw() like this to see backtrace in gdb:\r\n\r\n```diff\r\n--- a/src/runtime/panic.go\r\n+++ b/src/runtime/panic.go\r\n@@ -519,11 +519,6 @@ func dopanic(unused int) {\r\n //go:nosplit\r\n func throw(s string) {\r\n        print(\"fatal error: \", s, \"\\n\")\r\n-       gp := getg()\r\n-       if gp.m.throwing == 0 {\r\n-               gp.m.throwing = 1\r\n-       }\r\n-       startpanic()\r\n-       dopanic(0)\r\n+       crash()\r\n        *(*int)(nil) = 0 // not reached\r\n }\r\n```\r\n\r\nAnd reproduced it (`g already has stack barriers`).\r\n\r\n```\r\n(gdb) p/x *gp\r\n$6 = {stack = {lo = 0xc208d75000, hi = 0xc208d75fd0}, stackguard0 = 0xc208d75280, stackguard1 = 0xffffffffffffffff, _panic = 0x0, _defer = 0x0, stackAlloc = 0x1000, sched = {\r\n    sp = 0xc208d75c50, pc = 0x42a4d9, g = 0xc2081f2580, ctxt = 0x0, ret = 0x0, lr = 0x0, bp = 0x2}, syscallsp = 0x0, syscallpc = 0x58cf75, stkbar = {array = 0xc208d75fd0,\r\n    len = 0x1, cap = 0x3}, stkbarPos = 0x1, param = 0x0, atomicstatus = 0x1004, goid = 0x106, waitsince = 0x4a3fb6b9787544, waitreason = 0x70e7f0 \"select\",\r\n  schedlink = 0xc2082dd600, preempt = 0x0, paniconfault = 0x0, preemptscan = 0x0, gcworkdone = 0x0, gcscanvalid = 0x0, throwsplit = 0x0, raceignore = 0x0, m = 0x0, lockedm = 0x0,\r\n  sig = 0x0, writebuf = {array = 0x0, len = 0x0, cap = 0x0}, sigcode0 = 0x0, sigcode1 = 0x0, sigpc = 0x0, gopc = 0x480470, startpc = 0x483420, racectx = 0x0,\r\n  waiting = 0xc20908e640, readyg = 0x0, gcalloc = 0x0, gcscanwork = 0x0}\r\n(gdb) bt\r\n#0  runtime.raise () at /Users/inada-n/local/go/src/runtime/sys_linux_amd64.s:104\r\n#1  0x000000000043a977 in runtime.crash () at /Users/inada-n/local/go/src/runtime/signal1_unix.go:158\r\n#2  0x0000000000427f8d in runtime.throw (s=...) at /Users/inada-n/local/go/src/runtime/panic.go:522\r\n#3  0x00000000004192f4 in runtime.scanstack (gp=0xc2081f2580) at /Users/inada-n/local/go/src/runtime/mgcmark.go:334\r\n#4  0x0000000000418dad in runtime.gcphasework (gp=0xc2081f2580) at /Users/inada-n/local/go/src/runtime/mgcmark.go:273\r\n#5  0x000000000042c41e in runtime.stopg (gp=0xc2081f2580, ~r1=4) at /Users/inada-n/local/go/src/runtime/proc1.go:395\r\n#6  0x000000000041883f in runtime.markroot (desc=0xc208018000, i=198) at /Users/inada-n/local/go/src/runtime/mgcmark.go:138\r\n#7  0x0000000000428aea in runtime.parfordo (desc=0xc208018000) at /Users/inada-n/local/go/src/runtime/parfor.go:95\r\n#8  0x000000000041858e in runtime.gcscan_m () at /Users/inada-n/local/go/src/runtime/mgcmark.go:37\r\n#9  0x000000000044b70c in runtime.gc.func1 () at /Users/inada-n/local/go/src/runtime/mgc.go:876\r\n#10 0x0000000000455c6c in runtime.systemstack () at /Users/inada-n/local/go/src/runtime/asm_amd64.s:262\r\n#11 0x000000000042cd50 in runtime.startTheWorldWithSema () at /Users/inada-n/local/go/src/runtime/proc1.go:591\r\n#12 0x000000000053e751 in net/textproto.(*Reader).readLineSlice (r=0x0, ~r0=..., ~r1=...) at /Users/inada-n/local/go/src/net/textproto/reader.go:55\r\n#13 0x0000000000000000 in ?? ()\r\n```\r\n\r\nIt seems the `gp` is not corrupted.",
	"user": {
		"login": "methane",
		"id": 199592,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2015-06-14T03:22:33Z",
	"updated_at": "2015-06-14T03:22:33Z"
}
