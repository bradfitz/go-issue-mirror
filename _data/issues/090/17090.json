{
	"id": 176660651,
	"number": 17090,
	"state": "closed",
	"title": "compress/gzip produces incomplete file for Go 1.7+, Go 1.6.3 not affected",
	"body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n### What version of Go are you using (`go version`)?\r\n1.7, 1.7.1\r\n\r\n### What operating system and processor architecture are you using (`go env`)?\r\n GOARCH=\"amd64\"\r\n GOBIN=\"\"\r\n GOEXE=\"\"\r\n GOHOSTARCH=\"amd64\"\r\n GOHOSTOS=\"linux\"\r\n GOOS=\"linux\"\r\n GOPATH=\"/root/gowork\"\r\n GORACE=\"\"\r\n GOROOT=\"/usr/local/go\"\r\n GOTOOLDIR=\"/usr/local/go/pkg/tool/linux_amd64\"\r\n GO15VENDOREXPERIMENT=\"1\"\r\n CC=\"gcc\"\r\n GOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0\"\r\n CXX=\"g++\"\r\n CGO_ENABLED=\"1\"\r\n\r\n\r\n### What did you do?\r\nI wrote an application which can optionally stream gzipped Mysqldump files into a running mysql command for the purpose of restoring \u0026 converting old database data into a new format for an internal company application.  When mysql tables were mysteriously going missing, I started investigating further, and discovered that my gzip.NewReader() reader was aborting early.\r\n\r\nI have written a test harness which illustrates this problem against the current \"go1.7.1.linux-amd64.tar.gz\" as a test dataset.\r\n\r\nTest golang program (provides main()): https://play.golang.org/p/MdAVgNBay3\r\n\r\nTest file: https://storage.googleapis.com/golang/go1.7.1.linux-amd64.tar.gz\r\n\r\nSHA256 of test file:\r\n [root@toybox local]# sha256sum go1.7.1.linux-amd64.tar.gz\r\n 43ad621c9b014cde8db17393dc108378d37bc853aa351a6c74bf6432c1bbd182  go1.7.1.linux-amd64.tar.gz\r\n\r\n\r\nUsing GNU gunzip utility:\r\n [root@toybox local]# gunzip --version\r\n gunzip (gzip) 1.5\r\n\r\nThe gunzipped file looks as such:\r\n [root@toybox local]# gunzip -c go1.7.1.linux-amd64.tar.gz \u003e go171_good.tar\r\n [root@toybox local]# ls -l go171_good.tar\r\n -rw-r--r-- 1 root root 248978432 Sep 13 10:36 go171_good.tar\r\n [root@toybox local]# sha256sum go171_good.tar\r\n 5c6ecdbb8e9bfc166a17f76ff93ef909e233bbfd75f61e018a7e691f15600841  go171_good.tar\r\n\r\nUsing the aforementioned Golang utility, which I called \"gogunzt1\", when built using Go 1.6.3 (linux-amd64):\r\n [root@toybox local]# gogunzt1 --gzin go1.7.1.linux-amd64.tar.gz --output go171_gotest1.tar\r\n 2016/09/13 10:37:35 Total bytes written: 248978432\r\n [root@toybox local]# ls -l go171_gotest1.tar\r\n -rw-r--r-- 1 root root 248978432 Sep 13 10:37 go171_gotest1.tar\r\n [root@toybox local]# sha256sum go171_gotest1.tar\r\n 5c6ecdbb8e9bfc166a17f76ff93ef909e233bbfd75f61e018a7e691f15600841  go171_gotest1.tar\r\n\r\n\r\nUsing the same Golang utility, but built using Go 1.7.1 (linux-amd64):\r\n [root@toybox local]# gogunzt1 --gzin go1.7.1.linux-amd64.tar.gz --output go171_gotest2.tar\r\n 2016/09/13 10:38:38 Total bytes written: 248971264\r\n [root@toybox local]# ls -l go171_gotest2.tar\r\n -rw-r--r-- 1 root root 248971264 Sep 13 10:38 go171_gotest2.tar\r\n [root@toybox local]# sha256sum go171_gotest2.tar\r\n 82d124705de008af2d03c5524b653d12b4054e746bcd743a6e1cbb772f985e14  go171_gotest2.tar\r\n\r\nObviously an issue there, the Go 1.7.1 built utility was 7168 bytes short.\r\n\r\nAs a quick check, I tried using dd to trim the go 1.6.3-built test output (go171_gotest1.tar) by 7168 bytes, storing it into \"go171_gotest3.tar\" and comparing the SHA256:\r\n\r\n [root@toybox local]# dd if=go171_gotest1.tar of=go171_gotest3.tar bs=1 count=248971264\r\n 248971264+0 records in\r\n 248971264+0 records out\r\n 248971264 bytes (249 MB) copied, 211.809 s, 1.2 MB/s\r\n [root@toybox local]# sha256sum go171_gotest3.tar\r\n 82d124705de008af2d03c5524b653d12b4054e746bcd743a6e1cbb772f985e14  go171_gotest3.tar\r\n\r\nThe SHA256 sum for go171_gotest3.tar and go171_gotest2.tar match, which tells me that Go 1.7.1's compress/gzip implementation is faithfully decompressing the data, but just seems to be stopping short of decompressing all the data.\r\n",
	"user": {
		"login": "spirilis",
		"id": 1679003,
		"type": "User",
		"site_admin": false
	},
	"comments": 4,
	"closed_at": "2016-09-13T14:48:28Z",
	"created_at": "2016-09-13T14:45:40Z",
	"updated_at": "2016-09-13T17:29:23Z"
}
