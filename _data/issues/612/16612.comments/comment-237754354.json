{
	"id": 237754354,
	"body": "Okay, sorry, my fault. I see the problem.\r\n\r\nIt's a flow control issue, but it's not because of https://golang.org/cl/25382. It's actually because of the mod_h2 workaround https://golang.org/cl/25362 (#16519).\r\n\r\nGoogle is advertising a 1MB initial window size for streams, but because we no longer wait to hear that, we start out assuming it's 64KB and never adjust our limit by (1MB-64KB) when we see the SETTINGS update by the peer.\r\n\r\nThere's actually a TODO to do this:\r\n\r\n```go\r\n        err := f.ForeachSetting(func(s Setting) error {\r\n                switch s.ID {\r\n                case SettingMaxFrameSize:\r\n                        cc.maxFrameSize = s.Val\r\n                case SettingMaxConcurrentStreams:\r\n                        cc.maxConcurrentStreams = s.Val\r\n                case SettingInitialWindowSize:\r\n                        // TODO: error if this is too large.                                                                                                                                                           \r\n        \r\n                        // TODO: adjust flow control of still-open                                                                                                                                                     \r\n                        // frames by the difference of the old initial                                                                                                                                                 \r\n                        // window size and this one.                                                                                                                                                                   \r\n                        cc.initialWindowSize = s.Val\r\n\r\n```\r\n\r\n... but it was super low priority when we read the SETTINGS at start-up, because I've never seen a server change the initial flow control setting on a connection after the initial settings.\r\n\r\nBut it's super important to do that TODO if we're starting to do send requests (e.g. for Apache) before we wait for the initial SETTINGS from the peer.\r\n\r\nIt's easy enough to roll forward and fix this, which I understand people might object to, but rolling back is also not great (there have been a few h2 fixes), and cherry picking fixes is also something I don't think will be too great if a number of them are inter-dependent. I'd prefer x/net and std to match as much as possible.\r\n\r\nI'll send out a fix tomorrow morning and people can evaluate it.",
	"user": {
		"login": "bradfitz",
		"id": 2621,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2016-08-05T04:48:34Z",
	"updated_at": "2016-08-05T04:48:34Z"
}
