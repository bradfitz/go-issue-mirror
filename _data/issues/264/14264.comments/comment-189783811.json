{
	"id": 189783811,
	"body": "I tried running a 2GB heap hog for 15 minutes and, surprisingly, didn't get any huge pages anywhere (heap or metadata):\r\n\r\n```\r\nc000000000-c0001b0000 rw-p 00000000 00:00 0 \r\nSize:               1728 kB\r\nRss:                1728 kB\r\nPss:                1728 kB\r\nShared_Clean:          0 kB\r\nShared_Dirty:          0 kB\r\nPrivate_Clean:         0 kB\r\nPrivate_Dirty:      1728 kB\r\nReferenced:         1728 kB\r\nAnonymous:          1728 kB\r\nAnonHugePages:         0 kB\r\nSwap:                  0 kB\r\nKernelPageSize:        4 kB\r\nMMUPageSize:           4 kB\r\nLocked:                0 kB\r\nVmFlags: rd wr mr mw me ac sd \r\nc81ca18000-c85ec00000 rw-p 00000000 00:00 0                              [stack:12747]\r\nSize:            1083296 kB\r\nRss:             1083100 kB\r\nPss:             1083100 kB\r\nShared_Clean:          0 kB\r\nShared_Dirty:          0 kB\r\nPrivate_Clean:         0 kB\r\nPrivate_Dirty:   1083100 kB\r\nReferenced:      1083100 kB\r\nAnonymous:       1083100 kB\r\nAnonHugePages:         0 kB\r\nSwap:                  0 kB\r\nKernelPageSize:        4 kB\r\nMMUPageSize:           4 kB\r\nLocked:                0 kB\r\nVmFlags: rd wr mr mw me ac sd \r\nc85ec00000-c85ee00000 rw-p 00000000 00:00 0 \r\nSize:               2048 kB\r\nRss:                2048 kB\r\nPss:                2048 kB\r\nShared_Clean:          0 kB\r\nShared_Dirty:          0 kB\r\nPrivate_Clean:         0 kB\r\nPrivate_Dirty:      2048 kB\r\nReferenced:         2048 kB\r\nAnonymous:          2048 kB\r\nAnonHugePages:         0 kB\r\nSwap:                  0 kB\r\nKernelPageSize:        4 kB\r\nMMUPageSize:           4 kB\r\nLocked:                0 kB\r\nVmFlags: rd wr mr mw me ac sd nh \r\nc85ee00000-c88bd00000 rw-p 00000000 00:00 0 \r\nSize:             736256 kB\r\nRss:              736256 kB\r\nPss:              736256 kB\r\nShared_Clean:          0 kB\r\nShared_Dirty:          0 kB\r\nPrivate_Clean:         0 kB\r\nPrivate_Dirty:    736256 kB\r\nReferenced:       736256 kB\r\nAnonymous:        736256 kB\r\nAnonHugePages:         0 kB\r\nSwap:                  0 kB\r\nKernelPageSize:        4 kB\r\nMMUPageSize:           4 kB\r\nLocked:                0 kB\r\nVmFlags: rd wr mr mw me ac sd \r\n```\r\n\r\nspans start at 0xc000000000 and the bitmap ends/arena begins at 0xc820000000, as usual. So, we don't have much in the way of spans, but we do have 53 MB of bitmap.\r\n\r\nI confirmed that CONFIG_TRANSPARENT_HUGEPAGE=y and CONFIG_TRANSPARENT_HUGEPAGE_ALWAYS=y.\r\n\r\nOr maybe AnonHugePages doesn't mean what I think it means? Based on fs/proc/task_mmu.c it seems to be what you would think.\r\n\r\nIt's also possible THP just isn't working on my laptop. I tried cranking up khugepaged to full throttle by setting /sys/kernel/mm/transparent_hugepage/khugepaged/scan_sleep_millisecs to 0 and nothing happened. The scan count even stayed at \"53\".",
	"user": {
		"login": "aclements",
		"id": 2688315,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2016-02-28T04:57:23Z",
	"updated_at": "2016-02-28T04:57:23Z"
}
