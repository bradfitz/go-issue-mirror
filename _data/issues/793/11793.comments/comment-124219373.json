{
	"id": 124219373,
	"body": "New benchmark: added image NRGBA to JPEG (https://raw.githubusercontent.com/pierrre/imageserver/master/testdata/medium.jpg)\r\nTL;DR: -3~4% :unamused:\r\n\r\n`go test -x -a -bench=. -benchmem -benchtime=10s`\r\n\r\nbenchcmp\r\n```\r\nbenchmark                               old ns/op     new ns/op     delta\r\nBenchmarkNRGBAToRGBAOpaque-8            6.02          2.56          -57.48%\r\nBenchmarkNRGBAToRGBATransparent-8       6.01          1.05          -82.53%\r\nBenchmarkNRGBAToRGBATranslucent-8       6.01          6.27          +4.33%\r\nBenchmarkNRGBA64ToRGBAOpaque-8          4.78          1.77          -62.97%\r\nBenchmarkNRGBA64ToRGBATransparent-8     4.78          1.05          -78.03%\r\nBenchmarkNRGBA64ToRGBATranslucent-8     4.78          4.90          +2.51%\r\nBenchmarkImageNRGBAToJPEG-8             130436983     124108320     -4.85%\r\nBenchmarkImageNRGBA64ToJPEG-8           167729682     162254647     -3.26%\r\n```\r\n\r\nold\r\n```\r\ntesting: warning: no tests to run\r\nPASS\r\nBenchmarkNRGBAToRGBAOpaque-8       \t2000000000\t         6.02 ns/op\t       0 B/op\t       0 allocs/op\r\nBenchmarkNRGBAToRGBATransparent-8  \t3000000000\t         6.01 ns/op\t       0 B/op\t       0 allocs/op\r\nBenchmarkNRGBAToRGBATranslucent-8  \t2000000000\t         6.01 ns/op\t       0 B/op\t       0 allocs/op\r\nBenchmarkNRGBA64ToRGBAOpaque-8     \t3000000000\t         4.78 ns/op\t       0 B/op\t       0 allocs/op\r\nBenchmarkNRGBA64ToRGBATransparent-8\t3000000000\t         4.78 ns/op\t       0 B/op\t       0 allocs/op\r\nBenchmarkNRGBA64ToRGBATranslucent-8\t3000000000\t         4.78 ns/op\t       0 B/op\t       0 allocs/op\r\nBenchmarkImageNRGBAToJPEG-8        \t     100\t 130436983 ns/op\t13635888 B/op\t  851972 allocs/op\r\nBenchmarkImageNRGBA64ToJPEG-8      \t     100\t 167729682 ns/op\t13635888 B/op\t  851972 allocs/op\r\nok  \t_test/benchrgba\t119.014s\r\n```\r\n\r\nnew\r\n```\r\ntesting: warning: no tests to run\r\nPASS\r\nBenchmarkNRGBAToRGBAOpaque-8       \t10000000000\t         2.56 ns/op\t       0 B/op\t       0 allocs/op\r\nBenchmarkNRGBAToRGBATransparent-8  \t10000000000\t         1.05 ns/op\t       0 B/op\t       0 allocs/op\r\nBenchmarkNRGBAToRGBATranslucent-8  \t2000000000\t         6.27 ns/op\t       0 B/op\t       0 allocs/op\r\nBenchmarkNRGBA64ToRGBAOpaque-8     \t10000000000\t         1.77 ns/op\t       0 B/op\t       0 allocs/op\r\nBenchmarkNRGBA64ToRGBATransparent-8\t10000000000\t         1.05 ns/op\t       0 B/op\t       0 allocs/op\r\nBenchmarkNRGBA64ToRGBATranslucent-8\t3000000000\t         4.90 ns/op\t       0 B/op\t       0 allocs/op\r\nBenchmarkImageNRGBAToJPEG-8        \t     100\t 124108320 ns/op\t13635888 B/op\t  851972 allocs/op\r\nBenchmarkImageNRGBA64ToJPEG-8      \t     100\t 162254647 ns/op\t13635888 B/op\t  851972 allocs/op\r\nok  \t_test/benchrgba\t122.781s\r\n```\r\n\r\ncode\r\n```go\r\npackage main\r\n\r\nimport (\r\n\t\"image\"\r\n\t\"image/color\"\r\n\t\"image/draw\"\r\n\t\"image/jpeg\"\r\n\t_ \"image/jpeg\"\r\n\t_ \"image/png\"\r\n\t\"io/ioutil\"\r\n\t\"os\"\r\n\t\"testing\"\r\n)\r\n\r\nfunc BenchmarkNRGBAToRGBAOpaque(b *testing.B) {\r\n\tc := color.NRGBA{0xff, 0x80, 0x00, 0xff}\r\n\tfor i := 0; i \u003c b.N; i++ {\r\n\t\tc.RGBA()\r\n\t}\r\n}\r\n\r\nfunc BenchmarkNRGBAToRGBATransparent(b *testing.B) {\r\n\tc := color.NRGBA{0xff, 0x80, 0x00, 0x00}\r\n\tfor i := 0; i \u003c b.N; i++ {\r\n\t\tc.RGBA()\r\n\t}\r\n}\r\n\r\nfunc BenchmarkNRGBAToRGBATranslucent(b *testing.B) {\r\n\tc := color.NRGBA{0xff, 0x80, 0x00, 0x80}\r\n\tfor i := 0; i \u003c b.N; i++ {\r\n\t\tc.RGBA()\r\n\t}\r\n}\r\n\r\nfunc BenchmarkNRGBA64ToRGBAOpaque(b *testing.B) {\r\n\tc := color.NRGBA64{0xffff, 0x8000, 0x0000, 0xffff}\r\n\tfor i := 0; i \u003c b.N; i++ {\r\n\t\tc.RGBA()\r\n\t}\r\n}\r\n\r\nfunc BenchmarkNRGBA64ToRGBATransparent(b *testing.B) {\r\n\tc := color.NRGBA64{0xffff, 0x8000, 0x0000, 0x0000}\r\n\tfor i := 0; i \u003c b.N; i++ {\r\n\t\tc.RGBA()\r\n\t}\r\n}\r\n\r\nfunc BenchmarkNRGBA64ToRGBATranslucent(b *testing.B) {\r\n\tc := color.NRGBA64{0xffff, 0x8000, 0x0000, 0x8000}\r\n\tfor i := 0; i \u003c b.N; i++ {\r\n\t\tc.RGBA()\r\n\t}\r\n}\r\n\r\nvar (\r\n\timNRGBA   *image.NRGBA\r\n\timNRGBA64 *image.NRGBA64\r\n)\r\n\r\nfunc init() {\r\n\tf, err := os.Open(\"/home/pierre/Go/src/github.com/pierrre/imageserver/testdata/medium.jpg\")\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\tim, _, err := image.Decode(f)\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\timNRGBA = image.NewNRGBA(image.Rect(0, 0, im.Bounds().Dx(), im.Bounds().Dy()))\r\n\tdraw.Draw(imNRGBA, imNRGBA.Bounds(), im, im.Bounds().Min, draw.Src)\r\n\timNRGBA64 = image.NewNRGBA64(image.Rect(0, 0, im.Bounds().Dx(), im.Bounds().Dy()))\r\n\tdraw.Draw(imNRGBA64, imNRGBA64.Bounds(), im, im.Bounds().Min, draw.Src)\r\n}\r\n\r\nfunc BenchmarkImageNRGBAToJPEG(b *testing.B) {\r\n\tfor i := 0; i \u003c b.N; i++ {\r\n\t\terr := jpeg.Encode(ioutil.Discard, imNRGBA, nil)\r\n\t\tif err != nil {\r\n\t\t\tb.Fatal(err)\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunc BenchmarkImageNRGBA64ToJPEG(b *testing.B) {\r\n\tfor i := 0; i \u003c b.N; i++ {\r\n\t\terr := jpeg.Encode(ioutil.Discard, imNRGBA64, nil)\r\n\t\tif err != nil {\r\n\t\t\tb.Fatal(err)\r\n\t\t}\r\n\t}\r\n}\r\n```",
	"user": {
		"login": "pierrre",
		"id": 131535,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2015-07-23T19:34:39Z",
	"updated_at": "2015-07-23T19:34:39Z"
}
