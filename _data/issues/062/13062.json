{
	"id": 113509757,
	"number": 13062,
	"state": "closed",
	"title": "runtime: unexpected fault address 0x0 in hashmap.go",
	"body": "This involves a bus error that occurs when assigning to a local map with no concurrency involved. This happens within the context of a program that constructs a large in-memory index and consumes a lot of memory (~60GB) in the process.\r\n\r\nHere's additional info about the environment:\r\n\r\n- Go 1.5.1\r\n- Compiling on Ubuntu 14.04 x86_64\r\n- Running on CentOS 5.11 x86_64\r\n\r\n```\r\nunexpected fault address 0x0\r\nfatal error: fault\r\n[signal 0x7 code=0x80 addr=0x0 pc=0x40873b]\r\n\r\ngoroutine 97699 [running]:\r\nruntime.throw(0x17f5cc0, 0x5)\r\n\t/home/beyang/go/src/runtime/panic.go:527 +0x90 fp=0xc8c9b63ac0 sp=0xc8c9b63aa8\r\nruntime.sigpanic()\r\n\t/home/beyang/go/src/runtime/sigpanic_unix.go:21 +0x10c fp=0xc8c9b63b10 sp=0xc8c9b63ac0\r\nruntime.mapassign1(0x12c6fe0, 0xc88283b998, 0xc8c9b63c68, 0xc8c9b63cd8)\r\n\t/home/beyang/go/src/runtime/hashmap.go:446 +0x1fb fp=0xc8c9b63bb8 sp=0xc8c9b63b10\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb925110, 0x27, 0x189e, 0xc8839696c0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:150 +0x233 fp=0xc8c9b63d30 sp=0xc8c9b63bb8\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb9250e0, 0x26, 0x189e, 0xc8839695e0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b63ea8 sp=0xc8c9b63d30\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb9250b0, 0x25, 0x189e, 0xc8839695c0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b64020 sp=0xc8c9b63ea8\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb925080, 0x24, 0x189e, 0xc8839695a0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b64198 sp=0xc8c9b64020\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb925050, 0x23, 0x189e, 0xc8531460c0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b64310 sp=0xc8c9b64198\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb925020, 0x22, 0x189e, 0xc886397c00)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b64488 sp=0xc8c9b64310\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb924ff0, 0x21, 0x189e, 0xc886397ac0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b64600 sp=0xc8c9b64488\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc88283a480, 0x20, 0x189e, 0xc8863978e0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b64778 sp=0xc8c9b64600\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc88283a440, 0x1f, 0x189e, 0xc886397840)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b648f0 sp=0xc8c9b64778\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc88283a400, 0x1e, 0x189e, 0xc8863976e0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b64a68 sp=0xc8c9b648f0\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc88283a3c0, 0x1d, 0x189e, 0xc886397580)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b64be0 sp=0xc8c9b64a68\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc88283a380, 0x1c, 0x189e, 0xc886397560)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b64d58 sp=0xc8c9b64be0\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc88283a340, 0x1b, 0x189e, 0xc886397540)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b64ed0 sp=0xc8c9b64d58\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc88283a300, 0x1a, 0x189e, 0xc886397520)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b65048 sp=0xc8c9b64ed0\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc88283a2c0, 0x19, 0x189e, 0xc886397500)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b651c0 sp=0xc8c9b65048\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc88283a280, 0x18, 0x189e, 0xc8863974e0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b65338 sp=0xc8c9b651c0\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc88283a240, 0x17, 0x189e, 0xc8863974c0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b654b0 sp=0xc8c9b65338\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc88283a200, 0x16, 0x189e, 0xc8863974a0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b65628 sp=0xc8c9b654b0\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc88283a1c0, 0x15, 0x189e, 0xc886397480)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b657a0 sp=0xc8c9b65628\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc88283a180, 0x14, 0x189e, 0xc886397460)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b65918 sp=0xc8c9b657a0\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc88283a140, 0x13, 0x189e, 0xc886397440)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b65a90 sp=0xc8c9b65918\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc88283a100, 0x12, 0x189e, 0xc886397420)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b65c08 sp=0xc8c9b65a90\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc88283a0c0, 0x11, 0x189e, 0xc886397400)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b65d80 sp=0xc8c9b65c08\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb929180, 0x10, 0x189e, 0xc8863973e0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b65ef8 sp=0xc8c9b65d80\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb929160, 0xf, 0x189e, 0xc8863973c0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b66070 sp=0xc8c9b65ef8\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb929140, 0xe, 0x189e, 0xc8863973a0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b661e8 sp=0xc8c9b66070\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb929120, 0xd, 0x189e, 0xc886397380)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b66360 sp=0xc8c9b661e8\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb929100, 0xc, 0x189e, 0xc886397360)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b664d8 sp=0xc8c9b66360\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb9290e0, 0xb, 0x189e, 0xc886397340)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b66650 sp=0xc8c9b664d8\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb9290c0, 0xa, 0x189e, 0xc886397320)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b667c8 sp=0xc8c9b66650\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb9290a0, 0x9, 0x189e, 0xc886397300)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b66940 sp=0xc8c9b667c8\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb929080, 0x8, 0x189e, 0xc8863972e0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b66ab8 sp=0xc8c9b66940\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb929060, 0x7, 0x189e, 0xc8863972c0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b66c30 sp=0xc8c9b66ab8\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb929050, 0x6, 0x189e, 0xc8863972a0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b66da8 sp=0xc8c9b66c30\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb93cd50, 0x5, 0x189e, 0xc887ae5aa0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b66f20 sp=0xc8c9b66da8\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb93cd30, 0x4, 0x189e, 0xc887ae5a80)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b67098 sp=0xc8c9b66f20\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb93cd10, 0x3, 0x189e, 0xc887ae5a60)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b67210 sp=0xc8c9b67098\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb93ccf0, 0x2, 0x189e, 0xc887ae5a40)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b67388 sp=0xc8c9b67210\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0xc8cb93cc30, 0x1, 0x189e, 0xc887ae59a0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b67500 sp=0xc8c9b67388\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build.func2(0x0, 0x0, 0xc88283189e, 0xc887a13320)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:154 +0x3d0 fp=0xc8c9b67678 sp=0xc8c9b67500\r\nsourcegraph.com/sourcegraph/srclib/store.(*defQueryTreeIndex).Build(0xc82f88d440, 0xc844e08e40, 0x0, 0x0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/def_query_tree_index.go:163 +0x17b4 fp=0xc8c9b67d58 sp=0xc8c9b67678\r\nsourcegraph.com/sourcegraph/srclib/store.(*indexedTreeStore).buildIndexes.func4(0x0, 0x0)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/sourcegraph.com/sourcegraph/srclib/store/indexed.go:478 +0x48e fp=0xc8c9b67f20 sp=0xc8c9b67d58\r\ncode.google.com/p/rog-go/parallel.(*Run).Do.func1(0xc82f88d500, 0xc83bd1a690)\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/code.google.com/p/rog-go/parallel/parallel.go:67 +0x48 fp=0xc8c9b67f60 sp=0xc8c9b67f20\r\nruntime.goexit()\r\n\t/home/beyang/go/src/runtime/asm_amd64.s:1696 +0x1 fp=0xc8c9b67f68 sp=0xc8c9b67f60\r\ncreated by code.google.com/p/rog-go/parallel.(*Run).Do\r\n\t/home/beyang/src/src.sourcegraph.com/sourcegraph/Godeps/_workspace/src/code.google.com/p/rog-go/parallel/parallel.go:70 +0x8f\r\n```\r\n\r\nUnfortunately, I have not been able to find a consistent repro for this. It happens about 25% of the time when running the program over a large dataset.\r\n\r\nThe hashmap assignment involves a local variable with no concurrency: https://sourcegraph.com/github.com/sourcegraph/srclib@2b53944d3fb5c9882f66bff716f396a0542eeec7/.tree/store/def_query_tree_index.go#startline=150\u0026endline=150.\r\n\r\nIssues #11286 and #12415 might be related, but don't appear to have the same underlying cause.\r\n\r\nThis issue does not seem to occur when `GOGC=off`.\r\n\r\nAny ideas about what might be the cause here, or if there are known fixes or workarounds? I'm still trying to construct a reliable repro, but any advice/insight would be appreciated!",
	"user": {
		"login": "beyang",
		"id": 1646931,
		"type": "User",
		"site_admin": false
	},
	"comments": 14,
	"closed_at": "2015-12-07T05:51:47Z",
	"created_at": "2015-10-27T05:33:18Z",
	"updated_at": "2015-12-07T20:01:33Z",
	"milestone": {
		"id": 1055141,
		"number": 6,
		"title": "Unplanned"
	}
}
