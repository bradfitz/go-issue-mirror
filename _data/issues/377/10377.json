{
	"id": 67103634,
	"number": 10377,
	"state": "closed",
	"title": "compress/flate: fails to decompress zlib format compressed data",
	"body": "First I apologize in advance in case if I just misunderstood some basics of Go language. I work with a REST API that compresses HTTP responses with *deflate* algorithm. So I wasn't able to decompress JSON object from HTTP body with Go standard library tools. Please check the test file (actually it is a dumped HTTP body) and code below:\r\n\r\n#### Input data\r\n[File](http://www.fileconvoy.com/dfl.php?id=ga99041ebbf48e64299964773675b53e95a8effc5e) with *deflate* encoded JSON object\r\n```bash\r\n$ cat test\r\nx��PAN�0\u0010�\r\n;��NtJ�F\u001bӮdU�|\"oVR�C%�f\u001f�����Z.�^Hs�dW뮑�'��DH�S�\u0016SFVC��\u0013��r)\u0004\u001bG,�����\u003c���z}�x_\u0018g�+\u0014�2�\u001f�sl�r/�Oy\u003e��J3\u0006\\�G�9���N���#[5M�^v/�2Ҕ\u0012��|�\u001fh��[�~7�_\u0003崛\u003cD*���\u001b/��\u0019i\r\n```\r\nLet's make sure that this file can be decompressed and even contains valid JSON:\r\n```bash\r\n$ zlib-flate -uncompress \u003c test\r\n{\"timestamp\":{\"tv_sec\":1428488670,\"tv_usec\":197041},\"string_timestamp\":\"2015-04-08 10:24:30.197041\",\"monitor_status\":\"enabled\",\"commands\":{\"REVERSE_LOOKUP\":{\"cache\":{\"outside\":{\"successes\":0,\"failures\":0,\"size\":0,\"time\":0},\"internal\":{\"successes\":0,\"failures\":0,\"size\":0,\"time\":0}},\"disk\":{\"outside\":{\"successes\":0,\"failures\":0,\"size\":0,\"time\":0},\"internal\":{\"successes\":13366,\"failures\":0,\"size\":0,\"time\":501808}},\"total\":{\"storage\":{\"successes\":0,\"failures\":0},\"proxy\":{\"successes\":13366,\"failures\":0}}},\"clients\":{}}}\r\n$ zlib-flate -uncompress \u003c test | python -m json.tool\r\n{\r\n    \"commands\": {\r\n        \"REVERSE_LOOKUP\": {\r\n            \"cache\": {\r\n               ....\r\n```\r\n\r\n#### Source code\r\nI am going to decompress it with Go:\r\n```go\r\npackage main\r\n\r\nimport (\r\n\t\"bytes\"\r\n\t\"compress/flate\"\r\n\t\"fmt\"\r\n\t\"io/ioutil\"\r\n)\r\n\r\nfunc main() {\r\n\tfname := \"./test\"\r\n\tcontent, err := ioutil.ReadFile(fname)\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\tfmt.Println(\"File content:\\n\", content)\r\n\r\n\tenflated, err := ioutil.ReadAll(flate.NewReader(bytes.NewReader(content)))\r\n\tif err != nil {\r\n\t\tpanic(err)\r\n\t}\r\n\tfmt.Println(\"Enflated:\\n\", enflated)\r\n}\r\n```\r\n\r\n#### Error\r\n```bash\r\n$ go run uncompress.go \r\nFile content:\r\n [120 156 181 80 65 78 195 48 16 252 10 242 57 69 118 226 166 38 247 156 64 42 42 130 107 100 156 165 88 196 118 149 93 35 160 234 223 89 183 61 112 42 226 192 109 118 118 102 103 180 123 65 62 0 146 13 59 209 237 5 189 15 8 78 116 74 215 70 27 211 174 100 85 184 124 34 111 86 82 171 67 37 144 102 31 183 195 15 167 168 165 90 46 164 94 72 115 165 100 87 235 174 145 215 39 189 168 68 72 209 83 154 7 22 83 70 86 67 180 207 19 140 188 114 41 4 27 71 44 225 155 254 169 223 60 244 195 221 122 125 251 120 95 24 103 221 43 20 144 50 161 31 143 16 179 115 128 8 108 225 114 47 214 79 121 62 15 232 191 224 8 74 51 6 92 213 71 130 57 218 233 175 78 182 142 30 223 254 35 91 53 77 219 94 118 47 165 50 210 148 18 148 232 124 128 31 104 183 151 91 176 126 55 167 143 207 95 3 15 229 180 155 60 68 42 159 231 241 27 47 165 167 25]\r\npanic: flate: corrupt input before offset 5\r\n\r\ngoroutine 1 [running]:\r\nruntime.panic(0x4a7180, 0x5)\r\n\t/usr/lib/go/src/pkg/runtime/panic.c:266 +0xb6\r\nmain.main()\r\n\t/home/isaev/side-projects/elliptics-manager/uncompress.go:20 +0x2a3\r\nexit status 2\r\n```\r\n\r\n#### Version\r\nI use Ubuntu 14.10, Go 1.2.1:\r\n```bash\r\n$ dpkg -l | grep golang\r\nii  golang                                               2:1.2.1-2ubuntu1                         all          Go programming language compiler - metapackage\r\nii  golang-doc                                           2:1.2.1-2ubuntu1                         all          Go programming language compiler - documentation\r\nii  golang-go                                            2:1.2.1-2ubuntu1                         amd64        Go programming language compiler\r\nii  golang-go-linux-amd64                                2:1.2.1-2ubuntu1                         amd64        Go standard library compiled for linux_amd64\r\nii  golang-src                                           2:1.2.1-2ubuntu1                         amd64        Go programming language compiler - source files\r\n```\r\n\r\nAny help will be appreciated. ",
	"user": {
		"login": "vitalyisaev2",
		"id": 5507054,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"comments": 3,
	"closed_at": "2015-04-08T12:10:05Z",
	"created_at": "2015-04-08T10:56:55Z",
	"updated_at": "2016-06-25T02:05:01Z"
}
