{
	"id": 51278216,
	"number": 1725,
	"state": "closed",
	"title": "panic: runtime error: slice bounds out of range in bufio -\u003e net/textproto",
	"body": "by **tarmigan**:\n\n\u003cpre\u003eI have a go program that does about 3000 http.Get() calls and parses the results.  This\nprogram used to work (last time I rebuilt it was few months ago), but after updating to\nhg 14e85394f65e (\u0026quot;http: close underlying gzip Reader too\u0026quot;) it panics.  \nLooking at the backtrace, I don't think my program is at fault.  Looks like bufio got\ninto an inconsistent state somehow.  I have reproduced it twice now, so I may be able to\nadd debugging prints if needed.\n\nGOOS=darwin GOARCH=386\n\nThanks,\nTarmigan\n\n\npanic: runtime error: slice bounds out of range\n\nruntime.panic+0x92 /Users/tarm/devel/go/src/pkg/runtime/proc.c:1034\n\truntime.panic(0xf1a8c, 0x10b19018)\nruntime.panicstring+0x8f /Users/tarm/devel/go/src/pkg/runtime/runtime.c:116\n\truntime.panicstring(0x1d5879, 0x0)\nruntime.panicslice+0x24 /Users/tarm/devel/go/src/pkg/runtime/runtime.c:79\n\truntime.panicslice()\nbufio.*Reader·ReadSlice+0x6b /Users/tarm/devel/go/src/pkg/bufio/bufio.go:252\n\tbufio.*Reader·ReadSlice(0x10906f90, 0xa, 0x0, 0x0, 0x0, ...)\nbufio.*Reader·ReadBytes+0x84 /Users/tarm/devel/go/src/pkg/bufio/bufio.go:327\n\tbufio.*Reader·ReadBytes(0x10906f90, 0xa, 0x0, 0x0, 0x0, ...)\nnet/textproto.*Reader·ReadLineBytes+0x39\n/Users/tarm/devel/go/src/pkg/net/textproto/reader.go:43\n\tnet/textproto.*Reader·ReadLineBytes(0x10b19010, 0x0, 0x0)\nnet/textproto.*Reader·ReadLine+0x26\n/Users/tarm/devel/go/src/pkg/net/textproto/reader.go:36\n\tnet/textproto.*Reader·ReadLine(0x10b19010, 0x3, 0x105a98)\nhttp.ReadResponse+0x96 /Users/tarm/devel/go/src/pkg/http/response.go:88\n\thttp.ReadResponse(0x10906f90, 0x105a98, 0x3, 0x10855300, 0x0, ...)\nhttp.readResponseWithEOFSignal+0x3b /Users/tarm/devel/go/src/pkg/http/transport.go:577\n\thttp.readResponseWithEOFSignal(0x10906f90, 0x105a98, 0x3, 0x0, 0x0, ...)\nhttp.*ClientConn·Read+0x2fd /Users/tarm/devel/go/src/pkg/http/persist.go:368\n\thttp.*ClientConn·Read(0x10a7d930, 0x10d04e00, 0x0, 0x0, 0x0, ...)\nhttp.*persistConn·readLoop+0x246 /Users/tarm/devel/go/src/pkg/http/transport.go:450\n\thttp.*persistConn·readLoop(0x108fbd00, 0xea23)\nruntime.goexit /Users/tarm/devel/go/src/pkg/runtime/proc.c:178\n\truntime.goexit()\n----- goroutine created by -----\nhttp.*Transport·getConn+0x4db /Users/tarm/devel/go/src/pkg/http/transport.go:289\n\ngoroutine 5470 [4]:\nruntime.gosched+0x61 /Users/tarm/devel/go/src/pkg/runtime/proc.c:600\n\truntime.gosched()\nruntime.chanrecv+0x3af /Users/tarm/devel/go/src/pkg/runtime/chan.c:329\n\truntime.chanrecv(0x108c9b40, 0x67ee38, 0x0, 0x0, 0x67ee40, ...)\nruntime.chanrecv1+0x3f /Users/tarm/devel/go/src/pkg/runtime/chan.c:424\n\truntime.chanrecv1(0x108c9b40, 0x108551e0)\nhttp.*persistConn·readLoop+0x437 /Users/tarm/devel/go/src/pkg/http/transport.go:481\n\thttp.*persistConn·readLoop(0x10987200, 0xea23)\nruntime.goexit /Users/tarm/devel/go/src/pkg/runtime/proc.c:178\n\truntime.goexit()\n----- goroutine created by -----\nhttp.*Transport·getConn+0x4db /Users/tarm/devel/go/src/pkg/http/transport.go:289\n\ngoroutine 5469 [4]:\nruntime.gosched+0x61 /Users/tarm/devel/go/src/pkg/runtime/proc.c:600\n\truntime.gosched()\nruntime.chanrecv+0x3af /Users/tarm/devel/go/src/pkg/runtime/chan.c:329\n\truntime.chanrecv(0x108c96c0, 0x67de38, 0x0, 0x0, 0x67de40, ...)\nruntime.chanrecv1+0x3f /Users/tarm/devel/go/src/pkg/runtime/chan.c:424\n\truntime.chanrecv1(0x108c96c0, 0x10855120)\nhttp.*persistConn·readLoop+0x437 /Users/tarm/devel/go/src/pkg/http/transport.go:481\n\thttp.*persistConn·readLoop(0x108c9800, 0xea23)\nruntime.goexit /Users/tarm/devel/go/src/pkg/runtime/proc.c:178\n\truntime.goexit()\n----- goroutine created by -----\nhttp.*Transport·getConn+0x4db /Users/tarm/devel/go/src/pkg/http/transport.go:289\n\ngoroutine 5420 [1]:\nruntime.gosched+0x61 /Users/tarm/devel/go/src/pkg/runtime/proc.c:600\n\truntime.gosched()\nruntime.exitsyscall+0x64 /Users/tarm/devel/go/src/pkg/runtime/proc.c:665\n\truntime.exitsyscall()\nsyscall.Syscall6+0x4b /Users/tarm/devel/go/src/pkg/syscall/asm_darwin_386.s:61\n\tsyscall.Syscall6()\nsyscall.kevent+0x58 /Users/tarm/devel/go/src/pkg/syscall/zsyscall_darwin_386.go:158\n\tsyscall.kevent(0x11, 0x1082cfd8, 0x1, 0x1082cfd8, 0x1, ...)\nsyscall.Kevent+0x84 /Users/tarm/devel/go/src/pkg/syscall/syscall_bsd.go:441\n\tsyscall.Kevent(0x11, 0x1082cfd8, 0x1, 0x1, 0x1082cfd8, ...)\nnet.*pollster·AddFD+0x133 /Users/tarm/devel/go/src/pkg/net/fd_darwin.go:54\n\tnet.*pollster·AddFD(0x1082cf00, 0x29, 0x72, 0x0, 0x8, ...)\nnet.*pollServer·AddFD+0x1b0 /Users/tarm/devel/go/src/pkg/net/fd.go:125\n\tnet.*pollServer·AddFD(0x108a1f90, 0x10be6e00, 0x72, 0x4)\nnet.*pollServer·WaitRead+0x36 /Users/tarm/devel/go/src/pkg/net/fd.go:254\n\tnet.*pollServer·WaitRead(0x108a1f90, 0x10be6e00, 0x1000)\nnet.*netFD·Read+0x1be /Users/tarm/devel/go/src/pkg/net/fd.go:380\n\tnet.*netFD·Read(0x10be6e00, 0x10a76000, 0x1000, 0x1000, 0x0, ...)\nnet.*TCPConn·Read+0x6d /Users/tarm/devel/go/src/pkg/net/tcpsock.go:94\n\tnet.*TCPConn·Read(0x109e1bf8, 0x10a76000, 0x1000, 0x1000, 0x0, ...)\nbufio.*Reader·fill+0x14f /Users/tarm/devel/go/src/pkg/bufio/bufio.go:97\n\tbufio.*Reader·fill(0x10ba1900, 0x20)\nbufio.*Reader·Peek+0xb5 /Users/tarm/devel/go/src/pkg/bufio/bufio.go:116\n\tbufio.*Reader·Peek(0x10ba1900, 0x1, 0x0, 0x0)\nhttp.*persistConn·readLoop+0x7f /Users/tarm/devel/go/src/pkg/http/transport.go:433\n\thttp.*persistConn·readLoop(0x10ab6600, 0xea23)\nruntime.goexit /Users/tarm/devel/go/src/pkg/runtime/proc.c:178\n\truntime.goexit()\n----- goroutine created by -----\nhttp.*Transport·getConn+0x4db /Users/tarm/devel/go/src/pkg/http/transport.go:289\n\ngoroutine 5286 [4]:\nruntime.gosched+0x61 /Users/tarm/devel/go/src/pkg/runtime/proc.c:600\n\truntime.gosched()\nruntime.chanrecv+0x14d /Users/tarm/devel/go/src/pkg/runtime/chan.c:361\n\truntime.chanrecv(0x109873c0, 0x673b78, 0x0, 0x0, 0x1000, ...)\nruntime.chanrecv1+0x3f /Users/tarm/devel/go/src/pkg/runtime/chan.c:424\n\truntime.chanrecv1(0x109873c0, 0x10f37c00)\nnet.*pollServer·WaitRead+0x47 /Users/tarm/devel/go/src/pkg/net/fd.go:255\n\tnet.*pollServer·WaitRead(0x108a1f90, 0x10f37c00, 0x1000)\nnet.*netFD·Read+0x1be /Users/tarm/devel/go/src/pkg/net/fd.go:380\n\tnet.*netFD·Read(0x10f37c00, 0x111ba000, 0x1000, 0x1000, 0x0, ...)\nnet.*TCPConn·Read+0x6d /Users/tarm/devel/go/src/pkg/net/tcpsock.go:94\n\tnet.*TCPConn·Read(0x109e1858, 0x111ba000, 0x1000, 0x1000, 0x0, ...)\nbufio.*Reader·fill+0x14f /Users/tarm/devel/go/src/pkg/bufio/bufio.go:97\n\tbufio.*Reader·fill(0x10f2a8d0, 0x20)\nbufio.*Reader·Peek+0xb5 /Users/tarm/devel/go/src/pkg/bufio/bufio.go:116\n\tbufio.*Reader·Peek(0x10f2a8d0, 0x1, 0x0, 0x0)\nhttp.*persistConn·readLoop+0x7f /Users/tarm/devel/go/src/pkg/http/transport.go:433\n\thttp.*persistConn·readLoop(0x10c52840, 0xea23)\nruntime.goexit /Users/tarm/devel/go/src/pkg/runtime/proc.c:178\n\truntime.goexit()\n----- goroutine created by -----\n\n[ more backtrace.  Can include if needed]\u003c/pre\u003e",
	"user": {
		"login": "gopherbot",
		"id": 8566911,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"assignee": {
		"login": "bradfitz",
		"id": 2621,
		"type": "User",
		"site_admin": false
	},
	"comments": 31,
	"closed_at": "2014-12-08T10:09:36Z",
	"created_at": "2011-04-22T00:08:06Z",
	"updated_at": "2016-06-24T19:27:56Z"
}
