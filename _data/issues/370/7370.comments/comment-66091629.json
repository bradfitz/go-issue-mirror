{
	"id": 66091629,
	"body": "\u003ca id=\"c6\"\u003e\u003c/a\u003eComment 6:\n\n\u003cpre\u003eNot 100% sure it's the same issue any longer, but this is now 99% reproducible with the\nattached stripped-down append.go from tests. Run it with:\n\nGODEBUG=efence=1 go run append.go\n\nWith 6g, all's well. With 8g, I see panics like:\n\n\nunexpected fault address 0x107c84f7\nfatal error: fault\n[signal 0xb code=0x1 addr=0x107c84f7 pc=0xaeec]\n\ngoroutine 16 [running]:\nruntime.throw(0x11b888)\n\t.../src/pkg/runtime/panic.c:463 +0x5f fp=0x3034c830\nruntime.sigpanic()\n\t.../src/pkg/runtime/os_darwin.c:453 +0xf0 fp=0x3034c83c\nMHeap_FreeLocked(0x129b40, 0x109e191c)\n\t.../src/pkg/runtime/mheap.c:433 +0x16c fp=0x3034c864\nMHeap_Grow(0x129b40, 0x10)\n\t.../src/pkg/runtime/mheap.c:341 +0x165 fp=0x3034c88c\nMHeap_AllocLocked(0x129b40, 0x1, 0x0)\n\t.../src/pkg/runtime/mheap.c:222 +0x2fc fp=0x3034c8ac\nruntime.MHeap_Alloc(0x129b40, 0x1, 0x0, 0x101)\n\t.../src/pkg/runtime/mheap.c:178 +0x79 fp=0x3034c8c0\nlargealloc(0x0, 0x3034c920)\n\t.../src/pkg/runtime/malloc.goc:232 +0x91 fp=0x3034c8e4\nruntime.mallocgc(0x8, 0x7c660, 0x0)\n\t.../src/pkg/runtime/malloc.goc:167 +0x9e fp=0x3034c920\ncnew(0x7c660, 0x1, 0x0)\n\t.../src/pkg/runtime/malloc.goc:848 +0xa7 fp=0x3034c930\nruntime.cnew(0x7c660)\n\t.../src/pkg/runtime/malloc.goc:855 +0x39 fp=0x3034c940\nreflect.unsafe_New(0x7c660, 0x102c4228)\n\t.../src/pkg/runtime/iface.goc:578 +0x28 fp=0x3034c948\nreflect.packEface(0x7c660, 0x113f0228, 0x0, 0x187, 0x0, ...)\n\t.../src/pkg/reflect/value.go:137 +0x82 fp=0x3034c97c\nreflect.valueInterface(0x7c660, 0x113f0228, 0x0, 0x187, 0x0, ...)\n\t.../src/pkg/reflect/value.go:1081 +0x1a8 fp=0x3034c9d8\nreflect.deepValueEqual(0x7c660, 0x113f0228, 0x0, 0x187, 0x7c660, ...)\n\t.../src/pkg/reflect/deepequal.go:125 +0x5eb fp=0x3034cb4c\nreflect.deepValueEqual(0x8eda0, 0x113f0228, 0x0, 0x196, 0x8eda0, ...)\n\t.../src/pkg/reflect/deepequal.go:96 +0xbe5 fp=0x3034ccc0\nreflect.deepValueEqual(0x7a160, 0x1245c000, 0x0, 0x172, 0x7a160, ...)\n\t.../src/pkg/reflect/deepequal.go:82 +0xaeb fp=0x3034ce34\nreflect.DeepEqual(0x7a160, 0x1245c000, 0x7a160, 0x1245e000, 0x1ae9c)\n\t.../src/pkg/reflect/deepequal.go:144 +0x17b fp=0x3034ceb8\nmain.verify(0xa4508, 0x19, 0x7a160, 0x1245c000, 0x7a160, ...)\n\t.../test/append.go:21 +0x4d fp=0x3034cef8\nmain.main()\n\t.../test/append.go:33 +0x308 fp=0x3034cf98\nruntime.main()\n\t.../src/pkg/runtime/proc.c:231 +0xfa fp=0x3034cfcc\nruntime.goexit()\n\t.../src/pkg/runtime/proc.c:1438 fp=0x3034cfd0\ncreated by _rt0_go\n\t.../src/pkg/runtime/asm_386.s:101 +0xf7\n\n\nand\n\n\nSIGSEGV: segmentation violation\nPC=0x7fb2\n\nruntime.MSpan_Sweep(0x107c7fd0)\n\t.../src/pkg/runtime/mgc0.c:1774 +0x102\nruntime.sweepone()\n\t.../src/pkg/runtime/mgc0.c:1952 +0xd3\ngc(0x3034c8d8)\n\t.../src/pkg/runtime/mgc0.c:2322 +0xea\nmgc(0x1025e000)\n\t.../src/pkg/runtime/mgc0.c:2283 +0x2b\nruntime.mcall(0x2217f)\n\t.../src/pkg/runtime/asm_386.s:190 +0x3c\n\ngoroutine 16 [garbage collection]:\nruntime.gc(0x0)\n\t.../src/pkg/runtime/mgc0.c:2252 +0x196 fp=0x3034c8e4\nruntime.mallocgc(0x2000, 0x7c660, 0x0)\n\t.../src/pkg/runtime/malloc.goc:213 +0x186 fp=0x3034c920\ncnew(0x7c660, 0x1, 0x0)\n\t.../src/pkg/runtime/malloc.goc:848 +0xa7 fp=0x3034c930\nruntime.cnew(0x7c660)\n\t.../src/pkg/runtime/malloc.goc:855 +0x39 fp=0x3034c940\nreflect.unsafe_New(0x7c660, 0x25f90148)\n\t.../src/pkg/runtime/iface.goc:578 +0x28 fp=0x3034c948\nreflect.packEface(0x7c660, 0x102c4150, 0x0, 0x187, 0x0, ...)\n\t.../src/pkg/reflect/value.go:137 +0x82 fp=0x3034c97c\nreflect.valueInterface(0x7c660, 0x102c4150, 0x0, 0x187, 0x0, ...)\n\t.../src/pkg/reflect/value.go:1081 +0x1a8 fp=0x3034c9d8\nreflect.deepValueEqual(0x7c660, 0x25f90150, 0x0, 0x187, 0x7c660, ...)\n\t.../src/pkg/reflect/deepequal.go:125 +0x5bf fp=0x3034cb4c\nreflect.deepValueEqual(0x8eda0, 0x25f90150, 0x0, 0x196, 0x8eda0, ...)\n\t.../src/pkg/reflect/deepequal.go:96 +0xbe5 fp=0x3034ccc0\nreflect.deepValueEqual(0x7a160, 0x25f92000, 0x0, 0x172, 0x7a160, ...)\n\t.../src/pkg/reflect/deepequal.go:82 +0xaeb fp=0x3034ce34\nreflect.DeepEqual(0x7a160, 0x25f92000, 0x7a160, 0x25f94000, 0x1ae9c)\n\t.../src/pkg/reflect/deepequal.go:144 +0x17b fp=0x3034ceb8\nmain.verify(0x9ccd8, 0x8, 0x7a160, 0x25f92000, 0x7a160, ...)\n\t.../test/append.go:21 +0x4d fp=0x3034cef8\nmain.main()\n\t.../test/append.go:32 +0x282 fp=0x3034cf98\nruntime.main()\n\t.../src/pkg/runtime/proc.c:231 +0xfa fp=0x3034cfcc\nruntime.goexit()\n\t.../src/pkg/runtime/proc.c:1438 fp=0x3034cfd0\ncreated by _rt0_go\n\t.../src/pkg/runtime/asm_386.s:101 +0xf7\n\neax     0x3024b000\nebx     0x107c7fe4\necx     0x2b\nedx     0x0\nedi     0x107c8010\nesi     0x2000\nebp     0x107c7fd0\nesp     0x30364de8\neip     0x7fb2\neflags  0x10202\ncs      0x1b\nfs      0x23\ngs      0xf\u003c/pre\u003e\n\n\n\n\n\nAttachments:\n\n1. \u003ca href=\"https://storage.googleapis.com/go-attachment/7370/6/append.go\"\u003eappend.go\u003c/a\u003e (642 bytes)",
	"user": {
		"login": "josharian",
		"id": 67496,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2014-02-26T02:39:43Z",
	"updated_at": "2014-12-08T10:41:01Z"
}
