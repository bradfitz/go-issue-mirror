{
	"id": 78782743,
	"number": 10923,
	"state": "open",
	"title": "x/tools/cmd/eg: \"panic: unreachable\" while refactoring struct literals with unkeyed fields",
	"body": "This occurred while refactoring cmd/internal/obj's ProgInfo tables not to use unkeyed fields.\r\n\r\n$GOPATH/src/egbug/x.go:\r\n\r\n```\r\npackage egbug\r\n\r\ntype T struct {\r\n\tX int\r\n}\r\n\r\nfunc NewT(x int) T {\r\n\treturn T{X: x}\r\n}\r\n\r\nfunc f() {\r\n\tvar x int\r\n\tvar _ T = T{x}\r\n}\r\n```\r\n\r\nTemplate:\r\n\r\n```\r\npackage p\r\n\r\nimport \"egbug\"\r\n\r\nfunc before(x int) egbug.T { return egbug.T{x} }\r\nfunc after(x int) egbug.T  { return egbug.NewT(x) }\r\n```\r\n\r\neg output:\r\n\r\n```\r\npanic: unreachable\r\n\r\ngoroutine 1 [running]:\r\ngolang.org/x/tools/go/types.unreachable()\r\n\tgolang.org/x/tools/go/types/errors.go:23 +0x6c\r\ngolang.org/x/tools/go/types.identical(0x0, 0x0, 0x22086933e0, 0x45a340, 0x0, 0x2208694538)\r\n\tgolang.org/x/tools/go/types/predicates.go:281 +0x2f4\r\ngolang.org/x/tools/go/types.Identical(0x0, 0x0, 0x22086933e0, 0x45a340, 0x578fb646)\r\n\tgolang.org/x/tools/go/types/predicates.go:115 +0x4f\r\ngolang.org/x/tools/go/types.(*operand).assignableTo(0x20858f260, 0x0, 0x22086933e0, 0x45a340, 0x0)\r\n\tgolang.org/x/tools/go/types/operand.go:214 +0xbe\r\ngolang.org/x/tools/go/types.AssignableTo(0x0, 0x0, 0x22086933e0, 0x45a340, 0x0)\r\n\tgolang.org/x/tools/go/types/api.go:352 +0x8d\r\ngolang.org/x/tools/refactor/eg.(*Transformer).matchWildcard(0x2084f4100, 0x2084f3a40, 0x2208693c48, 0x2084ef5c0, 0x2084dd824)\r\n\tgolang.org/x/tools/refactor/eg/match.go:188 +0x414\r\ngolang.org/x/tools/refactor/eg.(*Transformer).matchExpr(0x2084f4100, 0x2208693b68, 0x2084ed6e0, 0x2208693c48, 0x2084ef5c0, 0x2084ef890)\r\n\tgolang.org/x/tools/refactor/eg/match.go:40 +0x23f\r\ngolang.org/x/tools/refactor/eg.(*Transformer).matchExprs(0x2084f4100, 0x2084f0f40, 0x1, 0x1, 0x2084f0a80, 0x1, 0x1, 0x2208693410)\r\n\tgolang.org/x/tools/refactor/eg/match.go:143 +0xb5\r\ngolang.org/x/tools/refactor/eg.(*Transformer).matchExpr(0x2084f4100, 0x2208693c80, 0x2084e9940, 0x2208693c80, 0x2084e9140, 0x2084e9140)\r\n\tgolang.org/x/tools/refactor/eg/match.go:79 +0xa8c\r\ngolang.org/x/tools/refactor/eg.(*Transformer).Transform.func1(0x2b0f20, 0x2084e9140, 0x16, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:58 +0x1cd\r\ngolang.org/x/tools/refactor/eg.apply(0x2085918d0, 0x29c7c0, 0x2084f0a90, 0xd4, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:186 +0x2cf\r\ngolang.org/x/tools/refactor/eg.(*Transformer).Transform.func1(0x29c7c0, 0x2084f0a90, 0xd4, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:51 +0xc4\r\ngolang.org/x/tools/refactor/eg.apply(0x2085918d0, 0x2200c0, 0x2084ecdc8, 0xd7, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:177 +0x42b\r\ngolang.org/x/tools/refactor/eg.(*Transformer).Transform.func1(0x2200c0, 0x2084ecdc8, 0xd7, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:51 +0xc4\r\ngolang.org/x/tools/refactor/eg.apply(0x2085918d0, 0x2b2900, 0x2084ecdc0, 0x16, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:182 +0x566\r\ngolang.org/x/tools/refactor/eg.(*Transformer).Transform.func1(0x2b2900, 0x2084ecdc0, 0x16, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:51 +0xc4\r\ngolang.org/x/tools/refactor/eg.apply(0x2085918d0, 0x29c980, 0x2084f0aa0, 0xd4, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:186 +0x2cf\r\ngolang.org/x/tools/refactor/eg.(*Transformer).Transform.func1(0x29c980, 0x2084f0aa0, 0xd4, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:51 +0xc4\r\ngolang.org/x/tools/refactor/eg.apply(0x2085918d0, 0x2201e0, 0x2084ef5f8, 0xd7, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:177 +0x42b\r\ngolang.org/x/tools/refactor/eg.(*Transformer).Transform.func1(0x2201e0, 0x2084ef5f8, 0xd7, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:51 +0xc4\r\ngolang.org/x/tools/refactor/eg.apply(0x2085918d0, 0x2b0740, 0x2084ef640, 0xd6, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:182 +0x566\r\ngolang.org/x/tools/refactor/eg.(*Transformer).Transform.func1(0x2b0740, 0x2084ef640, 0xd6, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:51 +0xc4\r\ngolang.org/x/tools/refactor/eg.apply(0x2085918d0, 0x2b1820, 0x2084ef620, 0x16, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:182 +0x566\r\ngolang.org/x/tools/refactor/eg.(*Transformer).Transform.func1(0x2b1820, 0x2084ef620, 0x16, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:51 +0xc4\r\ngolang.org/x/tools/refactor/eg.apply(0x2085918d0, 0x29c6e0, 0x2084ef660, 0xd4, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:186 +0x2cf\r\ngolang.org/x/tools/refactor/eg.(*Transformer).Transform.func1(0x29c6e0, 0x2084ef660, 0xd4, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:51 +0xc4\r\ngolang.org/x/tools/refactor/eg.apply(0x2085918d0, 0x220060, 0x208564398, 0xd7, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:177 +0x42b\r\ngolang.org/x/tools/refactor/eg.(*Transformer).Transform.func1(0x220060, 0x208564398, 0xd7, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:51 +0xc4\r\ngolang.org/x/tools/refactor/eg.apply(0x2085918d0, 0x29d080, 0x208564380, 0x16, 0x0, 0x0, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:182 +0x566\r\ngolang.org/x/tools/refactor/eg.(*Transformer).Transform(0x2084f4100, 0x20856aa40, 0x2084f3130, 0x208564380, 0x0)\r\n\tgolang.org/x/tools/refactor/eg/rewrite.go:83 +0x529\r\nmain.doMain(0x0, 0x0)\r\n\tgolang.org/x/tools/cmd/eg/eg.go:113 +0x8f5\r\nmain.main()\r\n\tgolang.org/x/tools/cmd/eg/eg.go:49 +0x27\r\n```\r\n",
	"user": {
		"login": "josharian",
		"id": 67496,
		"type": "User",
		"site_admin": false
	},
	"assignee": {
		"login": "alandonovan",
		"id": 8433140,
		"type": "User",
		"site_admin": false
	},
	"comments": 2,
	"created_at": "2015-05-21T02:04:33Z",
	"updated_at": "2015-05-22T19:31:44Z",
	"milestone": {
		"id": 1067491,
		"number": 22,
		"title": "Unreleased"
	}
}
