{
	"id": 66080403,
	"body": "\u003ca id=\"c6\"\u003e\u003c/a\u003eComment 6:\n\n\u003cpre\u003eThe os package interface is intended to be uniform across all operating systems. The\nWindows syscall.Getenv function should be equivalent to the Unix syscall.Getenv function.\n\nThe os.Setenv function calls syscall.Setenv which, on Windows, calls\nsycall.SetEnvironmentVariable.\n\nSetEnvironmentVariable function\n\u003ca href=\"http://msdn.microsoft.com/en-us/library/windows/desktop/ms686206.aspx\"\u003ehttp://msdn.microsoft.com/en-us/library/windows/desktop/ms686206.aspx\u003c/a\u003e\n\nOn Windows, syscall.Setenv wrongly converts an empty value string to a nil pointer\nbefore calling sycall.SetEnvironmentVariable. For example, os.Setenv(\"ENV_VAR\", \"\")\ncalls syscall.Setenv(\"ENV_VAR\", \"\") which calls\nsyscall.SetEnvironmentVariable(\"ENV_VAR\\x00\", nil) which asks for the variable \"ENV_VAR\"\nto be deleted from the current process's environment.\n\nThe 5610.diff file contains this patch to fix the issue.\n\ndiff --git a/src/pkg/syscall/env_windows.go b/src/pkg/syscall/env_windows.go\n--- a/src/pkg/syscall/env_windows.go\n+++ b/src/pkg/syscall/env_windows.go\n@@ -35,13 +35,9 @@\n }\n \n func Setenv(key, value string) error {\n-\tvar v *uint16\n-\tvar err error\n-\tif len(value) \u003e 0 {\n-\t\tv, err = UTF16PtrFromString(value)\n-\t\tif err != nil {\n-\t\t\treturn err\n-\t\t}\n+\tv, err := UTF16PtrFromString(value)\n+\tif err != nil {\n+\t\treturn err\n \t}\n \tkeyp, err := UTF16PtrFromString(key)\n \tif err != nil {\n\nThe 5610.go file illustrates and tests for the error.\n\nWindows 7 64-bit\ngo version devel +8c7d0793f4d5 Sun Jun 02 11:36:09 2013 +0200 windows/386\ngo version devel +8c7d0793f4d5 Sun Jun 02 11:36:09 2013 +0200 windows/amd64\nError: FAKE_ENV_VAR_EXISTS=\"\": deleted\nError: FAKE_ENV_VAR=\"\": not created\n\nWindows XP 32-bit\ngo version devel +31ab5b976437 Sun Jun 02 01:45:26 2013 +0400 windows/386\nError: FAKE_ENV_VAR_EXISTS=\"\": deleted\nFAKE_ENV_VAR=\"\": setenv: The system could not find the environment option that was\nentered.\nError: FAKE_ENV_VAR=\"\": not created\u003c/pre\u003e\n\n\n\n\n\nAttachments:\n\n1. \u003ca href=\"https://storage.googleapis.com/go-attachment/5610/6/5610.diff\"\u003e5610.diff\u003c/a\u003e (477 bytes)\n1. \u003ca href=\"https://storage.googleapis.com/go-attachment/5610/6/5610.go\"\u003e5610.go\u003c/a\u003e (1787 bytes)",
	"user": {
		"login": "peterGo",
		"id": 4561296,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2013-06-02T14:13:21Z",
	"updated_at": "2014-12-08T10:30:34Z"
}
