{
	"id": 51281895,
	"number": 4272,
	"state": "closed",
	"title": "cmd/ld: support R_X86_64_64 relocation for dynamic symbol",
	"body": "\u003cpre\u003eWhen trying to wrap a library using cgo on amd64 I keep getting\nunexpected R_X86_64_64 relocation for dynamic symbol. The C sources are\nin the same directory as the go source and get built by \u0026quot;go\ntest (/install)\u0026quot;. The error occurs on both go1 and tip.\n\nThis was posted to -nuts and it was suggested that an issue should be filed.\n\nCode: \u003ca href=\"https://github.com/taruti/tidy-html5/tree/master/go/tidyhtml5\"\u003ehttps://github.com/taruti/tidy-html5/tree/master/go/tidyhtml5\u003c/a\u003e\n\nDebugging:\n\ntaruti@gate:~/go-work/src/github.com/taruti/tidy-html5/go/tidyhtml5$ go\ntest -x\nWORK=/tmp/go-build850086970\nmkdir -p\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/github.com/taruti/tidy-html5/go/\nmkdir -p $WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/\ncd /home/taruti/go-work/src/github.com/taruti/tidy-html5/go/tidyhtml5\n/usr/lib/go/pkg/tool/linux_amd64/cgo -objdir\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -- -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ tidyhtml5.go\n/usr/lib/go/pkg/tool/linux_amd64/6c -FVw -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -I\n/usr/lib/go/pkg/linux_amd64 -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_cgo_defun.6\n-DGOOS_linux -DGOARCH_amd64\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_cgo_defun.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -print-libgcc-file-name\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_cgo_main.o -c\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_cgo_main.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_cgo_export.o -c\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_cgo_export.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/tidyhtml5.cgo2.o\n-c\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/tidyhtml5.cgo2.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/access.o -c\n./access.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/alloc.o -c\n./alloc.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/attrask.o -c\n./attrask.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/attrdict.o -c\n./attrdict.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/attrget.o -c\n./attrget.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/attrs.o -c\n./attrs.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/buffio.o -c\n./buffio.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/clean.o -c\n./clean.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/config.o -c\n./config.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/entities.o -c\n./entities.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/fileio.o -c\n./fileio.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/gdoc.o -c ./gdoc.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/istack.o -c\n./istack.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/lexer.o -c\n./lexer.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/localize.o -c\n./localize.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/mappedio.o -c\n./mappedio.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/parser.o -c\n./parser.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/pprint.o -c\n./pprint.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/streamio.o -c\n./streamio.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/tagask.o -c\n./tagask.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/tags.o -c ./tags.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/tidylib.o -c\n./tidylib.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/tmbstr.o -c\n./tmbstr.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/utf8.o -c ./utf8.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_cgo_.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_cgo_main.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_cgo_export.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/tidyhtml5.cgo2.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/access.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/alloc.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/attrask.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/attrdict.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/attrget.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/attrs.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/buffio.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/clean.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/config.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/entities.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/fileio.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/gdoc.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/istack.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/lexer.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/localize.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/mappedio.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/parser.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/pprint.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/streamio.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/tagask.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/tags.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/tidylib.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/tmbstr.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/utf8.o\n/usr/lib/go/pkg/tool/linux_amd64/cgo -objdir\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -dynimport\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_cgo_.o -dynout\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_cgo_import.c\n/usr/lib/go/pkg/tool/linux_amd64/6c -FVw -I\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/ -I\n/usr/lib/go/pkg/linux_amd64 -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_cgo_import.6\n-DGOOS_linux -DGOARCH_amd64\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_cgo_import.c\ngcc -I . -g -O2 -fPIC -m64 -pthread -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_all.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_cgo_export.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/tidyhtml5.cgo2.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/access.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/alloc.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/attrask.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/attrdict.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/attrget.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/attrs.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/buffio.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/clean.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/config.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/entities.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/fileio.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/gdoc.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/istack.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/lexer.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/localize.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/mappedio.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/parser.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/pprint.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/streamio.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/tagask.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/tags.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/tidylib.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/tmbstr.o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/utf8.o -Wl,-r\n-nostdlib /usr/lib/gcc/x86_64-linux-gnu/4.6/libgcc.a\n/usr/lib/go/pkg/tool/linux_amd64/6g -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_go_.6 -p\ngithub.com/taruti/tidy-html5/go/tidyhtml5 -D\n_/home/taruti/go-work/src/github.com/taruti/tidy-html5/go/tidyhtml5 -I\n$WORK ./tidyhtml5_test.go\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_cgo_gotypes.go\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/tidyhtml5.cgo1.go\n/usr/lib/go/pkg/tool/linux_amd64/pack grcP $WORK\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/github.com/taruti/tidy-html5/go/tidyhtml5.a\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_go_.6\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_cgo_import.6\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_cgo_defun.6\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/_all.o\ncd $WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test\n/usr/lib/go/pkg/tool/linux_amd64/6g -o ./_go_.6 -p testmain -D  -I . -I\n$WORK ./_testmain.go\n/usr/lib/go/pkg/tool/linux_amd64/pack grcP $WORK ./main.a ./_go_.6\ncd .\n/usr/lib/go/pkg/tool/linux_amd64/6l -o\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/tidyhtml5.test -L\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test -L $WORK\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/main.a\n# testmain\ngithub.com/taruti/tidy-html5/go/tidyhtml5(.data.rel.ro): unexpected\nR_X86_64_64 relocation for dynamic symbol prvTidyParsePre\ngithub.com/taruti/tidy-html5/go/tidyhtml5(.data.rel.ro): unexpected\nR_X86_64_64 relocation for dynamic symbol prvTidyParsePre\ngithub.com/taruti/tidy-html5/go/tidyhtml5(.data.rel.ro): unexpected\nR_X86_64_64 relocation for dynamic symbol prvTidyParsePre\ngithub.com/taruti/tidy-html5/go/tidyhtml5(.data.rel.ro): unexpected\nR_X86_64_64 relocation for dynamic symbol prvTidyParsePre\n$WORK/github.com/taruti/tidy-html5/go/tidyhtml5/_test/tidyhtml5.test\nFAIL    github.com/taruti/tidy-html5/go/tidyhtml5 [build failed]\ntaruti@gate:~/go-work/src/github.com/taruti/tidy-html5/go/tidyhtml5$\n\n\n\nAnd some more info:\n\n# Library built with cgo with \u0026quot;go build\u0026quot; and \u0026quot;go install\u0026quot; with the C\n  source files in the same directory.\n\ntaruti@gate:~/go-work/src/github.com/taruti/tidy-html5/go/tidyhtml5$ go\ntest\n# testmain\n/tmp/go-build100262425/github.com/taruti/tidy-html5/go/tidyhtml5/_test/github.com/taruti/tidy-html5/go/tidyhtml5.a(tags.o)(.data.rel.ro):\nunexpected R_X86_64_64 relocation for dynamic symbol prvTidyParsePre\n/tmp/go-build100262425/github.com/taruti/tidy-html5/go/tidyhtml5/_test/github.com/taruti/tidy-html5/go/tidyhtml5.a(tags.o)(.data.rel.ro):\nunexpected R_X86_64_64 relocation for dynamic symbol prvTidyParsePre\n/tmp/go-build100262425/github.com/taruti/tidy-html5/go/tidyhtml5/_test/github.com/taruti/tidy-html5/go/tidyhtml5.a(tags.o)(.data.rel.ro):\nunexpected R_X86_64_64 relocation for dynamic symbol prvTidyParsePre\n/tmp/go-build100262425/github.com/taruti/tidy-html5/go/tidyhtml5/_test/github.com/taruti/tidy-html5/go/tidyhtml5.a(tags.o)(.data.rel.ro):\nunexpected R_X86_64_64 relocation for dynamic symbol prvTidyParsePre\nFAIL       github.com/taruti/tidy-html5/go/tidyhtml5 [build failed]\ntaruti@gate:~/go-work/src/github.com/taruti/tidy-html5/go/tidyhtml5$ go\ntool pack xv\n~/go-work/pkg/linux_amd64/github.com/taruti/tidy-html5/go/tidyhtml5.a\ntags.o parser.o\nx - parser.o\nx - tags.o\ntaruti@gate:~/go-work/src/github.com/taruti/tidy-html5/go/tidyhtml5$ nm\ntags.o | grep prvTidyParsePre\n                 U prvTidyParsePre\ntaruti@gate:~/go-work/src/github.com/taruti/tidy-html5/go/tidyhtml5$\nobjdump -x tags.o | grep prvTidyParsePre\n0000000000000000         *UND*  0000000000000000 prvTidyParsePre\n000000000000048a R_X86_64_GOTPCREL  prvTidyParsePre-0x0000000000000004\n00000000000005d7 R_X86_64_GOTPCREL  prvTidyParsePre-0x0000000000000004\n000000000000091b R_X86_64_GOTPCREL  prvTidyParsePre-0x0000000000000004\n0000000000000de8 R_X86_64_64       prvTidyParsePre\n00000000000010e8 R_X86_64_64       prvTidyParsePre\n0000000000001128 R_X86_64_64       prvTidyParsePre\n0000000000001928 R_X86_64_64       prvTidyParsePre\ntaruti@gate:~/go-work/src/github.com/taruti/tidy-html5/go/tidyhtml5$ nm\nparser.o | grep prvTidyParsePre\n0000000000001290 T prvTidyParsePre\ntaruti@gate:~/go-work/src/github.com/taruti/tidy-html5/go/tidyhtml5$\nobjdump -x parser.o | grep prvTidyParsePre\n0000000000001290 g     F .text  0000000000000376 prvTidyParsePre\n000000000000054c R_X86_64_GOTPCREL  prvTidyParsePre-0x0000000000000004\n000000000000065c R_X86_64_GOTPCREL  prvTidyParsePre-0x0000000000000004\n00000000000010b4 R_X86_64_GOTPCREL  prvTidyParsePre-0x0000000000000004\n0000000000005b4f R_X86_64_GOTPCREL  prvTidyParsePre-0x0000000000000004\ntaruti@gate:~/go-work/src/github.com/taruti/tidy-html5/go/tidyhtml5$\u003c/pre\u003e",
	"user": {
		"login": "taruti",
		"id": 42174,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"comments": 3,
	"closed_at": "2014-12-08T10:22:43Z",
	"created_at": "2012-10-21T14:12:19Z",
	"updated_at": "2016-06-24T22:26:52Z",
	"milestone": {
		"id": 1067199,
		"number": 11,
		"title": "Go1.1"
	}
}
