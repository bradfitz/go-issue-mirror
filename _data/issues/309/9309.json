{
	"id": 51914059,
	"number": 9309,
	"state": "closed",
	"title": "runtime: intermittent checkmarks failures",
	"body": "```\r\ngo version devel +2d02ff2 Sat Dec 13 10:18:27 2014 +0000 dragonfly/amd64\r\n```\r\nI run all.bash three times, and this only happened once:\r\n```\r\nruntime:greyobject: checkmarks finds unexpected unmarked object obj=0xc2081ef450, mbits-\u003ebits=0x1 *mbits-\u003ebitp=0x5\r\nruntime:greyobject Span: obj=0xc2081ef450 k=0x61040f7 s.start=0xc2081ee000 s.limit=0xc2081f0000 s.sizeclass=2 s.elemsize=16\r\n *(obj+0) = 0x36\r\n *(obj+8) = 0x84\r\nfatal error: checkmark found unmarked object\r\n\r\nruntime stack:\r\nruntime.gothrow(0x65a030, 0x1f)\r\n\t/home/minux/build/go.git/src/runtime/panic.go:507 +0x98 fp=0xc20815da30 sp=0xc20815da18\r\nruntime.greyobject(0xc2081ef450, 0xc20815db08, 0x800777140, 0x800777140)\r\n\t/home/minux/build/go.git/src/runtime/mgc.go:438 +0x23b fp=0xc20815da90 sp=0xc20815da30\r\nruntime.scanobject(0xc20812b200, 0x7d4e00, 0x0, 0x800777140, 0x800777140)\r\n\t/home/minux/build/go.git/src/runtime/mgc.go:567 +0x395 fp=0xc20815db28 sp=0xc20815da90\r\nruntime.scanblock(0xc20812b200, 0x58, 0x68a64c)\r\n\t/home/minux/build/go.git/src/runtime/mgc.go:629 +0x1e6 fp=0xc20815db68 sp=0xc20815db28\r\nruntime.scanframe(0xc20815dcb8, 0x0, 0x1)\r\n\t/home/minux/build/go.git/src/runtime/mgc.go:924 +0x164 fp=0xc20815dc00 sp=0xc20815db68\r\nruntime.gentraceback(0x4254d8, 0xc208203420, 0x0, 0xc208297b00, 0x0, 0x0, 0x7fffffff, 0x698940, 0x0, 0x0, ...)\r\n\t/home/minux/build/go.git/src/runtime/traceback.go:313 +0x801 fp=0xc20815dd10 sp=0xc20815dc00\r\nruntime.scanstack(0xc208297b00)\r\n\t/home/minux/build/go.git/src/runtime/mgc.go:979 +0x214 fp=0xc20815dd88 sp=0xc20815dd10\r\nruntime.gcphasework(0xc208297b00)\r\n\t/home/minux/build/go.git/src/runtime/mgc.go:1093 +0x9c fp=0xc20815dda0 sp=0xc20815dd88\r\nruntime.stopg(0xc208297b00, 0x4)\r\n\t/home/minux/build/go.git/src/runtime/proc1.go:444 +0x91 fp=0xc20815ddc0 sp=0xc20815dda0\r\nruntime.markroot(0xc208010000, 0x2e8)\r\n\t/home/minux/build/go.git/src/runtime/mgc.go:705 +0x161 fp=0xc20815de30 sp=0xc20815ddc0\r\nruntime.parfordo(0xc208010000)\r\n\t/home/minux/build/go.git/src/runtime/parfor.go:84 +0x1af fp=0xc20815dea0 sp=0xc20815de30\r\nruntime.gchelper()\r\n\t/home/minux/build/go.git/src/runtime/mgc.go:1467 +0x4b fp=0xc20815ded0 sp=0xc20815dea0\r\nruntime.stopm()\r\n\t/home/minux/build/go.git/src/runtime/proc1.go:1057 +0x164 fp=0xc20815def8 sp=0xc20815ded0\r\nruntime.findrunnable(0xc208013200)\r\n\t/home/minux/build/go.git/src/runtime/proc1.go:1368 +0x4bd fp=0xc20815df60 sp=0xc20815def8\r\nruntime.schedule()\r\n\t/home/minux/build/go.git/src/runtime/proc1.go:1455 +0x1c7 fp=0xc20815df90 sp=0xc20815df60\r\nruntime.goexit0(0xc2080b25a0)\r\n\t/home/minux/build/go.git/src/runtime/proc1.go:1576 +0x197 fp=0xc20815dfb8 sp=0xc20815df90\r\nruntime.mcall(0x0)\r\n\t/home/minux/build/go.git/src/runtime/asm_amd64.s:187 +0x5a fp=0xc20815dfc8 sp=0xc20815dfb8\r\n\r\ngoroutine 1 [chan receive]:\r\nruntime.gopark(0x698918, 0xc2080b0478, 0x636c90, 0xc)\r\n\t/home/minux/build/go.git/src/runtime/proc.go:146 +0x108 fp=0xc2080f1bc8 sp=0xc2080f1b98\r\nruntime.goparkunlock(0xc2080b0478, 0x636c90, 0xc)\r\n\t/home/minux/build/go.git/src/runtime/proc.go:152 +0x48 fp=0xc2080f1bf0 sp=0xc2080f1bc8\r\nruntime.chanrecv(0x5870a0, 0xc2080b0420, 0xc2080f1dc0, 0x46bf01, 0x0)\r\n\t/home/minux/build/go.git/src/runtime/chan.go:410 +0x3e0 fp=0xc2080f1c70 sp=0xc2080f1bf0\r\nruntime.chanrecv1(0x5870a0, 0xc2080b0420, 0xc2080f1dc0)\r\n\t/home/minux/build/go.git/src/runtime/chan.go:311 +0x2b fp=0xc2080f1ca0 sp=0xc2080f1c70\r\ntesting.RunTests(0x698510, 0x752d60, 0x7b, 0x7b, 0xb4fc70aa243c9401)\r\n\t/home/minux/build/go.git/src/testing/testing.go:556 +0xad6 fp=0xc2080f1e48 sp=0xc2080f1ca0\r\ntesting.(*M).Run(0xc20803e0a0, 0x768060)\r\n\t/home/minux/build/go.git/src/testing/testing.go:485 +0x6c fp=0xc2080f1ed0 sp=0xc2080f1e48\r\nmain.main()\r\n\truntime/_test/_testmain.go:694 +0x1d5 fp=0xc2080f1f98 sp=0xc2080f1ed0\r\nruntime.main()\r\n\t/home/minux/build/go.git/src/runtime/proc.go:81 +0x1cc fp=0xc2080f1fe0 sp=0xc2080f1f98\r\nruntime.goexit()\r\n\t/home/minux/build/go.git/src/runtime/asm_amd64.s:2402 +0x1 fp=0xc2080f1fe8 sp=0xc2080f1fe0\r\n\r\ngoroutine 2 [force gc (idle)]:\r\nruntime.gopark(0x698918, 0x755420, 0x638190, 0xf)\r\n\t/home/minux/build/go.git/src/runtime/proc.go:146 +0x108 fp=0xc20801a798 sp=0xc20801a768\r\nruntime.goparkunlock(0x755420, 0x638190, 0xf)\r\n\t/home/minux/build/go.git/src/runtime/proc.go:152 +0x48 fp=0xc20801a7c0 sp=0xc20801a798\r\nruntime.forcegchelper()\r\n\t/home/minux/build/go.git/src/runtime/proc.go:115 +0xce fp=0xc20801a7e0 sp=0xc20801a7c0\r\nruntime.goexit()\r\n\t/home/minux/build/go.git/src/runtime/asm_amd64.s:2402 +0x1 fp=0xc20801a7e8 sp=0xc20801a7e0\r\ncreated by runtime.init·4\r\n\t/home/minux/build/go.git/src/runtime/proc.go:103 +0x25\r\n\r\ngoroutine 3 [GC sweep wait]:\r\nruntime.gopark(0x698918, 0x768400, 0x631db0, 0xd)\r\n\t/home/minux/build/go.git/src/runtime/proc.go:146 +0x108 fp=0xc20801d798 sp=0xc20801d768\r\nruntime.goparkunlock(0x768400, 0x631db0, 0xd)\r\n\t/home/minux/build/go.git/src/runtime/proc.go:152 +0x48 fp=0xc20801d7c0 sp=0xc20801d798\r\nruntime.bgsweep()\r\n\t/home/minux/build/go.git/src/runtime/mgc0.go:96 +0xdd fp=0xc20801d7e0 sp=0xc20801d7c0\r\nruntime.goexit()\r\n\t/home/minux/build/go.git/src/runtime/asm_amd64.s:2402 +0x1 fp=0xc20801d7e8 sp=0xc20801d7e0\r\ncreated by runtime.gc\r\n\t/home/minux/build/go.git/src/runtime/mgc.go:2042 +0xe5c\r\n\r\ngoroutine 4 [finalizer wait]:\r\nruntime.gopark(0x698918, 0x7683f8, 0x637a90, 0xe)\r\n\t/home/minux/build/go.git/src/runtime/proc.go:146 +0x108 fp=0xc208018f30 sp=0xc208018f00\r\nruntime.goparkunlock(0x7683f8, 0x637a90, 0xe)\r\n\t/home/minux/build/go.git/src/runtime/proc.go:152 +0x48 fp=0xc208018f58 sp=0xc208018f30\r\nruntime.runfinq()\r\n\t/home/minux/build/go.git/src/runtime/malloc.go:775 +0xba fp=0xc208018fe0 sp=0xc208018f58\r\nruntime.goexit()\r\n\t/home/minux/build/go.git/src/runtime/asm_amd64.s:2402 +0x1 fp=0xc208018fe8 sp=0xc208018fe0\r\ncreated by runtime.createfing\r\n\t/home/minux/build/go.git/src/runtime/malloc.go:755 +0x5e\r\n\r\ngoroutine 5 [syscall]:\r\nruntime.notetsleepg(0x755798, 0x1a257a321a, 0x0)\r\n\t/home/minux/build/go.git/src/runtime/lock_futex.go:198 +0x59 fp=0xc20801df60 sp=0xc20801df38\r\nruntime.timerproc()\r\n\t/home/minux/build/go.git/src/runtime/time.go:207 +0xfa fp=0xc20801dfe0 sp=0xc20801df60\r\nruntime.goexit()\r\n\t/home/minux/build/go.git/src/runtime/asm_amd64.s:2402 +0x1 fp=0xc20801dfe8 sp=0xc20801dfe0\r\ncreated by runtime.addtimerLocked\r\n\t/home/minux/build/go.git/src/runtime/time.go:113 +0x1ba\r\n\r\ngoroutine 560 [syscall]:\r\nruntime_test.func·047(0x0, 0x4e94914f0000, 0x64b570, 0x14, 0xc208040060)\r\n\t/home/minux/build/go.git/src/runtime/futex_test.go:47 +0x2d fp=0xc20801cfb8 sp=0xc20801cf70\r\nruntime.goexit()\r\n\t/home/minux/build/go.git/src/runtime/asm_amd64.s:2402 +0x1 fp=0xc20801cfc0 sp=0xc20801cfb8\r\ncreated by runtime_test.TestFutexsleep\r\n\t/home/minux/build/go.git/src/runtime/futex_test.go:51 +0x229\r\n\r\ngoroutine 65615 [semacquire]:\r\nruntime.gopark(0x698918, 0x75c180, 0x63c610, 0xa)\r\n\t/home/minux/build/go.git/src/runtime/proc.go:146 +0x108 fp=0xc208138c50 sp=0xc208138c20\r\nruntime.goparkunlock(0x75c180, 0x63c610, 0xa)\r\n\t/home/minux/build/go.git/src/runtime/proc.go:152 +0x48 fp=0xc208138c78 sp=0xc208138c50\r\nruntime.semacquire(0x73e034, 0xc208102400)\r\n\t/home/minux/build/go.git/src/runtime/sema.go:89 +0x22f fp=0xc208138cb0 sp=0xc208138c78\r\nruntime.gogc(0x800000000)\r\n\t/home/minux/build/go.git/src/runtime/malloc.go:461 +0x9d fp=0xc208138d08 sp=0xc208138cb0\r\nruntime.mallocgc(0x10, 0x590ba0, 0x1, 0xc20825a0f0)\r\n\t/home/minux/build/go.git/src/runtime/malloc.go:345 +0x3e5 fp=0xc208138e18 sp=0xc208138d08\r\nruntime.newobject(0x590ba0, 0xc20828aff8)\r\n\t/home/minux/build/go.git/src/runtime/malloc.go:387 +0x49 fp=0xc208138e40 sp=0xc208138e18\r\nreflect.Value.MapKeys(0x58f4a0, 0xc20800a540, 0x15, 0x0, 0x0, 0x0)\r\n\t/home/minux/build/go.git/src/reflect/value.go:1053 +0x1e6 fp=0xc208138ee8 sp=0xc208138e40\r\nruntime_test.func·058()\r\n\t/home/minux/build/go.git/src/runtime/map_test.go:270 +0xab fp=0xc208138fe0 sp=0xc208138ee8\r\nruntime.goexit()\r\n\t/home/minux/build/go.git/src/runtime/asm_amd64.s:2402 +0x1 fp=0xc208138fe8 sp=0xc208138fe0\r\ncreated by runtime_test.testConcurrentReadsAfterGrowth\r\n\t/home/minux/build/go.git/src/runtime/map_test.go:274 +0x383\r\n\r\ngoroutine 30829 [semacquire]:\r\nruntime.gopark(0x698918, 0x75bc80, 0x63c610, 0xa)\r\n\t/home/minux/build/go.git/src/runtime/proc.go:146 +0x108 fp=0xc208019e38 sp=0xc208019e08\r\nruntime.goparkunlock(0x75bc80, 0x63c610, 0xa)\r\n\t/home/minux/build/go.git/src/runtime/proc.go:152 +0x48 fp=0xc208019e60 sp=0xc208019e38\r\nruntime.semacquire(0xc2081f16e0, 0xc2081f1601)\r\n\t/home/minux/build/go.git/src/runtime/sema.go:89 +0x22f fp=0xc208019e98 sp=0xc208019e60\r\nruntime.asyncsemacquire(0xc2081f16e0)\r\n\t/home/minux/build/go.git/src/runtime/sema.go:43 +0x2d fp=0xc208019eb0 sp=0xc208019e98\r\nsync.(*WaitGroup).Wait(0xc208117d40)\r\n\t/home/minux/build/go.git/src/sync/waitgroup.go:132 +0x169 fp=0xc208019ed8 sp=0xc208019eb0\r\nruntime_test.testConcurrentReadsAfterGrowth(0xc20821e090, 0x755801)\r\n\t/home/minux/build/go.git/src/runtime/map_test.go:277 +0x3ae fp=0xc208019f60 sp=0xc208019ed8\r\nruntime_test.TestConcurrentReadsAfterGrowthReflect(0xc20821e090)\r\n\t/home/minux/build/go.git/src/runtime/map_test.go:287 +0x2d fp=0xc208019f78 sp=0xc208019f60\r\ntesting.tRunner(0xc20821e090, 0x753390)\r\n\t/home/minux/build/go.git/src/testing/testing.go:447 +0xbf fp=0xc208019fd0 sp=0xc208019f78\r\nruntime.goexit()\r\n\t/home/minux/build/go.git/src/runtime/asm_amd64.s:2402 +0x1 fp=0xc208019fd8 sp=0xc208019fd0\r\ncreated by testing.RunTests\r\n\t/home/minux/build/go.git/src/testing/testing.go:555 +0xa8b\r\n\r\ngoroutine 561 [syscall]:\r\nruntime_test.func·047(0x0, 0x1dcd65174876e800, 0x64afb0, 0x13, 0xc2080400c0)\r\n\t/home/minux/build/go.git/src/runtime/futex_test.go:47 +0x2d fp=0xc20801c7b8 sp=0xc20801c770\r\nruntime.goexit()\r\n\t/home/minux/build/go.git/src/runtime/asm_amd64.s:2402 +0x1 fp=0xc20801c7c0 sp=0xc20801c7b8\r\ncreated by runtime_test.TestFutexsleep\r\n\t/home/minux/build/go.git/src/runtime/futex_test.go:51 +0x229\r\n\r\ngoroutine 65645 [garbage collection]:\r\nruntime.systemstack_switch()\r\n\t/home/minux/build/go.git/src/runtime/asm_amd64.s:199 fp=0xc2080d5cb0 sp=0xc2080d5ca8\r\nruntime.gogc(0xc200000000)\r\n\t/home/minux/build/go.git/src/runtime/malloc.go:518 +0x28d fp=0xc2080d5d08 sp=0xc2080d5cb0\r\nruntime.mallocgc(0x20, 0x61f0a0, 0xc200000000, 0xc2081e6e30)\r\n\t/home/minux/build/go.git/src/runtime/malloc.go:345 +0x3e5 fp=0xc2080d5e18 sp=0xc2080d5d08\r\nruntime.newobject(0x61f0a0, 0xc20828a220)\r\n\t/home/minux/build/go.git/src/runtime/malloc.go:387 +0x49 fp=0xc2080d5e40 sp=0xc2080d5e18\r\nreflect.Value.MapIndex(0x58f4a0, 0xc20800a540, 0x15, 0x590ba0, 0xc2081e6868, 0x42, 0x590ba0, 0xc2081e6e30, 0x42)\r\n\t/home/minux/build/go.git/src/reflect/value.go:986 +0x32 fp=0xc2080d5ee8 sp=0xc2080d5e40\r\nruntime_test.func·058()\r\n\t/home/minux/build/go.git/src/runtime/map_test.go:272 +0x18b fp=0xc2080d5fe0 sp=0xc2080d5ee8\r\nruntime.goexit()\r\n\t/home/minux/build/go.git/src/runtime/asm_amd64.s:2402 +0x1 fp=0xc2080d5fe8 sp=0xc2080d5fe0\r\ncreated by runtime_test.testConcurrentReadsAfterGrowth\r\n\t/home/minux/build/go.git/src/runtime/map_test.go:274 +0x383\r\n\r\ngoroutine 65636 [semacquire]:\r\nruntime.gopark(0x698918, 0x75c180, 0x63c610, 0xa)\r\n\t/home/minux/build/go.git/src/runtime/proc.go:146 +0x108 fp=0xc208203450 sp=0xc208203420\r\nruntime.goparkunlock(0x75c180, 0x63c610, 0xa)\r\n\t/home/minux/build/go.git/src/runtime/proc.go:152 +0x48 fp=0xc208203478 sp=0xc208203450\r\nruntime.semacquire(0x73e034, 0xc208020c00)\r\n\t/home/minux/build/go.git/src/runtime/sema.go:89 +0x22f fp=0xc2082034b0 sp=0xc208203478\r\nruntime.gogc(0x800000000)\r\n\t/home/minux/build/go.git/src/runtime/malloc.go:461 +0x9d fp=0xc208203508 sp=0xc2082034b0\r\nruntime.mallocgc(0x10, 0x590ba0, 0x1, 0xc208208000)\r\n\t/home/minux/build/go.git/src/runtime/malloc.go:345 +0x3e5 fp=0xc208203618 sp=0xc208203508\r\nruntime.newobject(0x590ba0, 0xc20828a9c0)\r\n\t/home/minux/build/go.git/src/runtime/malloc.go:387 +0x49 fp=0xc208203640 sp=0xc208203618\r\nreflect.Value.MapKeys(0x58f4a0, 0xc20800a540, 0x15, 0x0, 0x0, 0x0)\r\n\t/home/minux/build/go.git/src/reflect/value.go:1053 +0x1e6 fp=0xc2082036e8 sp=0xc208203640\r\nruntime_test.func·058()\r\n\t/home/minux/build/go.git/src/runtime/map_test.go:270 +0xab fp=0xc2082037e0 sp=0xc2082036e8\r\nruntime.goexit()\r\n\t/home/minux/build/go.git/src/runtime/asm_amd64.s:2402 +0x1 fp=0xc2082037e8 sp=0xc2082037e0\r\ncreated by runtime_test.testConcurrentReadsAfterGrowth\r\n\t/home/minux/build/go.git/src/runtime/map_test.go:274 +0x383\r\nFAIL\truntime\t11.500s\r\n```",
	"user": {
		"login": "minux",
		"id": 135652,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"assignee": {
		"login": "RLH",
		"id": 972447,
		"type": "User",
		"site_admin": false
	},
	"comments": 5,
	"closed_at": "2015-01-06T00:10:17Z",
	"created_at": "2014-12-14T08:57:32Z",
	"updated_at": "2016-06-25T01:56:21Z",
	"milestone": {
		"id": 905105,
		"number": 1,
		"title": "Go1.5"
	}
}
