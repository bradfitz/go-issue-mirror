{
	"id": 210079369,
	"body": "Hi~ @bradfitz I meet some problem like ayanamist, and want to implement a h2 proxy, too....  - -!\r\n\r\nbase on http://httpwg.org/specs/rfc7540.html#CONNECT and above comment..maybe we should do something like this? (without something like `hijack`????)\r\n\r\n\thandler := func(rw http.ResponseWriter, req *http.Request) {\r\n\t\tif req.Method == \"CONNECT\" {\r\n\t\t\t// 1. receive CONNECT request..\r\n\t\t\tfmt.Println(\"Handle https\")\r\n\r\n\t\t\t// 2. establishes a TCP connection to the server identified in the :authority\r\n\t\t\tremoteConn, err := net.Dial(\"tcp\", req.Host)\r\n\t\t\tif err != nil {\r\n\t\t\t\tpanic(err)\r\n\t\t\t}\r\n\r\n\t\t\t// 3. sends a HEADERS frame containing a 2xx series status code to the client, as defined in [RFC7231], Section 4.3.6\r\n\t\t\trw.WriteHeader(http.StatusOK)\r\n\r\n\t\t\t// 4. transmitted DATA between client and TCP server\r\n\t\t\tgo Pipe(\u0026clientConn{Reader: req.Body, Writer: rw}, remoteConn)\r\n\t\t} else {\r\n\t\t\tfmt.Println(\"Handle as http\")\r\n\t\t\t//...\r\n\t\t}\r\n\t}\r\n\r\nbut, when we try proxy Chrome to this code using h2...it doesn't work\r\n\r\nin `chrome://net-internals` see some log like this..\r\n\r\n```\r\nt=   27 [st=    0] +HTTP2_SESSION  [dt=42430]\r\n                    --\u003e host = \"www.sulicc.com:443\"\r\n                    --\u003e proxy = \"DIRECT\"\r\nt=   27 [st=    0]    HTTP2_SESSION_INITIALIZED\r\n                      --\u003e protocol = \"h2\"\r\n                      --\u003e source_dependency = 546424 (SOCKET)\r\nt=   27 [st=    0]    HTTP2_SESSION_SEND_SETTINGS\r\n                      --\u003e settings = [\"[id:3 flags:0 value:1000]\",\"[id:4 flags:0 value:6291456]\"]\r\nt=   27 [st=    0]    HTTP2_STREAM_UPDATE_RECV_WINDOW\r\n                      --\u003e delta = 15663105\r\n                      --\u003e window_size = 15728640\r\nt=   27 [st=    0]    HTTP2_SESSION_SENT_WINDOW_UPDATE_FRAME\r\n                      --\u003e delta = 15663105\r\n                      --\u003e stream_id = 0\r\nt=   27 [st=    0]    HTTP2_SESSION_SEND_HEADERS\r\n                      --\u003e fin = false\r\n                      --\u003e :method: CONNECT\r\n                          :authority: imququ.com:443\r\n                          user-agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_4) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/49.0.2623.112 Safari/537.36\r\n                      --\u003e priority = 4\r\n                      --\u003e stream_id = 1\r\n                      --\u003e unidirectional = false\r\nt=   27 [st=    0]    HTTP2_SESSION_RECV_SETTINGS\r\n                      --\u003e clear_persisted = false\r\n                      --\u003e host = \"www.sulicc.com:443\"\r\nt=   27 [st=    0]    HTTP2_SESSION_RECV_SETTING\r\n                      --\u003e flags = 0\r\n                      --\u003e id = 5\r\n                      --\u003e value = 1048576\r\nt=   27 [st=    0]    HTTP2_SESSION_RECV_SETTING\r\n                      --\u003e flags = 0\r\n                      --\u003e id = 3\r\n                      --\u003e value = 250\r\nt=   27 [st=    0]    HTTP2_SESSION_RECV_SETTING\r\n                      --\u003e flags = 0\r\n                      --\u003e id = 6\r\n                      --\u003e value = 1048896\r\nt= 1056 [st= 1029]    HTTP2_SESSION_RECV_HEADERS\r\n                      --\u003e fin = true\r\n                      --\u003e :status: 200\r\n                          content-type: text/plain; charset=utf-8\r\n                          content-length: 0\r\n                          date: Thu, 14 Apr 2016 17:34:28 GMT\r\n                      --\u003e stream_id = 1\r\nt= 1056 [st= 1029]    HTTP2_SESSION_RECV_DATA\r\n                      --\u003e fin = true\r\n                      --\u003e size = 0\r\n                      --\u003e stream_id = 1\r\nt= 1056 [st= 1029]    HTTP2_SESSION_RST_STREAM\r\n                      --\u003e description = \"\"\r\n                      --\u003e status = 5\r\n                      --\u003e stream_id = 1\r\nt= 1056 [st= 1029]    HTTP2_STREAM_ERROR\r\n                      --\u003e description = \"SPDY stream closed with status: 5\"\r\n                      --\u003e status = -337\r\n                      --\u003e stream_id = 1 \r\n```\r\n\r\nAfter `CONNECT`, it receive HEADERS\r\n\r\n```\r\nt= 1056 [st= 1029]    HTTP2_SESSION_RECV_HEADERS\r\n                      --\u003e fin = true\r\n                      --\u003e :status: 200\r\n                          content-type: text/plain; charset=utf-8\r\n                          content-length: 0\r\n                          date: Thu, 14 Apr 2016 17:34:28 GMT\r\n                      --\u003e stream_id = 1 \r\n```\r\n then `HTTP2_SESSION_RECV_DATA`...and browser doesn't send any more data....\r\n\r\nIn http://httpwg.org/specs/rfc7231.html#CONNECT, it said \r\n\r\n\u003e A server MUST NOT send any Transfer-Encoding or Content-Length header fields in a 2xx (Successful) response to CONNECT. A client MUST ignore any Content-Length or Transfer-Encoding header fields received in a successful response to CONNECT.\r\n\r\nbut `rw.WriteHeader(http.StatusOK)` still write a header `content-length: 0`... maybe it's a question?\r\n\r\nwithout `hijack`, how can we write only httpcode and without header... just `\"HTTP/1.0 200 Connection established\\r\\n\\r\\n\"`?\r\n\r\nthank you~",
	"user": {
		"login": "lysu",
		"id": 528332,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2016-04-14T18:03:49Z",
	"updated_at": "2016-04-14T18:07:50Z"
}
