{
	"id": 51280929,
	"number": 3645,
	"state": "closed",
	"title": "./hello displays Illegal instruction using hg update default on ARM CPU based CISCO Linksys NSLU2",
	"body": "by **rounin.urashima**:\n\n\u003cpre\u003e./hello displays Illegal instruction using hg update default on ARM CPU based CISCO\nLinksys NSLU2\n\nBefore filing a bug, please check whether it has been fixed since the\nlatest release. Search the issue tracker and check that you're running the\nlatest version of Go:\n\nRun \u0026quot;go version\u0026quot; and compare against\n\u003ca href=\"http://golang.org/doc/devel/release.html\"\u003ehttp://golang.org/doc/devel/release.html\u003c/a\u003e  If a newer version of Go exists,\ninstall it and retry what you did to reproduce the problem.\n\nThanks.\n\nWhat steps will reproduce the problem?\nIf possible, include a link to a program on play.golang.org.\n\nrounin@LKG80B859:~$ cat hello.go\npackage main\n\nfunc main() {\n        print(\u0026quot;hello, world\\n\u0026quot;);\n}\nrounin@LKG80B859:~$ env|grep ARM\nGOARM=5\n\nrounin@LKG80B859:~$ go run hello.go\nsignal 4\nrounin@LKG80B859:~$ go build hello.go\nrounin@LKG80B859:~$ ./hello\nIllegal instruction\n\n\nWhat is the expected output?\nhello, world\n\nWhat do you see instead?\nIllegal instruction\n\nWhich compiler are you using (5g, 6g, 8g, gccgo)?\ngo build\n\nWhich operating system are you using?\n\nuname -a\nLinux LKG80B859 2.6.32-5-ixp4xx #1 Sun May 6 12:28:42 UTC 2012 armv5tel GNU/Linux\n\ncat /proc/cpuinfo \nProcessor       : XScale-IXP42x Family rev 1 (v5l)\nBogoMIPS        : 266.24\nFeatures        : swp half thumb fastmult edsp \nCPU implementer : 0x69\nCPU architecture: 5TE\nCPU variant     : 0x0\nCPU part        : 0x41f\nCPU revision    : 1\n\nHardware        : Linksys NSLU2\nRevision        : 0000\nSerial          : 0000000000000000\n\ncat /proc/cpu/alignment\nUser:           16\nSystem:         0\nSkipped:        0\nHalf:           0\nWord:           0\nDWord:          0\nMulti:          0\nUser faults:    0 (ignored)\n\nrounin@LKG80B859:~$ cat /etc/issue\nDebian GNU/Linux 6.0 \\n \\l\n\n\nWhich version are you using?  (run 'go version')\ngo version\ngo version weekly.2012-03-27 +820ffde8c396\n\nDid a:\n\nhg update default\n\nbefore this it was \n\n2ccfd4b451d3 (release-branch.go1) go1.0.1/release\n\nWith version go1.0.1/release system exhibits:\n\nThis program can only be run on EABI kernels\n\nPlease provide any additional information below.\n\nrounin@LKG80B859:~$ strace -f ./hello\nexecve(\u0026quot;./hello\u0026quot;, [\u0026quot;./hello\u0026quot;], [/* 24 vars */]) = 0\nrt_sigaction(SIGILL, {0x237fc, [RT_1], 0}, {SIG_DFL, [], 0}, 8) = 0\ngetpid()                                = 10347\nrt_sigaction(SIGILL, {SIG_DFL, [], 0}, NULL, 8) = 0\n--- SIGILL (Illegal instruction) @ 0 (0) ---\n+++ killed by SIGILL +++\nIllegal instruction\n\n\n\nGOARM was set to 5\nrounin@LKG80B859:~$ env|grep ARM\nGOARM=5\n\nScript started on Fri 18 May 2012 23:07:37 BST\nrounin@LKG80B859:~$  env|grep ARM\nGOESC[01;31mESC[KARMESC[mESC[K=5\nrounin@LKG80B859:~$ cd go/src\nrounin@LKG80B859:~/go/src$ ./all.bash\n# Building C bootstrap tool.\ncmd/dist\n^C\nrounin@LKG80B859:~/go/src$ time ./all.bash\n# Building C bootstrap tool.\ncmd/dist\n\n\n# Building compilers and Go bootstrap tool for host, linux/arm.\nlib9\nlibbio\nlibmach\n.\n.\n.\n.\nnet/http/httptest\nnet/http/httputil\nnet/mail\nnet/rpc\nnet/rpc/jsonrpc\nnet/smtp\nold/netchan\nos/signal\nos/user\ntesting\ntesting/iotest\ntesting/quick\n\n# Testing packages.\nsfloat2 0x71924 0x159fb010\nUnsupported floating point instruction\npanic: runtime error: invalid memory address or nil pointer dereference\n[signal 0xb code=0x1 addr=0x0 pc=0x7624c]\n\ngoroutine 3 [running]:\ncreated by main.(*builder).do\n        /home/rounin/go/src/cmd/go/build.go:608 +0x53c\n\ngoroutine 1 [chan receive]:\nmain.(*builder).do(0x109a33c0, 0x10e838c0, 0x10963b40)\n        /home/rounin/go/src/cmd/go/build.go:611 +0x568\nmain.runTest(0x456fd8, 0x109513d0, 0x3)\n        /home/rounin/go/src/cmd/go/test.go:367 +0x24b8\nmain.main()\n        /home/rounin/go/src/cmd/go/main.go:141 +0x5c8\n\ngoroutine 2 [syscall]:\ncreated by runtime.main\n        /home/rounin/go/src/pkg/runtime/proc.c:221\n\ngoroutine 9 [finalizer wait]:\ncreated by runtime.gc\n        /home/rounin/go/src/pkg/runtime/mgc0.c:922\n\ngoroutine 11 [syscall]:\ncreated by addtimer\n        /home/rounin/go/src/pkg/runtime/ztime_linux_arm.c:69\n\nreal    235m2.002s\nuser    52m9.280s\nsys     15m18.940s\nrounin@LKG80B859:~/go/src$ \nrounin@LKG80B859:~/go/src$ ^MESC[Krounin@LKG80B859:~/go/src$ exit\nexit\n\nScript done on Sat 19 May 2012 07:50:27 BST\n\n\nrounin@LKG80B859:~$ gdb ./hello\nGNU gdb (GDB) 7.0.1-debian\nCopyright (C) 2009 Free Software Foundation, Inc.\nLicense GPLv3+: GNU GPL version 3 or later \u0026lt;\u003ca href=\"http://gnu.org/licenses/gpl.html\u0026gt\"\u003ehttp://gnu.org/licenses/gpl.html\u0026gt\u003c/a\u003e;\nThis is free software: you are free to change and redistribute it.\nThere is NO WARRANTY, to the extent permitted by law.  Type \u0026quot;show copying\u0026quot;\nand \u0026quot;show warranty\u0026quot; for details.\nThis GDB was configured as \u0026quot;arm-linux-gnueabi\u0026quot;.\nFor bug reporting instructions, please see:\n\u0026lt;\u003ca href=\"http://www.gnu.org/software/gdb/bugs/\u0026gt\"\u003ehttp://www.gnu.org/software/gdb/bugs/\u0026gt\u003c/a\u003e;...\nReading symbols from /home/rounin/hello...(no debugging symbols found)...done.\n(gdb) run\nStarting program: /home/rounin/hello\n\nProgram received signal SIGILL, Illegal instruction.\n0x0001d744 in runtime.check ()\n(gdb) x/i 0x0001d744\n0x1d744 \u0026lt;runtime.check+184\u0026gt;:    vldr    d0, [sp, #36]   ; 0x24\n(gdb) info registers \nr0             0x0      0\nr1             0xbe859278       3196424824\nr2             0xffffffff       4294967295\nr3             0x4      4\nr4             0x35     53\nr5             0x0      0\nr6             0x0      0\nr7             0xae     174\nr8             0x0      0\nr9             0x36314  221972\nr10            0x36100  221440\nr11            0x35ff0  221168\nr12            0xcafebabe       3405691582\nsp             0xbe859254       0xbe859254\nlr             0x23c14  146452\npc             0x1d744  0x1d744 \u0026lt;runtime.check+184\u0026gt;\nfps            0x1001000        16781312\ncpsr           0x60000010       1610612752\n(gdb) x/10i $pc \n0x1d744 \u0026lt;runtime.check+184\u0026gt;:    vldr    d0, [sp, #36]   ; 0x24\n0x1d748 \u0026lt;runtime.check+188\u0026gt;:    vldr    d1, [sp, #36]   ; 0x24\n0x1d74c \u0026lt;runtime.check+192\u0026gt;:    vcmpe.f64       d0, d1\n0x1d750 \u0026lt;runtime.check+196\u0026gt;:    vmrs    APSR_nzcv, fpscr\n0x1d754 \u0026lt;runtime.check+200\u0026gt;:    ldreq   r1, [pc, #264]  ; 0x1d864\n\u0026lt;runtime.check+472\u0026gt;\n0x1d758 \u0026lt;runtime.check+204\u0026gt;:    streq   r1, [sp, #4]\n0x1d75c \u0026lt;runtime.check+208\u0026gt;:    bleq    0x1cee0 \u0026lt;runtime.throw\u0026gt;\n0x1d760 \u0026lt;runtime.check+212\u0026gt;:    vldr    d0, [sp, #36]   ; 0x24\n0x1d764 \u0026lt;runtime.check+216\u0026gt;:    vldr    d1, [sp, #36]   ; 0x24\n0x1d768 \u0026lt;runtime.check+220\u0026gt;:    vcmpe.f64       d0, d1\n(gdb) bt\n#0  0x0001d744 in runtime.check ()\n#1  0x00023c14 in runtime.cas ()\n#2  0x0002326c in _rt0_arm ()\n#3  0x0002326c in _rt0_arm ()\n#4  0x0002326c in _rt0_arm ()\n#5  0x0002326c in _rt0_arm ()\n#6  0x0002326c in _rt0_arm ()\n#7  0x0002326c in _rt0_arm ()\n#8  0x0002326c in _rt0_arm ()\n#9  0x0002326c in _rt0_arm ()\n#10 0x0002326c in _rt0_arm ()\n#11 0x0002326c in _rt0_arm ()\n#12 0x0002326c in _rt0_arm ()\n#13 0x0002326c in _rt0_arm ()\n#14 0x0002326c in _rt0_arm ()\n#15 0x0002326c in _rt0_arm ()\n#16 0x0002326c in _rt0_arm ()\n#17 0x0002326c in _rt0_arm ()\n#18 0x0002326c in _rt0_arm ()\n#19 0x0002326c in _rt0_arm ()\n#20 0x0002326c in _rt0_arm ()\n#21 0x0002326c in _rt0_arm ()\n#22 0x0002326c in _rt0_arm ()\n#23 0x0002326c in _rt0_arm ()\n#24 0x0002326c in _rt0_arm ()\n#25 0x0002326c in _rt0_arm ()\n#26 0x0002326c in _rt0_arm ()\n#27 0x0002326c in _rt0_arm ()\n#28 0x0002326c in _rt0_arm ()\n#29 0x0002326c in _rt0_arm ()\n---Type \u0026lt;return\u0026gt; to continue, or q \u0026lt;return\u0026gt; to quit---\nQuit\n(gdb) x/10i $pc\n0x1d744 \u0026lt;runtime.check+184\u0026gt;:    vldr    d0, [sp, #36]   ; 0x24\n0x1d748 \u0026lt;runtime.check+188\u0026gt;:    vldr    d1, [sp, #36]   ; 0x24\n0x1d74c \u0026lt;runtime.check+192\u0026gt;:    vcmpe.f64       d0, d1\n0x1d750 \u0026lt;runtime.check+196\u0026gt;:    vmrs    APSR_nzcv, fpscr\n0x1d754 \u0026lt;runtime.check+200\u0026gt;:    ldreq   r1, [pc, #264]  ; 0x1d864\n\u0026lt;runtime.check+472\u0026gt;\n0x1d758 \u0026lt;runtime.check+204\u0026gt;:    streq   r1, [sp, #4]\n0x1d75c \u0026lt;runtime.check+208\u0026gt;:    bleq    0x1cee0 \u0026lt;runtime.throw\u0026gt;\n0x1d760 \u0026lt;runtime.check+212\u0026gt;:    vldr    d0, [sp, #36]   ; 0x24\n0x1d764 \u0026lt;runtime.check+216\u0026gt;:    vldr    d1, [sp, #36]   ; 0x24\n0x1d768 \u0026lt;runtime.check+220\u0026gt;:    vcmpe.f64       d0, d1\n(gdb) quit\nA debugging session is active.\n\n        Inferior 1 [process 10356] will be killed.\n\nQuit anyway? (y or n) y\n\nrounin@LKG80B859:~$ cd go\nrounin@LKG80B859:~/go$ hg identify\n820ffde8c396 tip\nrounin@LKG80B859:~$ cd -\nrounin@LKG80B859:~$ lt hello*\n-rw-r--r-- 1 rounin rounin     64 May 18 19:26 hello.go\n-rwxr-xr-x 1 rounin rounin 226212 May 18 21:20 hello.old\n-rwxr-xr-x 1 rounin rounin 226212 May 18 22:33 hello.old.1\n-rwxr-xr-x 1 rounin rounin 171430 May 19 14:55 hello\n\nrounin@LKG80B859:~$ file hello\nhello: ELF 32-bit LSB executable, ARM, version 1 (SYSV), statically linked, not stripped\nrounin@LKG80B859:~$ file hello.old\nhello.old: ELF 32-bit LSB executable, ARM, version 1 (SYSV), statically linked, not\nstripped\n\nrounin@LKG80B859:~$ ./hello.old\nThis program can only be run on EABI kernels\n\nhello.old executable was created by compiling with the original release of\ngo1.0.1/release\n\nrounin@LKG80B859:~$ cd go.Fri18May2012_2247\nrounin@LKG80B859:~/go.Fri18May2012_2247$ hg identify\n2ccfd4b451d3 (release-branch.go1) go1.0.1/release\n\nPlease note on this ARM CPU based Cisco Linksys NSLU2 NAS it takes about 235 minutes\nto compile after starting ./all.bash\n\nSo the debug cycles to debug this going forward will be long - your patience and guidance\nwill be greatly appreciated.\nreal    235m2.002s\u003c/pre\u003e",
	"user": {
		"login": "gopherbot",
		"id": 8566911,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"comments": 3,
	"closed_at": "2014-12-08T10:19:14Z",
	"created_at": "2012-05-19T14:30:13Z",
	"updated_at": "2016-06-24T22:19:18Z"
}
