{
	"id": 51287789,
	"number": 8169,
	"state": "closed",
	"title": "go.tools/go/types assertion failure in recordTypeAndValue",
	"body": "\u003cpre\u003ego.tools$ hg id\n75a83badcaf5+ tip\n\n$ go version\ngo version go1.3rc1 linux/amd64\n\nWhen I run godoc with -analysis=\u0026quot;(something)\u0026quot; -http=\u0026quot;...\u0026quot; it crashes\nin the analysis.\n\nThe following check appears to fail in go.tools/go/types/check.go:249:\n\n\nfunc (check *checker) recordTypeAndValue(x ast.Expr, typ Type, val exact.Value) {\n\tassert(x != nil \u0026amp;\u0026amp; typ != nil)\n\tif val != nil {\n\t\tassert(isConstType(typ)) // \u0026lt;- Fails here.\n\t}\n\tif m := check.Types; m != nil {\n\t\tm[x] = TypeAndValue{typ, val}\n\t}\n}\n\n\nIf I hide:\ngithub.com/youtube/vitess/go/zk/\n\nThen the issue is not triggered.\n\n\npanic: assertion failed [recovered]\n\tpanic: assertion failed [recovered]\n\tpanic: assertion failed [recovered]\n\tpanic: assertion failed\n\ngoroutine 1463 [running]:\nruntime.panic(0x901300, 0xc2183fdc70)\n\t/home/daniel/code/go/src/pkg/runtime/panic.c:279 +0xf5\ncode.google.com/p/go.tools/go/types.(*checker).handleBailout(0xc2178fd800, 0xc20b453250)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/check.go:202 +0xcd\nruntime.panic(0x901300, 0xc2183fdc70)\n\t/home/daniel/code/go/src/pkg/runtime/panic.c:248 +0x18d\ncode.google.com/p/go.tools/go/types.(*checker).handleBailout(0xc217c42b00, 0xc20b452718)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/check.go:202 +0xcd\nruntime.panic(0x901300, 0xc2183fdc70)\n\t/home/daniel/code/go/src/pkg/runtime/panic.c:248 +0x18d\ncode.google.com/p/go.tools/go/types.(*checker).handleBailout(0xc217d2c700, 0xc20b451be0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/check.go:202 +0xcd\nruntime.panic(0x901300, 0xc2183fdc70)\n\t/home/daniel/code/go/src/pkg/runtime/panic.c:248 +0x18d\ncode.google.com/p/go.tools/go/types.assert(0x7f719be7f600)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/errors.go:18 +0x68\ncode.google.com/p/go.tools/go/types.(*checker).recordTypeAndValue(0xc217d2c700,\n0x7f719be9abe8, 0xc217cd4de0, 0x7f719be7f6d0, 0xebbfc0, 0x7f719be7f698, 0x1)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/check.go:252 +0x70\ncode.google.com/p/go.tools/go/types.(*checker).rawExpr(0xc217d2c700, 0xc218499300,\n0x7f719be9abe8, 0xc217cd4de0, 0x0, 0x0, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/expr.go:938 +0x30b\ncode.google.com/p/go.tools/go/types.(*checker).use(0xc217d2c700, 0xc217cd0ab0, 0x1, 0x1)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/call.go:91 +0xd5\ncode.google.com/p/go.tools/go/types.(*checker).call(0xc217d2c700, 0xc218499280,\n0xc217cdc1c0, 0xc217cdc1c0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/call.go:19 +0xad\ncode.google.com/p/go.tools/go/types.(*checker).exprInternal(0xc217d2c700, 0xc218499280,\n0x7f719be9ac20, 0xc217cdc1c0, 0x0, 0x0, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/expr.go:1332 +0x244f\ncode.google.com/p/go.tools/go/types.(*checker).rawExpr(0xc217d2c700, 0xc218499280,\n0x7f719be9ac20, 0xc217cdc1c0, 0x0, 0x0, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/expr.go:915 +0x84\ncode.google.com/p/go.tools/go/types.(*checker).expr(0xc217d2c700, 0xc218499280,\n0x7f719be9ac20, 0xc217cdc1c0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/expr.go:1419 +0x64\ncode.google.com/p/go.tools/go/types.func路007(0xc218499280, 0x3)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/call.go:64 +0x7e\ncode.google.com/p/go.tools/go/types.(*checker).arguments(0xc217d2c700, 0xc218499280,\n0xc217cdc200, 0xc21847a5d0, 0xc20b450600, 0x4)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/call.go:182 +0x90\ncode.google.com/p/go.tools/go/types.(*checker).call(0xc217d2c700, 0xc218499280,\n0xc217cdc200, 0xc217cdc200)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/call.go:65 +0x826\ncode.google.com/p/go.tools/go/types.(*checker).exprInternal(0xc217d2c700, 0xc218499280,\n0x7f719be9ac20, 0xc217cdc200, 0x0, 0x0, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/expr.go:1332 +0x244f\ncode.google.com/p/go.tools/go/types.(*checker).rawExpr(0xc217d2c700, 0xc218499280,\n0x7f719be9ac20, 0xc217cdc200, 0x0, 0x0, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/expr.go:915 +0x84\ncode.google.com/p/go.tools/go/types.(*checker).expr(0xc217d2c700, 0xc218499280,\n0x7f719be9ac20, 0xc217cdc200)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/expr.go:1419 +0x64\ncode.google.com/p/go.tools/go/types.func路002(0xc218499280, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/assignments.go:211 +0x77\ncode.google.com/p/go.tools/go/types.unpack(0xc20b450f10, 0x1, 0x42e301, 0xd0, 0xa240a0,\n0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/call.go:121 +0x5f\ncode.google.com/p/go.tools/go/types.(*checker).initVars(0xc217d2c700, 0xc2183fdbe0, 0x2,\n0x2, 0xc217cd0ac0, 0x1, 0x1, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/assignments.go:211 +0xc8\ncode.google.com/p/go.tools/go/types.(*checker).shortVarDecl(0xc217d2c700, 0x7c29cf,\n0xc217cd4b60, 0x2, 0x2, 0xc217cd0ac0, 0x1, 0x1)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/assignments.go:310 +0x459\ncode.google.com/p/go.tools/go/types.(*checker).stmt(0xc217d2c700, 0x0, 0x7f719be9ac58,\n0xc217cdc240)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/stmt.go:291 +0x4f23\ncode.google.com/p/go.tools/go/types.(*checker).stmtList(0xc217d2c700, 0x0, 0xc217cca480,\n0x5, 0x8)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/stmt.go:91 +0x106\ncode.google.com/p/go.tools/go/types.(*checker).funcBody(0xc217d2c700, 0xc218154480,\n0xc217cd0910, 0xd, 0xc2183f7440, 0xc217cd2f30)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/stmt.go:39 +0x158\ncode.google.com/p/go.tools/go/types.(*checker).functionBodies(0xc217d2c700)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/resolver.go:379 +0xf2\ncode.google.com/p/go.tools/go/types.(*checker).Files(0xc217d2c700, 0xc217c7cfc0, 0xb,\n0xb, 0x0, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/check.go:218 +0x10e\ncode.google.com/p/go.tools/go/loader.typeCheckFiles(0xc21798f0e0, 0xc217c7cfc0, 0xb, 0xb)\n\t/home/daniel/src/code.google.com/p/go.tools/go/loader/loader.go:745 +0x22d\ncode.google.com/p/go.tools/go/loader.(*importer).importFromSource(0xc209ad5e20,\n0xc217c48a81, 0x26, 0x26, 0x0, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/loader/loader.go:733 +0x11c\ncode.google.com/p/go.tools/go/loader.(*importer).importPackage(0xc209ad5e20,\n0xc217c48a81, 0x26, 0x0, 0x0, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/loader/loader.go:693 +0x31b\ncode.google.com/p/go.tools/go/loader.(*importer).doImport(0xc209ad5e20, 0xc20984c5d0,\n0xc217c48a81, 0x26, 0xc20b451e98, 0x0, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/loader/loader.go:666 +0xc2\ncode.google.com/p/go.tools/go/loader.*importer.(code.google.com/p/go.tools/go/loader.doImport)路fm(0xc20984c5d0,\n0xc217c48a81, 0x26, 0x26, 0x0, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/loader/loader.go:763 +0x56\ncode.google.com/p/go.tools/go/types.(*checker).collectObjects(0xc217c42b00)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/resolver.go:166 +0x221d\ncode.google.com/p/go.tools/go/types.(*checker).Files(0xc217c42b00, 0xc217732f20, 0x15,\n0x15, 0x0, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/check.go:212 +0xb7\ncode.google.com/p/go.tools/go/loader.typeCheckFiles(0xc21798e870, 0xc217732f20, 0x15,\n0x15)\n\t/home/daniel/src/code.google.com/p/go.tools/go/loader/loader.go:745 +0x22d\ncode.google.com/p/go.tools/go/loader.(*importer).importFromSource(0xc209ad5e20,\n0xc2178e3e31, 0x28, 0x28, 0x0, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/loader/loader.go:733 +0x11c\ncode.google.com/p/go.tools/go/loader.(*importer).importPackage(0xc209ad5e20,\n0xc2178e3e31, 0x28, 0x0, 0x0, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/loader/loader.go:693 +0x31b\ncode.google.com/p/go.tools/go/loader.(*importer).doImport(0xc209ad5e20, 0xc20984c5d0,\n0xc2178e3e31, 0x28, 0xc20b4529d0, 0x0, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/loader/loader.go:666 +0xc2\ncode.google.com/p/go.tools/go/loader.*importer.(code.google.com/p/go.tools/go/loader.doImport)路fm(0xc20984c5d0,\n0xc2178e3e31, 0x28, 0x28, 0x0, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/loader/loader.go:763 +0x56\ncode.google.com/p/go.tools/go/types.(*checker).collectObjects(0xc2178fd800)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/resolver.go:166 +0x221d\ncode.google.com/p/go.tools/go/types.(*checker).Files(0xc2178fd800, 0xc21789d080, 0x6,\n0x6, 0x0, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/types/check.go:212 +0xb7\ncode.google.com/p/go.tools/go/loader.typeCheckFiles(0xc217883950, 0xc21789d080, 0x6, 0x6)\n\t/home/daniel/src/code.google.com/p/go.tools/go/loader/loader.go:745 +0x22d\ncode.google.com/p/go.tools/go/loader.(*importer).importFromSource(0xc209ad5e20,\n0xc208647bd1, 0x26, 0x26, 0x0, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/loader/loader.go:733 +0x11c\ncode.google.com/p/go.tools/go/loader.(*importer).importPackage(0xc209ad5e20,\n0xc208647bd1, 0x26, 0xc20b453510, 0x0, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/loader/loader.go:693 +0x31b\ncode.google.com/p/go.tools/go/loader.(*Config).Load(0xc2087161b0, 0x1, 0x0, 0x0)\n\t/home/daniel/src/code.google.com/p/go.tools/go/loader/loader.go:494 +0x253\ncode.google.com/p/go.tools/godoc/analysis.Run(0xa81501, 0xc20802ce70)\n\t/home/daniel/src/code.google.com/p/go.tools/godoc/analysis/analysis.go:341 +0xad0\ncreated by main.main\n\t/home/daniel/src/code.google.com/p/go.tools/cmd/godoc/main.go:306 +0x177d\u003c/pre\u003e",
	"user": {
		"login": "kardianos",
		"id": 755121,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"assignee": {
		"login": "griesemer",
		"id": 8528975,
		"type": "User",
		"site_admin": false
	},
	"comments": 5,
	"closed_at": "2014-12-08T10:45:20Z",
	"created_at": "2014-06-07T23:23:41Z",
	"updated_at": "2016-06-25T01:36:06Z",
	"milestone": {
		"id": 1067218,
		"number": 21,
		"title": "Go1.4"
	}
}
