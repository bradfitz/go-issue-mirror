{
	"id": 70124184,
	"number": 10534,
	"state": "closed",
	"title": "runtime: crash in sigtramp",
	"body": "go version devel +87054c4 Wed Apr 22 02:50:48 2015 +0000 linux/amd64\r\n\r\nA program silently crashed here (from a core file):\r\n```\r\n(gdb) bt\r\n#0  runtime.sigtramp () at /ssd/src/go10/src/runtime/sys_linux_amd64.s:232\r\n#1  0x0000000000469690 in runtime.sigtramp () at /ssd/src/go10/src/runtime/sys_linux_amd64.s:246\r\n#2  0x0000000000000001 in ?? ()\r\n#3  0x0000000000000000 in ?? ()\r\n(gdb) disass\r\nDump of assembler code for function runtime.sigtramp:\r\n   0x0000000000469620 \u003c+0\u003e:\tsub    $0x40,%rsp\r\n   0x0000000000469624 \u003c+4\u003e:\tmov    %fs:0xfffffffffffffff8,%r10\r\n   0x000000000046962d \u003c+13\u003e:\tcmp    $0x0,%r10\r\n   0x0000000000469631 \u003c+17\u003e:\tjne    0x469645 \u003cruntime.sigtramp+37\u003e\r\n   0x0000000000469633 \u003c+19\u003e:\tmov    %rdi,(%rsp)\r\n   0x0000000000469637 \u003c+23\u003e:\tlea    -0x1d60e(%rip),%rax        # 0x44c030 \u003cruntime.badsignal\u003e\r\n   0x000000000046963e \u003c+30\u003e:\tcallq  *%rax\r\n   0x0000000000469640 \u003c+32\u003e:\tadd    $0x40,%rsp\r\n   0x0000000000469644 \u003c+36\u003e:\tretq   \r\n   0x0000000000469645 \u003c+37\u003e:\tmov    %r10,0x28(%rsp)\r\n   0x000000000046964a \u003c+42\u003e:\tmov    0xb8(%r10),%rax\r\n=\u003e 0x0000000000469651 \u003c+49\u003e:\tmov    0x48(%rax),%rax\r\n   0x0000000000469655 \u003c+53\u003e:\tmov    %rax,%fs:0xfffffffffffffff8\r\n   0x000000000046965e \u003c+62\u003e:\tmov    %rdi,(%rsp)\r\n   0x0000000000469662 \u003c+66\u003e:\tmov    %rsi,0x8(%rsp)\r\n   0x0000000000469667 \u003c+71\u003e:\tmov    %rdx,0x10(%rsp)\r\n   0x000000000046966c \u003c+76\u003e:\tmov    %r10,0x18(%rsp)\r\n   0x0000000000469671 \u003c+81\u003e:\tcallq  0x44abd0 \u003cruntime.sighandler\u003e\r\n   0x0000000000469676 \u003c+86\u003e:\tmov    0x28(%rsp),%r10\r\n   0x000000000046967b \u003c+91\u003e:\tmov    %r10,%fs:0xfffffffffffffff8\r\n   0x0000000000469684 \u003c+100\u003e:\tadd    $0x40,%rsp\r\n   0x0000000000469688 \u003c+104\u003e:\tretq   \r\n   0x0000000000469689 \u003c+105\u003e:\tadd    %al,(%rax)\r\n   0x000000000046968b \u003c+107\u003e:\tadd    %al,(%rax)\r\n   0x000000000046968d \u003c+109\u003e:\tadd    %al,(%rax)\r\n   0x000000000046968f \u003c+111\u003e:\tadd    %bh,0xf(%rax)\r\nEnd of assembler dump.\r\n(gdb) info registers\r\nrax            0x0\t0\r\nrbx            0x0\t0\r\nrcx            0xc20807ab40\t833358375744\r\nrdx            0xc2097ebac0\t833382955712\r\nrsi            0xc2097ebbf0\t833382956016\r\nrdi            0xb\t11\r\nrbp            0x8\t0x8\r\nrsp            0xc2097eba78\t0xc2097eba78\r\nr8             0x10\t16\r\nr9             0x0\t0\r\nr10            0xc20807ab40\t833358375744\r\nr11            0x216\t534\r\nr12            0x1\t1\r\nr13            0xeccc98a8a\t63565302410\r\nr14            0xeccc98a8b\t63565302411\r\nr15            0xa3b0c0\t10727616\r\nrip            0x469651\t0x469651 \u003cruntime.sigtramp+49\u003e\r\neflags         0x10202\t[ IF RF ]\r\ncs             0x33\t51\r\nss             0x2b\t43\r\nds             0x0\t0\r\nes             0x0\t0\r\nfs             0x0\t0\r\ngs             0x0\t0\r\n```\r\n\r\nIt means that g != nil but g.m == nil. The goroutine descriptor looks valid:\r\n```\r\n(gdb) p /x $r10\r\n$1 = 0xc20807ab40\r\n(gdb) x/100g 0xc20807ab40\r\n0xc20807ab40:\t0x000000c208953000\t0x000000c208954000\r\n0xc20807ab50:\t0x000000c208953280\t0xffffffffffffffff\r\n0xc20807ab60:\t0x0000000000000000\t0x0000000000000000\r\n0xc20807ab70:\t0x0000000000000000\t0x0000000000465f90\r\n0xc20807ab80:\t0x000000c20807ab40\t0x0000000000000000\r\n0xc20807ab90:\t0x0000000000000000\t0x0000000000000000\r\n0xc20807aba0:\t0x000000000045ace0\t0x0000000000000000\r\n0xc20807abb0:\t0x000000000051c0f5\t0x0000000000000000\r\n0xc20807abc0:\t0x0000000000000002\t0x0000000000000017\r\n0xc20807abd0:\t0x0000000000000000\t0x000000000084ddb0\r\n0xc20807abe0:\t0x000000000000000c\t0x000000c20807a8c0\r\n0xc20807abf0:\t0x0000000001000000\t0x0000000000000000\r\n0xc20807ac00:\t0x0000000000000000\t0x0000000000000000\r\n0xc20807ac10:\t0x0000000000000000\t0x0000000000000000\r\n0xc20807ac20:\t0x0000000000000000\t0x0000000000000000\r\n0xc20807ac30:\t0x0000000000000000\t0x0000000000000000\r\n0xc20807ac40:\t0x000000000040a1b6\t0x000000000040a1f0\r\n0xc20807ac50:\t0x0000000000000000\t0x0000000000000000\r\n0xc20807ac60:\t0x0000000000000000\t0x0000000000002d40\r\n0xc20807ac70:\t0x000000000000015f\t0x0000000000000000\r\n0xc20807ac80:\t0x000000c208e1f000\t0x000000c208e20000\r\n0xc20807ac90:\t0x000000c208e1f280\t0xffffffffffffffff\r\n0xc20807aca0:\t0x0000000000000000\t0x0000000000000000\r\n0xc20807acb0:\t0x000000c208e1f950\t0x0000000000465f90\r\n0xc20807acc0:\t0x000000c20807ac80\t0x0000000000000000\r\n0xc20807acd0:\t0x0000000000000000\t0x0000000000000000\r\n0xc20807ace0:\t0x000000000045ad20\t0x0000000000000000\r\n0xc20807acf0:\t0x000000000051c0f5\t0x0000000000000000\r\n0xc20807ad00:\t0x0000000000000002\t0x0000000000000018\r\n0xc20807ad10:\t0x0000000000000000\t0x000000000084ddb0\r\n0xc20807ad20:\t0x000000000000000c\t0x000000c20807bb80\r\n0xc20807ad30:\t0x0000000001000000\t0x000000c2099c4000\r\n0xc20807ad40:\t0x0000000000000000\t0x0000000000000000\r\n0xc20807ad50:\t0x0000000000000000\t0x0000000000000000\r\n0xc20807ad60:\t0x0000000000000000\t0x0000000000000000\r\n0xc20807ad70:\t0x0000000000000000\t0x0000000000000000\r\n0xc20807ad80:\t0x000000000040a1b6\t0x000000000040a1f0\r\n0xc20807ad90:\t0x0000000000000000\t0x0000000000000000\r\n0xc20807ada0:\t0x0000000000000000\t0x0000000000006620\r\n0xc20807adb0:\t0x0000000000000322\t0x0000000000000000\r\n0xc20807adc0:\t0x000000c208aae000\t0x000000c208aaf000\r\n0xc20807add0:\t0x000000c208aae280\t0xffffffffffffffff\r\n0xc20807ade0:\t0x0000000000000000\t0x0000000000000000\r\n0xc20807adf0:\t0x000000c208aae640\t0x000000000051c0f5\r\n0xc20807ae00:\t0x000000c20807adc0\t0x0000000000000000\r\n0xc20807ae10:\t0x0000000000000000\t0x0000000000000000\r\n```\r\n\r\nThis is goroutine 17:\r\n```\r\n(gdb) info goroutines\r\n* 17 syscall  runtime.goexit\r\n```\r\n\r\nI don't any obvious place where we setg(g) with g.m==nil.\r\n\r\nCore file and the binary are here:\r\nhttps://drive.google.com/file/d/0B20Uwp8Hs1oCdVpieWdfZy1PN3M/view?usp=sharing\r\n",
	"user": {
		"login": "dvyukov",
		"id": 1095328,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"comments": 5,
	"closed_at": "2015-06-24T20:57:49Z",
	"created_at": "2015-04-22T13:21:49Z",
	"updated_at": "2016-06-25T02:06:11Z",
	"milestone": {
		"id": 905105,
		"number": 1,
		"title": "Go1.5"
	}
}
