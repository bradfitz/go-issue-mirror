{
	"id": 85568940,
	"body": "Fixing the write barriers in os1_nacl.go's newosproc should fix this\nspecific failure, but I'm more generally concerned that it's possible to\nstart a new M while the world is stopped. This is walking on thin ice.\n\nOn Mon, Mar 23, 2015 at 10:58 PM, Minux Ma \u003cnotifications@github.com\u003e wrote:\n\n\u003e I just saw that i also failed on a previous commit on the nacl-amd64p32\n\u003e builder:\n\u003e\n\u003e http://build.golang.org/log/6bc2419376e65f381076f15802ca1fe10e9098d4\n\u003e (it was on commit 08af4c3a798054ec22a6fdac3af2213d6a34d7eb, but that is\n\u003e probably irrelevant for this issue.)\n\u003e\n\u003e It has a better stack trace with no elided frames, but it might be caused\n\u003e by\n\u003e a separate issue:\n\u003e fatal error: writebarrierptr_nostore1 called with mp.p == nil\n\u003e\n\u003e runtime stack:\n\u003e runtime.throw(0x28e428, 0x30)\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/panic.go:543 +0x120\n\u003e runtime.writebarrierptr_nostore1.func1()\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/mbarrier.go:108 +0x160\n\u003e runtime.systemstack(0x109a5e80)\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/asm_amd64p32.s:231 +0x100\n\u003e runtime.writebarrierptr_nostore1(0x1091ea34, 0x109ba280)\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/mbarrier.go:112 +0x80\n\u003e runtime.writebarrierptr(0x1091ea34, 0x109ba280)\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/mbarrier.go:135 +0xc0\n\u003e runtime.newosproc(0x1091ea00, 0x1098c000)\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/os1_nacl.go:75 +0x60\n\u003e runtime.newm(0x0, 0x10913400)\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/proc1.go:995 +0x1a0\n\u003e runtime.startm(0x10913400, 0x10913d00)\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/proc1.go:1058 +0x180\n\u003e runtime.handoffp(0x10913400, 0x1)\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/proc1.go:1077 +0x2e0\n\u003e runtime.stoplockedm()\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/proc1.go:1133 +0xe0\n\u003e runtime.schedule()\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/proc1.go:1417 +0xc0\n\u003e runtime.goschedImpl(0x109ba000, 0x8b9)\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/proc1.go:1530 +0x180\n\u003e runtime.gosched_m(0x109ba000, 0x0)\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/proc1.go:1538 +0x60\n\u003e runtime.mcall(0x0)\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/asm_amd64p32.s:162 +0x80\n\u003e\n\u003e goroutine 33 [runnable, locked to thread]:\n\u003e runtime.Gosched()\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/proc.go:135 +0x20\n\u003e fp=0x109c2fb8 sp=0x109c2fa8\n\u003e runtime/pprof_test.TestTraceStress.func4(0x1099c580, 0x0)\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/pprof/trace_test.go:136 +0xa0\n\u003e fp=0x109c2fd8 sp=0x109c2fb8\n\u003e runtime.goexit()\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/asm_amd64p32.s:1086 +0x1\n\u003e fp=0x109c2fe0 sp=0x109c2fd8\n\u003e created by runtime/pprof_test.TestTraceStress\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/pprof/trace_test.go:139 +0x4e0\n\u003e\n\u003e goroutine 1 [chan receive]:\n\u003e testing.RunTests(0x2a9a24, 0x6b1460, 0x8, 0x8, 0x1, 0x0)\n\u003e /tmp/buildlet-scatch909750053/go/src/testing/testing.go:561 +0xba0\n\u003e testing.(*M).Run(0x1093a120, 0x6cb700, 0x0, 0x0)\n\u003e /tmp/buildlet-scatch909750053/go/src/testing/testing.go:490 +0x100\n\u003e main.main()\n\u003e /tmp/go-build587579621/runtime/pprof/_test/_testmain.go:70 +0x200\n\u003e\n\u003e goroutine 15 [runnable]:\n\u003e runtime/pprof_test.TestTraceStress(0x10958900, 0x0)\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/pprof/trace_test.go:144 +0x540\n\u003e testing.tRunner(0x10958900, 0x6b149c)\n\u003e /tmp/buildlet-scatch909750053/go/src/testing/testing.go:452 +0x120\n\u003e created by testing.RunTests\n\u003e /tmp/buildlet-scatch909750053/go/src/testing/testing.go:560 +0xb60\n\u003e\n\u003e goroutine 16 [chan receive]:\n\u003e runtime/pprof_test.TestTraceStress.func1(0x1099c580, 0x1090bbc0)\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/pprof/trace_test.go:99 +0x60\n\u003e created by runtime/pprof_test.TestTraceStress\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/pprof/trace_test.go:101 +0xe0\n\u003e\n\u003e goroutine 17 [semacquire]:\n\u003e sync.runtime_Syncsemacquire(0x10958970, 0x1)\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/sema.go:237 +0x320\n\u003e sync.(*Cond).Wait(0x10958968, 0x10958960)\n\u003e /tmp/buildlet-scatch909750053/go/src/sync/cond.go:62 +0x100\n\u003e syscall.(*queue).waitRead(0x10958960, 0x1, 0x0, 0x0, 0x6b65e0, 0x0, 0x0,\n\u003e 0x8b9)\n\u003e /tmp/buildlet-scatch909750053/go/src/syscall/net_nacl.go:263 +0x180\n\u003e syscall.(*byteq).read(0x10958960, 0x109a8a20, 0x1, 0x1, 0x0, 0x0, 0x0, 0x0,\n\u003e 0x0, 0x0)\n\u003e /tmp/buildlet-scatch909750053/go/src/syscall/net_nacl.go:328 +0xe0\n\u003e syscall.(*pipeFile).read(0x1091c4e8, 0x109a8a20, 0x1, 0x1, 0x0, 0x0, 0x0,\n\u003e 0x0)\n\u003e /tmp/buildlet-scatch909750053/go/src/syscall/fd_nacl.go:303 +0x100\n\u003e syscall.Read(0x3, 0x109a8a20, 0x1, 0x1, 0x0, 0x0, 0x0, 0x0)\n\u003e /tmp/buildlet-scatch909750053/go/src/syscall/fd_nacl.go:162 +0xe0\n\u003e os.(*File).read(0x1091c4f8, 0x109a8a20, 0x1, 0x1, 0x32460, 0x0, 0x0,\n\u003e 0x1fc260)\n\u003e /tmp/buildlet-scatch909750053/go/src/os/file_unix.go:203 +0x80\n\u003e os.(*File).Read(0x1091c4f8, 0x109a8a20, 0x1, 0x1, 0x0, 0x0, 0x0, 0x0)\n\u003e /tmp/buildlet-scatch909750053/go/src/os/file.go:95 +0xa0\n\u003e runtime/pprof_test.TestTraceStress.func3(0x1091c4f8, 0x1099c580,\n\u003e 0x1090bbc0, 0x0)\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/pprof/trace_test.go:115 +0x80\n\u003e created by runtime/pprof_test.TestTraceStress\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/pprof/trace_test.go:118 +0x2e0\n\u003e\n\u003e goroutine 18 [trace reader (blocked)]:\n\u003e runtime.ReadTrace(0x0, 0x0, 0x0, 0x8)\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/trace.go:313 +0x320\n\u003e runtime/pprof.StartTrace.func1(0xfeed09a8, 0x109589c0)\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/pprof/pprof.go:629 +0x40\n\u003e created by runtime/pprof.StartTrace\n\u003e /tmp/buildlet-scatch909750053/go/src/runtime/pprof/pprof.go:635 +0xa0\n\u003e FAIL runtime/pprof 0.258s\n\u003e\n\u003e\n\u003e It seems nacl's newosproc should be labeled nowritebarrier?\n\u003e\n\u003e â€”\n\u003e Reply to this email directly or view it on GitHub\n\u003e \u003chttps://github.com/golang/go/issues/10223#issuecomment-85318069\u003e.\n\u003e\n",
	"user": {
		"login": "aclements",
		"id": 2688315,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2015-03-24T15:47:49Z",
	"updated_at": "2015-03-24T15:47:49Z"
}
