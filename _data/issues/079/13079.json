{
	"id": 113737051,
	"number": 13079,
	"state": "open",
	"title": "net/http: when I ctrl+C terminate the process,and start process again, repeat several times, http.Get function will crash",
	"body": "\u003e http.Get: In version go1.5.1 and win10-x64, when I ctrl+C terminate the process,and start process again, repeate several timesï¼Œhttp.Get function will crash.\r\n\u003e When I use version go1.4.3, don't have this bug.\r\n\u003e===========================codes:============================\r\n\r\n    package main\r\n    \r\n    import (\r\n    \"fmt\"\r\n    \"io/ioutil\"\r\n    \"net/http\"\r\n    )\r\n    \r\n    func getSize(num int) string {\r\n    if num \u003e 102410241024 {\r\n    return fmt.Sprintf(\"%.1fGB\", float32(num)/1024/1024/1024)\r\n    } else if num \u003e 1024*1024 {\r\n    return fmt.Sprintf(\"%.1fMB\", float32(num)/1024/1024)\r\n    } else if num \u003e 1024 {\r\n    return fmt.Sprintf(\"%.1fKB\", float32(num)/1024)\r\n    }\r\n    \r\n    return fmt.Sprintf(\"%dB\", num)\r\n    }\r\n    \r\n    func downloadUrl(url string) bool {\r\n    resp, err := http.Get(url)\r\n    if err != nil {\r\n    return false\r\n    }\r\n    defer resp.Body.Close()\r\n    \r\n    body, err := ioutil.ReadAll(resp.Body)\r\n    if err != nil {\r\n    return false\r\n    }\r\n    \r\n    fmt.Println(\"success download:\", url, \" \", getSize(len(body)))\r\n    return true\r\n    }\r\n    \r\n    func main() {\r\n    downloadUrl(\"http://mirrors.163.com/debian/dists/unstable/Release\")\r\n    downloadUrl(\"http://mirrors.163.com/debian/dists/unstable/main/source/Sources.gz\")\r\n    }\r\n\r\n===========================errors:============================\r\nD:\\code\\server-work\\golang\\project\\src\\apt-mirror\u003ego build main.go\r\n\r\nD:\\code\\server-work\\golang\\project\\src\\apt-mirror\u003emain.exe\r\nsuccess download: http://mirrors.163.com/debian/dists/unstable/Release   248.5KB\r\n\r\nD:\\code\\server-work\\golang\\project\\src\\apt-mirror\u003emain.exe\r\nsuccess download: http://mirrors.163.com/debian/dists/unstable/Release   248.5KB\r\n\r\nD:\\code\\server-work\\golang\\project\\src\\apt-mirror\u003emain.exe\r\n\r\nD:\\code\\server-work\\golang\\project\\src\\apt-mirror\u003emain.exe\r\n\r\nD:\\code\\server-work\\golang\\project\\src\\apt-mirror\u003emain.exe\r\nsuccess download: http://mirrors.163.com/debian/dists/unstable/Release   248.5KB\r\n\r\nD:\\code\\server-work\\golang\\project\\src\\apt-mirror\u003emain.exe\r\nsuccess download: http://mirrors.163.com/debian/dists/unstable/Release   248.5KB\r\n\r\nD:\\code\\server-work\\golang\\project\\src\\apt-mirror\u003emain.exe\r\nException 0xe06d7363 0x19930520 0x8f9b0 0x7fff3e21a1c8\r\nPC=0x7fff3e21a1c8\r\n\r\nsyscall.Syscall9(0x7fff3ecaf0e0, 0x7, 0x294, 0xc08200d1b0, 0x1, 0xc08200d198, 0x0, 0xc08200d168, 0x0, 0x0, ...)\r\n        c:/go/src/runtime/syscall_windows.go:150 +0x5c\r\nsyscall.WSASend(0x294, 0xc08200d1b0, 0x1, 0xc08200d198, 0x0, 0xc08200d168, 0x0, 0x0, 0x0)\r\n        c:/go/src/syscall/zsyscall_windows.go:1529 +0xc4\r\nnet.(*netFD).Write.func1(0xc08200d168, 0x0, 0x0)\r\n        c:/go/src/net/fd_windows.go:513 +0x8c\r\nnet.(*ioSrv).ExecIO(0xc082022040, 0xc08200d168, 0x7055e8, 0x7, 0x783b30, 0x47e320, 0x0, 0x0)\r\n        c:/go/src/net/fd_windows.go:160 +0xd5\r\nnet.(*netFD).Write(0xc08200d080, 0xc08208c000, 0x7d, 0x1000, 0x0, 0x0, 0x0)\r\n        c:/go/src/net/fd_windows.go:514 +0x181\r\nnet.(*conn).Write(0xc082022048, 0xc08208c000, 0x7d, 0x1000, 0x0, 0x0, 0x0)\r\n        c:/go/src/net/net.go:184 +0xeb\r\nbufio.(*Writer).flush(0xc082006640, 0x0, 0x0)\r\n        c:/go/src/bufio/bufio.go:562 +0xe7\r\nbufio.(*Writer).Flush(0xc082006640, 0x0, 0x0)\r\n        c:/go/src/bufio/bufio.go:551 +0x34\r\nnet/http.(*persistConn).writeLoop(0xc082082000)\r\n        c:/go/src/net/http/transport.go:1017 +0x2b8\r\ncreated by net/http.(*Transport).dialConn\r\n        c:/go/src/net/http/transport.go:686 +0xca4\r\n\r\ngoroutine 1 [select]:\r\nnet/http.(*persistConn).roundTrip(0xc082082000, 0xc082002b40, 0x0, 0x0, 0x0)\r\n        c:/go/src/net/http/transport.go:1164 +0xb14\r\nnet/http.(*Transport).RoundTrip(0xc08205a120, 0xc08207e000, 0xc000000002, 0x0, 0x0)\r\n        c:/go/src/net/http/transport.go:235 +0x537\r\nnet/http.send(0xc08207e000, 0x3c4440, 0xc08205a120, 0xc082006440, 0x0, 0x0)\r\n        c:/go/src/net/http/client.go:220 +0x533\r\nnet/http.(*Client).send(0x874ea0, 0xc08207e000, 0x34, 0x0, 0x0)\r\n        c:/go/src/net/http/client.go:143 +0x161\r\nnet/http.(*Client).doFollowingRedirects(0x874ea0, 0xc08207e000, 0x783d40, 0x0, 0x0, 0x0)\r\n        c:/go/src/net/http/client.go:380 +0xbc7\r\nnet/http.(*Client).Get(0x874ea0, 0x764100, 0x34, 0x4112b9, 0x0, 0x0)\r\n        c:/go/src/net/http/client.go:306 +0xb1\r\nnet/http.Get(0x764100, 0x34, 0x899a70, 0x0, 0x0)\r\n        c:/go/src/net/http/client.go:281 +0x4c\r\nmain.downloadUrl(0x764100, 0x34, 0xc08200c100)\r\n        D:/code/server-work/golang/project/src/apt-mirror/main.go:22 +0x4f\r\nmain.main()\r\n        D:/code/server-work/golang/project/src/apt-mirror/main.go:38 +0x33\r\n\r\ngoroutine 8 [IO wait]:\r\nnet.runtime_pollWait(0x3c54c0, 0x72, 0xc082098010)\r\n        c:/go/src/runtime/netpoll.go:157 +0x67\r\nnet.(*pollDesc).Wait(0xc08200d1f0, 0x72, 0x0, 0x0)\r\n        c:/go/src/net/fd_poll_runtime.go:73 +0x41\r\nnet.(*ioSrv).ExecIO(0xc082022038, 0xc08200d0e0, 0x7055e0, 0x7, 0x783b28, 0x20, 0x0, 0x0)\r\n        c:/go/src/net/fd_windows.go:182 +0x177\r\nnet.(*netFD).Read(0xc08200d080, 0xc082011000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\r\n        c:/go/src/net/fd_windows.go:463 +0x17e\r\nnet.(*conn).Read(0xc082022048, 0xc082011000, 0x1000, 0x1000, 0x0, 0x0, 0x0)\r\n        c:/go/src/net/net.go:172 +0xeb\r\nnet/http.noteEOFReader.Read(0x3c5580, 0xc082022048, 0xc082082058, 0xc082011000, 0x1000, 0x1000, 0xc082094000, 0x0, 0x0)\r\n        c:/go/src/net/http/transport.go:1370 +0x6e\r\nnet/http.(*noteEOFReader).Read(0xc082004ec0, 0xc082011000, 0x1000, 0x1000, 0x8, 0x0, 0x0)\r\n        \u003cautogenerated\u003e:126 +0xd7\r\nbufio.(*Reader).fill(0xc08200e660)\r\n        c:/go/src/bufio/bufio.go:97 +0x1f0\r\nbufio.(*Reader).Peek(0xc08200e660, 0x1, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n        c:/go/src/bufio/bufio.go:132 +0xd3\r\nnet/http.(*persistConn).readLoop(0xc082082000)\r\n        c:/go/src/net/http/transport.go:876 +0xfe\r\ncreated by net/http.(*Transport).dialConn\r\n        c:/go/src/net/http/transport.go:685 +0xc7f\r\nrax     0x0\r\nrbx     0x8f9b0\r\nrcx     0x112f00000000\r\nrdi     0x18006a6b8\r\nrsi     0x26ee6f0\r\nrbp     0x8f980\r\nrsp     0x8f840\r\nr8      0x0\r\nr9      0x8f460\r\nr10     0x7fff3e1ff437\r\nr11     0x2a24b0\r\nr12     0x1\r\nr13     0x1\r\nr14     0xc08200d1b0\r\nr15     0x294\r\nrip     0x7fff3e21a1c8\r\nrflags  0x206\r\ncs      0x33\r\nfs      0x53\r\ngs      0x2b\r\n\r\n",
	"user": {
		"login": "aegsea",
		"id": 5748600,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "OS-Windows"
		}
	],
	"comments": 2,
	"created_at": "2015-10-28T03:37:09Z",
	"updated_at": "2015-11-05T01:51:52Z",
	"milestone": {
		"id": 1055141,
		"number": 6,
		"title": "Unplanned"
	}
}
