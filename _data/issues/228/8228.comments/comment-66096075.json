{
	"id": 66096075,
	"body": "\u003ca id=\"c1\"\u003e\u003c/a\u003eComment 1:\n\n\u003cpre\u003eI think it is corrupted memory (most difficult to find bug) somewhere. It is hard to see\nwhere - many potential areas. I simplified your test case - github.com/StackExchange/wmi\nis not needed. Add new test to mattn/go-ole/oleutil:\n\ndiff --git a/oleutil/a_test.go b/oleutil/a_test.go\nnew file mode 100644\nindex 0000000..52341d0\n--- /dev/null\n+++ b/oleutil/a_test.go\n@@ -0,0 +1,34 @@\n+package oleutil_test\n+\n+import (\n+\t\"runtime\"\n+\t\"testing\"\n+\n+\t\"github.com/mattn/go-ole\"\n+\t\"github.com/mattn/go-ole/oleutil\"\n+)\n+\n+func TestALEX(t *testing.T) {\n+\truntime.LockOSThread()\n+\tdefer runtime.UnlockOSThread()\n+\n+\tole.CoInitializeEx(0, 0)\n+\tdefer ole.CoUninitialize()\n+\n+\tunknown, err := oleutil.CreateObject(\"WbemScripting.SWbemLocator\")\n+\tif err != nil {\n+\t\tt.Fatal(err)\n+\t}\n+\tdefer unknown.Release()\n+\n+\twmi, err := unknown.QueryInterface(ole.IID_IDispatch)\n+\tif err != nil {\n+\t\tt.Fatal(err)\n+\t}\n+\tdefer wmi.Release()\n+\n+\t_, err = oleutil.CallMethod(wmi, \"ConnectServer\")\n+\tif err != nil {\n+\t\tt.Fatal(err)\n+\t}\n+}\n\nand you can crash it on windows-amd64\n\nC:\\\u003eu:\\test -test.run=ALEX -test.v\n=== RUN TestALEX\nfatal error: freelist empty\n\ngoroutine 16 [running]:\nruntime.throw(0x62d32b)\n        /root/go/root/src/pkg/runtime/panic.c:520 +0x7e fp=0x193a88 sp=0x193a70\nruntime.MCentral_CacheSpan(0x64b5d8)\n        /root/go/root/src/pkg/runtime/mcentral.c:96 +0x23f fp=0x193ab8 sp=0x193a88\nruntime.MCache_Refill(0x140000, 0x2)\n        /root/go/root/src/pkg/runtime/mcache.c:78 +0x127 fp=0x193ae8 sp=0x193ab8\nruntime.mallocgc(0x10, 0x5055a0, 0x0)\n        /root/go/root/src/pkg/runtime/malloc.goc:152 +0x354 fp=0x193b50 sp=0x193ae8\ncnew(0x5055a0, 0x1, 0x0)\n        /root/go/root/src/pkg/runtime/malloc.goc:836 +0xc8 fp=0x193b70 sp=0x193b50\nruntime.cnew(0x5055a0)\n        /root/go/root/src/pkg/runtime/malloc.goc:843 +0x42 fp=0x193b90 sp=0x193b70\ncopyin(0x5055a0, 0x193c68, 0x193c00)\n        /root/go/root/src/pkg/runtime/iface.goc:164 +0x6e fp=0x193bc8 sp=0x193b90\nruntime.convT2E(0x5055a0, 0x193c68, 0x5055a0, 0x0)\n        /root/go/root/src/pkg/runtime/iface.goc:207 +0x3d fp=0x193be8 sp=0x193bc8\ntesting.(*T).report(0xc08200a120)\n        /root/go/root/src/pkg/testing/testing.go:462 +0x4b8 fp=0x193cd8 sp=0x193be8\ntesting.RunTests(0x5a8100, 0x629b60, 0x1, 0x1, 0x1)\n        /root/go/root/src/pkg/testing/testing.go:518 +0x9c8 fp=0x193e78 sp=0x193cd8\ntesting.Main(0x5a8100, 0x629b60, 0x1, 0x1, 0x635c20, 0x0, 0x0, 0x635c20, 0x0, 0x0)\n        /root/go/root/src/pkg/testing/testing.go:440 +0x8b fp=0x193ef8 sp=0x193e78\nmain.main()\n        github.com/mattn/go-ole/oleutil/_test/_testmain.go:47 +0xa3 fp=0x193f50 sp=0x193ef8\nruntime.main()\n        /root/go/root/src/pkg/runtime/proc.c:247 +0x144 fp=0x193fa8 sp=0x193f50\nruntime.goexit()\n        /root/go/root/src/pkg/runtime/proc.c:1445 fp=0x193fb0 sp=0x193fa8\ncreated by _rt0_go\n        /root/go/root/src/pkg/runtime/asm_amd64.s:97 +0x12c\n\ngoroutine 19 [finalizer wait]:\nruntime.park(0x416a40, 0x632160, 0x630ba9)\n        /root/go/root/src/pkg/runtime/proc.c:1369 +0xac\nruntime.parkunlock(0x632160, 0x630ba9)\n        /root/go/root/src/pkg/runtime/proc.c:1385 +0x42\nrunfinq()\n        /root/go/root/src/pkg/runtime/mgc0.c:2644 +0xdd\nruntime.goexit()\n        /root/go/root/src/pkg/runtime/proc.c:1445\n\nAlex\u003c/pre\u003e",
	"user": {
		"login": "alexbrainman",
		"id": 9796621,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2014-06-20T00:11:25Z",
	"updated_at": "2014-12-08T10:45:37Z"
}
