{
	"id": 107090143,
	"number": 12670,
	"state": "closed",
	"title": "cmd/dist: failure of test in \"Testing packages\" phase causes remaining tests to be skipped",
	"body": "If one of the tests during the \"Testing packages\" phase of \"go tool dist test\" fails, remaining test phases are skipped.\r\n\r\nFor example, on Solaris, due to issue #12115:\r\n```\r\n$ ./all.bash\r\n...\r\n##### Testing packages.\r\n...\r\nok      cmd/fix 0.041s\r\n--- FAIL: TestCgoHandlesWlORIGIN (0.47s)\r\n        go_test.go:257: running testgo [build origin]\r\n        go_test.go:276: standard error:\r\n        go_test.go:277: # origin\r\n                ld: fatal: option '-rpath $ORIGIN' is incompatible with building a relocatable object\r\n                collect2: error: ld returned 1 exit status\r\n                \r\n        go_test.go:286: go [build origin] failed unexpectedly: exit status 2\r\nFAIL\r\nFAIL    cmd/go  23.903s\r\nok      cmd/gofmt       0.041s\r\nok      cmd/internal/goobj      0.030s\r\nok      cmd/internal/obj        0.013s\r\nok      cmd/internal/obj/x86    0.036s\r\nok      cmd/newlink     0.020s\r\nok      cmd/nm  1.643s\r\nok      cmd/objdump     4.048s\r\nok      cmd/pack        2.954s\r\nok      cmd/pprof/internal/profile      0.009s\r\nok      cmd/vendor/golang.org/x/arch/arm/armasm 0.013s\r\nok      cmd/vendor/golang.org/x/arch/x86/x86asm 0.189s\r\nok      cmd/vet 4.023s\r\n2015/09/17 15:32:52 Failed: exit status 1\r\n```\r\n\r\nWe see that it exits almost immediately after the \"Testing Packages\" phase completes.\r\n\r\nOnce I fixed issue #12115, suddenly, these additional tests were executed:\r\n\r\n```\r\n##### GOMAXPROCS=2 runtime -cpu=1,2,4\r\nok      runtime 39.300s\r\n\r\n##### sync -cpu=10\r\nok      sync    0.109s\r\n\r\n##### ../misc/cgo/stdio\r\n\r\n##### ../misc/cgo/life\r\n\r\n##### ../misc/cgo/test\r\nscatter = 60b3a0\r\nhello from C\r\nsqrt is: 0\r\nPASS\r\nok      _/builds/srwalker/golang/go-12115/misc/cgo/test 1.106s\r\nscatter = 552c10\r\nhello from C\r\nsqrt is: 0\r\nPASS\r\nok      _/builds/srwalker/golang/go-12115/misc/cgo/test 1.074s\r\n\r\n##### ../misc/cgo/testgodefs\r\n\r\n##### ../misc/cgo/testso\r\n\r\n##### ../misc/cgo/testsovar\r\n\r\n##### ../misc/cgo/errors\r\n\r\n##### ../doc/progs\r\n\r\nreal        4.1\r\nuser       20.4\r\nsys         5.6\r\n\r\n##### ../doc/articles/wiki\r\nNo differences encountered\r\nNo differences encountered\r\nNo differences encountered\r\nNo differences encountered\r\nPASS\r\n\r\n##### ../doc/codewalk\r\n\r\nreal        1.8\r\nuser        1.9\r\nsys         0.3\r\n\r\n##### ../test/bench/shootout\r\nfasta\r\nreverse-complement\r\nnbody\r\nbinary-tree\r\nbinary-tree-freelist\r\nfannkuch\r\nfannkuch-parallel\r\nregex-dna\r\nregex-dna-parallel\r\nspectral-norm\r\nk-nucleotide\r\nk-nucleotide-parallel\r\nmandelbrot\r\nmeteor-contest\r\npidigits\r\nthreadring\r\nchameneosredux\r\n\r\nreal        8.8\r\nuser        9.9\r\nsys         1.9\r\n\r\n##### ../test/bench/go1\r\ntesting: warning: no tests to run\r\nPASS\r\nok      _/builds/srwalker/golang/go-12115/test/bench/go1        1.620s\r\n\r\n##### ../test\r\n\r\n##### API check\r\n+pkg debug/dwarf, const ClassUnknown = 0\r\n+pkg debug/dwarf, const ClassUnknown Class\r\n+pkg math/rand, func Read([]uint8) (int, error)\r\n+pkg math/rand, method (*Rand) Read([]uint8) (int, error)\r\n+pkg net, type DNSError struct, IsTemporary bool\r\n+pkg net/http/httptest, method (*ResponseRecorder) WriteString(string) (int, error)\r\n+pkg strconv, func AppendQuoteRuneToGraphic([]uint8, int32) []uint8\r\n+pkg strconv, func AppendQuoteToGraphic([]uint8, string) []uint8\r\n+pkg strconv, func IsGraphic(int32) bool\r\n+pkg strconv, func QuoteRuneToGraphic(int32) string\r\n+pkg strconv, func QuoteToGraphic(string) string\r\n+pkg text/template, method (ExecError) Error() string\r\n+pkg text/template, type ExecError struct\r\n+pkg text/template, type ExecError struct, Err error\r\n+pkg text/template, type ExecError struct, Name string\r\n\r\nALL TESTS PASSED\r\n\r\n---\r\nInstalled Go for solaris/amd64 in /builds/srwalker/golang/go\r\nInstalled commands in /builds/srwalker/golang/go/bin\r\n```\r\n\r\nThis seems undesirable, as it means that even a minor failure in the \"Testing packages\" phase could result in all remaining tests being skipped, allowing bitrot to set in while the failing test is still being resolved.\r\n\r\nHowever, I can see how this might have been intentional in some cases with the logic being that if any of those tests failed, there wasn't any point in running the remaining.  Since I was uncertain of the intent, I've opened this bug.\r\n\r\nPersonally, my desired alternatives, ranked by preference would be:\r\n\r\n  1) don't skip remaining tests\r\n  2) skip remaining tests, but add an option to ignore failures and print a message\r\n      saying that option can be used if all should be run\r\n  3) skip remaining tests, but print a warning\r\n",
	"user": {
		"login": "binarycrusader",
		"id": 541114,
		"type": "User",
		"site_admin": false
	},
	"comments": 4,
	"closed_at": "2015-11-05T00:58:36Z",
	"created_at": "2015-09-17T22:39:47Z",
	"updated_at": "2015-11-05T01:02:57Z",
	"milestone": {
		"id": 1096159,
		"number": 24,
		"title": "Go1.6"
	}
}
