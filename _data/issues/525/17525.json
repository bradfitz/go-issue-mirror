{
	"id": 184224971,
	"number": 17525,
	"state": "closed",
	"title": "net/http: panic() on ioutil.ReadAll in caddy on go 692df21",
	"body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n### What version of Go are you using (`go version`)?\r\n\r\ngo version devel +692df21 Thu Oct 20 08:48:44 2016 +0000 darwin/amd64\r\n\r\n### What operating system and processor architecture are you using (`go env`)?\r\n```\r\nGOARCH=\"amd64\"\r\nGOBIN=\"\"\r\nGOEXE=\"\"\r\nGOHOSTARCH=\"amd64\"\r\nGOHOSTOS=\"darwin\"\r\nGOOS=\"darwin\"\r\nGOPATH=\"/Users/mateusz.gajewski/Desktop/Projects/\"\r\nGORACE=\"\"\r\nGOROOT=\"/usr/local/Cellar/go/HEAD-692df21/libexec\"\r\nGOTOOLDIR=\"/usr/local/Cellar/go/HEAD-692df21/libexec/pkg/tool/darwin_amd64\"\r\nGCCGO=\"gccgo\"\r\nCC=\"clang\"\r\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fdebug-prefix-map=/var/folders/43/1y0rrqr55zq3f8cj5wpkt1kmhc7r33/T/go-build099060148=/tmp/go-build -gno-record-gcc-switches -fno-common\"\r\nCXX=\"clang++\"\r\nCGO_ENABLED=\"1\"\r\nPKG_CONFIG=\"pkg-config\"\r\nCGO_CFLAGS=\"-g -O2\"\r\nCGO_CPPFLAGS=\"\"\r\nCGO_CXXFLAGS=\"-g -O2\"\r\nCGO_FFLAGS=\"-g -O2\"\r\nCGO_LDFLAGS=\"-g -O2\"\r\n```\r\n### What did you do?\r\n```\r\ngo get -u -d github.com/mholt/caddy\r\ngo test github.com/mholt/caddy/...\r\n```\r\n\r\n### What did you expect to see?\r\n\r\nAll tests pass as in Go 1.7.3\r\n\r\n### What did you see instead?\r\n```\r\npanic: runtime error: invalid memory address or nil pointer dereference [recovered]\r\n\tpanic: runtime error: invalid memory address or nil pointer dereference [recovered]\r\n\tpanic: runtime error: invalid memory address or nil pointer dereference\r\n[signal SIGSEGV: segmentation violation code=0x1 addr=0x20 pc=0xbf4d4]\r\n\r\ngoroutine 23 [running]:\r\npanic(0x4a18a0, 0x796300)\r\n\t/usr/local/Cellar/go/HEAD-692df21/libexec/src/runtime/panic.go:527 +0x1a0\r\ntesting.tRunner.func1(0xc42014e240)\r\n\t/usr/local/Cellar/go/HEAD-692df21/libexec/src/testing/testing.go:603 +0x287\r\npanic(0x4a18a0, 0x796300)\r\n\t/usr/local/Cellar/go/HEAD-692df21/libexec/src/runtime/panic.go:485 +0x241\r\nio/ioutil.readAll.func1(0xc420154ae8)\r\n\t/usr/local/Cellar/go/HEAD-692df21/libexec/src/io/ioutil/ioutil.go:30 +0x135\r\npanic(0x4a18a0, 0x796300)\r\n\t/usr/local/Cellar/go/HEAD-692df21/libexec/src/runtime/panic.go:485 +0x241\r\nbytes.(*Buffer).ReadFrom(0xc420154a40, 0x0, 0x0, 0xc4201c4000, 0x0, 0x200)\r\n\t/usr/local/Cellar/go/HEAD-692df21/libexec/src/bytes/buffer.go:179 +0x134\r\nio/ioutil.readAll(0x0, 0x0, 0x200, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\t/usr/local/Cellar/go/HEAD-692df21/libexec/src/io/ioutil/ioutil.go:33 +0x150\r\nio/ioutil.ReadAll(0x0, 0x0, 0x0, 0x0, 0x0, 0xa1eb, 0x55d50d4c)\r\n\t/usr/local/Cellar/go/HEAD-692df21/libexec/src/io/ioutil/ioutil.go:42 +0x3e\r\ngithub.com/mholt/caddy/caddyhttp/log.TestLogRequestBody.func1(0x744800, 0xc4200745a0, 0xc4201580f0, 0x4ea760, 0xc420074501, 0xc42007dd10)\r\n\t/Users/mateusz.gajewski/Desktop/Projects/src/github.com/mholt/caddy/caddyhttp/log/log_test.go:79 +0x5c\r\ngithub.com/mholt/caddy/caddyhttp/httpserver.HandlerFunc.ServeHTTP(0x544280, 0x744800, 0xc4200745a0, 0xc4201580f0, 0xc42007dce0, 0xc420154c58, 0x118f0)\r\n\t/Users/mateusz.gajewski/Desktop/Projects/src/github.com/mholt/caddy/caddyhttp/httpserver/middleware.go:72 +0x44\r\ngithub.com/mholt/caddy/caddyhttp/log.Logger.ServeHTTP(0x740240, 0x544280, 0xc420088060, 0x1, 0x1, 0x0, 0x744b80, 0xc42007edc0, 0xc4201580f0, 0xc420088050, ...)\r\n\t/Users/mateusz.gajewski/Desktop/Projects/src/github.com/mholt/caddy/caddyhttp/log/log.go:40 +0x2eb\r\ngithub.com/mholt/caddy/caddyhttp/log.TestLogRequestBody(0xc42014e240)\r\n\t/Users/mateusz.gajewski/Desktop/Projects/src/github.com/mholt/caddy/caddyhttp/log/log_test.go:112 +0x52f\r\ntesting.tRunner(0xc42014e240, 0x544288)\r\n\t/usr/local/Cellar/go/HEAD-692df21/libexec/src/testing/testing.go:637 +0x81\r\ncreated by testing.(*T).Run\r\n\t/usr/local/Cellar/go/HEAD-692df21/libexec/src/testing/testing.go:674 +0x2c0\r\n```\r\n\r\nPanic happens when draining ```response.Body``` with ```ioutil.ReadAll()``` into ```bytes.Buffer``` https://github.com/mholt/caddy/blob/master/caddyhttp/log/log_test.go#L79",
	"user": {
		"login": "wendigo",
		"id": 66972,
		"type": "User",
		"site_admin": false
	},
	"comments": 2,
	"closed_at": "2016-10-20T17:06:13Z",
	"created_at": "2016-10-20T13:09:08Z",
	"updated_at": "2016-10-20T17:06:13Z"
}
