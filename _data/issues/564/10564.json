{
	"id": 70552439,
	"number": 10564,
	"state": "closed",
	"title": "runtime/pprof: unexpected signal during runtime execution on windows-386-gce",
	"body": "I cannot reproduce it myself, but from windows-386-gce builder http://build.golang.org/log/e3bf7d994667518abb7f2a2f0064257d8c373927 while building 56a7c5b95c01\r\n\r\n```\r\nfatal error: unexpected signal during runtime execution\r\n[signal 0xc0000005 code=0x0 addr=0x2140c00 pc=0x40d8c1]\r\n\r\nruntime stack:\r\nruntime.throw(0x5ff288, 0x2a)\r\n\tC:/workdir/go/src/runtime/panic.go:543 +0x7f\r\nruntime.sigpanic()\r\n\tC:/workdir/go/src/runtime/signal_windows.go:157 +0x5c\r\nruntime.gcmarkwb_m(0x3280000c, 0x32800218)\r\n\tC:/workdir/go/src/runtime/mbarrier.go:73 +0xb1\r\nruntime.writebarrierptr_nostore1.func1()\r\n\tC:/workdir/go/src/runtime/mbarrier.go:107 +0x117\r\nruntime.systemstack(0x32a7fdfc)\r\n\tC:/workdir/go/src/runtime/asm_386.s:283 +0x81\r\nruntime.writebarrierptr_nostore1(0x3280000c, 0x32800218)\r\n\tC:/workdir/go/src/runtime/mbarrier.go:108 +0x56\r\nruntime.writebarrierptr(0x3280000c, 0x32800218)\r\n\tC:/workdir/go/src/runtime/mbarrier.go:131 +0x7f\r\nruntime.writebarrierslice(0x3280000c, 0x32800218, 0x6933, 0xfde8)\r\n\tC:/workdir/go/src/runtime/mbarrier.go:207 +0x1e\r\nruntime.traceEvent(0x15, 0x0, 0x32a7fee4, 0x1, 0x1)\r\n\tC:/workdir/go/src/runtime/trace.go:502 +0x5b2\r\nruntime.traceGoUnpark(0x12215080, 0x0)\r\n\tC:/workdir/go/src/runtime/trace.go:793 +0x75\r\nruntime.findrunnable(0x12212a00)\r\n\tC:/workdir/go/src/runtime/proc1.go:1345 +0x251\r\nruntime.schedule()\r\n\tC:/workdir/go/src/runtime/proc1.go:1515 +0x1dd\r\nruntime.park_m(0x12215080)\r\n\tC:/workdir/go/src/runtime/proc1.go:1574 +0x161\r\nruntime.mcall(0x0)\r\n\tC:/workdir/go/src/runtime/asm_386.s:210 +0x47\r\n\r\ngoroutine 1 [chan receive]:\r\ntesting.RunTests(0x620844, 0x6b83e0, 0xe, 0xe, 0x12246001)\r\n\tC:/workdir/go/src/testing/testing.go:561 +0x884\r\ntesting.(*M).Run(0x12206360, 0x6cf540)\r\n\tC:/workdir/go/src/testing/testing.go:490 +0x6b\r\nmain.main()\r\n\truntime/pprof/_test/_testmain.go:82 +0x177\r\n\r\ngoroutine 58 [runnable]:\r\nruntime/pprof_test.TestTraceStress(0x18a9dd40)\r\n\tC:/workdir/go/src/runtime/pprof/trace_test.go:149 +0x3af\r\ntesting.tRunner(0x18a9dd40, 0x6b8464)\r\n\tC:/workdir/go/src/testing/testing.go:452 +0xa6\r\ncreated by testing.RunTests\r\n\tC:/workdir/go/src/testing/testing.go:560 +0x852\r\n\r\ngoroutine 41 [select (no cases)]:\r\nruntime/pprof_test.TestTraceSymbolize.func1()\r\n\tC:/workdir/go/src/runtime/pprof/trace_stack_test.go:38 +0x1e\r\ncreated by runtime/pprof_test.TestTraceSymbolize\r\n\tC:/workdir/go/src/runtime/pprof/trace_stack_test.go:39 +0x178\r\n\r\ngoroutine 60 [syscall, locked to thread]:\r\nsyscall.Syscall6(0x77433e93, 0x5, 0x194, 0x1268cfcf, 0x1, 0x1268cf38, 0x0, 0x0, 0x40bbd6, 0x6be720, ...)\r\n\tC:/workdir/go/src/runtime/syscall_windows.go:139 +0x4b\r\nsyscall.ReadFile(0x194, 0x1268cfcf, 0x1, 0x1, 0x1268cf38, 0x0, 0x0, 0x0)\r\n\tC:/workdir/go/src/syscall/zsyscall_windows.go:283 +0xa0\r\nsyscall.Read(0x194, 0x1268cfcf, 0x1, 0x1, 0xf69, 0x0, 0x0)\r\n\tC:/workdir/go/src/syscall/syscall_windows.go:286 +0x64\r\nos.(*File).read(0x1221e658, 0x1268cfcf, 0x1, 0x1, 0x0, 0x0, 0x0)\r\n\tC:/workdir/go/src/os/file_windows.go:300 +0x106\r\nos.(*File).Read(0x1221e658, 0x1268cfcf, 0x1, 0x1, 0x0, 0x0, 0x0)\r\n\tC:/workdir/go/src/os/file.go:95 +0x72\r\nruntime/pprof_test.TestTraceStress.func3(0x1221e658, 0x126a7940, 0x1228c9a0)\r\n\tC:/workdir/go/src/runtime/pprof/trace_test.go:120 +0x5b\r\ncreated by runtime/pprof_test.TestTraceStress\r\n\tC:/workdir/go/src/runtime/pprof/trace_test.go:123 +0x1ff\r\n\r\ngoroutine 42 [chan send (nil chan)]:\r\nruntime/pprof_test.TestTraceSymbolize.func2()\r\n\tC:/workdir/go/src/runtime/pprof/trace_stack_test.go:42 +0x3e\r\ncreated by runtime/pprof_test.TestTraceSymbolize\r\n\tC:/workdir/go/src/runtime/pprof/trace_stack_test.go:43 +0x18d\r\n\r\ngoroutine 43 [chan receive (nil chan)]:\r\nruntime/pprof_test.TestTraceSymbolize.func3()\r\n\tC:/workdir/go/src/runtime/pprof/trace_stack_test.go:46 +0x36\r\ncreated by runtime/pprof_test.TestTraceSymbolize\r\n\tC:/workdir/go/src/runtime/pprof/trace_stack_test.go:47 +0x1a2\r\n\r\ngoroutine 62 [runnable, locked to thread]:\r\nruntime.Gosched()\r\n\tC:/workdir/go/src/runtime/proc.go:166 +0x10\r\nruntime/pprof_test.TestTraceStress.func4(0x126a7940)\r\n\tC:/workdir/go/src/runtime/pprof/trace_test.go:141 +0xb4\r\ncreated by runtime/pprof_test.TestTraceStress\r\n\tC:/workdir/go/src/runtime/pprof/trace_test.go:144 +0x371\r\n\r\ngoroutine 59 [chan receive]:\r\nruntime/pprof_test.TestTraceStress.func1(0x126a7940, 0x1228c9a0)\r\n\tC:/workdir/go/src/runtime/pprof/trace_test.go:104 +0x38\r\ncreated by runtime/pprof_test.TestTraceStress\r\n\tC:/workdir/go/src/runtime/pprof/trace_test.go:106 +0xa3\r\n\r\ngoroutine 61 [trace reader (blocked)]:\r\nruntime.ReadTrace(0x0, 0x0, 0x0)\r\n\tC:/workdir/go/src/runtime/trace.go:313 +0x1d9\r\nruntime/pprof.StartTrace.func1(0x3b0c58, 0x18a9dda0)\r\n\tC:/workdir/go/src/runtime/pprof/pprof.go:629 +0x21\r\ncreated by runtime/pprof.StartTrace\r\n\tC:/workdir/go/src/runtime/pprof/pprof.go:635 +0x70\r\nFAIL\truntime/pprof\t8.670s\r\n```\r\n\r\nI also have couple of questions about the stack trace:\r\n\r\n- It looks like our exception handler got fired because of EXCEPTION_ACCESS_VIOLATION (see signal 0xc0000005). The source code line where it happened must be mbarrier.go:73 - it is right before signal_windows.go:157 (runtime.sigpanic). Looking at that line: \"if ptr != 0 \u0026\u0026 inheap(ptr) {\", I don't see how it is possible for EXCEPTION_ACCESS_VIOLATION to be raised here. Can someone explain?\r\n\r\n- Also \"runtime stack:\" starts with runtime.mcall. But why? Who called it? Looking at remaining goroutine stacks, I see \"goroutine 58 [runnable]\" allocating memory at trace_test.go:149 with \"_ = make([]byte, 1\u003c\u003c20)\". But how did we get from allocating memory into runtime.mcall?\r\n\r\nI suspect there is missing information here. Is it OK for it to be missing? How should I debug this crash?\r\n\r\nPerhaps I am misreading this altogether.\r\n\r\nAlex",
	"user": {
		"login": "alexbrainman",
		"id": 9796621,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		},
		{
			"name": "OS-Windows"
		}
	],
	"comments": 4,
	"closed_at": "2015-06-17T16:30:07Z",
	"created_at": "2015-04-24T00:48:56Z",
	"updated_at": "2016-06-25T02:06:24Z",
	"milestone": {
		"id": 905105,
		"number": 1,
		"title": "Go1.5"
	}
}
