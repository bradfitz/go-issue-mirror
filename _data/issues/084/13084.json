{
	"id": 113824736,
	"number": 13084,
	"state": "open",
	"title": "cmd/go: go get -u fails with local remote url",
	"body": "I commented in #11457 \r\nbut this is a new issue, albeit related.\r\n\r\nThe workflow is this:\r\n- user is getting created\r\n- bare repo /home/$user/repo.git is created\r\n- ~/go/src/project/ is created\r\n- .ssh/authorized_keys is created\r\n- code is pushed to server like git remote add s4 user@s4.mydomain.tld:repo:git; git push -u s4 master\r\n- post-update hook is invoked which clones into ~/go/src/project and does the things mentioned below in the build command (I see that I should update my build command and remove netgo tag)\r\n\r\nSo there are only 2 possible reasons why this fails:\r\n1. `cmd := exec.Command(\"go\", \"get\", \"-u\")`\r\nor\r\n2. `cmd = exec.Command(\"go\", \"build\", \"-o\", un, \"-a\", \"-tags\", \"netgo\")`\r\n\r\n```bash\r\n# go version\r\ngo version go1.5.1 linux/amd64\r\n```\r\n\r\n```bash\r\n# cd /home/gewicht.luketic.de/\r\ns4 gewicht.luketic.de # l\r\ntotal 40K\r\ndrwxr-xr-x 5 gewicht.luketic.de gewicht.luketic.de 4.0K Oct 27 15:07 .\r\ndrwxr-xr-x 9 root               root               4.0K Oct 27 02:51 ..\r\n-rw------- 1 gewicht.luketic.de gewicht.luketic.de   78 Oct 27 15:07 .bash_history\r\n-rw-r--r-- 1 gewicht.luketic.de gewicht.luketic.de  127 Aug 19 21:15 .bash_logout\r\n-rw-r--r-- 1 gewicht.luketic.de gewicht.luketic.de  193 Aug 19 21:15 .bash_profile\r\n-rw-r--r-- 1 gewicht.luketic.de gewicht.luketic.de  551 Aug 19 21:15 .bashrc\r\n-rw-r--r-- 1 gewicht.luketic.de gewicht.luketic.de  172 Oct 27 02:51 .controlkey\r\ndrwxr-xr-x 5 gewicht.luketic.de gewicht.luketic.de 4.0K Oct 27 15:07 go\r\ndrwxr-xr-x 6 gewicht.luketic.de gewicht.luketic.de 4.0K Oct 27 02:51 repo.git\r\ndrwx------ 2 gewicht.luketic.de gewicht.luketic.de 4.0K Oct 27 02:51 .ssh\r\n```\r\n\r\n```bash\r\ns4 gewicht.luketic.de # tree\r\n.\r\n├── go\r\n│   ├── bin\r\n│   │   └── project\r\n│   ├── pkg\r\n│   │   └── linux_amd64\r\n│   │       ├── github.com\r\n│   │       │   └── gohost\r\n│   │       │       └── paddr.a\r\n│   │       └── gopkg.in\r\n│   │           ├── mgo.v2\r\n│   │           │   ├── bson.a\r\n│   │           │   └── internal\r\n│   │           │       └── scram.a\r\n│   │           └── mgo.v2.a\r\n│   └── src\r\n│       ├── github.com\r\n│       │   └── gohost\r\n│       │       └── paddr\r\n│       │           ├── privateaddr.go\r\n│       │           ├── privateaddr_test.go\r\n│       │           └── README.md\r\n│       ├── gopkg.in\r\n│       │   └── mgo.v2\r\n│       │       ├── auth.go\r\n│       │       ├── auth_test.go\r\n│       │       ├── bson\r\n│       │       │   ├── bson.go\r\n│       │       │   ├── bson_test.go\r\n│       │       │   ├── decode.go\r\n│       │       │   ├── encode.go\r\n│       │       │   ├── LICENSE\r\n│       │       │   ├── specdata\r\n│       │       │   │   └── update.sh\r\n│       │       │   └── specdata_test.go\r\n│       │       ├── bulk.go\r\n│       │       ├── bulk_test.go\r\n│       │       ├── cluster.go\r\n│       │       ├── cluster_test.go\r\n│       │       ├── dbtest\r\n│       │       │   ├── dbserver.go\r\n│       │       │   ├── dbserver_test.go\r\n│       │       │   └── export_test.go\r\n│       │       ├── doc.go\r\n│       │       ├── export_test.go\r\n│       │       ├── gridfs.go\r\n│       │       ├── gridfs_test.go\r\n│       │       ├── internal\r\n│       │       │   ├── sasl\r\n│       │       │   │   ├── sasl.c\r\n│       │       │   │   ├── sasl.go\r\n│       │       │   │   ├── sasl_windows.c\r\n│       │       │   │   ├── sasl_windows.go\r\n│       │       │   │   ├── sasl_windows.h\r\n│       │       │   │   ├── sspi_windows.c\r\n│       │       │   │   └── sspi_windows.h\r\n│       │       │   └── scram\r\n│       │       │       ├── scram.go\r\n│       │       │       └── scram_test.go\r\n│       │       ├── LICENSE\r\n│       │       ├── log.go\r\n│       │       ├── Makefile\r\n│       │       ├── queue.go\r\n│       │       ├── queue_test.go\r\n│       │       ├── raceoff.go\r\n│       │       ├── raceon.go\r\n│       │       ├── README.md\r\n│       │       ├── saslimpl.go\r\n│       │       ├── saslstub.go\r\n│       │       ├── server.go\r\n│       │       ├── session.go\r\n│       │       ├── session_test.go\r\n│       │       ├── socket.go\r\n│       │       ├── stats.go\r\n│       │       ├── suite_test.go\r\n│       │       ├── syscall_test.go\r\n│       │       ├── syscall_windows_test.go\r\n│       │       ├── testdb\r\n│       │       │   ├── client.pem\r\n│       │       │   ├── dropall.js\r\n│       │       │   ├── init.js\r\n│       │       │   ├── server.pem\r\n│       │       │   ├── setup.sh\r\n│       │       │   ├── supervisord.conf\r\n│       │       │   └── wait.js\r\n│       │       ├── testserver\r\n│       │       │   ├── export_test.go\r\n│       │       │   ├── testserver.go\r\n│       │       │   └── testserver_test.go\r\n│       │       └── txn\r\n│       │           ├── chaos.go\r\n│       │           ├── debug.go\r\n│       │           ├── dockey_test.go\r\n│       │           ├── flusher.go\r\n│       │           ├── mgo_test.go\r\n│       │           ├── sim_test.go\r\n│       │           ├── tarjan.go\r\n│       │           ├── tarjan_test.go\r\n│       │           ├── txn.go\r\n│       │           └── txn_test.go\r\n│       └── project\r\n│           ├── gewicht.luketic.de\r\n│           ├── main.go\r\n│           └── static\r\n│               └── index.html\r\n└── repo.git\r\n    ├── config\r\n    ├── description\r\n    ├── HEAD\r\n    ├── hooks\r\n    │   ├── applypatch-msg.sample\r\n    │   ├── commit-msg.sample\r\n    │   ├── post-update\r\n    │   ├── post-update.sample\r\n    │   ├── pre-applypatch.sample\r\n    │   ├── pre-commit.sample\r\n    │   ├── prepare-commit-msg.sample\r\n    │   ├── pre-push.sample\r\n    │   ├── pre-rebase.sample\r\n    │   └── update.sample\r\n    ├── info\r\n    │   ├── exclude\r\n    │   └── refs\r\n    ├── objects\r\n    │   ├── 16\r\n    │   │   └── a9fdee551f95921b142c7f8b52951b8ca08b61\r\n    │   ├── 26\r\n    │   │   └── 2081fd4e3ad664705a0863ce9253850dccb762\r\n    │   ├── 3c\r\n    │   │   └── 7cce1ec59019d444c124b22ba4379a05d594b0\r\n    │   ├── 5b\r\n    │   │   └── 86b2ef84c60c764acc670726b32a4a31bc808c\r\n    │   ├── 72\r\n    │   │   └── 5135ea5625e06588c54a58f81fd7daa91ffe4b\r\n    │   ├── f0\r\n    │   │   └── 23cf1c034a529cde14e1f437195adb2a1f3bd8\r\n    │   ├── info\r\n    │   │   └── packs\r\n    │   └── pack\r\n    └── refs\r\n        ├── heads\r\n        │   └── master\r\n        └── tags\r\n```\r\n\r\n~/go/src/project/.git/config\r\n```\r\n[core]\r\n        repositoryformatversion = 0\r\n        filemode = true\r\n        bare = false\r\n        logallrefupdates = true\r\n[remote \"origin\"]\r\n        url = /home/gewicht.luketic.de/repo.git\r\n        fetch = +refs/heads/*:refs/remotes/origin/*\r\n[branch \"master\"]\r\n        remote = origin\r\n        merge = refs/heads/master\r\n```\r\n\r\nwhen building\r\n```\r\nremote: package project: unable to parse output of git config remote.origin.url\r\nremote: error: exit status 1\r\n```\r\n\r\nthe build command:\r\n```go\r\n        case \"build\":\r\n                if os.Getenv(\"GOPATH\") != os.Getenv(\"HOME\")+\"/go\" {\r\n                        os.Setenv(\"GOPATH\", os.Getenv(\"HOME\")+\"/go\")\r\n                }\r\n\r\n                if e := os.Chdir(os.Getenv(\"HOME\") + defaultProjectPath + \"/\"); e != nil {\r\n                        printError(e)\r\n                        return\r\n                }\r\n\r\n                cmd := exec.Command(\"go\", \"get\", \"-u\")\r\n                cmd.Stdout = os.Stdout\r\n                cmd.Stderr = os.Stderr\r\n                if e := cmd.Start(); e != nil {\r\n                        printError(e)\r\n                        return\r\n                }\r\n                if e := cmd.Wait(); e != nil {\r\n                        printError(e)\r\n                        return\r\n                }\r\n                t := strings.Split(os.Getenv(\"HOME\"), \"/\")\r\n                un := t[len(t)-1]\r\n                cmd = exec.Command(\"go\", \"build\", \"-o\", un, \"-a\", \"-tags\", \"netgo\")\r\n                cmd.Stdout = os.Stdout\r\n                cmd.Stderr = os.Stderr\r\n                if e := cmd.Start(); e != nil {\r\n                        printError(e)\r\n                        return\r\n                }\r\n                if e := cmd.Wait(); e != nil {\r\n                        printError(e)\r\n                        return\r\n                }\r\n```",
	"user": {
		"login": "dalu",
		"id": 2694548,
		"type": "User",
		"site_admin": false
	},
	"comments": 10,
	"created_at": "2015-10-28T13:49:24Z",
	"updated_at": "2016-02-10T00:42:32Z",
	"milestone": {
		"id": 1055141,
		"number": 6,
		"title": "Unplanned"
	}
}
