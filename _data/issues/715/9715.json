{
	"id": 55810968,
	"number": 9715,
	"state": "closed",
	"title": "database/sql: data race",
	"body": "Noticed on freebsd-amd64-race: http://build.golang.org/log/bfca7707a0ccb2dd15e8228eb5b97434c33d1143\r\n\r\n```\r\nWARNING: DATA RACE\r\nWrite by goroutine 71:\r\n  database/sql.(*Stmt).Query()\r\n      /tmp/buildlet-scatch184358971/go/src/database/sql/sql.go:1436 +0x6f3\r\n  database/sql.func·039()\r\n      /tmp/buildlet-scatch184358971/go/src/database/sql/sql_test.go:1957 +0x1ea\r\n  testing.func·002()\r\n      /tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:418 +0x18f\r\n\r\nPrevious read by goroutine 61:\r\n  database/sql.(*Stmt).Query()\r\n      /tmp/buildlet-scatch184358971/go/src/database/sql/sql.go:1435 +0x51f\r\n  database/sql.func·039()\r\n      /tmp/buildlet-scatch184358971/go/src/database/sql/sql_test.go:1957 +0x1ea\r\n  testing.func·002()\r\n      /tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:418 +0x18f\r\n  runtime.goexit()\r\n      /tmp/buildlet-scatch184358971/go/src/runtime/asm_amd64.s:2430 +0x0\r\n  reflect.ValueOf()\r\n      /tmp/buildlet-scatch184358971/go/src/reflect/value.go:2081 +0xfc\r\n  database/sql/driver.int32Type.ConvertValue()\r\n      /tmp/buildlet-scatch184358971/go/src/database/sql/driver/types.go:108 +0x80\r\n  database/sql/driver.(*int32Type).ConvertValue()\r\n      \u003cautogenerated\u003e:12 +0xf9\r\n  database/sql.driverArgs()\r\n      /tmp/buildlet-scatch184358971/go/src/database/sql/convert.go:68 +0xb3d\r\n  database/sql.resultFromStatement()\r\n      /tmp/buildlet-scatch184358971/go/src/database/sql/sql.go:1310 +0x372\r\n  database/sql.(*Stmt).Exec()\r\n      /tmp/buildlet-scatch184358971/go/src/database/sql/sql.go:1289 +0x31c\r\n  database/sql.(*concurrentTxStmtExecTest).test()\r\n      /tmp/buildlet-scatch184358971/go/src/database/sql/sql_test.go:1689 +0x1a0\r\n  database/sql.func·035()\r\n      /tmp/buildlet-scatch184358971/go/src/database/sql/sql_test.go:1750 +0xe2\r\n\r\nGoroutine 71 (running) created at:\r\n  testing.(*B).RunParallel()\r\n      /tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:410 +0x46e\r\n  database/sql.BenchmarkManyConcurrentQueries()\r\n      /tmp/buildlet-scatch184358971/go/src/database/sql/sql_test.go:1964 +0x496\r\n  testing.(*B).runN()\r\n      /tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:124 +0xf2\r\n  testing.(*B).launch()\r\n      /tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:216 +0x1d0\r\n\r\nGoroutine 61 (running) created at:\r\n  testing.(*B).RunParallel()\r\n      /tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:410 +0x46e\r\n  database/sql.BenchmarkManyConcurrentQueries()\r\n      /tmp/buildlet-scatch184358971/go/src/database/sql/sql_test.go:1964 +0x496\r\n  testing.(*B).runN()\r\n      /tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:124 +0xf2\r\n  testing.(*B).launch()\r\n      /tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:216 +0x1d0\r\n==================\r\nunexpected fault address 0x4c9c18\r\nfatal error: fault\r\n[signal 0xa code=0xc addr=0x4c9c18 pc=0x5bb9d8]\r\n\r\ngoroutine 431 [running]:\r\nruntime.throw(0x44099f, 0x423c28)\r\n\t/tmp/buildlet-scatch184358971/go/src/runtime/panic.go:508 +0x98 fp=0x7fffff1f8e78 sp=0x7fffff1f8e60\r\nruntime.goroutineheader(0x423c28)\r\n\t/tmp/buildlet-scatch184358971/go/src/runtime/traceback.go:586 +0x1c4 fp=0x7fffff1f8eb0 sp=0x7fffff1f8e78\r\nruntime.dopanic_m(0xc2081377a0, 0x423c28, 0x7fffff1f8e60)\r\n\t/tmp/buildlet-scatch184358971/go/src/runtime/panic1.go:96 +0x1ca fp=0x7fffff1f8f08 sp=0x7fffff1f8eb0\r\nruntime.func·045()\r\n\t/tmp/buildlet-scatch184358971/go/src/runtime/panic.go:495 +0x43 fp=0x7fffff1f8f28 sp=0x7fffff1f8f08\r\nruntime.systemstack(0xc208013200)\r\n\t/tmp/buildlet-scatch184358971/go/src/runtime/asm_amd64.s:244 +0x71 fp=0x7fffff1f8f30 sp=0x7fffff1f8f28\r\nruntime.mstart()\r\n\t/tmp/buildlet-scatch184358971/go/src/runtime/proc1.go:735 fp=0x7fffff1f8f38 sp=0x7fffff1f8f30\r\ncreated by testing.(*B).RunParallel\r\n\t/tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:419 +0x46e\r\n\r\ngoroutine 1 [chan receive]:\r\ntesting.(*B).run(0xc20807a200, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\t/tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:180 +0x91\r\ntesting.RunBenchmarks(0x6d1418, 0x784cc0, 0x9, 0x9)\r\n\t/tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:312 +0x7ec\r\ntesting.(*M).Run(0xc20800a140, 0x7ace40)\r\n\t/tmp/buildlet-scatch184358971/go/src/testing/testing.go:495 +0x286\r\nmain.main()\r\n\tdatabase/sql/_test/_testmain.go:158 +0x28d\r\n\r\ngoroutine 390 [semacquire]:\r\nsync.runtime_Semacquire(0xc2080b0fcc)\r\n\t/tmp/buildlet-scatch184358971/go/src/runtime/sema.go:43 +0x2d\r\nsync.(*Mutex).Lock(0xc2080b0fc8)\r\n\t/tmp/buildlet-scatch184358971/go/src/sync/mutex.go:66 +0xfd\r\ndatabase/sql.(*DB).removeDep(0xc2080b0fa0, 0x8007da350, 0xc2081f2000, 0x63bdc0, 0xc208178f00, 0x0, 0x0)\r\n\t/tmp/buildlet-scatch184358971/go/src/database/sql/sql.go:392 +0x5b\r\ndatabase/sql.func·009(0x0, 0x0)\r\n\t/tmp/buildlet-scatch184358971/go/src/database/sql/sql.go:1438 +0x13e\r\ndatabase/sql.(*Rows).Close(0xc208178f00, 0x0, 0x0)\r\n\t/tmp/buildlet-scatch184358971/go/src/database/sql/sql.go:1650 +0x201\r\ndatabase/sql.func·039(0xc2080d4000)\r\n\t/tmp/buildlet-scatch184358971/go/src/database/sql/sql_test.go:1962 +0x322\r\ntesting.func·002()\r\n\t/tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:418 +0x190\r\ncreated by testing.(*B).RunParallel\r\n\t/tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:419 +0x46e\r\n\r\ngoroutine 418 [semacquire]:\r\nsync.runtime_Semacquire(0xc2080b0fcc)\r\n\t/tmp/buildlet-scatch184358971/go/src/runtime/sema.go:43 +0x2d\r\nsync.(*Mutex).Lock(0xc2080b0fc8)\r\n\t/tmp/buildlet-scatch184358971/go/src/sync/mutex.go:66 +0xfd\r\ndatabase/sql.(*DB).putConn(0xc2080b0fa0, 0xc208069740, 0x0, 0x0)\r\n\t/tmp/buildlet-scatch184358971/go/src/database/sql/sql.go:721 +0x54\r\ndatabase/sql.(*driverConn).releaseConn(0xc208069740, 0x0, 0x0)\r\n\t/tmp/buildlet-scatch184358971/go/src/database/sql/sql.go:258 +0x60\r\ndatabase/sql.*driverConn.(database/sql.releaseConn)·fm(0x0, 0x0)\r\n\t/tmp/buildlet-scatch184358971/go/src/database/sql/sql.go:908 +0x49\r\ndatabase/sql.func·009(0x0, 0x0)\r\n\t/tmp/buildlet-scatch184358971/go/src/database/sql/sql.go:1437 +0x7d\r\ndatabase/sql.(*Rows).Close(0xc2080a7860, 0x0, 0x0)\r\n\t/tmp/buildlet-scatch184358971/go/src/database/sql/sql.go:1650 +0x201\r\ndatabase/sql.func·039(0xc2080d4a60)\r\n\t/tmp/buildlet-scatch184358971/go/src/database/sql/sql_test.go:1962 +0x322\r\ntesting.func·002()\r\n\t/tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:418 +0x190\r\ncreated by testing.(*B).RunParallel\r\n\t/tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:419 +0x46e\r\n\r\ngoroutine 340 [semacquire]:\r\nsync.runtime_Semacquire(0xc2080b0fcc)\r\n\t/tmp/buildlet-scatch184358971/go/src/runtime/sema.go:43 +0x2d\r\nsync.(*Mutex).Lock(0xc2080b0fc8)\r\n\t/tmp/buildlet-scatch184358971/go/src/sync/mutex.go:66 +0xfd\r\ndatabase/sql.(*DB).putConn(0xc2080b0fa0, 0xc208069680, 0x0, 0x0)\r\n\t/tmp/buildlet-scatch184358971/go/src/database/sql/sql.go:721 +0x54\r\ndatabase/sql.(*driverConn).releaseConn(0xc208069680, 0x0, 0x0)\r\n\t/tmp/buildlet-scatch184358971/go/src/database/sql/sql.go:258 +0x60\r\ndatabase/sql.*driverConn.(database/sql.releaseConn)·fm(0x0, 0x0)\r\n\t/tmp/buildlet-scatch184358971/go/src/database/sql/sql.go:908 +0x49\r\ndatabase/sql.func·009(0x0, 0x0)\r\n\t/tmp/buildlet-scatch184358971/go/src/database/sql/sql.go:1437 +0x7d\r\ndatabase/sql.(*Rows).Close(0xc2081e88a0, 0x0, 0x0)\r\n\t/tmp/buildlet-scatch184358971/go/src/database/sql/sql.go:1650 +0x201\r\ndatabase/sql.func·039(0xc2081a41a0)\r\n\t/tmp/buildlet-scatch184358971/go/src/database/sql/sql_test.go:1962 +0x322\r\ntesting.func·002()\r\n\t/tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:418 +0x190\r\ncreated by testing.(*B).RunParallel\r\n\t/tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:419 +0x46e\r\n\r\ngoroutine 205 [semacquire]:\r\nsync.runtime_Semacquire(0xc20802a060)\r\n\t/tmp/buildlet-scatch184358971/go/src/runtime/sema.go:43 +0x2d\r\nsync.(*WaitGroup).Wait(0xc20804c600)\r\n\t/tmp/buildlet-scatch184358971/go/src/sync/waitgroup.go:132 +0x1e8\r\ntesting.(*B).RunParallel(0xc20807a200, 0xc20804c5c0)\r\n\t/tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:421 +0x497\r\ndatabase/sql.BenchmarkManyConcurrentQueries(0xc20807a200)\r\n\t/tmp/buildlet-scatch184358971/go/src/database/sql/sql_test.go:1964 +0x497\r\ntesting.(*B).runN(0xc20807a200, 0x3e8)\r\n\t/tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:124 +0xf3\r\ntesting.(*B).launch(0xc20807a200)\r\n\t/tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:216 +0x1d1\r\ncreated by testing.(*B).run\r\n\t/tmp/buildlet-scatch184358971/go/src/testing/benchmark.go:179 +0x57\r\n\r\n```\r\n",
	"user": {
		"login": "bradfitz",
		"id": 2621,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"assignee": {
		"login": "bradfitz",
		"id": 2621,
		"type": "User",
		"site_admin": false
	},
	"comments": 2,
	"closed_at": "2015-01-29T12:41:08Z",
	"created_at": "2015-01-28T20:30:20Z",
	"updated_at": "2016-06-25T01:59:32Z"
}
