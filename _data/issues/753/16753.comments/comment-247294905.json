{
	"id": 247294905,
	"body": "Here's the proposal only for the adding bookmarks to IDENTs (i.e. structs, vars, etc.):\r\nIt's my first proposal ever, so any comment or advice is really appreciated.\r\n\r\n1) In `LinkifyText` (`linkify.go`)  call `BookmarkText` located in a new file `bookmark.go`:\r\n```\r\nbookmarksWriter := BookmarkText(text)\r\nidents := tokenSelection(text, token.IDENT)\r\ncomments := tokenSelection(text, token.COMMENT)\r\nFormatSelections(w, text, linkWriter, idents, selectionTag, bookmarksWriter, comments)\r\n```\r\n\r\nHere's its signature:\r\n`func BookmarkText(text []byte) (bw BookmarkWriter)` \r\n\r\n\r\n2) `BookmarkText` identifies all the IDENTs using a helper function:\r\n\r\n`func createBookmarks(text []byte) (bookmarkMap map[int]bookmarkList)`\r\ncreateBookmarks parses the source code and identifies every IDENT that needs a bookmark.\r\nIf the first line of a comment is found above its relative IDENT, then a bookmark struct is pushed into a map using the comment line number.\r\ne.g.:\r\n```\r\n      // Comment\r\n      n := 1\r\n```\r\n\r\nIf there isn't a comment block above the IDENT, or the comment is on the right-side of the IDENT, then the IDENT line number is used as key.\r\ne.g.:\r\n`      n := 1 // Comment`\r\n\r\n 3) At this point in:\r\n`func FormatSelections(w io.Writer, text []byte, lw LinkWriter, links Selection, sw SegmentWriter, bw BookmarkWriter, selections ...Selection)`\r\n\r\neach time a token is processed a call to:\r\n`bw(w, lastOffs, start)`\r\nis made. The `BookmarkWriter` function checks if a `lastOffs` key exists in the `bookmarkMap` and prints its related bookmark to `w`.\r\n\r\nHere's a test page: \r\n[page.html.zip](https://github.com/golang/go/files/474389/page.html.zip)\r\n\r\nTry:\r\n```\r\nfile:///page.html#ErrBodyNotAllowed\r\nfile:///page.html#SingleBlock.T3\r\nfile:///page.html#Test.What\r\n\r\n```\r\n\r\nNote: the test page has each main comment above the its relative node as pointed in [#16728](https://github.com/golang/go/issues/16728). To achieve this changes have been made in `package.html`, such as:\r\n```\r\n\u003ch2 id=\"pkg-constants\"\u003eConstants\u003c/h2\u003e\r\n    {{range .}}\r\n        {{comment_html .Doc}}\r\n        \u003cpre\u003e{{node_html $ .Decl true}}\u003c/pre\u003e\r\n    {{end}}\r\n```\r\nEach `{{comment_html .Doc}}` has been moved above `\u003cpre\u003e{{node_html $ .Decl true}}\u003c/pre\u003e`.\r\n\r\nPlease let me know if I need to file a formal proposal or this is sufficient.\r\n\r\n/cc @bradfitz @broady @shurcooL @appleby @adg ",
	"user": {
		"login": "luigi-riefolo",
		"id": 4227453,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2016-09-15T10:41:37Z",
	"updated_at": "2016-09-15T17:10:47Z"
}
