{
	"id": 51283604,
	"number": 5422,
	"state": "closed",
	"title": "runtime: segfault in tests",
	"body": "\u003cpre\u003eWhat steps will reproduce the problem?\n\n./run.bash --no-rebuild\n\nWhat do you see instead?\n\n# GOMAXPROCS=2 runtime -cpu=1,2,4\nSIGSEGV: segmentation violation\nPC=0x4065cf\n\nselunlock(0xc2009a4cc0)\n\t/build/go.tip/go/src/pkg/runtime/chan.c:817 +0x3f\npark0(0xc20099bd00)\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1186 +0x7a\nruntime.mcall()\n\t/build/go.tip/go/src/pkg/runtime/asm_amd64.s:195 +0x49\n\ngoroutine 1 [runnable]:\nruntime.park(0x40d1b0, 0xc2007e84d0, 0x75f92a)\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1175 +0x64\nruntime.chanrecv(0x573a20, 0xc2007e8480, 0x7f3f426f4ce0, 0x0, 0x0, ...)\n\t/build/go.tip/go/src/pkg/runtime/chan.c:366 +0x566\nruntime.chanrecv1()\n\t/build/go.tip/go/src/pkg/runtime/chan.c:458 +0x38\ntesting.RunTests(0x650568, 0x760280, 0x31, 0x31, 0x1, ...)\n\t/build/go.tip/go/src/pkg/testing/testing.go:434 +0x88e\ntesting.Main(0x650568, 0x760280, 0x31, 0x31, 0x762060, ...)\n\t/build/go.tip/go/src/pkg/testing/testing.go:365 +0x8a\nmain.main()\n\truntime/_test/_testmain.go:319 +0x9a\nruntime.main()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:182 +0x92\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\n\ngoroutine 2 [syscall]:\nruntime.entersyscallblock()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1333 +0x16e\nruntime.MHeap_Scavenger()\n\t/build/go.tip/go/src/pkg/runtime/mheap.c:454 +0xee\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime.main\n\t/build/go.tip/go/src/pkg/runtime/proc.c:165\n\ngoroutine 3 [syscall]:\nruntime.entersyscallblock()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1333 +0x16e\ntimerproc()\n\t/build/go.tip/go/src/pkg/runtime/ztime_linux_amd64.c:195 +0xbc\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by addtimer\n\t/build/go.tip/go/src/pkg/runtime/ztime_linux_amd64.c:82\n\ngoroutine 80122 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0x0)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 73 [finalizer wait]:\nruntime.park(0x0, 0x0, 0x760af1)\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1175 +0x64\nrunfinq()\n\t/build/go.tip/go/src/pkg/runtime/mgc0.c:2182 +0x6d\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime.gc\n\t/build/go.tip/go/src/pkg/runtime/mgc0.c:1886\n\ngoroutine 80139 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0x11)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80135 [running]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0xd)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80131 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0x9)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80140 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0x12)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80123 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0x1)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80125 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0x3)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80142 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0x14)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80144 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0x16)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80136 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0xe)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80137 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0xf)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80126 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0x4)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80127 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0x5)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80145 [runnable]:\nruntime.park(0x40d1b0, 0xc2007bc350, 0x7f3f4227df78)\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1175 +0x64\nruntime.chansend(0x5739c0, 0xc2007bc280, 0x7f3f4227df78, 0x0, 0x47d279, ...)\n\t/build/go.tip/go/src/pkg/runtime/chan.c:261 +0x1d7\nruntime.chansend1()\n\t/build/go.tip/go/src/pkg/runtime/chan.c:450 +0x4c\nruntime_test.func·003()\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:93 +0xb9\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:98 +0x23d\n\ngoroutine 80129 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0x7)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80138 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0x10)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80143 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0x15)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80130 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0x8)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80121 [runnable]:\nruntime.park(0x40d1b0, 0xc2007bc550, 0x0)\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1175 +0x64\nruntime.chanrecv(0x5739c0, 0xc2007bc500, 0x7f3f4228be88, 0x0, 0x7f3f4228be90, ...)\n\t/build/go.tip/go/src/pkg/runtime/chan.c:397 +0x234\nruntime.chanrecv2()\n\t/build/go.tip/go/src/pkg/runtime/chan.c:470 +0x45\nruntime_test.TestMultiConsumer(0xc200781510)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:103 +0x27e\ntesting.tRunner(0xc200781510, 0x7602e0)\n\t/build/go.tip/go/src/pkg/testing/testing.go:353 +0x8a\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by testing.RunTests\n\t/build/go.tip/go/src/pkg/testing/testing.go:433 +0x86b\n\ngoroutine 80124 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0x2)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80128 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0x6)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80133 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0xb)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80132 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0xa)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80141 [running]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0x13)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:76 +0x55\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\n\ngoroutine 80134 [runnable]:\nruntime.gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1201 +0x25\nruntime.Gosched()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1621 +0x18\nruntime_test.func·002(0xc)\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:79 +0xb0\nruntime.goexit()\n\t/build/go.tip/go/src/pkg/runtime/proc.c:1223\ncreated by runtime_test.TestMultiConsumer\n\t/build/go.tip/go/src/pkg/runtime/chan_test.go:84 +0x1ab\nrax     0x0\nrbx     0x0\nrcx     0x0\nrdx     0xc2007e8dc0\nrdi     0x419340\nrsi     0xc2003bd600\nrbp     0xc2007e8d80\nrsp     0xc20094cf58\nr8      0xffffffff\nr9      0xc2007e8d80\nr10     0x0\nr11     0x202\nr12     0x80\nr13     0x4f\nr14     0x2aa89543b5100c\nr15     0x626210\nrip     0x4065cf\nrflags  0x10202\ncs      0x33\nfs      0x0\ngs      0x0\nFAIL\truntime\t8.486s\n\nWhich compiler are you using (5g, 6g, 8g, gccgo)?\n\n6g\n\nWhich operating system are you using?\n\nlinux\n\nWhich version are you using?  (run 'go version')\n\ngo version devel +17c26220ac96 Mon May 06 10:15:16 2013 -0700 linux/amd64\n\nPlease provide any additional information below.\n\nfirst time I've seen this one...\u003c/pre\u003e",
	"user": {
		"login": "alberts",
		"id": 409689,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "FrozenDueToAge"
		}
	],
	"comments": 14,
	"closed_at": "2014-12-08T10:29:19Z",
	"created_at": "2013-05-07T07:47:30Z",
	"updated_at": "2016-06-24T22:39:33Z",
	"milestone": {
		"id": 1067199,
		"number": 11,
		"title": "Go1.1"
	}
}
