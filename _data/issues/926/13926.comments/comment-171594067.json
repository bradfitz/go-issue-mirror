{
	"id": 171594067,
	"body": "Below I've got some results. Beware though that the linux machine has 8 cores (including hyperthreads), the freebsd machine only has two:\r\n\r\n```\r\nFreeBSD # GOTRACEBACK=crash GOPATH=`pwd` /usr/local/go/bin/go run -race  threads.go\r\n# runtime/cgo\r\ncc: warning: argument unused during compilation: '-pthread'\r\n# runtime/race\r\ncc: warning: argument unused during compilation: '-pthread'\r\n# command-line-arguments\r\ncc: warning: argument unused during compilation: '-pthread'\r\n1.64223369s\r\n```\r\n\r\n```\r\n`Linux # time  GOTRACEBACK=crash GOPATH=`pwd` /usr/local/go/bin/go run  -race  threads.go\r\n113.884271ms\r\n```\r\n\r\nI've repeated the above a dozen times or so, all yielding similar results. One time however I again got a load that skyrocketed on FreeBSD. In order to stress the system a little bit more, I upped the THREADS constant to 650. \r\n\r\n```\r\nLinux # while true; do ./threads ; sleep 1; done\r\n1.523410828s\r\n271.040985ms\r\n587.719518ms\r\n681.638101ms\r\n334.02606ms\r\n366.330778ms\r\n```\r\n\r\nAll results are similar to the ones posted above, the 1.5s is the highest number observed (even with GOMAXPROCS set to 1, results are not too dissimilar averaging at ~650ms). \r\n\r\nDoing the same on FreeBSD though:\r\n```\r\nFreeBSD # while true; do ./threads ; sleep 1; done\r\n751.868957ms\r\n34.801136295s\r\n3m59.019588714s\r\n1.51715983s\r\n12.29715116s\r\n587.125403ms\r\n4.297773294s\r\n2.025705987s\r\n```\r\n\r\nEvery few runs the load spikes. With the run that took \u003e3 minutes, the load went up to 600. The \u003e3 minute run is not an exception, but rather a regular phenomenon. Even though the symptoms are the same (load spikes to semi-infinite amounts), internally it's a little different. Truss shows:\r\n```\r\nnanosleep({0.000001000 })\t\t\t = 0 (0x0)\r\nnanosleep({0.000001000 })\t\t\t = 0 (0x0)\r\nnanosleep({0.000001000 })\t\t\t = 0 (0x0)\r\nnanosleep({0.000001000 })\t\t\t = 0 (0x0)\r\nnanosleep({0.000001000 })\t\t\t = 0 (0x0)\r\nnanosleep({0.000001000 })\t\t\t = 0 (0x0)\r\n```\r\n\r\nA random backtrace from during such an event:\r\n```\r\n[Switching to thread 30 (Thread 801522400 (LWP 102052))]\r\n#0  runtime.usleep () at /usr/local/go/src/runtime/sys_freebsd_amd64.s:272\r\n272\t\tRET\r\n(gdb) bt full\r\n#0  runtime.usleep () at /usr/local/go/src/runtime/sys_freebsd_amd64.s:272\r\nNo locals.\r\n#1  0x00000000004589b6 in runtime.lockextra (nilokay=false, ~r1=0x0) at /usr/local/go/src/runtime/proc1.go:1069\r\n        old = 0\r\n#2  0x000000000045852f in runtime.needm (x=0 '\\000') at /usr/local/go/src/runtime/proc1.go:942\r\n        mp = 0x0\r\n        _g_ = 0x0\r\n#3  0x0000000000480971 in runtime.cgocallback_gofunc () at /usr/local/go/src/runtime/asm_amd64.s:742\r\nNo locals.\r\n#4  0x000000000048089a in runtime.cgocallback () at /usr/local/go/src/runtime/asm_amd64.s:714\r\nNo locals.\r\n#5  0x000000000042c988 in _cgoexp_454a349e7b7e_GoFn (a=0x7fffb4da7f8f, n=0) at command-line-arguments/_obj/_cgo_gotypes.go:48\r\n        fn = {void (void)} 0x7fffb4da7f10\r\n#6  0x00000000004829dd in crosscall2 () at /usr/local/go/src/runtime/cgo/asm_amd64.s:36\r\nNo locals.\r\n#7  0x00007fffb4da7f8f in ?? ()\r\nNo symbol table info available.\r\n#8  0x0000000000000000 in ?? ()\r\nNo symbol table info available.\r\n(gdb) \r\n```\r\n",
	"user": {
		"login": "Freeaqingme",
		"id": 33034,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2016-01-14T10:08:25Z",
	"updated_at": "2016-01-14T10:09:16Z"
}
