{
	"id": 171775379,
	"body": "I was just able to come up with this little snippet. I ran it ~10 times, and with two runs it showed the same problem almost right away. That is, load soaring, truss showing predominantly sched_yield() calls, but also some nanosleep() calls. A representative snippet:\r\n\r\n```\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nnanosleep({0.010000000 })\t\t\t = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8fc7d90,0x5c6620,0x443b291d,0xffffffff81590700,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff93c9d80,0x5c6620,0x443b2922,0xffffffff8158df70,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff97cbd90,0x5c6620,0x443b28ef,0xffffffff8158e080,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff93c9d80,0x5c6620,0x443b2922,0xffffffff8158df70,0x443b2525) = 0 (0x0)\r\nclock_gettime(4,{11447280.710362564 })\t\t = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nclock_gettime(0,{1452803833.553310724 })\t = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff97cbd90,0x5c6620,0x443b28ef,0xffffffff8158e080,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8fc7d90,0x5c6620,0x443b291d,0xffffffff81590700,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8fc7d90,0x5c6620,0x443b291d,0xffffffff81590700,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff95cad80,0x5c6620,0xffff807f009315f0,0xffffffff8158fae0,0x443b2075) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8fc7d90,0x5c6620,0x443b291d,0xffffffff81590700,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8fc7d90,0x5c6620,0x443b291d,0xffffffff81590700,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff93c9d80,0x5c6620,0x443b2922,0xffffffff8158df70,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8fc7d90,0x5c6620,0x443b291d,0xffffffff81590700,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff91c8d80,0x5c6620,0x443b2465,0xffffffff8158ef50,0x443b2075) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8fc7d90,0x5c6620,0x443b291d,0xffffffff81590700,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8fc7d90,0x5c6620,0x443b291d,0xffffffff81590700,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff95cad80,0x5c6620,0xffff807f009315f0,0xffffffff8158fae0,0x443b2075) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff93c9d80,0x5c6620,0x443b2922,0xffffffff8158df70,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8fc7d90,0x5c6620,0x443b291d,0xffffffff81590700,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff93c9d80,0x5c6620,0x443b2922,0xffffffff8158df70,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff93c9d80,0x5c6620,0x443b2922,0xffffffff8158df70,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nwrite(1,\"2016-01-14 21:36:37.595712734 +0\"...,42) = 42 (0x2a)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8fc7d90,0x5c6620,0x443b291d,0xffffffff81590700,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff97cbd90,0x5c6620,0x443b28ef,0xffffffff8158e080,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff91c8d80,0x5c6620,0x443b2465,0xffffffff8158ef50,0x443b2075) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nnanosleep({0.010000000 })\t\t\t = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff95cad80,0x5c6620,0xffff807f009315f0,0xffffffff8158fae0,0x443b2075) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nclock_gettime(4,{11447280.725765584 })\t\t = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8fc7d90,0x5c6620,0x443b291d,0xffffffff81590700,0x443b2525) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8bc5d80,0x5c6620,0x443b290b,0xffffffff8158edd0,0x443b24c1) = 0 (0x0)\r\nsched_yield(0x14,0x7ffff8dc6d80,0x5c6620,0x443b28fa,0xffffffff8158e020,0x443b2525) = 0 (0x0)\r\n```\r\n\r\nCode:\r\n```\r\npackage main\r\n\r\n/*\r\n#include \u003cstddef.h\u003e\r\n#include \u003ctime.h\u003e\r\n#include \u003cpthread.h\u003e\r\n\r\n#define THREADS (50)\r\n\r\nextern void GoFn();\r\n\r\nstatic void* thread(void* darg) {\r\n    struct timespec ts;\r\n\r\n    int *arg = (int*)(darg);\r\n    ts.tv_sec = 0;\r\n    ts.tv_nsec = 1000 * (THREADS - *arg);\r\n    nanosleep(\u0026ts, NULL);\r\n\r\n    GoFn();\r\n\r\n    return NULL;\r\n}\r\n\r\nstatic void CFn() {\r\n    int i;\r\n    pthread_t tids[THREADS];\r\n\r\n    for (i = 0; i \u003c THREADS; i++) {\r\n        pthread_create(\u0026tids[i], NULL, thread, (void*)(\u0026i));\r\n    }\r\n    for (i = 0; i \u003c THREADS; i++) {\r\n        pthread_join(tids[i], NULL);\r\n    }\r\n}\r\n*/\r\nimport \"C\"\r\n\r\nimport (\r\n\t\"bytes\"\r\n\t\"fmt\"\r\n\t\"os/exec\"\r\n\t\"time\"\r\n)\r\n\r\n//export GoFn\r\nfunc GoFn() {\r\n\ttime.Sleep(time.Millisecond)\r\n}\r\n\r\nfunc main() {\r\n\r\n\tgo cmdTimer()\r\n\tticker := time.NewTicker(time.Millisecond * 1000)\r\n\tfor _ = range ticker.C {\r\n\t\tC.CFn()\r\n\t}\r\n}\r\n\r\nfunc cmdTimer() {\r\n\tt := time.Now()\r\n\r\n\tcmdRun := func(id string) {\r\n\t\tcmd := exec.Command(\"iostat\")\r\n\t\tcmd.Dir = \"/\"\r\n\t\tvar out bytes.Buffer\r\n\t\tcmd.Stdout = \u0026out\r\n\t\tcmd.Run()\r\n\t\tfmt.Println(t.String() + \" \"  + id)\r\n\t}\r\n\r\n\tticker := time.NewTicker(time.Millisecond * 500)\r\n\tfor _ = range ticker.C {\r\n\t\tgo cmdRun(\"1\")\r\n\t\tgo cmdRun(\"2\")\r\n\t\tgo cmdRun(\"3\")\r\n\t\tgo cmdRun(\"4\")\r\n\t}\r\n\r\n}\r\n```\r\n\r\nUsing a larger number of threads (e.g. 250 instead of 50) triggers the issue almost immediately.",
	"user": {
		"login": "Freeaqingme",
		"id": 33034,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2016-01-14T20:50:05Z",
	"updated_at": "2016-01-14T20:50:05Z"
}
