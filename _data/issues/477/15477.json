{
	"id": 151561270,
	"number": 15477,
	"state": "closed",
	"title": "runtime/pprof: TestStackBarrierProfiling hangs",
	"body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What version of Go are you using (`go version`)?\r\n```\r\ngo version devel +80e9a7f Thu Apr 28 05:26:36 2016 +0000 linux/386\r\n```\r\n2. What operating system and processor architecture are you using (`go env`)?\r\n```\r\nGOARCH=\"386\"\r\nGOBIN=\"\"\r\nGOEXE=\"\"\r\nGOHOSTARCH=\"386\"\r\nGOHOSTOS=\"linux\"\r\nGOOS=\"linux\"\r\nGOPATH=\"/root\"\r\nGORACE=\"\"\r\nGOROOT=\"/root/go\"\r\nGOTOOLDIR=\"/root/go/pkg/tool/linux_386\"\r\nCC=\"gcc\"\r\nGOGCCFLAGS=\"-fPIC -m32 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build695579586=/tmp/go-build\"\r\nCXX=\"g++\"\r\nCGO_ENABLED=\"1\"\r\n```\r\n\r\n3. What did you do?\r\nIf possible, provide a recipe for reproducing the error.\r\nA complete runnable program is good.\r\nA link on play.golang.org is best.\r\n\r\nI run:\r\n```\r\ngo test runtime/pprof -v -short -run=TestStackBarrierProfiling -timeout=1m\r\n```\r\n\r\n4. What did you expect to see?\r\n\r\nI expect test pass.\r\n\r\n5. What did you see instead?\r\n\r\n```\r\n=== RUN   TestStackBarrierProfiling\r\npanic: test timed out after 1m0s\r\n\r\ngoroutine 8 [running]:\r\npanic(0x813de00, 0x184262d0)\r\n        /root/go/src/runtime/panic.go:500 +0x331\r\ntesting.startAlarm.func1()\r\n        /root/go/src/testing/testing.go:855 +0xf5\r\ncreated by time.goFunc\r\n        /root/go/src/time/sleep.go:129 +0x36\r\n\r\ngoroutine 1 [chan receive]:\r\ntesting.(*T).Run(0x18418280, 0x8160c86, 0x19, 0x816f7b0, 0x1)\r\n        /root/go/src/testing/testing.go:584 +0x2c4\r\ntesting.RunTests.func1(0x18418200)\r\n        /root/go/src/testing/testing.go:730 +0x98\r\ntesting.tRunner(0x18418200, 0x18439ed8)\r\n        /root/go/src/testing/testing.go:547 +0x8c\r\ntesting.RunTests(0x816f50c, 0x81d9da0, 0x9, 0x9, 0x18462001)\r\n        /root/go/src/testing/testing.go:736 +0x332\r\ntesting.(*M).Run(0x18439f7c, 0x0)\r\n        /root/go/src/testing/testing.go:680 +0x79\r\nmain.main()\r\n        runtime/pprof/_test/_testmain.go:72 +0x100\r\n\r\ngoroutine 6 [syscall]:\r\nsyscall.Syscall6(0x72, 0x76c1, 0x184245cc, 0x0, 0x18478000, 0x0, 0x0, 0x80772bf, 0xb76df000, 0x0)\r\n        /root/go/src/syscall/asm_linux_386.s:45 +0x5\r\nsyscall.wait4(0x76c1, 0x184245cc, 0x0, 0x18478000, 0x50, 0x0, 0x0)\r\n        /root/go/src/syscall/zsyscall_linux_386.go:172 +0x71\r\nsyscall.Wait4(0x76c1, 0x184245f0, 0x0, 0x18478000, 0x184262b0, 0x0, 0x0)\r\n        /root/go/src/syscall/syscall_linux.go:256 +0x4d\r\nos.(*Process).wait(0x184103a0, 0x1f, 0x0, 0x0)\r\n        /root/go/src/os/exec_unix.go:22 +0xae\r\nos.(*Process).Wait(0x184103a0, 0x0, 0x0, 0x0)\r\n        /root/go/src/os/doc.go:49 +0x2b\r\nos/exec.(*Cmd).Wait(0x1840e140, 0x0, 0x0)\r\n        /root/go/src/os/exec/exec.go:396 +0x11c\r\nos/exec.(*Cmd).Run(0x1840e140, 0x0, 0x0)\r\n        /root/go/src/os/exec/exec.go:262 +0x58\r\nos/exec.(*Cmd).CombinedOutput(0x1840e140, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n        /root/go/src/os/exec/exec.go:453 +0x1a7\r\nruntime/pprof_test.TestStackBarrierProfiling(0x18418280)\r\n        /root/go/src/runtime/pprof/pprof_test.go:392 +0x2b6\r\ntesting.tRunner(0x18418280, 0x816f7b0)\r\n        /root/go/src/testing/testing.go:547 +0x8c\r\ncreated by testing.(*T).Run\r\n        /root/go/src/testing/testing.go:583 +0x2a5\r\n\r\ngoroutine 7 [syscall]:\r\nsyscall.Syscall(0x3, 0x4, 0x1847a000, 0x200, 0xb76df000, 0x0, 0x1)\r\n        /root/go/src/syscall/asm_linux_386.s:20 +0x5\r\nsyscall.read(0x4, 0x1847a000, 0x200, 0x200, 0x816f4fc, 0x0, 0x0)\r\n        /root/go/src/syscall/zsyscall_linux_386.go:783 +0x5b\r\nsyscall.Read(0x4, 0x1847a000, 0x200, 0x200, 0x0, 0x0, 0x0)\r\n        /root/go/src/syscall/syscall_unix.go:161 +0x45\r\nos.(*File).read(0x184262a8, 0x1847a000, 0x200, 0x200, 0x1847a000, 0x0, 0x0)\r\n        /root/go/src/os/file_unix.go:228 +0x4a\r\nos.(*File).Read(0x184262a8, 0x1847a000, 0x200, 0x200, 0x11de5298, 0x0, 0x0)\r\n        /root/go/src/os/file.go:97 +0x6f\r\nbytes.(*Buffer).ReadFrom(0x18462180, 0x81c9770, 0x184262a8, 0x0, 0x0, 0x0, 0x0)\r\n        /root/go/src/bytes/buffer.go:176 +0x1c5\r\nio.copyBuffer(0x81c96f0, 0x18462180, 0x81c9770, 0x184262a8, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, ...)\r\n        /root/go/src/io/io.go:392 +0x129\r\nio.Copy(0x81c96f0, 0x18462180, 0x81c9770, 0x184262a8, 0x0, 0x0, 0x0, 0x0)\r\n        /root/go/src/io/io.go:368 +0x53\r\nos/exec.(*Cmd).writerDescriptor.func1(0x0, 0x0)\r\n        /root/go/src/os/exec/exec.go:236 +0x57\r\nos/exec.(*Cmd).Start.func1(0x1840e140, 0x18410260)\r\n        /root/go/src/os/exec/exec.go:344 +0x1d\r\ncreated by os/exec.(*Cmd).Start\r\n        /root/go/src/os/exec/exec.go:345 +0x698\r\nexit status 2\r\nFAIL    runtime/pprof   60.005s\r\n```\r\n\r\nThe test fails on my windows-amd64 too.\r\n\r\nAlex",
	"user": {
		"login": "alexbrainman",
		"id": 9796621,
		"type": "User",
		"site_admin": false
	},
	"comments": 11,
	"closed_at": "2016-05-18T04:38:46Z",
	"created_at": "2016-04-28T06:41:21Z",
	"updated_at": "2016-05-18T13:15:44Z",
	"milestone": {
		"id": 1414133,
		"number": 31,
		"title": "Go1.7"
	}
}
