{
	"id": 219687206,
	"body": "\u003e are you (or were you) able to reproduce this reliably?\r\n\r\nYes. It fails nearly every time.\r\n\r\n\u003e How many CPUs does the host have?\r\n\r\n```\r\nprocessor\t: 0\r\nvendor_id\t: GenuineIntel\r\ncpu family\t: 6\r\nmodel\t\t: 26\r\nmodel name\t: Intel(R) Xeon(R) CPU           E5530  @ 2.40GHz\r\nstepping\t: 5\r\nmicrocode\t: 0x10\r\ncpu MHz\t\t: 2400.085\r\ncache size\t: 8192 KB\r\nfdiv_bug\t: no\r\nhlt_bug\t\t: no\r\nf00f_bug\t: no\r\ncoma_bug\t: no\r\nfpu\t\t: yes\r\nfpu_exception\t: yes\r\ncpuid level\t: 11\r\nwp\t\t: yes\r\nflags\t\t: fpu vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov pat pse36 clflush dts acpi mmx fxsr sse sse2 ss nx rdtscp lm constant_tsc up arch_perfmon pebs bts xtopology tsc_reliable nonstop_tsc aperfmperf pni ssse3 cx16 sse4_1 sse4_2 popcnt hypervisor lahf_lm ida dts\r\nbogomips\t: 4800.17\r\nclflush size\t: 64\r\ncache_alignment\t: 64\r\naddress sizes\t: 40 bits physical, 48 bits virtual\r\npower management:\r\n\r\n```\r\n\r\n\u003e Actually, GODEBUG=gcstackbarrierall=1 GOGC=1 GOTRACEBACK=crash ./pprof.test -test.v -test.short -test.run=TestStackBarrierProfiling -test.timeout=1m\r\n\r\nIf I use GODEBUG=gcstackbarrierall=1, the problem goes away. So running:\r\n\r\n```\r\n# go test -c \u0026\u0026 GOGC=1 GOTRACEBACK=crash ./pprof.test -test.v -test.short -test.run=TestStackBarrierProfiling -test.timeout=1m\r\npanic: test timed out after 1m0s\r\n\r\ngoroutine 9 [running]:\r\npanic(0x8142240, 0x185261d8)\r\n\t/root/go/src/runtime/panic.go:500 +0x331 fp=0x1851f7a0 sp=0x1851f75c\r\ntesting.startAlarm.func1()\r\n\t/root/go/src/testing/testing.go:855 +0xf5 fp=0x1851f7e0 sp=0x1851f7a0\r\nruntime.goexit()\r\n\t/root/go/src/runtime/asm_386.s:1605 +0x1 fp=0x1851f7e4 sp=0x1851f7e0\r\ncreated by time.goFunc\r\n\t/root/go/src/time/sleep.go:129 +0x36\r\n\r\ngoroutine 1 [chan receive, 1 minutes]:\r\nruntime.gopark(0x8174460, 0x185421b0, 0x8162da0, 0xc, 0x18512017, 0x3)\r\n\t/root/go/src/runtime/proc.go:265 +0x130 fp=0x1853ed10 sp=0x1853ecfc\r\nruntime.goparkunlock(0x185421b0, 0x8162da0, 0xc, 0x809f617, 0x3)\r\n\t/root/go/src/runtime/proc.go:271 +0x4b fp=0x1853ed2c sp=0x1853ed10\r\nruntime.chanrecv(0x8141080, 0x18542180, 0x0, 0x1853ed01, 0x80a0000)\r\n\t/root/go/src/runtime/chan.go:496 +0x3e8 fp=0x1853ed74 sp=0x1853ed2c\r\nruntime.chanrecv1(0x8141080, 0x18542180, 0x0)\r\n\t/root/go/src/runtime/chan.go:378 +0x24 fp=0x1853ed8c sp=0x1853ed74\r\ntesting.(*T).Run(0x18518200, 0x8165738, 0x19, 0x8174538, 0x8056401)\r\n\t/root/go/src/testing/testing.go:584 +0x2c4 fp=0x1853edf4 sp=0x1853ed8c\r\ntesting.RunTests.func1(0x18518100)\r\n\t/root/go/src/testing/testing.go:730 +0x98 fp=0x1853ee3c sp=0x1853edf4\r\ntesting.tRunner(0x18518100, 0x1853eee0)\r\n\t/root/go/src/testing/testing.go:547 +0x8c fp=0x1853ee60 sp=0x1853ee3c\r\ntesting.RunTests(0x817428c, 0x81dfee0, 0x9, 0x9, 0x1856c001)\r\n\t/root/go/src/testing/testing.go:736 +0x332 fp=0x1853eef4 sp=0x1853ee60\r\ntesting.(*M).Run(0x1853ef84, 0x0)\r\n\t/root/go/src/testing/testing.go:680 +0x79 fp=0x1853ef34 sp=0x1853eef4\r\nmain.main()\r\n\truntime/pprof/_test/_testmain.go:72 +0x100 fp=0x1853efb0 sp=0x1853ef34\r\nruntime.main()\r\n\t/root/go/src/runtime/proc.go:189 +0x276 fp=0x1853efd8 sp=0x1853efb0\r\nruntime.goexit()\r\n\t/root/go/src/runtime/asm_386.s:1605 +0x1 fp=0x1853efdc sp=0x1853efd8\r\n\r\ngoroutine 2 [force gc (idle), 1 minutes]:\r\nruntime.gopark(0x8174460, 0x81e0fe8, 0x816359b, 0xf, 0x1508814, 0x1)\r\n\t/root/go/src/runtime/proc.go:265 +0x130 fp=0x185227ac sp=0x18522798\r\nruntime.goparkunlock(0x81e0fe8, 0x816359b, 0xf, 0x18500014, 0x1)\r\n\t/root/go/src/runtime/proc.go:271 +0x4b fp=0x185227c8 sp=0x185227ac\r\nruntime.forcegchelper()\r\n\t/root/go/src/runtime/proc.go:230 +0xaa fp=0x185227e0 sp=0x185227c8\r\nruntime.goexit()\r\n\t/root/go/src/runtime/asm_386.s:1605 +0x1 fp=0x185227e4 sp=0x185227e0\r\ncreated by runtime.init.4\r\n\t/root/go/src/runtime/proc.go:219 +0x2a\r\n\r\ngoroutine 3 [GC sweep wait]:\r\nruntime.gopark(0x8174460, 0x81e10e0, 0x8162ff6, 0xd, 0x8096514, 0x1)\r\n\t/root/go/src/runtime/proc.go:265 +0x130 fp=0x18522fa0 sp=0x18522f8c\r\nruntime.goparkunlock(0x81e10e0, 0x8162ff6, 0xd, 0x14, 0x1)\r\n\t/root/go/src/runtime/proc.go:271 +0x4b fp=0x18522fbc sp=0x18522fa0\r\nruntime.bgsweep(0x18542000)\r\n\t/root/go/src/runtime/mgcsweep.go:79 +0x125 fp=0x18522fd8 sp=0x18522fbc\r\nruntime.goexit()\r\n\t/root/go/src/runtime/asm_386.s:1605 +0x1 fp=0x18522fdc sp=0x18522fd8\r\ncreated by runtime.gcenable\r\n\t/root/go/src/runtime/mgc.go:195 +0x52\r\n\r\ngoroutine 4 [GC worker (idle)]:\r\nruntime.gopark(0x81743b0, 0x18510110, 0x8163797, 0x10, 0x14, 0x0)\r\n\t/root/go/src/runtime/proc.go:265 +0x130 fp=0x1852379c sp=0x18523788\r\nruntime.gcBgMarkWorker(0x1851c000)\r\n\t/root/go/src/runtime/mgc.go:1421 +0xd6 fp=0x185237d8 sp=0x1852379c\r\nruntime.goexit()\r\n\t/root/go/src/runtime/asm_386.s:1605 +0x1 fp=0x185237dc sp=0x185237d8\r\ncreated by runtime.gcBgMarkStartWorkers\r\n\t/root/go/src/runtime/mgc.go:1342 +0x79\r\n\r\ngoroutine 5 [finalizer wait, 1 minutes]:\r\nruntime.gopark(0x8174460, 0x81f13fc, 0x81632e9, 0xe, 0x14, 0x1)\r\n\t/root/go/src/runtime/proc.go:265 +0x130 fp=0x18523f8c sp=0x18523f78\r\nruntime.goparkunlock(0x81f13fc, 0x81632e9, 0xe, 0x14, 0x1)\r\n\t/root/go/src/runtime/proc.go:271 +0x4b fp=0x18523fa8 sp=0x18523f8c\r\nruntime.runfinq()\r\n\t/root/go/src/runtime/mfinal.go:158 +0x9e fp=0x18523fe0 sp=0x18523fa8\r\nruntime.goexit()\r\n\t/root/go/src/runtime/asm_386.s:1605 +0x1 fp=0x18523fe4 sp=0x18523fe0\r\ncreated by runtime.createfing\r\n\t/root/go/src/runtime/mfinal.go:139 +0x5c\r\n\r\ngoroutine 6 [timer goroutine (idle)]:\r\nruntime.gopark(0x8174460, 0x81e1180, 0x816505e, 0x16, 0x8174514, 0x1)\r\n\t/root/go/src/runtime/proc.go:265 +0x130 fp=0x18524770 sp=0x1852475c\r\nruntime.goparkunlock(0x81e1180, 0x816505e, 0x16, 0x14, 0x1)\r\n\t/root/go/src/runtime/proc.go:271 +0x4b fp=0x1852478c sp=0x18524770\r\nruntime.timerproc()\r\n\t/root/go/src/runtime/time.go:202 +0x123 fp=0x185247e0 sp=0x1852478c\r\nruntime.goexit()\r\n\t/root/go/src/runtime/asm_386.s:1605 +0x1 fp=0x185247e4 sp=0x185247e0\r\ncreated by runtime.addtimerLocked\r\n\t/root/go/src/runtime/time.go:116 +0x112\r\n\r\ngoroutine 7 [syscall]:\r\nsyscall.Syscall6(0x72, 0x7ed0, 0x1853dda0, 0x0, 0x1855c000, 0x0, 0x0, 0xb76ec000, 0x0, 0x16caa3ff)\r\n\t/root/go/src/syscall/asm_linux_386.s:45 +0x5 fp=0x1853dd44 sp=0x1853dd40\r\nsyscall.wait4(0x7ed0, 0x1853dda0, 0x0, 0x1855c000, 0x50, 0x0, 0x0)\r\n\t/root/go/src/syscall/zsyscall_linux_386.go:172 +0x71 fp=0x1853dd84 sp=0x1853dd44\r\nsyscall.Wait4(0x7ed0, 0x1853ddc4, 0x0, 0x1855c000, 0x18510240, 0x0, 0x0)\r\n\t/root/go/src/syscall/syscall_linux.go:256 +0x4d fp=0x1853dda8 sp=0x1853dd84\r\nos.(*Process).wait(0x185103a0, 0x0, 0x0, 0x0)\r\n\t/root/go/src/os/exec_unix.go:22 +0xae fp=0x1853de00 sp=0x1853dda8\r\nos.(*Process).Wait(0x185103a0, 0x1850e700, 0x0, 0x0)\r\n\t/root/go/src/os/doc.go:49 +0x2b fp=0x1853de14 sp=0x1853de00\r\nos/exec.(*Cmd).WaitContext(0x185120a0, 0x0, 0x0, 0x0, 0x0)\r\n\t/root/go/src/os/exec/exec.go:424 +0x198 fp=0x1853de88 sp=0x1853de14\r\nos/exec.(*Cmd).Wait(0x185120a0, 0x0, 0x0)\r\n\t/root/go/src/os/exec/exec.go:399 +0x35 fp=0x1853dea0 sp=0x1853de88\r\nos/exec.(*Cmd).Run(0x185120a0, 0x0, 0x0)\r\n\t/root/go/src/os/exec/exec.go:263 +0x58 fp=0x1853deb8 sp=0x1853dea0\r\nos/exec.(*Cmd).CombinedOutput(0x185120a0, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\t/root/go/src/os/exec/exec.go:484 +0x1a7 fp=0x1853df00 sp=0x1853deb8\r\nruntime/pprof_test.TestStackBarrierProfiling(0x18518200)\r\n\t/root/go/src/runtime/pprof/pprof_test.go:392 +0x2c8 fp=0x1853dfac sp=0x1853df00\r\ntesting.tRunner(0x18518200, 0x8174538)\r\n\t/root/go/src/testing/testing.go:547 +0x8c fp=0x1853dfd0 sp=0x1853dfac\r\nruntime.goexit()\r\n\t/root/go/src/runtime/asm_386.s:1605 +0x1 fp=0x1853dfd4 sp=0x1853dfd0\r\ncreated by testing.(*T).Run\r\n\t/root/go/src/testing/testing.go:583 +0x2a5\r\n\r\ngoroutine 8 [syscall]:\r\nsyscall.Syscall(0x3, 0x4, 0x1856e000, 0x200, 0x8095550, 0x18528500, 0x0)\r\n\t/root/go/src/syscall/asm_linux_386.s:20 +0x5 fp=0x185205fc sp=0x185205f8\r\nsyscall.read(0x4, 0x1856e000, 0x200, 0x200, 0x817427c, 0x0, 0x0)\r\n\t/root/go/src/syscall/zsyscall_linux_386.go:783 +0x5b fp=0x18520628 sp=0x185205fc\r\nsyscall.Read(0x4, 0x1856e000, 0x200, 0x200, 0x0, 0x0, 0x0)\r\n\t/root/go/src/syscall/syscall_unix.go:161 +0x45 fp=0x18520648 sp=0x18520628\r\nos.(*File).read(0x18526188, 0x1856e000, 0x200, 0x200, 0x80564fe, 0x0, 0x0)\r\n\t/root/go/src/os/file_unix.go:228 +0x4a fp=0x18520668 sp=0x18520648\r\nos.(*File).Read(0x18526188, 0x1856e000, 0x200, 0x200, 0x185206ac, 0x0, 0x0)\r\n\t/root/go/src/os/file.go:97 +0x6f fp=0x18520694 sp=0x18520668\r\nbytes.(*Buffer).ReadFrom(0x1856c060, 0x81cf770, 0x18526188, 0x0, 0x0, 0x0, 0x0)\r\n\t/root/go/src/bytes/buffer.go:176 +0x1c5 fp=0x185206ec sp=0x18520694\r\nio.copyBuffer(0x81cf6f0, 0x1856c060, 0x81cf770, 0x18526188, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0, ...)\r\n\t/root/go/src/io/io.go:392 +0x129 fp=0x18520750 sp=0x185206ec\r\nio.Copy(0x81cf6f0, 0x1856c060, 0x81cf770, 0x18526188, 0x0, 0x0, 0x0, 0x0)\r\n\t/root/go/src/io/io.go:368 +0x53 fp=0x18520780 sp=0x18520750\r\nos/exec.(*Cmd).writerDescriptor.func1(0x0, 0x0)\r\n\t/root/go/src/os/exec/exec.go:237 +0x57 fp=0x185207c0 sp=0x18520780\r\nos/exec.(*Cmd).Start.func1(0x185120a0, 0x18510240)\r\n\t/root/go/src/os/exec/exec.go:354 +0x1d fp=0x185207d8 sp=0x185207c0\r\nruntime.goexit()\r\n\t/root/go/src/runtime/asm_386.s:1605 +0x1 fp=0x185207dc sp=0x185207d8\r\ncreated by os/exec.(*Cmd).Start\r\n\t/root/go/src/os/exec/exec.go:355 +0x698\r\n\r\n```\r\n\r\nThis is all on current tip:\r\n```\r\ngo version devel +495e3c6 Tue May 17 04:02:11 2016 +0000 linux/386\r\n```\r\n\r\nI hope you have everything you need, Dr Austin.\r\n\r\nAlex",
	"user": {
		"login": "alexbrainman",
		"id": 9796621,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2016-05-17T11:08:36Z",
	"updated_at": "2016-05-17T11:08:36Z"
}
