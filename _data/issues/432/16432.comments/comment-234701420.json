{
	"id": 234701420,
	"body": "I mailed [CL 25155](https://golang.org/cl/25155). With that change (at PS 1) applied to go1.7rc3, the runtime execution trace of my program shows inbound network events as continuing at the same rate whether or not a concurrent GC is executing. The delay between inbound network events and the execution of the goroutines they unblock is generally less than 10µs even when a garbage collection is in progress. With go1.7rc3 without the change, the delays are often near 10ms.\r\n\r\nThe gctrace output shows that the heap grew more during the concurrent mark phase than with go1.7rc3. In the other gctrace outputs I shared, the GC cycles started when the goal was around 10MB away and completed after growing 1–2MB: the collection finished about 5–10x faster than expected. With this change, the gctrace output shows that the GC cycles start about 20MB before the goal and complete after the 10MB has been allocated: the collection finished only 2x faster than the pacer expected.\r\n\r\nFinally, the runtime execution trace shows the goroutine run queue growing and shrinking during the concurrent GC, rather than waiting until almost the end of the cycle before draining. It shows many goroutines each being scheduled for a few hundred microseconds, and yielding once their work is done to allow other goroutines to have some CPU time.\r\n\r\n```\r\npacer: assist ratio=+5.599321e+000 (scan 155 MB in 468-\u003e496 MB) workers=9+0\r\npacer: H_m_prev=260271008 h_t=+8.876642e-001 H_T=491304256 h_a=+9.315716e-001 H_a=502732080 h_g=+1.000000e+000 H_g=520542016 u_a=+6.200409e-001 u_g=+2.500000e-001 W_a=88987328 goalΔ=+1.123358e-001 actualΔ=+4.390740e-002 u_a/u_g=+2.480164e+000\r\ngc 1199 @688.817s 3%: 4.7+28+1.1 ms clock, 150+447/255/0.030+35 ms cpu, 468-\u003e479-\u003e259 MB, 496 MB goal, 36 P\r\npacer: sweep done at heap size 271MB; allocated 11MB of spans; swept 62143 pages at +2.583740e-004 pages/byte\r\npacer: assist ratio=+5.534240e+000 (scan 158 MB in 489-\u003e518 MB) workers=9+0\r\npacer: H_m_prev=271608696 h_t=+8.893833e-001 H_T=513172939 h_a=+9.295383e-001 H_a=524079392 h_g=+1.000000e+000 H_g=543217392 u_a=+5.818598e-001 u_g=+2.500000e-001 W_a=87967656 goalΔ=+1.106167e-001 actualΔ=+4.015502e-002 u_a/u_g=+2.327439e+000\r\ngc 1200 @689.361s 3%: 0.065+28+1.1 ms clock, 2.0+335/248/155+37 ms cpu, 489-\u003e499-\u003e245 MB, 518 MB goal, 36 P\r\npacer: sweep done at heap size 266MB; allocated 20MB of spans; swept 64830 pages at +2.813143e-004 pages/byte\r\npacer: assist ratio=+6.188041e+000 (scan 154 MB in 466-\u003e491 MB) workers=9+0\r\npacer: H_m_prev=257808720 h_t=+8.979625e-001 H_T=489311275 h_a=+9.371894e-001 H_a=499424320 h_g=+1.000000e+000 H_g=515617440 u_a=+6.944268e-001 u_g=+2.500000e-001 W_a=85881912 goalΔ=+1.020375e-001 actualΔ=+3.922693e-002 u_a/u_g=+2.777707e+000\r\ngc 1201 @689.904s 3%: 0.20+28+1.2 ms clock, 6.2+468/255/15+38 ms cpu, 466-\u003e476-\u003e233 MB, 491 MB goal, 36 P\r\npacer: sweep done at heap size 253MB; allocated 20MB of spans; swept 62384 pages at +2.868048e-004 pages/byte\r\npacer: assist ratio=+6.014401e+000 (scan 147 MB in 441-\u003e466 MB) workers=9+0\r\npacer: H_m_prev=244340048 h_t=+8.945008e-001 H_T=462902409 h_a=+9.222571e-001 H_a=469684400 h_g=+1.000000e+000 H_g=488680096 u_a=+2.575276e-001 u_g=+2.500000e-001 W_a=88528928 goalΔ=+1.054992e-001 actualΔ=+2.775636e-002 u_a/u_g=+1.030110e+000\r\ngc 1202 @690.446s 3%: 0.24+27+1.3 ms clock, 7.8+7.5/243/507+42 ms cpu, 441-\u003e447-\u003e239 MB, 466 MB goal, 36 P\r\npacer: sweep done at heap size 249MB; allocated 10MB of spans; swept 59243 pages at +2.540863e-004 pages/byte\r\npacer: assist ratio=+1.224502e+001 (scan 155 MB in 466-\u003e478 MB) workers=9+0\r\npacer: H_m_prev=251040688 h_t=+9.329543e-001 H_T=485250185 h_a=+9.722309e-001 H_a=495110208 h_g=+1.000000e+000 H_g=502081376 u_a=+7.129376e-001 u_g=+2.500000e-001 W_a=91107928 goalΔ=+6.704567e-002 actualΔ=+3.927659e-002 u_a/u_g=+2.851750e+000\r\ngc 1203 @691.011s 3%: 0.89+29+1.0 ms clock, 28+503/256/0+32 ms cpu, 466-\u003e472-\u003e249 MB, 478 MB goal, 36 P\r\npacer: sweep done at heap size 264MB; allocated 14MB of spans; swept 61019 pages at +2.573175e-004 pages/byte\r\npacer: assist ratio=+7.232023e+000 (scan 160 MB in 476-\u003e498 MB) workers=9+0\r\npacer: H_m_prev=261604112 h_t=+9.104736e-001 H_T=499787761 h_a=+9.500183e-001 H_a=510132800 h_g=+1.000000e+000 H_g=523208224 u_a=+6.067982e-001 u_g=+2.500000e-001 W_a=88859424 goalΔ=+8.952635e-002 actualΔ=+3.954463e-002 u_a/u_g=+2.427193e+000\r\ngc 1204 @691.602s 3%: 0.10+32+1.1 ms clock, 3.2+421/284/88+37 ms cpu, 476-\u003e486-\u003e242 MB, 498 MB goal, 36 P\r\npacer: sweep done at heap size 264MB; allocated 22MB of spans; swept 62582 pages at +2.729750e-004 pages/byte\r\npacer: assist ratio=+6.720931e+000 (scan 150 MB in 461-\u003e484 MB) workers=9+0\r\npacer: H_m_prev=253853736 h_t=+9.072456e-001 H_T=484161420 h_a=+9.460856e-001 H_a=494021104 h_g=+1.000000e+000 H_g=507707472 u_a=+5.527317e-001 u_g=+2.500000e-001 W_a=90982696 goalΔ=+9.275440e-002 actualΔ=+3.884002e-002 u_a/u_g=+2.210927e+000\r\ngc 1205 @692.146s 3%: 0.11+31+1.5 ms clock, 3.6+348/276/166+50 ms cpu, 461-\u003e471-\u003e246 MB, 484 MB goal, 36 P\r\npacer: sweep done at heap size 259MB; allocated 15MB of spans; swept 61663 pages at +2.635020e-004 pages/byte\r\npacer: assist ratio=+7.261088e+000 (scan 159 MB in 470-\u003e492 MB) workers=9+0\r\npacer: H_m_prev=258115136 h_t=+9.106866e-001 H_T=493177126 h_a=+9.494011e-001 H_a=503169936 h_g=+1.000000e+000 H_g=516230272 u_a=+5.632074e-001 u_g=+2.500000e-001 W_a=91345616 goalΔ=+8.931342e-002 actualΔ=+3.871454e-002 u_a/u_g=+2.252830e+000\r\ngc 1206 @692.652s 3%: 0.15+29+1.2 ms clock, 4.7+339/261/229+39 ms cpu, 470-\u003e479-\u003e253 MB, 492 MB goal, 36 P\r\npacer: sweep done at heap size 273MB; allocated 19MB of spans; swept 61908 pages at +2.565693e-004 pages/byte\r\n```\r\n\r\n![screen shot 2016-07-22 at 7 46 11 pm redacted](https://cloud.githubusercontent.com/assets/230685/17075998/553704ae-505b-11e6-95a6-e35e4642e439.png)\r\n",
	"user": {
		"login": "rhysh",
		"id": 230685,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2016-07-23T05:54:55Z",
	"updated_at": "2016-07-23T05:54:55Z"
}
