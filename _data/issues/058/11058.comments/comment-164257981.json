{
	"id": 164257981,
	"body": "Thank you, that was very helpful. I now have data showing up in the .ctors section. I think it is not the correct data, but I'm getting closer.\r\n\r\nI have forked the go repo and put my changes up. The commit with all the work so far is:\r\nhttps://github.com/nadiasvertex/go/commit/6a98514598645aa03b21c54f1ea0a18e413ce5fb\r\n\r\nThe particular function that I am focusing on right now is:\r\nhttps://github.com/nadiasvertex/go/blob/master/src/cmd/link/internal/ld/pe.go#L1089\r\n\r\nAccording to objdump:\r\n```\r\n$ objdump -S ./tmpo/go.o | grep \"_rt0\"                                                                                             \r\n000000000004f430 \u003c_rt0_amd64_windows_lib\u003e:\r\n```\r\n\r\nThe address of the symbol I want is 0x4f430. This corresponds with what gcc does:\r\n\r\n```\r\n$ objdump -S const_2.o\r\n0000000000000012 \u003cdo_this_first\u003e:\r\n\r\n$ objdump -s const_2.o\r\nContents of section .ctors:\r\n 0000 12000000 00000000                    ........   \r\n```\r\n\r\nHowever, that's not what I'm actually getting in the data:\r\n\r\n```\r\n$ objdump -s -j .ctors tmpo/go.o \r\nContents of section .ctors:\r\n e5000 30e40400 00000000 00000000 00000000  0...............\r\n```\r\n\r\nOr, if I don't subtract to Segtext.Vaddr:\r\n\r\n```\r\nContents of section .ctors:\r\n e5000 30f44400 00000000 00000000 00000000  0.D.............\r\n\r\n```\r\n\r\nI also notice that the minimum section size I can create is 512 bytes here, but gcc appears to set the section size to the length of the actual written data. In this case, gcc makes .ctors 8 bytes long, but go makes it 512 bytes long. I wonder if that might be confusing the platform linker when it goes to merge the .ctors sections of the .o files at the end.\r\n\r\nGCC:\r\n```\r\n$ objdump -h const_2.o\r\n\r\nconst_2.o:     file format pe-x86-64\r\n\r\nSections:\r\nIdx Name          Size      VMA               LMA               File off  Algn\r\n  0 .text         00000040  0000000000000000  0000000000000000  0000012c  2**4\r\n                  CONTENTS, ALLOC, LOAD, READONLY, CODE\r\n  1 .data         00000000  0000000000000000  0000000000000000  00000000  2**4\r\n                  ALLOC, LOAD, DATA\r\n  2 .bss          00000000  0000000000000000  0000000000000000  00000000  2**4\r\n                  ALLOC\r\n  3 .xdata        00000024  0000000000000000  0000000000000000  0000016c  2**2\r\n                  CONTENTS, ALLOC, LOAD, READONLY, DATA\r\n  4 .pdata        00000030  0000000000000000  0000000000000000  00000190  2**2\r\n                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, DATA\r\n  5 .ctors        00000008  0000000000000000  0000000000000000  000001c0  2**3\r\n                  CONTENTS, ALLOC, LOAD, RELOC, DATA\r\n  6 .rdata$zzz    00000020  0000000000000000  0000000000000000  000001c8  2**4\r\n                  CONTENTS, ALLOC, LOAD, READONLY, DATA\r\n\r\n```\r\nGo:\r\n\r\n```\r\n$ objdump -h tmpo/go.o\r\nSections:\r\nIdx Name          Size      VMA               LMA               File off  Algn\r\n  0 .text         000c1200  0000000000001000  0000000000001000  00000600  2**5\r\n                  CONTENTS, ALLOC, LOAD, RELOC, READONLY, CODE, DATA\r\n  1 .data         00001200  00000000000c3000  00000000000c3000  000c1800  2**5\r\n                  CONTENTS, ALLOC, LOAD, RELOC, DATA\r\n  2 .bss          0001f4c0  00000000000c5000  00000000000c5000  00000000  2**5\r\n                  ALLOC\r\n  3 .ctors        00000200  00000000000e5000  00000000000e5000  000c2a00  2**2\r\n                  CONTENTS, ALLOC, LOAD, READONLY, DATA\r\n```\r\n",
	"user": {
		"login": "nadiasvertex",
		"id": 2034108,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2015-12-13T13:23:47Z",
	"updated_at": "2015-12-13T13:23:47Z"
}
