{
	"id": 171785828,
	"number": 16780,
	"state": "closed",
	"title": "cmd/go: TestCgoConsistentResults fails on s390x with gcc 6",
	"body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n1. What version of Go are you using (`go version`)?\r\n\r\ngo version devel +17eee31 Wed Aug 17 23:28:20 2016 +0000 linux/s390x\r\n\r\nbut it happens with 1.7 too (see https://launchpadlibrarian.net/279519590/buildlog_ubuntu-yakkety-s390x.golang-1.7_1.7-2ubuntu1_BUILDING.txt.gz)\r\n\r\n2. What operating system and processor architecture are you using (`go env`)?\r\n\r\nUbuntu 16.10, s390x\r\n\r\n3. What did you do?\r\n\r\ngo test cmd/go -run TestCgoConsistentResults\r\n\r\n4. What did you expect to see?\r\n\r\nok      cmd/go  2.538s\r\n\r\n5. What did you see instead?\r\n\r\n```\r\n--- FAIL: TestCgoConsistentResults (0.66s)\r\n        go_test.go:244: running testgo [build -o /tmp/gotest566723264/cgotest1 cgotest]\r\n        go_test.go:244: running testgo [build -x -o /tmp/gotest566723264/cgotest2 cgotest]\r\n        go_test.go:263: standard error:\r\n        go_test.go:264: WORK=/tmp/go-build196067513\r\n                mkdir -p $WORK/cgotest/_obj/\r\n                mkdir -p $WORK/\r\n                cd /home/mwh/go/src/cmd/go/testdata/src/cgotest\r\n                CGO_LDFLAGS=\"-g\" \"-O2\" /home/mwh/go/pkg/tool/linux_s390x/cgo -objdir $WORK/cgotest/_obj/ -importpath cgotest -- -I $WORK/cgotest/_obj/ m.go\r\n                cd $WORK\r\n                gcc -fdebug-prefix-map=a=b -c trivial.c\r\n                gcc -gno-record-gcc-switches -c trivial.c\r\n                cd /home/mwh/go/src/cmd/go/testdata/src/cgotest\r\n                gcc -I . -fPIC -m64 -march=z196 -pthread -fmessage-length=0 -fdebug-prefix-map=$WORK=/tmp/go-build -gno-record-gcc-switches -I $WORK/cgotest/_obj/ -g -O2 -o $WORK/cgotest/_obj/_cgo_main.o -c $WORK/cgotest/_obj/_cgo_main.c\r\n                gcc -I . -fPIC -m64 -march=z196 -pthread -fmessage-length=0 -fdebug-prefix-map=$WORK=/tmp/go-build -gno-record-gcc-switches -I $WORK/cgotest/_obj/ -g -O2 -o $WORK/cgotest/_obj/_cgo_export.o -c $WORK/cgotest/_obj/_cgo_export.c\r\n                gcc -I . -fPIC -m64 -march=z196 -pthread -fmessage-length=0 -fdebug-prefix-map=$WORK=/tmp/go-build -gno-record-gcc-switches -I $WORK/cgotest/_obj/ -g -O2 -o $WORK/cgotest/_obj/m.cgo2.o -c $WORK/cgotest/_obj/m.cgo2.c\r\n                gcc -I . -fPIC -m64 -march=z196 -pthread -fmessage-length=0 -fdebug-prefix-map=$WORK=/tmp/go-build -gno-record-gcc-switches -o $WORK/cgotest/_obj/_cgo_.o $WORK/cgotest/_obj/_cgo_main.o $WORK/cgotest/_obj/_cgo_export.o $WORK/cgotest/_obj/m.cgo2.o -g -O2\r\n                /home/mwh/go/pkg/tool/linux_s390x/cgo -objdir $WORK/cgotest/_obj/ -dynpackage cgotest -dynimport $WORK/cgotest/_obj/_cgo_.o -dynout $WORK/cgotest/_obj/_cgo_import.go\r\n                cd $WORK\r\n                gcc -no-pie -c trivial.c\r\n                cd /home/mwh/go/src/cmd/go/testdata/src/cgotest\r\n                gcc -I . -fPIC -m64 -march=z196 -pthread -fmessage-length=0 -fdebug-prefix-map=$WORK=/tmp/go-build -gno-record-gcc-switches -o $WORK/cgotest/_obj/_all.o $WORK/cgotest/_obj/_cgo_export.o $WORK/cgotest/_obj/m.cgo2.o -g -O2 -Wl,-r -nostdlib -no-pie -Wl,--build-id=none\r\n                /home/mwh/go/pkg/tool/linux_s390x/compile -o $WORK/cgotest.a -trimpath $WORK -p cgotest -buildid 48821ae85cbf574dd21896d65f343fccedd4a562 -D _/home/mwh/go/src/cmd/go/testdata/src/cgotest -I $WORK -pack $WORK/cgotest/_obj/_cgo_gotypes.go $WORK/cgotest/_obj/m.cgo1.go $WORK/cgotest/_obj/_cgo_import.go\r\n                pack r $WORK/cgotest.a $WORK/cgotest/_obj/_all.o # internal\r\n                mkdir -p /tmp/gotest566723264/\r\n                mv $WORK/cgotest.a /tmp/gotest566723264/cgotest2\r\n\r\n        go_test.go:2819: building cgotest twice did not produce the same output\r\nFAIL\r\nFAIL    cmd/go  2.574s\r\n```\r\n\r\nIt passes if I set CC=gcc-5.",
	"user": {
		"login": "mwhudson",
		"id": 672022,
		"type": "User",
		"site_admin": false
	},
	"comments": 6,
	"closed_at": "2016-08-23T23:44:36Z",
	"created_at": "2016-08-17T23:39:56Z",
	"updated_at": "2016-08-23T23:44:37Z"
}
