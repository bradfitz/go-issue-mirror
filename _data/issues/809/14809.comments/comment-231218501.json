{
	"id": 231218501,
	"body": "i've been able to consistently reproduce this.\r\n\r\ncompiled/testing from current master (e5ff529)\r\n\r\ngo env\r\n```\r\nGOARCH=\"amd64\"\r\nGOBIN=\"\"\r\nGOEXE=\"\"\r\nGOHOSTARCH=\"amd64\"\r\nGOHOSTOS=\"darwin\"\r\nGOOS=\"darwin\"\r\nGOPATH=\"/go/tip/src\"\r\nGORACE=\"\"\r\nGOROOT=\"/go/tip\"\r\nGOTOOLDIR=\"/go/tip/pkg/tool/darwin_amd64\"\r\nGO15VENDOREXPERIMENT=\"1\"\r\nCC=\"clang\"\r\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fno-caret-diagnostics -Qunused-arguments -fmessage-length=0 -fno-common\"\r\nCXX=\"clang++\"\r\nCGO_ENABLED=\"1\"\r\n```\r\n\r\nsteps taken\r\n```\r\ncd $GOROOT/src/runtime\r\ngo test -c runtime\r\n./runtime.test -test.v -test.run TestCgoExternalThreadSignal -test.count 10000\r\n```\r\n\r\nthe hang happens every few hundred to few thousand iterations, leading to the following output:\r\n\r\n```\r\n--- FAIL: TestCgoExternalThreadSignal (60.02s)\r\n\tcrash_test.go:105: testprogcgo CgoExternalThreadSignal exit status: exit status 2\r\n\tcrash_cgo_test.go:116: expected \"OK\\n\", but got:\r\n\t\tSIGQUIT: quit\r\n\t\tPC=0x4074f7e m=0\r\n\t\t\r\n\t\tgoroutine 1 [syscall]:\r\n\t\tsyscall.Syscall6(0xad, 0x1, 0x103da, 0xc42009a000, 0x24, 0x0, 0x0, 0x40c4ea0, 0xc420051bb0, 0x4037a5e)\r\n\t\t\t/go/tip/src/syscall/asm_darwin_amd64.s:41 +0x5 fp=0xc420051b28 sp=0xc420051b20\r\n\t\tos.(*Process).blockUntilWaitable(0xc420074300, 0x40ea4b8, 0xc420092000, 0xc42007e120)\r\n\t\t\t/go/tip/src/os/wait_waitid.go:28 +0xbc fp=0xc420051bc0 sp=0xc420051b28\r\n\t\tos.(*Process).wait(0xc420074300, 0x0, 0x40164ee, 0xc420080040)\r\n\t\t\t/go/tip/src/os/exec_unix.go:22 +0xab fp=0xc420051c50 sp=0xc420051bc0\r\n\t\tos.(*Process).Wait(0xc420074300, 0xc420051cb8, 0x0, 0x0)\r\n\t\t\t/go/tip/src/os/doc.go:49 +0x2b fp=0xc420051c80 sp=0xc420051c50\r\n\t\tos/exec.(*Cmd).Wait(0xc420092000, 0x0, 0x0)\r\n\t\t\t/go/tip/src/os/exec/exec.go:434 +0x6d fp=0xc420051d10 sp=0xc420051c80\r\n\t\tos/exec.(*Cmd).Run(0xc420092000, 0xc420094000, 0x3)\r\n\t\t\t/go/tip/src/os/exec/exec.go:279 +0x48 fp=0xc420051d38 sp=0xc420051d10\r\n\t\tos/exec.(*Cmd).CombinedOutput(0xc420092000, 0x52, 0xc420051e50, 0x2, 0x2, 0xc420092000)\r\n\t\t\t/go/tip/src/os/exec/exec.go:494 +0x13b fp=0xc420051d78 sp=0xc420051d38\r\n\t\tmain.CgoExternalThreadSignal()\r\n\t\t\t/go/tip/src/runtime/testdata/testprogcgo/threadprof.go:85 +0xe3 fp=0xc420051ea0 sp=0xc420051d78\r\n\t\tmain.main()\r\n\t\t\t/go/tip/src/runtime/testdata/testprogcgo/main.go:34 +0x1f1 fp=0xc420051f48 sp=0xc420051ea0\r\n\t\truntime.main()\r\n\t\t\t/go/tip/src/runtime/proc.go:183 +0x1f4 fp=0xc420051fa0 sp=0xc420051f48\r\n\t\truntime.goexit()\r\n\t\t\t/go/tip/src/runtime/asm_amd64.s:2086 +0x1 fp=0xc420051fa8 sp=0xc420051fa0\r\n\t\t\r\n\t\tgoroutine 17 [syscall, locked to thread]:\r\n\t\truntime.goexit()\r\n\t\t\t/go/tip/src/runtime/asm_amd64.s:2086 +0x1\r\n\t\t\r\n\t\tgoroutine 19 [syscall]:\r\n\t\tos/signal.signal_recv(0x0)\r\n\t\t\t/go/tip/src/runtime/sigqueue.go:116 +0x157\r\n\t\tos/signal.loop()\r\n\t\t\t/go/tip/src/os/signal/signal_unix.go:22 +0x22\r\n\t\tcreated by os/signal.init.1\r\n\t\t\t/go/tip/src/os/signal/signal_unix.go:28 +0x41\r\n\t\t\r\n\t\tgoroutine 20 [syscall]:\r\n\t\tsyscall.Syscall(0x3, 0x4, 0xc4200b0aa2, 0x135e, 0x38, 0x0, 0x0)\r\n\t\t\t/go/tip/src/syscall/asm_darwin_amd64.s:16 +0x5\r\n\t\tsyscall.read(0x4, 0xc4200b0aa2, 0x135e, 0x135e, 0x38, 0x0, 0x0)\r\n\t\t\t/go/tip/src/syscall/zsyscall_darwin_amd64.go:973 +0x55\r\n\t\tsyscall.Read(0x4, 0xc4200b0aa2, 0x135e, 0x135e, 0x38, 0x0, 0x0)\r\n\t\t\t/go/tip/src/syscall/syscall_unix.go:161 +0x49\r\n\t\tos.(*File).read(0xc420080028, 0xc4200b0aa2, 0x135e, 0x135e, 0x38, 0x0, 0x0)\r\n\t\t\t/go/tip/src/os/file_unix.go:228 +0x6a\r\n\t\tos.(*File).Read(0xc420080028, 0xc4200b0aa2, 0x135e, 0x135e, 0x38, 0x0, 0x0)\r\n\t\t\t/go/tip/src/os/file.go:101 +0x59\r\n\t\tbytes.(*Buffer).ReadFrom(0xc420094000, 0x4145300, 0xc420080028, 0xc420021688, 0x1, 0x0)\r\n\t\t\t/go/tip/src/bytes/buffer.go:176 +0x155\r\n\t\tio.copyBuffer(0x4145240, 0xc420094000, 0x4145300, 0xc420080028, 0x0, 0x0, 0x0, 0x0, 0x0, 0x0)\r\n\t\t\t/go/tip/src/io/io.go:384 +0x324\r\n\t\tio.Copy(0x4145240, 0xc420094000, 0x4145300, 0xc420080028, 0x0, 0x0, 0x0)\r\n\t\t\t/go/tip/src/io/io.go:360 +0x68\r\n\t\tos/exec.(*Cmd).writerDescriptor.func1(0x0, 0x0)\r\n\t\t\t/go/tip/src/os/exec/exec.go:253 +0x4d\r\n\t\tos/exec.(*Cmd).Start.func1(0xc420092000, 0xc42007e120)\r\n\t\t\t/go/tip/src/os/exec/exec.go:370 +0x27\r\n\t\tcreated by os/exec.(*Cmd).Start\r\n\t\t\t/go/tip/src/os/exec/exec.go:371 +0x4db\r\n\t\t\r\n\t\trax    0x20000ad\r\n\t\trbx    0xc42001950c\r\n\t\trcx    0xc420051b20\r\n\t\trdx    0xc42009a000\r\n\t\trdi    0x1\r\n\t\trsi    0x103da\r\n\t\trbp    0xc420051bb0\r\n\t\trsp    0xc420051b20\r\n\t\tr8     0x0\r\n\t\tr9     0x0\r\n\t\tr10    0x24\r\n\t\tr11    0x202\r\n\t\tr12    0x40\r\n\t\tr13    0xf3\r\n\t\tr14    0x30\r\n\t\tr15    0x3\r\n\t\trip    0x4074f7e\r\n\t\trflags 0x202\r\n\t\tcs     0x7\r\n\t\tfs     0x0\r\n\t\tgs     0x0\r\n```\r\n\r\ni also captured several hangs with `GODEBUG=gctrace=1,schedtrace=100,scheddetail=1` set. they're pretty noisy but i can upload one of them somewhere if that would be useful.\r\n\r\nlastly, there is an instance of a `testprogcgo.exe CgoExternalThreadSignal crash` process for every hang. if i ctrl-c the main test process, these processes are cleaned up. if i let it finish on its own, they stay alive.\r\n",
	"user": {
		"login": "jaredborner",
		"id": 1760991,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2016-07-07T21:52:13Z",
	"updated_at": "2016-07-07T21:52:13Z"
}
