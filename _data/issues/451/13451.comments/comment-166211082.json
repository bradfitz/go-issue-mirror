{
	"id": 166211082,
	"body": "I test the server with one and multiple clients.\r\n\r\nThe benchmark is:\r\n\r\n|ID| OS | API | CPU | MEM | BW | GC | C | CCPU |\r\n|-----| ----- |----- |----- |----- |----- |----- | -----|-----|\r\n|1|Linux|Write|100%|8M|12810Mbps|0|1|78.5%|\r\n|2|Linux|Writev|100.3%|7M|11519Mbps|0|1|105.3%|\r\n|3|Linux|Write|800.1%|546M|77379Mbps|976Âµs|1000|799.9%|\r\n|4|Linux|Writev|789.7%|39M|78261Mbps|2.19ms|1000|723.7%|\r\n|5|Linux|Write|804.3%|1.1G|58926Mbps|3.63ms|2000|798.0%|\r\n|6|Linux|Writev|790.1%|68M|77904Mbps|4.07ms|2000|674.5%|\r\n|7|Linux|Write|1246.2%|1.6G|58800Mbps|3.15ms|3000|800.6%|\r\n|8|Linux|Writev|802.6%|73M|78083Mbps|2.84ms|3000|704.9%|\r\n|9|Linux|Write|597.8%|2.1G|63852Mbps|6.5ms|4000|599.8%|\r\n|10|Linux|Writev|593.3%|89M|68355Mbps|6.4ms|4000|510.1%|\r\n|11|Linux|Write|601.3%|2.6G|73028Mbps|1.06s|5000|542.6%|\r\n|12|Linux|Writev|591.8%|114M|71373Mbps|6.5ms|5000|525.2%|\r\n|13|Linux|Write|590.3%|3.1G|72853Mbps|8.04ms|6000|533.7%|\r\n|14|Linux|Writev|598.6%|142M|82191Mbps|13ms|6000|542.5%|\r\n|15|Linux|Write|599.8%|3.7G|71342Mbps|9.49ms|7000|547.4%|\r\n|16|Linux|Writev|592.7%|154M|67619Mbps|26ms|7000|515.9%|\r\n|17|Linux|Write|598.6%|5.2G|73846Mbps|7.02ms|10000|563.2%|\r\n|18|Linux|Writev|601.8%|267M|70770Mbps|22.5ms|10000|543.9%|\r\n\r\nRemark:\r\n\r\n* C: The number of goroutine for client.\r\n* CCPU: The cpu usage for clients.\r\n* BW: The bandwidth consumed for server and clients.\r\n* API: Use writev or write(+bufio) API.\r\n* ID1-8: Server use 8CPUs, client use 8CPUs.\r\n* ID9-18: Server use 6CPUs, client use 6CPUs.\r\n\r\nThe profile for server 1(write+bufio, serve 1 client)\r\n```\r\n134.45s of 135.18s total (99.46%)\r\nDropped 43 nodes (cum \u003c= 0.68s)\r\nShowing top 10 nodes out of 12 (cum \u003e= 105.85s)\r\n      flat  flat%   sum%        cum   cum%\r\n   105.15s 77.79% 77.79%    105.40s 77.97%  syscall.Syscall\r\n    15.56s 11.51% 89.30%     15.56s 11.51%  runtime.memmove\r\n    10.34s  7.65% 96.94%     25.90s 19.16%  bufio.(*Writer).Write\r\n     3.20s  2.37% 99.31%    135.01s 99.87%  main.srs_serve\r\n```\r\n\r\nThe profile for server 2(writev, serve 1 client):\r\n```\r\n280.57s of 281.62s total (99.63%)\r\nDropped 44 nodes (cum \u003c= 1.41s)\r\n      flat  flat%   sum%        cum   cum%\r\n   273.99s 97.29% 97.29%    274.39s 97.43%  syscall.Syscall\r\n     6.45s  2.29% 99.58%    281.38s 99.91%  net.(*netFD).Writev\r\n```\r\n\r\nThe profile for server 3(write+bufio, serve 1000 clients):\r\n```\r\n815.38s of 827.36s total (98.55%)\r\nDropped 189 nodes (cum \u003c= 4.14s)\r\nShowing top 10 nodes out of 12 (cum \u003e= 622.36s)\r\n      flat  flat%   sum%        cum   cum%\r\n   616.35s 74.50% 74.50%    618.03s 74.70%  syscall.Syscall\r\n    96.01s 11.60% 86.10%     96.01s 11.60%  runtime.memmove\r\n    57.75s  6.98% 93.08%    153.68s 18.57%  bufio.(*Writer).Write\r\n    43.87s  5.30% 98.38%    821.45s 99.29%  main.srs_serve\r\n```\r\n\r\nThe profile for server 4(writev, serve 1000 clients):\r\n```\r\n593.54s of 602.01s total (98.59%)\r\nDropped 167 nodes (cum \u003c= 3.01s)\r\n      flat  flat%   sum%        cum   cum%\r\n   577.70s 95.96% 95.96%    578.64s 96.12%  syscall.Syscall\r\n    15.54s  2.58% 98.54%    596.44s 99.07%  net.(*netFD).Writev\r\n```\r\n\r\nThe profile for server 5(write+bufio, serve 2000 clients):\r\n```\r\n855.32s of 870.39s total (98.27%)\r\nDropped 209 nodes (cum \u003c= 4.35s)\r\nShowing top 10 nodes out of 19 (cum \u003e= 5.93s)\r\n      flat  flat%   sum%        cum   cum%\r\n   637.77s 73.27% 73.27%    639.53s 73.48%  syscall.Syscall\r\n       91s 10.46% 83.73%        91s 10.46%  runtime.memmove\r\n    71.65s  8.23% 91.96%    854.65s 98.19%  main.srs_serve\r\n    46.23s  5.31% 97.27%    137.08s 15.75%  bufio.(*Writer).Write\r\n```\r\n\r\nThe profile for server 6(writev, serve 2000 clients):\r\n```\r\n739.71s of 751.98s total (98.37%)\r\nDropped 205 nodes (cum \u003c= 3.76s)\r\n      flat  flat%   sum%        cum   cum%\r\n   720.12s 95.76% 95.76%    721.32s 95.92%  syscall.Syscall\r\n    19.16s  2.55% 98.31%    743.46s 98.87%  net.(*netFD).Writev\r\n```\r\n\r\nThe profile for server 7(write+bufio, serve 3000 clients):\r\n```\r\n886.09s of 903.74s total (98.05%)\r\nDropped 236 nodes (cum \u003c= 4.52s)\r\nShowing top 10 nodes out of 22 (cum \u003e= 5.43s)\r\n      flat  flat%   sum%        cum   cum%\r\n   653.56s 72.32% 72.32%    655.35s 72.52%  syscall.Syscall\r\n    93.78s 10.38% 82.69%     93.78s 10.38%  runtime.memmove\r\n    85.32s  9.44% 92.13%    883.87s 97.80%  main.srs_serve\r\n    42.42s  4.69% 96.83%    136.19s 15.07%  bufio.(*Writer).Write\r\n```\r\n\r\nThe profile for server 8(writev, serve 3000 clients):\r\n```\r\n707.97s of 724.03s total (97.78%)\r\nDropped 230 nodes (cum \u003c= 3.62s)\r\n      flat  flat%   sum%        cum   cum%\r\n   687.89s 95.01% 95.01%    689.35s 95.21%  syscall.Syscall\r\n    19.54s  2.70% 97.71%    712.05s 98.35%  net.(*netFD).Writev\r\n```\r\n\r\nThe profile for server 9(write+bufio, serve 4000 clients):\r\n```\r\n903.63s of 922.03s total (98.00%)\r\nDropped 251 nodes (cum \u003c= 4.61s)\r\nShowing top 10 nodes out of 13 (cum \u003e= 673.46s)\r\n      flat  flat%   sum%        cum   cum%\r\n   671.39s 72.82% 72.82%    673.29s 73.02%  syscall.Syscall\r\n   109.78s 11.91% 84.72%    109.78s 11.91%  runtime.memmove\r\n    76.56s  8.30% 93.03%    186.19s 20.19%  bufio.(*Writer).Write\r\n    44.25s  4.80% 97.83%    911.20s 98.83%  main.srs_serve\r\n```\r\n\r\nThe profile for server 10(writev, serve 4000 clients):\r\n```\r\n443.05s of 452.06s total (98.01%)\r\nDropped 234 nodes (cum \u003c= 2.26s)\r\n      flat  flat%   sum%        cum   cum%\r\n   428.19s 94.72% 94.72%    429.08s 94.92%  syscall.Syscall\r\n    12.05s  2.67% 97.39%    443.26s 98.05%  net.(*netFD).Writev\r\n```\r\n\r\nThe profile for server 11(write+bufio, serve 5000 clients):\r\n```\r\n1052.65s of 1074.42s total (97.97%)\r\nDropped 267 nodes (cum \u003c= 5.37s)\r\nShowing top 10 nodes out of 13 (cum \u003e= 797.94s)\r\n      flat  flat%   sum%        cum   cum%\r\n   795.47s 74.04% 74.04%    797.67s 74.24%  syscall.Syscall\r\n   119.77s 11.15% 85.18%    119.77s 11.15%  runtime.memmove\r\n    82.31s  7.66% 92.85%    201.85s 18.79%  bufio.(*Writer).Write\r\n    53.42s  4.97% 97.82%   1061.58s 98.80%  main.srs_serve\r\n```\r\n\r\nThe profile for server 12(writev, serve 5000 clients):\r\n```\r\n520.34s of 530.21s total (98.14%)\r\nDropped 228 nodes (cum \u003c= 2.65s)\r\n      flat  flat%   sum%        cum   cum%\r\n   505.73s 95.38% 95.38%    506.76s 95.58%  syscall.Syscall\r\n    14.22s  2.68% 98.06%    523.51s 98.74%  net.(*netFD).Writev\r\n```\r\n\r\nThe profile for server 13(write+bufio, serve 6000 clients):\r\n```\r\n501.03s of 511.33s total (97.99%)\r\nDropped 240 nodes (cum \u003c= 2.56s)\r\nShowing top 10 nodes out of 12 (cum \u003e= 366.68s)\r\n      flat  flat%   sum%        cum   cum%\r\n   365.52s 71.48% 71.48%    366.60s 71.70%  syscall.Syscall\r\n    69.87s 13.66% 85.15%     69.87s 13.66%  runtime.memmove\r\n    45.21s  8.84% 93.99%    114.96s 22.48%  bufio.(*Writer).Write\r\n    19.65s  3.84% 97.83%    506.76s 99.11%  main.srs_serve\r\n```\r\n\r\nThe profile for server 14(writev, serve 6000 clients):\r\n```\r\n430.34s of 439.27s total (97.97%)\r\nDropped 224 nodes (cum \u003c= 2.20s)\r\n      flat  flat%   sum%        cum   cum%\r\n   418.56s 95.29% 95.29%    419.27s 95.45%  syscall.Syscall\r\n    11.43s  2.60% 97.89%    433.08s 98.59%  net.(*netFD).Writev\r\n```\r\n\r\nThe profile for server 15(write+bufio, serve 7000 clients):\r\n```\r\n359.48s of 367.11s total (97.92%)\r\nDropped 251 nodes (cum \u003c= 1.84s)\r\nShowing top 10 nodes out of 12 (cum \u003e= 267.14s)\r\n      flat  flat%   sum%        cum   cum%\r\n   264.35s 72.01% 72.01%    265.22s 72.25%  syscall.Syscall\r\n    47.81s 13.02% 85.03%     47.81s 13.02%  runtime.memmove\r\n    32.32s  8.80% 93.84%     80.04s 21.80%  bufio.(*Writer).Write\r\n    14.45s  3.94% 97.77%    363.58s 99.04%  main.srs_serve\r\n```\r\n\r\nThe profile for server 16(writev, serve 7000 clients):\r\n```\r\n594.12s of 607.03s total (97.87%)\r\nDropped 243 nodes (cum \u003c= 3.04s)\r\n      flat  flat%   sum%        cum   cum%\r\n   578.62s 95.32% 95.32%    579.63s 95.49%  syscall.Syscall\r\n    15.23s  2.51% 97.83%    598.22s 98.55%  net.(*netFD).Writev\r\n```\r\n\r\nThe profile for server 17(write+bufio, serve 10000 clients):\r\n```\r\n459.34s of 471.92s total (97.33%)\r\nDropped 270 nodes (cum \u003c= 2.36s)\r\nShowing top 10 nodes out of 13 (cum \u003e= 337.13s)\r\n      flat  flat%   sum%        cum   cum%\r\n   332.91s 70.54% 70.54%    334.19s 70.81%  syscall.Syscall\r\n    58.92s 12.49% 83.03%     58.92s 12.49%  runtime.memmove\r\n    38.67s  8.19% 91.22%     97.49s 20.66%  bufio.(*Writer).Write\r\n    27.79s  5.89% 97.11%    464.45s 98.42%  main.srs_serve\r\n```\r\n\r\nThe profile for server 18(writev, serve 10000 clients):\r\n```\r\n474.04s of 484.01s total (97.94%)\r\nDropped 256 nodes (cum \u003c= 2.42s)\r\n      flat  flat%   sum%        cum   cum%\r\n   460.48s 95.14% 95.14%    461.33s 95.31%  syscall.Syscall\r\n    12.98s  2.68% 97.82%    477.22s 98.60%  net.(*netFD).Writev\r\n```\r\n\r\nIn a word, the write(+bufio) can serve the same bandwidth and clients as writev, but write(+bufio) use nb_clients times memory than writev.\r\n",
	"user": {
		"login": "winlinvip",
		"id": 2777660,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2015-12-21T06:00:10Z",
	"updated_at": "2015-12-21T06:02:44Z"
}
