{
	"id": 159741853,
	"number": 16037,
	"state": "closed",
	"title": "cmd/compile: internal compiler error: methods are too far away",
	"body": "Using `go1.7beta1`\r\n\r\nConsider this generator code:\r\n```go\r\npackage main\r\n\r\nimport (\r\n\t\"fmt\"\r\n\t\"html/template\"\r\n\t\"os\"\r\n)\r\n\r\nvar tmpl = template.Must(template.New(\"main\").Parse(`\r\npackage main\r\n\r\ntype T struct {\r\n{{range .Names}}\r\n\t{{.Name}} *string\r\n{{end}}\r\n}\r\n\r\n{{range .Names}}\r\nfunc (t *T) Get{{.Name}}() string {\r\n\tif t.{{.Name}} == nil {\r\n\t\treturn \"\"\r\n\t}\r\n\treturn *t.{{.Name}}\r\n}\r\n{{end}}\r\n\r\nfunc main() {}\r\n`))\r\n\r\nfunc main() {\r\n\tconst n = 5000\r\n\r\n\ttype Name struct{ Name string }\r\n\tvar t struct{ Names []Name }\r\n\tfor i := 0; i \u003c n; i++ {\r\n\t\tt.Names = append(t.Names, Name{Name: fmt.Sprintf(\"H%06X\", i)})\r\n\t}\r\n\ttmpl.Execute(os.Stdout, t)\r\n}\r\n```\r\n\r\nThis program produces a giant struct with *n* fields, and *n* accessor methods to get at those fields and is similar to whats generated by large protobuf files.\r\n\r\nCompiling the program produced by this generator crashes the compiler:\r\n```\r\n$ go run gen.go \u003e main.go\r\n$ go run main.go\r\n# command-line-arguments\r\nmain.go:45011: internal compiler error: methods are too far away on T: 120008\r\n\r\ngoroutine 1 [running]:\r\nruntime/debug.Stack(0x0, 0x0, 0x0)\r\n\t/go/src/runtime/debug/stack.go:24 +0x79\r\ncmd/compile/internal/gc.Fatalf(0x4fffff, 0x22, 0xc420c6b340, 0x2, 0x2)\r\n\t/go/src/cmd/compile/internal/gc/subr.go:165 +0x248\r\ncmd/compile/internal/gc.dextratype(0xc420e693b0, 0x54, 0xc420c40af0, 0x1d4c8, 0x50)\r\n\t/go/src/cmd/compile/internal/gc/reflect.go:613 +0x2db\r\ncmd/compile/internal/gc.dtypesym(0xc420c40af0, 0xc420c40af0)\r\n\t/go/src/cmd/compile/internal/gc/reflect.go:1305 +0x103b\r\ncmd/compile/internal/gc.dtypesym(0xc420c40c30, 0xc420c6ba20)\r\n\t/go/src/cmd/compile/internal/gc/reflect.go:1278 +0xd37\r\ncmd/compile/internal/gc.dumptypestructs()\r\n\t/go/src/cmd/compile/internal/gc/reflect.go:1363 +0xcc\r\ncmd/compile/internal/gc.dumpobj1(0x7fff5fbff451, 0x5b, 0x3)\r\n\t/go/src/cmd/compile/internal/gc/obj.go:133 +0x553\r\ncmd/compile/internal/gc.dumpobj()\r\n\t/go/src/cmd/compile/internal/gc/obj.go:45 +0x52\r\ncmd/compile/internal/gc.Main()\r\n\t/go/src/cmd/compile/internal/gc/main.go:488 +0x1a5d\r\ncmd/compile/internal/amd64.Main()\r\n\t/go/src/cmd/compile/internal/amd64/galign.go:93 +0x2fa\r\nmain.main()\r\n\t/go/src/cmd/compile/main.go:33 +0x2a3\r\n```\r\n\r\nThis did not fail with the `Go1.6` compiler.\r\n\r\n/cc @crawshaw @griesemer @ianlancetaylor @randall77 ",
	"user": {
		"login": "dsnet",
		"id": 6354026,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "NeedsFix"
		}
	],
	"assignee": {
		"login": "crawshaw",
		"id": 161319,
		"type": "User",
		"site_admin": false
	},
	"comments": 4,
	"closed_at": "2016-06-14T15:33:13Z",
	"created_at": "2016-06-10T23:30:59Z",
	"updated_at": "2016-06-14T15:33:13Z",
	"milestone": {
		"id": 1414133,
		"number": 31,
		"title": "Go1.7"
	}
}
