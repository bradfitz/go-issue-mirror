{
	"id": 184753347,
	"number": 17561,
	"state": "open",
	"title": "x/tools/present: runtime error: index out of range",
	"body": "Please answer these questions before submitting your issue. Thanks!\r\n\r\n### What version of Go are you using (`go version`)?\r\n\r\ngo version go1.7 linux/amd64\r\n\r\n### What operating system and processor architecture are you using (`go env`)?\r\n\r\nGOARCH=\"amd64\"\r\nGOBIN=\"\"\r\nGOEXE=\"\"\r\nGOHOSTARCH=\"amd64\"\r\nGOHOSTOS=\"linux\"\r\nGOOS=\"linux\"\r\nGOPATH=\"/home/i4k/.gvm/pkgsets/go1.7/global\"\r\nGORACE=\"\"\r\nGOROOT=\"/home/i4k/.gvm/gos/go1.7\"\r\nGOTOOLDIR=\"/home/i4k/.gvm/gos/go1.7/pkg/tool/linux_amd64\"\r\nCC=\"gcc\"\r\nGOGCCFLAGS=\"-fPIC -m64 -pthread -fmessage-length=0 -fdebug-prefix-map=/tmp/go-build934553730=/tmp/go-build -gno-record-gcc-switches\"\r\nCXX=\"g++\"\r\nCGO_ENABLED=\"1\"\r\n\r\n### What did you do?\r\n\r\nI ran:\r\n```\r\npresent -notes -play -orighost localhost\r\n```\r\n\r\nWith an invalid .link/.iframe/.image/.background line like below:\r\n\r\n```\r\n.link\r\n```\r\n### What did you expect to see?\r\n\r\nAn error in the browser, like below:\r\nnash.slide:290: syntax error for .link invocation\r\n\r\nOthers invocations like .play/.code works as expected.\r\n\r\nI had to dig into the stack trace to figure out the problem was with an invalid link to then find the wrong syntax in the presentation.\r\n\r\n### What did you see instead?\r\nThe server closes the connection without sending any data (ERR_EMPTY_RESPONSE on chrome).\r\n\r\nAnd the server panics with:\r\n```\r\nÎ»\u003e present -notes -play -orighost localhost\r\n2016/10/24 03:11:18 Open your web browser and visit http://localhost:3999\r\n2016/10/24 03:11:18 Notes are enabled, press 'N' from the browser to display them.\r\n2016/10/24 03:11:24 http: panic serving 127.0.0.1:43080: runtime error: index out of range\r\ngoroutine 40 [running]:\r\nnet/http.(*conn).serve.func1(0xc420132f80)\r\n\t/home/i4k/.gvm/gos/go1.7/src/net/http/server.go:1491 +0x13d\r\npanic(0x77d3e0, 0xc420014130)\r\n\t/home/i4k/.gvm/gos/go1.7/src/runtime/panic.go:458 +0x243\r\ngolang.org/x/tools/present.parseLink(0xc42012e348, 0xc420127ac0, 0xa, 0x122, 0xc420127d28, 0x5, 0x3, 0x8, 0x15d, 0x0)\r\n\t/home/i4k/.gvm/pkgsets/go1.7/global/src/golang.org/x/tools/present/link.go:27 +0x305\r\ngolang.org/x/tools/present.parseSections(0xc42012e348, 0xc420127ac0, 0xa, 0xc4201fc160, 0xc420249a08, 0x0, 0x0, 0xc420131960, 0xc42002a800, 0x7f047221f960, ...)\r\n\t/home/i4k/.gvm/pkgsets/go1.7/global/src/golang.org/x/tools/present/parse.go:373 +0xf65\r\ngolang.org/x/tools/present.(*Context).Parse(0xc42012e348, 0x9fdd00, 0xc42012e340, 0xc420127ac0, 0xa, 0x0, 0xc420034ae8, 0x401f53, 0xc420034ae0)\r\n\t/home/i4k/.gvm/pkgsets/go1.7/global/src/golang.org/x/tools/present/parse.go:278 +0x3b8\r\ngolang.org/x/tools/present.Parse(0x9fdd00, 0xc42012e340, 0xc420127ac0, 0xa, 0x0, 0xd, 0x9fdb40, 0xa)\r\n\t/home/i4k/.gvm/pkgsets/go1.7/global/src/golang.org/x/tools/present/parse.go:288 +0x8f\r\nmain.parse(0xc420127ac0, 0xa, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/i4k/.gvm/pkgsets/go1.7/global/src/golang.org/x/tools/cmd/present/dir.go:120 +0xee\r\nmain.renderDoc(0x9fdb40, 0xc420139860, 0xc420127ac0, 0xa, 0xc420139860, 0xc420127a40)\r\n\t/home/i4k/.gvm/pkgsets/go1.7/global/src/golang.org/x/tools/cmd/present/dir.go:102 +0x42\r\nmain.dirHandler(0xa02b80, 0xc420139860, 0xc4201f4000)\r\n\t/home/i4k/.gvm/pkgsets/go1.7/global/src/golang.org/x/tools/cmd/present/dir.go:33 +0x133\r\nnet/http.HandlerFunc.ServeHTTP(0x88ad28, 0xa02b80, 0xc420139860, 0xc4201f4000)\r\n\t/home/i4k/.gvm/gos/go1.7/src/net/http/server.go:1731 +0x44\r\nnet/http.(*ServeMux).ServeHTTP(0xa23c60, 0xa02b80, 0xc420139860, 0xc4201f4000)\r\n\t/home/i4k/.gvm/gos/go1.7/src/net/http/server.go:2027 +0x7f\r\nnet/http.serverHandler.ServeHTTP(0xc420132f00, 0xa02b80, 0xc420139860, 0xc4201f4000)\r\n\t/home/i4k/.gvm/gos/go1.7/src/net/http/server.go:2207 +0x7d\r\nnet/http.(*conn).serve(0xc420132f80, 0xa03300, 0xc42018eec0)\r\n\t/home/i4k/.gvm/gos/go1.7/src/net/http/server.go:1584 +0x4b7\r\ncreated by net/http.(*Server).Serve\r\n\t/home/i4k/.gvm/gos/go1.7/src/net/http/server.go:2298 +0x44d\r\nGot 2188 bytes\r\nErr: runtime error: index out of range\r\n2016/10/24 03:11:24 http: panic serving 127.0.0.1:43084: runtime error: index out of range\r\ngoroutine 41 [running]:\r\nnet/http.(*conn).serve.func1(0xc420133f80)\r\n\t/home/i4k/.gvm/gos/go1.7/src/net/http/server.go:1491 +0x13d\r\npanic(0x77d3e0, 0xc420014130)\r\n\t/home/i4k/.gvm/gos/go1.7/src/runtime/panic.go:458 +0x243\r\ngolang.org/x/tools/present.parseLink(0xc420028168, 0xc420014b40, 0xa, 0x122, 0xc420014da8, 0x5, 0x3, 0x8, 0x15d, 0x0)\r\n\t/home/i4k/.gvm/pkgsets/go1.7/global/src/golang.org/x/tools/present/link.go:27 +0x305\r\ngolang.org/x/tools/present.parseSections(0xc420028168, 0xc420014b40, 0xa, 0xc420013460, 0xc420245a08, 0x0, 0x0, 0xc420012c60, 0xc42002a800, 0x7f047221f000, ...)\r\n\t/home/i4k/.gvm/pkgsets/go1.7/global/src/golang.org/x/tools/present/parse.go:373 +0xf65\r\ngolang.org/x/tools/present.(*Context).Parse(0xc420028168, 0x9fdd00, 0xc420028160, 0xc420014b40, 0xa, 0x0, 0xc420034ae8, 0x401f53, 0xc420034ae0)\r\n\t/home/i4k/.gvm/pkgsets/go1.7/global/src/golang.org/x/tools/present/parse.go:278 +0x3b8\r\ngolang.org/x/tools/present.Parse(0x9fdd00, 0xc420028160, 0xc420014b40, 0xa, 0x0, 0xd, 0x9fdb40, 0xa)\r\n\t/home/i4k/.gvm/pkgsets/go1.7/global/src/golang.org/x/tools/present/parse.go:288 +0x8f\r\nmain.parse(0xc420014b40, 0xa, 0x0, 0x0, 0x0, 0x0)\r\n\t/home/i4k/.gvm/pkgsets/go1.7/global/src/golang.org/x/tools/cmd/present/dir.go:120 +0xee\r\nmain.renderDoc(0x9fdb40, 0xc42031a000, 0xc420014b40, 0xa, 0xc42031a000, 0xc420014ac0)\r\n\t/home/i4k/.gvm/pkgsets/go1.7/global/src/golang.org/x/tools/cmd/present/dir.go:102 +0x42\r\nmain.dirHandler(0xa02b80, 0xc42031a000, 0xc4201f40f0)\r\n\t/home/i4k/.gvm/pkgsets/go1.7/global/src/golang.org/x/tools/cmd/present/dir.go:33 +0x133\r\nnet/http.HandlerFunc.ServeHTTP(0x88ad28, 0xa02b80, 0xc42031a000, 0xc4201f40f0)\r\n\t/home/i4k/.gvm/gos/go1.7/src/net/http/server.go:1731 +0x44\r\nnet/http.(*ServeMux).ServeHTTP(0xa23c60, 0xa02b80, 0xc42031a000, 0xc4201f40f0)\r\n\t/home/i4k/.gvm/gos/go1.7/src/net/http/server.go:2027 +0x7f\r\nnet/http.serverHandler.ServeHTTP(0xc420132f00, 0xa02b80, 0xc42031a000, 0xc4201f40f0)\r\n\t/home/i4k/.gvm/gos/go1.7/src/net/http/server.go:2207 +0x7d\r\nnet/http.(*conn).serve(0xc420133f80, 0xa03300, 0xc420286b00)\r\n\t/home/i4k/.gvm/gos/go1.7/src/net/http/server.go:1584 +0x4b7\r\ncreated by net/http.(*Server).Serve\r\n\t/home/i4k/.gvm/gos/go1.7/src/net/http/server.go:2298 +0x44d\r\n```\r\n",
	"user": {
		"login": "tiago4orion",
		"id": 251478,
		"type": "User",
		"site_admin": false
	},
	"labels": [
		{
			"name": "NeedsFix"
		}
	],
	"comments": 0,
	"created_at": "2016-10-24T05:40:38Z",
	"updated_at": "2016-10-24T16:07:23Z",
	"milestone": {
		"id": 1067491,
		"number": 22,
		"title": "Unreleased"
	}
}
