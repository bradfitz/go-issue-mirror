{
	"id": 66059184,
	"body": "\u003ca id=\"c7\"\u003e\u003c/a\u003eComment 7:\n\n\u003cpre\u003eI am running out of ideas. :-)\n\nThe problem here is not the amount of memory you have in your computer, but free block\nof address space available in your process. Go memory manager is designed to use 1 big\nblock of address space (see that request for 805306368 bytes). It asks OS to reserve\nsingle contiguous block of addresses for future use. No real memory is associated with\nthese addresses at the start, but will get assigned as addresses are used by the\nprogram. The problem here is that OS refuses to allocate this 805306368 bytes block. I\ndon't know why. Perhaps, there is no contiguous block of such size at the time, because\nmemory is used by other parts of your process (dlls and such).\n\nWhat I would do next is put a bug in mem.c: replace line with\n\"runtimeÂ·throw(\"VirtualAlloc\");\" with \"*(int32*)0 = 0;\". This will raise an exception\nat the right moment in your program. If you run it under debugger (I use\n\u003ca href=\"http://www.ollydbg.de/)\"\u003ehttp://www.ollydbg.de/)\u003c/a\u003e, you should be able to see memory map of your process, this will\ngive you a clue if there is free block of addresses or not and why. Here is my run:\n\nSysReserve: v=0xa00000 n=805306368\nSysReserve: hint failed with errno=487\nSysReserve: accepting any address worked v=0xd30000\n\nhere is my map:\n\nMemory map\nAddress   Size      Owner            Section    Contains                 Type  Access  \nInitial \u003eMapped as\n00010000  00001000 \u003e                \u003e           Environment              Priv \u003eRW      \nRW\n00020000  00001000 \u003e                \u003e           Process Parameters       Priv \u003eRW      \nRW\n0005F000  00001000 \u003e                \u003e                                    Priv \u003eRW \nGuar\u003eRW  Guar\u003e\n00060000  00010000 \u003e                \u003e           Stack of main thread     Priv \u003eRW      \nRW\n00070000  00006000 \u003e                \u003e                                    Priv \u003eRW      \nRW\n00170000  00003000 \u003e                \u003e                                    Map  \u003eRW      \nRW\n00180000  00016000 \u003e                \u003e                                    Map  \u003eR       \nR        C:\\WINNT\\system32\\unicode.nls\n001A0000  0002F000 \u003e                \u003e                                    Map  \u003eR       \nR        C:\\WINNT\\system32\\locale.nls\n001D0000  00041000 \u003e                \u003e                                    Map  \u003eR       \nR        C:\\WINNT\\system32\\sortkey.nls\n00220000  00004000 \u003e                \u003e                                    Map  \u003eR       \nR        C:\\WINNT\\system32\\sorttbls.nls\n00230000  00008000 \u003e                \u003e                                    Map  \u003eR E     \nR E\n002F0000  00002000 \u003e                \u003e                                    Map  \u003eR E     \nR E\n00300000  00043000 \u003e                \u003e           GDI handles              Map  \u003eR        R\n00400000  00001000 \u003e8_out           \u003e           PE header                Img  \u003eR       \nRWE Copy\u003e\n00401000  000E9000 \u003e8_out           \u003e.text      Code                     Img  \u003eR E     \nRWE Copy\u003e\n004EA000  00421000 \u003e8_out           \u003e.data      Data                     Img  \u003eRW \nCopy\u003eRWE Copy\u003e\n0090B000  00001000 \u003e8_out           \u003e/4                                  Img  \u003eR       \nRWE Copy\u003e\n0090C000  0000E000 \u003e8_out           \u003e/18                                 Img  \u003eR       \nRWE Copy\u003e\n0091A000  0000A000 \u003e8_out           \u003e/30                                 Img  \u003eR       \nRWE Copy\u003e\n00924000  0002B000 \u003e8_out           \u003e/43                                 Img  \u003eR       \nRWE Copy\u003e\n0094F000  00010000 \u003e8_out           \u003e/55                                 Img  \u003eR       \nRWE Copy\u003e\n0095F000  00003000 \u003e8_out           \u003e/71                                 Img  \u003eR       \nRWE Copy\u003e\n00962000  00001000 \u003e8_out           \u003e/87                                 Img  \u003eR       \nRWE Copy\u003e\n00963000  00001000 \u003e8_out           \u003e/102                                Img  \u003eR       \nRWE Copy\u003e\n00964000  00001000 \u003e8_out           \u003e.idata     Imports                  Img  \u003eRW \nCopy\u003eRWE Copy\u003e\n00965000  00001000 \u003e8_out           \u003e.edata     Exports                  Img  \u003eR       \nRWE Copy\u003e\n00966000  00001000 \u003e8_out           \u003e.symtab                             Img  \u003eR       \nRWE Copy\u003e\n00970000  000B5000 \u003e                \u003e                                    Map  \u003eR E     \nR E\n00C70000  00001000 \u003e                \u003e                                    Priv \u003eRW      \nRW\n00C80000  00001000 \u003e                \u003e                                    Priv \u003eRW      \nRW\n00C90000  00001000 \u003e                \u003e                                    Priv \u003eRW      \nRW\n00D10000  00005000 \u003e                \u003e                                    Priv \u003eRW      \nRW\n00D20000  00002000 \u003e                \u003e                                    Map  \u003eR       \nR        C:\\WINNT\\system32\\ctype.nls\n77570000  00001000 \u003ewinmm           \u003e           PE header                Img  \u003eR       \nRWE Copy\u003e\n77571000  0001F000 \u003ewinmm           \u003e.text      Code,imports,exports     Img  \u003eR E     \nRWE Copy\u003e\n77590000  00005000 \u003ewinmm           \u003e.data      Data                     Img  \u003eRW \nCopy\u003eRWE Copy\u003e\n77595000  00009000 \u003ewinmm           \u003e.rsrc      Resources                Img  \u003eR       \nRWE Copy\u003e\n7759E000  00002000 \u003ewinmm           \u003e.reloc     Relocations              Img  \u003eR       \nRWE Copy\u003e\n77D30000  00001000 \u003eRPCRT4          \u003e           PE header                Img  \u003eR       \nRWE Copy\u003e\n77D31000  00067000 \u003eRPCRT4          \u003e.text,.orp\u003eCode,imports,exports     Img  \u003eR E     \nRWE Copy\u003e\n77D98000  00002000 \u003eRPCRT4          \u003e.data      Data                     Img  \u003eRW      \nRWE Copy\u003e\n77D9A000  00001000 \u003eRPCRT4          \u003e.rsrc      Resources                Img  \u003eR       \nRWE Copy\u003e\n77D9B000  00004000 \u003eRPCRT4          \u003e.reloc     Relocations              Img  \u003eR       \nRWE Copy\u003e\n77E10000  00001000 \u003eUSER32          \u003e           PE header                Img  \u003eR       \nRWE Copy\u003e\n77E11000  00052000 \u003eUSER32          \u003e.text      Code,imports,exports     Img  \u003eR E     \nRWE Copy\u003e\n77E63000  00001000 \u003eUSER32          \u003e.data      Data                     Img  \u003eRW      \nRWE Copy\u003e\n77E64000  00008000 \u003eUSER32          \u003e.rsrc      Resources                Img  \u003eR       \nRWE Copy\u003e\n77E6C000  00003000 \u003eUSER32          \u003e.reloc     Relocations              Img  \u003eR       \nRWE Copy\u003e\n77F40000  00001000 \u003eGDI32           \u003e           PE header                Img  \u003eR       \nRWE Copy\u003e\n77F41000  00038000 \u003eGDI32           \u003e.text      Code,imports,exports     Img  \u003eR E     \nRWE Copy\u003e\n77F79000  00001000 \u003eGDI32           \u003e.data      Data                     Img  \u003eRW      \nRWE Copy\u003e\n77F7A000  00001000 \u003eGDI32           \u003e.rsrc      Resources                Img  \u003eR       \nRWE Copy\u003e\n77F7B000  00002000 \u003eGDI32           \u003e.reloc     Relocations              Img  \u003eR       \nRWE Copy\u003e\n77F80000  00001000 \u003entdll           \u003e           PE header                Img  \u003eR       \nRWE Copy\u003e\n77F81000  0004D000 \u003entdll           \u003e.text,ECOD\u003eCode,exports             Img  \u003eR E     \nRWE Copy\u003e\n77FCE000  00003000 \u003entdll           \u003e.data      Data                     Img  \u003eRW \nCopy\u003eRWE Copy\u003e\n77FD1000  00001000 \u003entdll           \u003eEDATA                               Img  \u003eRW \nCopy\u003eRWE Copy\u003e\n77FD2000  00027000 \u003entdll           \u003e.rsrc      Resources                Img  \u003eR       \nRWE Copy\u003e\n77FF9000  00003000 \u003entdll           \u003e.reloc     Relocations              Img  \u003eR       \nRWE Copy\u003e\n78000000  00001000 \u003emsvcrt          \u003e           PE header                Img  \u003eR       \nRWE Copy\u003e\n78001000  00031000 \u003emsvcrt          \u003e.text      Code                     Img  \u003eR E     \nRWE Copy\u003e\n78032000  00008000 \u003emsvcrt          \u003e.rdata     Imports,exports          Img  \u003eR       \nRWE Copy\u003e\n7803A000  00007000 \u003emsvcrt          \u003e.data      Data                     Img  \u003eRW \nCopy\u003eRWE Copy\u003e\n78041000  00001000 \u003emsvcrt          \u003e.rsrc      Resources                Img  \u003eR       \nRWE Copy\u003e\n78042000  00003000 \u003emsvcrt          \u003e.reloc     Relocations              Img  \u003eR       \nRWE Copy\u003e\n7C2D0000  00001000 \u003eADVAPI32        \u003e           PE header                Img  \u003eR       \nRWE Copy\u003e\n7C2D1000  0005A000 \u003eADVAPI32        \u003e.text      Code,imports,exports     Img  \u003eR E     \nRWE Copy\u003e\n7C32B000  00004000 \u003eADVAPI32        \u003e.data      Data                     Img  \u003eRW \nCopy\u003eRWE Copy\u003e\n7C32F000  00002000 \u003eADVAPI32        \u003e.rsrc      Resources                Img  \u003eR       \nRWE Copy\u003e\n7C331000  00004000 \u003eADVAPI32        \u003e.reloc     Relocations              Img  \u003eR       \nRWE Copy\u003e\n7C340000  00001000 \u003eSecur32         \u003e           PE header                Img  \u003eR       \nRWE Copy\u003e\n7C341000  0000B000 \u003eSecur32         \u003e.text      Code,imports,exports     Img  \u003eR E     \nRWE Copy\u003e\n7C34C000  00001000 \u003eSecur32         \u003e.data      Data                     Img  \u003eRW      \nRWE Copy\u003e\n7C34D000  00001000 \u003eSecur32         \u003e.rsrc      Resources                Img  \u003eR       \nRWE Copy\u003e\n7C34E000  00001000 \u003eSecur32         \u003e.reloc     Relocations              Img  \u003eR       \nRWE Copy\u003e\n7C570000  00001000 \u003eKERNEL32        \u003e           PE header                Img  \u003eR       \nRWE Copy\u003e\n7C571000  0005A000 \u003eKERNEL32        \u003e.text      Code,imports,exports     Img  \u003eR E     \nRWE Copy\u003e\n7C5CB000  00004000 \u003eKERNEL32        \u003e.data      Data                     Img  \u003eRW      \nRWE Copy\u003e\n7C5CF000  00051000 \u003eKERNEL32        \u003e.rsrc      Resources                Img  \u003eR       \nRWE Copy\u003e\n7C620000  00004000 \u003eKERNEL32        \u003e.reloc     Relocations              Img  \u003eR       \nRWE Copy\u003e\n7F6F0000  00007000 \u003e                \u003e                                    Map  \u003eR E     \nR E\n7FFB0000  00024000 \u003e                \u003e           Code pages               Map  \u003eR        R\n7FFDE000  00001000 \u003e                \u003e           Data block of main threa\u003ePriv \u003eRWE     \nRWE\n7FFDF000  00001000 \u003e                \u003e           Process Environment Bloc\u003ePriv \u003eRWE     \nRWE\n7FFE0000  00001000 \u003e                \u003e           User Shared Data         Priv \u003eR        R\n\nAs you can see, OS gave me address 0xd30000 which is right after end of program\n\n00D20000  00002000 \u003e                \u003e                                    Map  \u003eR       \nR        C:\\WINNT\\system32\\ctype.nls\n\nand before start of first dll\n\n77570000  00001000 \u003ewinmm           \u003e           PE header                Img  \u003eR       \nRWE Copy\u003e\n\nPerhaps, you will see that there is no hole big enough to fit 805306368 bytes.\nOtherwise, OS is lying when returns ERROR_NOT_ENOUGH_MEMORY and there is a different\nreason for failure. Perhaps, it is security related.\n\nAlex\u003c/pre\u003e",
	"user": {
		"login": "alexbrainman",
		"id": 9796621,
		"type": "User",
		"site_admin": false
	},
	"created_at": "2011-10-07T00:09:25Z",
	"updated_at": "2014-12-08T10:12:29Z"
}
